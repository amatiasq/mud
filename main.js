!function(e){function a(a){for(var t,i,s=a[0],l=a[1],c=a[2],d=0,m=[];d<s.length;d++)i=s[d],Object.prototype.hasOwnProperty.call(o,i)&&o[i]&&m.push(o[i][0]),o[i]=0;for(t in l)Object.prototype.hasOwnProperty.call(l,t)&&(e[t]=l[t]);for(u&&u(a);m.length;)m.shift()();return r.push.apply(r,c||[]),n()}function n(){for(var e,a=0;a<r.length;a++){for(var n=r[a],t=!0,s=1;s<n.length;s++){var l=n[s];0!==o[l]&&(t=!1)}t&&(r.splice(a--,1),e=i(i.s=n[0]))}return e}var t={},o={0:0},r=[];function i(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,a,n){i.o(e,a)||Object.defineProperty(e,a,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,a){if(1&a&&(e=i(e)),8&a)return e;if(4&a&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&a&&"string"!=typeof e)for(var t in e)i.d(n,t,function(a){return e[a]}.bind(null,t));return n},i.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(a,"a",a),a},i.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)},i.p="";var s=window.webpackJsonp=window.webpackJsonp||[],l=s.push.bind(s);s.push=a,s=s.slice();for(var c=0;c<s.length;c++)a(s[c]);var u=l;r.push([26,1]),n()}([,function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.concatRegexesUnescaped=a.concatRegexes=void 0;const t=e=>(...a)=>{const n=a.map(a=>a instanceof RegExp?a.toString().replace(/^\/|\/[gi]*$/g,""):e(a)).join(""),t=a.map(e=>e instanceof RegExp&&e.flags).filter(Boolean).join(""),o=[...new Set(t)].join("");return new RegExp(n,o)};function o(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/\n/g,"\\n")}a.concatRegexes=t(o),a.concatRegexesUnescaped=t(String)},,function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.createPlugin=void 0,a.createPlugin=function(e,a){return n=>a(e(n))}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.int=a.toInt=void 0;const t=n(1),o=/-?\d+(?:,\d{3})*/;a.toInt=function(e){return parseInt(e.replace(/,/g,""),10)},a.int=function(e){return e?t.concatRegexesUnescaped(`(?<${e}>`,o,")"):o}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.CancellablePromise=void 0;const t=n(0);class o extends Promise{constructor(e){const a=t.emitter(),n=a.subscribe;super((a,t)=>{e(e=>{(this.isPending||this.isCancelled)&&(this.state="resolved",a(e))},e=>{(this.isPending||this.isCancelled)&&(this.state="rejected",t(e))},n)}),this.state="pending",this.emitCancel=a,this.onCancel=n}static race(e){return new o((a,n,t)=>{e.forEach(e=>e.then(a,n)),t(()=>e.forEach(e=>e.cancel()))})}get isCancelled(){return"cancelled"===this.state}get isPending(){return"pending"===this.state}get isResolved(){return"resolved"===this.state}get isRejected(){return"rejected"===this.state}then(e,a){const n=super.then(e,a);return n.onCancel(()=>this.cancel()),this.onCancel(()=>n.cancel()),n}cancel(){this.isPending&&(this.state="cancelled",this.emitCancel())}}a.CancellablePromise=o},function(e,a,n){"use strict";var t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(a,"__esModule",{value:!0}),a.getSpell=a.getSpells=a.SPELL_LEARN_ORDER=a.SPELLS_BY_TYPE=a.SPELL_NOT_POSSIBLE=a.SPELL_ALREADY_APPLIED=a.SPELL_FAILED=a.weaponList=a.spellList=a.skillList=a.languageList=void 0;const o=n(1),r=n(4),i=t(n(36));a.languageList=i.default.filter(e=>"Idioma"===e.type),a.skillList=i.default.filter(e=>"Habilidad"===e.type),a.spellList=i.default.filter(e=>"Hechizo"===e.type),a.weaponList=i.default.filter(e=>"Arma"===e.type);const s=e=>o.concatRegexes(/Hechizo  : '/,e,/'  durante /,r.int("asaltos"),/ asaltos./),l=e=>a=>o.concatRegexes(/Hechizo  : '/,a,/' Afecta /,e,/ en /,r.int("cantidad"),/ durante /,r.int("asaltos"),/ asaltos./),c={armadura:{success:"Tu armadura brilla suavemente al ser mejorada por un conjuro.",target:/La armadura de (?<target>(?:\w+ )+)brilla suavemente al ser mejorada por un conjuro\./,end:"Tu armadura vuelve a su valor normal.",effect:l("armor class")},"atravesar puerta":{success:"Te vuelves translucido.",end:"Vuelves a tener un cuerpo solido.",effect:s},bendecir:{success:"Tu dios te otorga una poderosa bendicion.",end:"La bendicion desaparece.",effect:l("hit roll")},"causar critica":{target:/Tu conjuro [^\n]+ a(?<target>(?: \w+)+)!/},"causar grave":{target:/Tu conjuro [^\n]+ a(?<target>(?: \w+)+)!/},"causar leve":{target:/Tu conjuro [^\n]+ a(?<target>(?: \w+)+)!/},ceguera:{target:/Lanzas un conjuro de ceguera contra (?<target>[^.]+)./},"crear agua":{target:" esta lleno.\n"},"crear baya":{success:"Una baya brillante y dorada aparece en tus manos!"},"crear comida":{success:"Una seta magica aparece de repente."},"crear fuego":{success:"Una gran hoguera se enciende en el suelo delante tuyo."},"crear manantial":{success:"Trazas un circulo delante tuyo del cual emerge un manantial de agua cristalina.",end:"Un manantial magico se seca."},"curar criticas":{success:"Tus heridas mas graves se cierran y el dolor desaparece.",target:/Curas las heridas mas graves de (?<target>[^\.]+)\./},"curar graves":{success:"Tus heridas graves se cierran y el dolor desaparece.",target:/Curas las heridas graves de (?<target>[^\.]+)\./},"curar leves":{success:"Tus heridas leves se cierran y el dolor desaparece.",target:/Curas las heridas leves de (?<target>[^\.]+)\./},"curar veneno":{success:"Un agradable sensacion recorre tu cuerpo."},"detectar escondido":{success:"Tus sentidos cobran la viveza de los del mejor predador.",end:"Te sientes menos consciente de lo que te rodea.",effect:s},"detectar invisible":{success:"Tus ojos brillan, siendo capaces ahora de ver lo invisible.",end:"Ya no ves objetos invisibles.",effect:s},"detectar magia":{success:"Delgadas lineas azules reseguiran las siluetas de los objetos magicos que te encuentres.",end:"Las lineas azules desaparecen de tu vision",effect:s},"detectar maldad":{success:"Delgadas lineas rojas reseguiran las siluetas de los seres malvados que te encuentres.",effect:s,end:"Las lineas rojas desaparecen de tu vision."},"detectar trampas":{success:"De repente te sientes mas alerta de los peligros que te rodean.",end:"Te sientes menos alerta de los peligros que te rodean.",effect:s},"encantar arma":{success:" resplandece con destellos de energia azul."},"escudo hielo":{success:"Un torbellino de granizo te envuelve protectivamente.",effect:s},flotar:{success:"Empiezas a flotar a unos centimetros del suelo...",target:/\n(?<target>[^\n]+) empieza a flotar a unos centimetros del suelo\.\.\./,end:"Tus pies aterrizan suavemente en el suelo."},"fuerza vampirica":{success:"La fuerza de los vampiros fluye por tus venas...",end:"Tu musculos vuelven lentamente a su estado normal...",effect:l("fuerza")},"furia naturaleza":{success:"Sientes como la furia de la naturaleza te embarga..."},identificar:{target:/El objeto '(?<name>[^']+)' es un\(a\) (?<type>\w+), propiedades especiales: (?<properties>[^\n]+)\n/},invisibilidad:{success:"Te desvaneces en el aire.",target:/\n(?<target>[^\n]+) se desvanece en el aire./,end:"Ya no eres invisible.",effect:s},"invisibilidad grupo":{success:"Tu cuerpo se vuelve traslucido por un momento y luego se desvanece."},"invocar armadillo":{success:"Agitas tus brazos a la vez que te concentras para invocar un pequenyo armadillo."},"luz eterna":{success:"Rayos de luz iridiscente colisionan para formar una bola de luz eterna..."},"piel petrea":{success:"Tu piel se vuelve dura como la piedra, aunque flexible.",effect:l("armor class")},"piel robliza":{success:"Tu piel se oscurece a la vez que adquiere la dureza del roble.",end:"Tu piel vuelve a su estado normal...",effect:l("armor class")},polimorfar:{success:/Tu cuerpo empieza a cambiar... hasta transformarte en (?<result>[^!]+)!/,end:"Recuperas tu forma natural."},refrescar:{success:"Nueva vitalidad fluye hacia ti."},"respiracion acuatica":{success:"Tus pulmones ahora son capaces de respirar bajo agua...",target:/Los pulmones de (?<target>[^\n]+) ahora son capaces de respirar bajo agua\.\.\./,end:"Tus pulmones vuelven a su estado original.",effect:s},"retirar maldicion":{success:"Te sientes liberado de la maldicion."},santuario:{success:"Una aura luminosa se forma lentamente a tu alrededor.",end:"El aura luminosa alrededor tuyo se desvanece.",effect:s},terremoto:{success:"La tierra tiembla bajo tus pies!",target:"La tierra tiembla bajo tus pies!"},veneno:{target:/\n(?<target>[^\n]+)cobra un aspecto enfermizo cuando tu veneno se esparce por su cuerpo./},viajar:{target:"Salidas: "},"vista distancia":{success:"Tienes una vision reveladora...",target:/Los ojos de (?<target>[^\n]+) parecen estar mirando un lugar lejano\.\.\./,end:"Tu clarividencia te abandona...",effect:s},volar:{success:"Te elevas entre las corrientes de aire...",target:/\n(?<target>[^\n]+) se eleva entre las corrientes de aire.../,end:"Aterrizas suavemente en el suelo.",effect:s}},u=a.spellList.map(e=>({...e,...c[e.name]||{}}));a.SPELL_FAILED=["Algo te distrae y pierdes la concentracion.","Has perdido la concentracion.","Has tenido una laguna mental mientras invocabas el hechizo.","Pierdes la concentracion.","Un picor en la nariz te impide mantener la concentracion.","Un pinchazo en tu pierna te impide lanzar el conjuro adecuadamente.","Una mota de polvo en el ojo rompe tu concentracion por un momento."],a.SPELL_ALREADY_APPLIED=["Has fallado.","Eso no parece tener ningun efecto."],a.SPELL_NOT_POSSIBLE=["No esta aqui.","Falta algo...","No tienes suficiente mana.","Sobre que quieres lanzar este conjuro?","No puedes encontrar ningun ","Este estilo de lucha pide demasiado atencion para hacer eso!","Este asalto del combate es demasiado febril para concentrarte adecuadamente.","No has tenido suficiente tiempo en este asalto para completar el conjuro.","Estas demasiado malherido para hacer eso.","Estas demasiado aturdido para hacer eso.","Tu armadura metalica no te permite concentrarte para hacer magia."],a.SPELLS_BY_TYPE={food:["saciar hambre","crear comida"],water:["crear manantial","crear agua"],movement:["volar","flotar"],heal:["curar criticas","curar graves","curar leves"],invisibility:["invisibilidad grupo","invisibilidad"],massAttack:["terremoto"],attack:["causar critica","causar grave","causar leve"],attackAlternative:["agarron impactante","relampago","bola fuego","misil magico"],dedope:["ceguera","veneno","disipar magia","disipar maldad","maldecir","proteccion","fuego espectral","debilitar"],pet:["invocar oso","invocar jaguar","invocar lobo","invocar aguila","invocar lince","invocar armadillo"]},a.SPELL_LEARN_ORDER=[a.SPELLS_BY_TYPE.food,a.SPELLS_BY_TYPE.water,a.SPELLS_BY_TYPE.dedope,"luz eterna","invisibilidad","invocar armadillo","armadura","bendecir","detectar escondido","detectar invisible","detectar magia",a.SPELLS_BY_TYPE.movement,"curar ceguera",a.SPELLS_BY_TYPE.heal,"refrescar",a.SPELLS_BY_TYPE.attack,"crear fuego"],a.getSpells=function(){return u},a.getSpell=function(e){const n=e.toLowerCase(),t=a.spellList.find(e=>e.name.startsWith(n));if(!t)throw new Error("Unknown spell "+e);const o=t&&c[t.name];return o?{...t,...o,effect:"function"==typeof o.effect?o.effect(t.name):o.effect}:t}},,,function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.getMobIn=a.getMobFromPresence=a.getMobsPresence=a.MOB_DIES=a.MOB_LEAVES=a.MOB_ARRIVES=a.ATTACK_RECEIVED=void 0;const t=n(1),o=/(?:(?:un|una|el|la|los|las|unos|unas) )?/,r=/(?<mob>(?: |\w|-)+)/,i=["armadillo","lince"],s=Object.entries({clegg:"El carnicero demente saca espuma por la boca mientras parte la carne.",edmund:"Un hombre pequenyo y rechoncho yace aturdido en el suelo.",devrel:"Un hombre desnudo yace sobre sus propios excrementos.",kivon:"Kivon, el líder del culto, no está nada contento con intromisiones.",mariah:"Una joven esta aqui sentada y canta suavemente para si.",nejane:"Nejane, la líder, parece estar en trance.",silus:"Un delgado elfo, el propietario del establecimiento, te mira fijamente.",adorador:["Un adorador mira con cólera a su alrededor.","Un devoto adorador mira con cólera a su alrededor."],aguila:["Una enorme aguila esta aqui profundamente dormido.","Una gigantesca aguila vuela a tu alrededor."],anciano:"Un marchito anciano deambula por los pasillos vigilando.",atontada:"Una granjera atontada mira hacia ningun lugar.",atontado:"Un granjero atontado tropieza por aqui.",bicho:"Un asqueroso bicho se fija en ti nada mas verte.",buitre:"Un buitre carronyero esta aqui.",calamar:"Un calamar gigante esta aqui nadando.",caracol:"Un pequenyo caracol esta aqui haciendo trompos.",ciervo:null,ciudadano:"El pobre ciudadano esta tan absorto en su pena que no te advierte.",cliente:"Un cliente muy serio se sienta silenciosamente en una de las grandes mesas.",conejo:null,criatura:["Una poderosa criatura del pantano esta aqui profundamente dormido."],cubo:"Un enorme cubo transparente de materia gelatinosa rezuma ante ti.",cultista:["Una joven cultista parece bastante serena, mientras no vea a nadie m"],dragon:null,empleado:null,engendro:"Un deforme humano, un engendro de la magia, quiere descargar su agresividad.",espiritu:"Un espíritu se desliza por el aire.",esqueleto:["El esqueleto hace castanyetear sus dientes amenazadoramente y se acerca!","Un esqueleto con armadura avanza torpemente a traves de los arboles.","Un esqueleto huesudo esta aqui profundamente dormido.","Un esqueleto polvoriento esta aqui."],fanatico:["Un humano poseído por el fanatismo busca 'herejes'.","Una figura humanoide resplandece detras de un brillante campo de fuerza."],gusano:["Un gusano de roca esta aqui profundamente dormido.",/Un monstruoso gusano de hielo excava a traves del hielo y la nieve aqui\. Se yergue y\s+ataca!/],hobgoblin:["un guardia hobgoblin de elite esta aqui profundamente dormido.","Un hobgoblin armado esta aqui, interrogando a un prisionero.","Un macizo hobgoblin esta de guardia cerca del hueco de la escalera.","Un guardian de la montaña esta aquí, echando espuma por la boca."],hombre:"Un salvaje hombre, medio desnudo, te mira con ansiedad.",gnoll:"un gnoll feo esta aqui profundamente dormido.",goblin:["Un alegre goblin cacarea maniaticamente.","un goblin negrero esta aqui profundamente dormido.","Un habitante del bosque merodea por aqui, protegiendo su montanya.","Un macizo chaman goblin esta aqui rugiendo a sus lacayos.","Un pequenyo, pero fuerte goblin se arrastra por las cabanyas."],guardia:["Un Guardia Real está aquí velando por la seguridad del estadio","Un guardia del pueblo vaga a ciegas."],guerrero:"Un guerrero asqueroso grunye al verte.",jefe:["Un jefe esta aqui descansando.","Un jefe orco esta aqui mirandote desconfiado.","Un macizo chaman goblin esta aqui rugiendo a sus lacayos."],ladron:["Un cauteloso ladron busca algo valioso por la ciudad.","Un ladron esta aqui profundamente dormido.","Un ladron te mira desconfiado.","Una extraña figura se mueve furtivamente.",/Tu ataque causa .* a un ladron!/],lobo:["Un gran lobo negro, te muestra los colmillos hambriento.","Un lobo blanco como la nieve del tamanyo de una vaca grunye amenzadoramente.","Un lobo feroz esta aqui y grunye muy enojado.","Un lobo hambriento te esta mirando"],mago:["Un mago viejo esta aqui profundamente dormido.","Un anciano con ropajes de mago, pregona sus mercancias."],merodeador:null,murcielago:null,ogro:["el capitan ogro esta aqui profundamente dormido.","Un gigantesco ogro juega con una enorme roca lanzandola al aire."],orco:["El arquero orco esta aqui profundamente dormido.","El capitan orco te observa con sus ojos llenos de furia.","El chaman esta sentado detras de un escritorio, escribiendo una misiva.","El desagradable y malioliente espadachin orco esta aqui.","el jefe orco minero esta aqui profundamente dormido.","El orco espadachin llega desde el este.","Un asqueroso arquero orco esta aqui.","Un corpulento orco esta aqui de guardia.","un guardia orco esta aqui profundamente dormido.","Un jefe orco esta aqui profundamente dormido.","Un ogro centinela esta de guardia delante de la puerta norte.","un orco centinela esta aqui profundamente dormido.","Un orco esta de pie al lado de la ballesta.","Un orco fuera de servicio esta sentado aqui jugando a ","un orco minero esta aqui profundamente dormido.","Un orco que se ve fiero, grune y oscila su arma hacia tu cabeza","Un orco salvaje gruñe y prepara sus armas.","Un pequenyo orco se sienta en una de las sillas roncando.","Un sargento orco mantiene vigilada la chusma a la que comanda.","Un voluminoso cocinero orco sopesa un cuchillo de carnicero manchado de sangre.",/El orco espadachin esta aqui profundamente dormido\./i],oso:"Un oso pardo se mueve pesadamente detras de la mesa, hay sangre en su piel.",pantera:null,picara:"Una picara sale de las sombras y te ataca!",piranya:["Una piranya te mira con su enorme boca.",/Una piranya esta aqui profundamente dormido\./i],rana:"Una rana enorme croa furiosamente.",rata:"Una rata gigante esta aqui profundamente dormido.",sapo:"un sapo gigante esta aqui profundamente dormido.",sacerdotisa:"Una voluptuosa mujer desnuda se postra ante su dios lujuriosamente.",serpiente:"Una serpiente que parece venenosa te mira fijamente.","uruk-hai":["Un asqueroso arquero uruk-hai tensa su arco al verte.","Un superior uruk-hai esta aqui vigilando."],troll:"Un troll de mas de 3 metros de alto esta destrozando el mobiliario.",viejo:"Un harapiento y despeinado viejo llora sentado en el suelo.",zombie:"Un zombie se acerca hacia ti con los brazos extendidos."}).map(([e,a])=>({name:e,presence:a}));a.ATTACK_RECEIVED=[/Tu ataque \w+ a un (?<mob>ladron)./,t.concatRegexes(/El \w+ de /,o,r,/ te /)],a.MOB_ARRIVES=t.concatRegexes(o,r,/ llega desde el (?<direction>\w+)/),a.MOB_LEAVES=t.concatRegexes(o,r,/ (?:se va)|(?:vuela) hacia (?:el )?(?<direction>\w+)/),a.MOB_DIES=t.concatRegexes(o,r,/ ha MUERTO!!/),a.getMobsPresence=function(){return s.map(e=>e.presence).flat().filter(Boolean)},a.getMobFromPresence=function(e){return s.filter(e=>e.presence).find(({presence:a})=>Array.isArray(a)?e.some(e=>a.includes(e)):e.includes(a))},a.getMobIn=function(e){const a=e.toLowerCase();if(i.some(e=>a.includes(e)))return null;const n=s.find(e=>a.includes(e.name));return n||console.warn(`Unknown sustantive for "${e}"`),n}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.getItemSustantive=a.ITEM_SUSTANTIVES=a.UNWEAR=a.WEAR=a.ITEM_ARTICLE=void 0;const t=n(1);a.ITEM_ARTICLE=/(?: (?:un|una|el|la|los|las|unos|unas))?/,a.WEAR=["Te colocas ","Te pones ","Metes las piernas ","Vistes ","Usas "],a.UNWEAR=t.concatRegexes(/Dejas de usar/,a.ITEM_ARTICLE,/ (?<item>[^.]+?)\./),a.ITEM_SUSTANTIVES=["amuleto","anillo","anteojos","armadura","baculo","baston","bola","botas","brazal","brazalete","brazaletes","brigandina","capa","capote","casco","cetro","cinto","cinturon","cinturón","coderas","colgante","collar","coraza","cota","cubrepiernas","daga","escudo","espada","faja","faldones","grebas","guanteletes","guantes","hacha","lanza","luz","máscara","mangas","manoplas","martillo","maza","mocasines","pendiente","perneras","peto","pica","placa","polainas","pulsera","ropaje","sentido","sombrero","tobillera","vara","varita","visera","yelmo"],a.getItemSustantive=function(e){const n=e.toLowerCase(),t=a.ITEM_SUSTANTIVES.find(e=>n.includes(e));return t||(console.warn("Unknown item sustantive:",e),null)}},,function(e,a,n){"use strict";var t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(a,"__esModule",{value:!0}),a.render=a.html=void 0;const o=n(78);Object.defineProperty(a,"render",{enumerable:!0,get:function(){return o.render}});const r=t(n(79));a.html=r.default.bind(o.h)},function(e,a,n){"use strict";var t=n(7),o=n.n(t),r=n(8),i=n.n(r),s=n(25),l=i()(o.a);l.i(s.a),l.push([e.i,"body {\n  --background-color: #1c1c1c;\n  --border-color: #484848;\n  --control-color: white;\n  --color: white;\n  background-color: black;\n  color: white;\n}\n\n.container {\n  height: 100%;\n  display: grid;\n  grid-template-rows: 1fr;\n  grid-template-columns: 1fr;\n  grid-template-areas: 'terminal';\n}\n\n.container.show-controls {\n  grid-template-columns: 1fr 1fr;\n}\n\n.container.show-controls:not(.top) {\n  grid-template-areas:\n    'terminal sidebar'\n    'controls sidebar';\n}\n\n.container.show-controls.top {\n  grid-template-areas:\n    'controls sidebar'\n    'terminal sidebar';\n}\n\n.container:not(.show-controls) .sidebar,\n.container:not(.show-controls) .controls {\n  display: none;\n}\n\n.container.show-controls:not(.top) .controls:empty {\n  border-top: 1px solid var(--border-color);\n}\n\n.container.show-controls.top .controls:empty {\n  border-bottom: 1px solid var(--border-color);\n}\n\n/* TERMINAL */\n\n.terminal {\n  min-width: 700px;\n  grid-area: terminal;\n  overflow-x: hidden;\n  overflow-y: auto;\n  -ms-overflow-style: none; /* IE and Edge */\n  scrollbar-width: none; /* Firefox */\n  display: flex;\n  flex-direction: column-reverse;\n  padding: 0 0.5em;\n}\n\n.terminal::-webkit-scrollbar {\n  display: none;\n}\n\n.terminal p {\n  margin: 1em 0;\n}\n\n.terminal input {\n  background-color: transparent;\n  border: none;\n  color: white;\n  display: inline-block;\n  font-family: monospace;\n  outline: none;\n}\n\n/* CONTROLS */\n\n.controls {\n  grid-area: controls;\n  background-color: var(--background-color);\n  display: flex;\n  align-items: stretch;\n  height: 30px;\n}\n\n.controls .meters {\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n  flex: 1;\n}\n\n.controls .meters .meter {\n  flex: 1;\n}\n\n.controls .meter .bar {\n  height: 100%;\n}\n\n/* SIDEBAR */\n\n.sidebar {\n  grid-area: sidebar;\n  background-color: var(--background-color);\n  border-left: 1px solid var(--border-color);\n  display: flex;\n  flex-direction: column-reverse;\n  align-items: stretch;\n  overflow-y: auto;\n}\n\n.sidebar .title {\n  text-align: center;\n  text-transform: uppercase;\n}\n\n.sidebar .workflow-list {\n  list-style: none;\n  margin-bottom: 0;\n  padding: 0;\n}\n\n.sidebar .workflow {\n  border-top: 1px solid var(--border-color);\n}\n.sidebar .workflow.running {\n  color: gray;\n}\n.sidebar .workflow.disabled .workflow-content {\n  opacity: 0.5;\n}\n\n.sidebar .workflow header {\n  display: flex;\n  align-items: center;\n  padding: 1rem;\n}\n\n.sidebar .workflow .name {\n  flex: 1;\n  margin: 0 0.5rem;\n  font-size: 1.4rem;\n  font-family: monospace;\n  text-transform: uppercase;\n  font-weight: normal;\n}\n\n.sidebar .action {\n  appearance: none;\n  background: none;\n  border: none;\n  outline: none;\n  margin: 0;\n  padding: 3px;\n  color: var(--control-color);\n  font-size: 0.9rem;\n  transition: opacity 0.1s ease-in-out;\n  text-align: center;\n  opacity: 0.8;\n}\n.sidebar .action:hover {\n  opacity: 1;\n}\n.sidebar .action:active {\n  opacity: 0.5;\n}\n\n.sidebar .workflow .triggers:not(:empty) {\n  max-height: 25vh;\n  overflow-y: auto;\n  list-style: square;\n  border-top: 1px solid var(--border-color);\n}\n\n.sidebar .workflow .trigger {\n  display: flex;\n  flex-direction: column;\n}\n\n.sidebar .workflow .pattern {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.sidebar .workflow .pattern.blink {\n  animation: highlight 0.3s linear;\n}\n\n.sidebar .action.enable-control:hover i:first-child,\n.sidebar .action.enable-control:not(:hover) i:last-child,\n.sidebar .workflow.running .run,\n.sidebar .workflow:not(.running) .stop,\n.sidebar .workflow:not(.expanded) .triggers {\n  display: none;\n}\n\n@keyframes highlight {\n  0% {\n    background-color: transparent;\n    color: inherit;\n  }\n  10% {\n    background-color: #aa0000;\n    color: #ffffff;\n  }\n  100% {\n    background-color: transparent;\n    color: inherit;\n  }\n}\n\n/* HAMBURGER */\n\n.hamburger {\n  display: inline-block;\n  position: absolute;\n  top: 24px;\n  right: 40px;\n  z-index: 1;\n  -webkit-user-select: none;\n  user-select: none;\n}\n\n.hamburger input {\n  display: block;\n  width: 40px;\n  height: 32px;\n  position: absolute;\n  top: -7px;\n  left: -5px;\n  cursor: pointer;\n  opacity: 0; /* hide this */\n  z-index: 2; /* and place it over the hamburger */\n  -webkit-touch-callout: none;\n}\n\n.hamburger span {\n  display: block;\n  width: 33px;\n  height: 4px;\n  margin-bottom: 5px;\n  position: relative;\n  background: #cdcdcd;\n  border-radius: 3px;\n  z-index: 1;\n  transform-origin: center right;\n  transition: transform 0.5s cubic-bezier(0.77, 0.2, 0.05, 1),\n    background 0.5s cubic-bezier(0.77, 0.2, 0.05, 1), opacity 0.55s ease;\n}\n\n/*\n * Transform all the slices of hamburger\n * into a crossmark.\n */\n.hamburger input:checked ~ span:nth-of-type(2) {\n  opacity: 0;\n  transform: rotate(0deg) scale(0.2, 0.2);\n}\n\n.hamburger input:checked ~ span:first-of-type {\n  transform: rotate(-45deg) translate(0, -4px);\n}\n\n.hamburger input:checked ~ span:last-of-type {\n  transform: rotate(45deg) translate(0, 4px);\n}\n","",{version:3,sources:["webpack://src/ui/index.css"],names:[],mappings:"AAEA;EACE,2BAA2B;EAC3B,uBAAuB;EACvB,sBAAsB;EACtB,cAAc;EACd,uBAAuB;EACvB,YAAY;AACd;;AAEA;EACE,YAAY;EACZ,aAAa;EACb,uBAAuB;EACvB,0BAA0B;EAC1B,+BAA+B;AACjC;;AAEA;EACE,8BAA8B;AAChC;;AAEA;EACE;;sBAEoB;AACtB;;AAEA;EACE;;sBAEoB;AACtB;;AAEA;;EAEE,aAAa;AACf;;AAEA;EACE,yCAAyC;AAC3C;;AAEA;EACE,4CAA4C;AAC9C;;AAEA,aAAa;;AAEb;EACE,gBAAgB;EAChB,mBAAmB;EACnB,kBAAkB;EAClB,gBAAgB;EAChB,wBAAwB,EAAE,gBAAgB;EAC1C,qBAAqB,EAAE,YAAY;EACnC,aAAa;EACb,8BAA8B;EAC9B,gBAAgB;AAClB;;AAEA;EACE,aAAa;AACf;;AAEA;EACE,aAAa;AACf;;AAEA;EACE,6BAA6B;EAC7B,YAAY;EACZ,YAAY;EACZ,qBAAqB;EACrB,sBAAsB;EACtB,aAAa;AACf;;AAEA,aAAa;;AAEb;EACE,mBAAmB;EACnB,yCAAyC;EACzC,aAAa;EACb,oBAAoB;EACpB,YAAY;AACd;;AAEA;EACE,aAAa;EACb,sBAAsB;EACtB,oBAAoB;EACpB,OAAO;AACT;;AAEA;EACE,OAAO;AACT;;AAEA;EACE,YAAY;AACd;;AAEA,YAAY;;AAEZ;EACE,kBAAkB;EAClB,yCAAyC;EACzC,0CAA0C;EAC1C,aAAa;EACb,8BAA8B;EAC9B,oBAAoB;EACpB,gBAAgB;AAClB;;AAEA;EACE,kBAAkB;EAClB,yBAAyB;AAC3B;;AAEA;EACE,gBAAgB;EAChB,gBAAgB;EAChB,UAAU;AACZ;;AAEA;EACE,yCAAyC;AAC3C;AACA;EACE,WAAW;AACb;AACA;EACE,YAAY;AACd;;AAEA;EACE,aAAa;EACb,mBAAmB;EACnB,aAAa;AACf;;AAEA;EACE,OAAO;EACP,gBAAgB;EAChB,iBAAiB;EACjB,sBAAsB;EACtB,yBAAyB;EACzB,mBAAmB;AACrB;;AAEA;EACE,gBAAgB;EAChB,gBAAgB;EAChB,YAAY;EACZ,aAAa;EACb,SAAS;EACT,YAAY;EACZ,2BAA2B;EAC3B,iBAAiB;EACjB,oCAAoC;EACpC,kBAAkB;EAClB,YAAY;AACd;AACA;EACE,UAAU;AACZ;AACA;EACE,YAAY;AACd;;AAEA;EACE,gBAAgB;EAChB,gBAAgB;EAChB,kBAAkB;EAClB,yCAAyC;AAC3C;;AAEA;EACE,aAAa;EACb,sBAAsB;AACxB;;AAEA;EACE,mBAAmB;EACnB,gBAAgB;EAChB,uBAAuB;AACzB;;AAEA;EACE,gCAAgC;AAClC;;AAEA;;;;;EAKE,aAAa;AACf;;AAEA;EACE;IACE,6BAA6B;IAC7B,cAAc;EAChB;EACA;IACE,yBAAyB;IACzB,cAAc;EAChB;EACA;IACE,6BAA6B;IAC7B,cAAc;EAChB;AACF;;AAEA,cAAc;;AAEd;EACE,qBAAqB;EACrB,kBAAkB;EAClB,SAAS;EACT,WAAW;EACX,UAAU;EACV,yBAAyB;EACzB,iBAAiB;AACnB;;AAEA;EACE,cAAc;EACd,WAAW;EACX,YAAY;EACZ,kBAAkB;EAClB,SAAS;EACT,UAAU;EACV,eAAe;EACf,UAAU,EAAE,cAAc;EAC1B,UAAU,EAAE,oCAAoC;EAChD,2BAA2B;AAC7B;;AAEA;EACE,cAAc;EACd,WAAW;EACX,WAAW;EACX,kBAAkB;EAClB,kBAAkB;EAClB,mBAAmB;EACnB,kBAAkB;EAClB,UAAU;EACV,8BAA8B;EAC9B;wEACsE;AACxE;;AAEA;;;EAGE;AACF;EACE,UAAU;EACV,uCAAuC;AACzC;;AAEA;EACE,4CAA4C;AAC9C;;AAEA;EACE,0CAA0C;AAC5C",sourcesContent:["@import '../../node_modules/normalize.css/normalize.css';\n\nbody {\n  --background-color: #1c1c1c;\n  --border-color: #484848;\n  --control-color: white;\n  --color: white;\n  background-color: black;\n  color: white;\n}\n\n.container {\n  height: 100%;\n  display: grid;\n  grid-template-rows: 1fr;\n  grid-template-columns: 1fr;\n  grid-template-areas: 'terminal';\n}\n\n.container.show-controls {\n  grid-template-columns: 1fr 1fr;\n}\n\n.container.show-controls:not(.top) {\n  grid-template-areas:\n    'terminal sidebar'\n    'controls sidebar';\n}\n\n.container.show-controls.top {\n  grid-template-areas:\n    'controls sidebar'\n    'terminal sidebar';\n}\n\n.container:not(.show-controls) .sidebar,\n.container:not(.show-controls) .controls {\n  display: none;\n}\n\n.container.show-controls:not(.top) .controls:empty {\n  border-top: 1px solid var(--border-color);\n}\n\n.container.show-controls.top .controls:empty {\n  border-bottom: 1px solid var(--border-color);\n}\n\n/* TERMINAL */\n\n.terminal {\n  min-width: 700px;\n  grid-area: terminal;\n  overflow-x: hidden;\n  overflow-y: auto;\n  -ms-overflow-style: none; /* IE and Edge */\n  scrollbar-width: none; /* Firefox */\n  display: flex;\n  flex-direction: column-reverse;\n  padding: 0 0.5em;\n}\n\n.terminal::-webkit-scrollbar {\n  display: none;\n}\n\n.terminal p {\n  margin: 1em 0;\n}\n\n.terminal input {\n  background-color: transparent;\n  border: none;\n  color: white;\n  display: inline-block;\n  font-family: monospace;\n  outline: none;\n}\n\n/* CONTROLS */\n\n.controls {\n  grid-area: controls;\n  background-color: var(--background-color);\n  display: flex;\n  align-items: stretch;\n  height: 30px;\n}\n\n.controls .meters {\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n  flex: 1;\n}\n\n.controls .meters .meter {\n  flex: 1;\n}\n\n.controls .meter .bar {\n  height: 100%;\n}\n\n/* SIDEBAR */\n\n.sidebar {\n  grid-area: sidebar;\n  background-color: var(--background-color);\n  border-left: 1px solid var(--border-color);\n  display: flex;\n  flex-direction: column-reverse;\n  align-items: stretch;\n  overflow-y: auto;\n}\n\n.sidebar .title {\n  text-align: center;\n  text-transform: uppercase;\n}\n\n.sidebar .workflow-list {\n  list-style: none;\n  margin-bottom: 0;\n  padding: 0;\n}\n\n.sidebar .workflow {\n  border-top: 1px solid var(--border-color);\n}\n.sidebar .workflow.running {\n  color: gray;\n}\n.sidebar .workflow.disabled .workflow-content {\n  opacity: 0.5;\n}\n\n.sidebar .workflow header {\n  display: flex;\n  align-items: center;\n  padding: 1rem;\n}\n\n.sidebar .workflow .name {\n  flex: 1;\n  margin: 0 0.5rem;\n  font-size: 1.4rem;\n  font-family: monospace;\n  text-transform: uppercase;\n  font-weight: normal;\n}\n\n.sidebar .action {\n  appearance: none;\n  background: none;\n  border: none;\n  outline: none;\n  margin: 0;\n  padding: 3px;\n  color: var(--control-color);\n  font-size: 0.9rem;\n  transition: opacity 0.1s ease-in-out;\n  text-align: center;\n  opacity: 0.8;\n}\n.sidebar .action:hover {\n  opacity: 1;\n}\n.sidebar .action:active {\n  opacity: 0.5;\n}\n\n.sidebar .workflow .triggers:not(:empty) {\n  max-height: 25vh;\n  overflow-y: auto;\n  list-style: square;\n  border-top: 1px solid var(--border-color);\n}\n\n.sidebar .workflow .trigger {\n  display: flex;\n  flex-direction: column;\n}\n\n.sidebar .workflow .pattern {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.sidebar .workflow .pattern.blink {\n  animation: highlight 0.3s linear;\n}\n\n.sidebar .action.enable-control:hover i:first-child,\n.sidebar .action.enable-control:not(:hover) i:last-child,\n.sidebar .workflow.running .run,\n.sidebar .workflow:not(.running) .stop,\n.sidebar .workflow:not(.expanded) .triggers {\n  display: none;\n}\n\n@keyframes highlight {\n  0% {\n    background-color: transparent;\n    color: inherit;\n  }\n  10% {\n    background-color: #aa0000;\n    color: #ffffff;\n  }\n  100% {\n    background-color: transparent;\n    color: inherit;\n  }\n}\n\n/* HAMBURGER */\n\n.hamburger {\n  display: inline-block;\n  position: absolute;\n  top: 24px;\n  right: 40px;\n  z-index: 1;\n  -webkit-user-select: none;\n  user-select: none;\n}\n\n.hamburger input {\n  display: block;\n  width: 40px;\n  height: 32px;\n  position: absolute;\n  top: -7px;\n  left: -5px;\n  cursor: pointer;\n  opacity: 0; /* hide this */\n  z-index: 2; /* and place it over the hamburger */\n  -webkit-touch-callout: none;\n}\n\n.hamburger span {\n  display: block;\n  width: 33px;\n  height: 4px;\n  margin-bottom: 5px;\n  position: relative;\n  background: #cdcdcd;\n  border-radius: 3px;\n  z-index: 1;\n  transform-origin: center right;\n  transition: transform 0.5s cubic-bezier(0.77, 0.2, 0.05, 1),\n    background 0.5s cubic-bezier(0.77, 0.2, 0.05, 1), opacity 0.55s ease;\n}\n\n/*\n * Transform all the slices of hamburger\n * into a crossmark.\n */\n.hamburger input:checked ~ span:nth-of-type(2) {\n  opacity: 0;\n  transform: rotate(0deg) scale(0.2, 0.2);\n}\n\n.hamburger input:checked ~ span:first-of-type {\n  transform: rotate(-45deg) translate(0, -4px);\n}\n\n.hamburger input:checked ~ span:last-of-type {\n  transform: rotate(45deg) translate(0, 4px);\n}\n"],sourceRoot:""}]),a.a=l},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.singleExecution=void 0,a.singleExecution=function(e){let a=null;return()=>a||(a=e().then(e=>(a=null,e)),a)}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.promptPlugin=a.PROMPT_DETECTOR=void 0;const t=n(0),o=n(3),r=n(1),i=n(4),s=["&W<","&R%h/%Hhp ","&C%m/%Mm ","&G%v/%Vmv ","&P%Xxp ","&Y%gg ","&W&0%d","&W> ","&W%A ","\n"].join(""),l=s.replace("&W>"," &R%E&W>"),c=e=>r.concatRegexes(i.int(e+"Curr"),"/",i.int(e+"Total"),e+" ");a.PROMPT_DETECTOR=r.concatRegexes(/</,c("hp"),c("m"),c("mv"),i.int("exp"),/xp /,i.int("gold"),/g /,i.int("favor"),/( \((?<enemy>\d+)%\))?/,/> (?<invis>I)?/);class u{constructor(){this.total=0,this.current=0}get percent(){const e=this.total?1/this.total*this.current:0;return Math.round(100*e)/100}}const d={hp:new u,mana:new u,mv:new u,exp:0,gold:0,enemy:null,get isFighting(){return null!==d.enemy}};a.promptPlugin=o.createPlugin(({when:e,write:n})=>{let o=!1;const r=t.emitter();return e(a.PROMPT_DETECTOR).timeout(1).catch((function(){n("prompt "+s),n("fprompt "+l)})).finally(()=>{e(a.PROMPT_DETECTOR,({groups:e})=>{d.hp.current=i.toInt(e.hpCurr),d.hp.total=i.toInt(e.hpTotal),d.mana.current=i.toInt(e.mCurr),d.mana.total=i.toInt(e.mTotal),d.mv.current=i.toInt(e.mvCurr),d.mv.total=i.toInt(e.mvTotal),d.exp=i.toInt(e.exp),d.gold=i.toInt(e.gold),d.enemy=e.enemy?i.toInt(e.enemy):null,o=Boolean(e.invis),r(d)})}),{getIsInvisible:()=>o,onUpdate:r.subscribe}},({getIsInvisible:e,onUpdate:n})=>({when:t})=>{return{getPercent:function(e){return d[e].percent},getValue:function(e){return d[e]},until:o,whenFresh:function(){return o(e=>(console.log(e.hp.percent,e.mana.percent,e.mv.percent,1===e.hp.percent&&1===e.mana.percent&&1===e.mv.percent),1===e.hp.percent&&1===e.mana.percent&&1===e.mv.percent))},onUpdate:n,get isFighting(){return d.isFighting},get isInvisible(){return e()}};function o(e){return e?e(d)?Promise.resolve(!0):new Promise(a=>{const t=n(n=>{e(n)&&(t(),a(n))})}):t(a.PROMPT_DETECTOR)}})},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.conversation=void 0,a.conversation=function(e,a){return async n=>{for(const[t,o]of Object.entries(n))await e(t),a(o)}}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.getPassword=void 0;const t=n(2);a.getPassword=function(e){const a=new t.ClientStorage("pass:"+e),n=a.get();if(n)return n;const o=prompt("Password for "+e);if(!o)throw new Error("Password required");return a.set(o),o}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.BasicContextCreator=void 0;const t=n(0),o=n(5),r=n(19);a.BasicContextCreator=class{constructor(e,a){this.triggers=e,this.send=a,this.dispositions=new Map,this.emitInstanceAborted=t.emitter(),this.onInstanceAborted=this.emitInstanceAborted.subscribe,this.emitInstanceDisposed=t.emitter(),this.onInstanceDisposed=this.emitInstanceDisposed.subscribe}get triggerList(){return this.triggers.list}onTriggersChange(e){return this.triggers.onChange(e)}createInstance(e){const{checkNotAborted:a,send:n,triggers:i}=this,s=t.emitter(),l=[];let c=!1,u=!1;const d={get name(){return e},get isAborted(){return u},get isPrintingLogs(){return c},get printLogs(){return c=!0},onDispose:s.subscribe,send:n,log:m,when:Object.assign((function(e,n,t){a(d),m("[WATCH]",e,t),"function"!=typeof n&&arguments.length>1&&(t=n,n=void 0);if(c){if(t&&t.logger)throw new Error("run after not supported");t=Object.assign({logger:[({patterns:e,...a})=>m("[TRIG GERED]",...e,a)]},t)}const o="function"==typeof n?i.add(e,n,t):i.add(e,t);return l.push(o),o}),{any:async function(...e){const a=await Promise.any(e);return e.forEach(e=>e instanceof o.CancellablePromise?e.cancel():e.unsubscribe()),a}}),sleep:e=>(a(d),m("[SLEEP]",e),r.wait(e)),abort:()=>{u||(u=!0,this.emitInstanceAborted(d))},write:(e,t)=>{a(d),m("[WRITE]",e),n(e,t)}};return s.subscribe(()=>l.forEach(e=>e.unsubscribe())),this.dispositions.set(d,s),d;function m(...n){a(d),c&&console.log(`[${e}]`,...n)}}dispose(e){const a=this.dispositions.get(e);if(!a)throw new Error("Can't dispose context: "+e.name);this.dispositions.delete(e),a(),this.emitInstanceDisposed(e)}checkNotAborted(e){if(e.isAborted)throw new Error(`[${e.name}] Workflow aborted.`)}}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.wait=void 0;const t=n(5);a.wait=function(e){let a;const n=new t.CancellablePromise(n=>{a=setTimeout(n,1e3*e)});return n.onCancel(()=>clearTimeout(a)),n}},function(e,a,n){"use strict";var t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(a,"__esModule",{value:!0}),a.getAreaMetadata=a.getAreasForLevel=void 0;const o=t(n(67)),r={"Academia de Darkhaven":["Xse","Xne","Xse","Xne","Xs"],"El Gran Estadio":"j","El Imperio Orco":["4ne2wen","dse2wese2wese2wese2weXnu","uXs","une2wene2weXs","une2wene2wenXsejk2whlen","u3ne2we2nXs","Xnu2se2we2ndXs","une2wene2wene2wene2weXs","une2wene2weXs","uns","une2wene2we2n","u"],"El Pantano Orco":["wn2w","n3esje4n4sw","4nw3sw3nw3sw3nd","3es3w3es3w"],"La Mansion de Marmol":["e2n","n2d",["3n3s","3e3w","3w3e","3s3n","2us"].join(""),"2e2w","4w4e","2unu"],"Los Usurpadores de Hochenyana":["n3w","ensen2sne","en2snense","wse2wee2sn","wn2sn2wn2sn2w","ene2wee2sn2e","2sws2wu","2en2es2e4snwe3n2wnw","4s","2ss2e4w2es"],"La tumba de Damara":["nnwes","esn","2ln"]};function i(e){return e.name in r?{...e,arena:r[e.name]}:e}a.getAreasForLevel=function(e,a){return o.default.filter(n=>n.realm===e&&n.from<=a&&n.to>=a).sort((e,a)=>e.to-a.to).map(i)},a.getAreaMetadata=function(e){const a=e.toLowerCase(),[n,...t]=o.default.filter(e=>e.name.toLocaleLowerCase().includes(a));return t.length&&console.warn(`Many areas detected for ${e}:\n- ${[n,...t].map(e=>e.name).join("\n- ")}`),n&&i(n)}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.getSidebarProps=a.getControlsProps=a.bindViewTo=a.onStateChange=void 0;const t=n(0),o=new WeakMap,r=t.emitter();a.onStateChange=r.subscribe,a.bindViewTo=function(e){e.onWorkflowsChange(e=>{c=e.sort((e,a)=>e.name<a.name?-1:1),c.forEach(e=>{o.has(e)||(o.set(e,!0),e.onChange(()=>r()))}),r()}),e.getPlugin("prompt").onUpdate(e=>{i=e.hp.percent,s=e.mana.percent,l=e.mv.percent,r()})};let i=1,s=1,l=1;a.getControlsProps=function(){return{buttons:[],meters:[{color:"550000",value:i},{color:"000055",value:s},{color:"005500",value:l}]}};let c=[];a.getSidebarProps=function(){return{workflows:c}}},,,,,function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0});const t=n(27),o=n(28),r=n(48),i=n(50),s=n(21),l=n(75),c=n(17),u=n(90);const d="https://amatiasq.github.io"===location.origin?"wss://mudOS.amatiasq.com":"ws://localhost:"+t.DEFAULT_PORT,{host:m,port:p,user:h,pass:g}=function(){const{user:e,server:a}=u.getQueryParams(),[n,t]=(a||"mud.balzhur.org:5400").split(":"),o=c.getPassword(e);return{host:n,port:parseInt(t,10),user:e,pass:o}}(),A=l.renderUserInterface(document.body);!function(){const e=new WebSocket(d);e.addEventListener("open",()=>{const a=new r.RemoteTelnet(e);a.connect(m,p),A.write(`Connecting to ${m}:${p} as ${h}\n`),async function(e){const a=new o.Mud(e);function n(n){A.write(n+"\n"),a.userInput(n)&&e.send(n)}function t(e,n){const t=`"${e}" with "${n.join(" ")}"`;A.write(`-> Running ${t}\n`),a.getWorkflow(e).execute(...n).then(e=>A.write(`\n<- Done ${t}: ${e}\n`),e=>A.write(`\n\n<! FAILED ${t}: ${e.message}\n\n`))}a.onCommand(e=>A.write(e+"\n")),e.onData(e=>A.write(e)),A.onSubmit(n),window.onbeforeunload=()=>{e.isConnected&&e.send("abandonar"),e.close()},a.registerHandler("!",e=>{const[n,...o]=e.split(/\s+/);"stop"===n?a.stopAll():t(n,o)}),a.registerHandler("#",e=>{const[t,o,r]=e.split(/#/).map(e=>e.trim()),i=`#${t}${r}`,s=()=>n(o);null!=r?a.daemon(i,({when:e,printLogs:a})=>e(t,s)):a.runOnce(i,({when:e,printLogs:a})=>e(t).then(s)),A.write(`WHEN: ${t}\nRUN: ${o}\n`)}),await a.login(h,g),s.bindViewTo(a),i.registerWorkflows(a),Object.assign(window,{mud:a})}(a)})}(),window.addEventListener("unhandledrejection",e=>{const a=e.reason;"aborted"===a&&e.preventDefault(),a&&a.message&&a.message.startsWith("Timeout: ")&&(e.preventDefault(),console.warn(a.message))})},function(e){e.exports=JSON.parse('{"DEFAULT_PORT":53472}')},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.Mud=void 0;const t=n(0),o=n(29),r=n(38),i=n(18),s=n(40),l=n(41),c=n(47);a.Mud=class{constructor(e){this.telnet=e,this.triggers=new l.RootTriggerCollection,this.workflows=new Map,this.contextCreator=new i.BasicContextCreator(this.triggers,this.send.bind(this)),this.handlers=[],this.emitCommand=t.emitter(),this.onCommand=this.emitCommand.subscribe,this.emitWorkflowsChange=t.emitter(),this.onWorkflowsChange=this.emitWorkflowsChange.subscribe,this.whenLoggedIn=new Promise(e=>this.emitLoggedIn=e),this.telnet.onData(e=>this.triggers.process(function(e){u&&(e=`${u}${e}`,u="");const a=e.match(/\u001b[^m]*?$/);return a&&(u=a[0],e=e.substr(0,e.length-u.length)),e.replace(/\u001b\[[^m]*?m/g,"")}(e).replace(/\r/g,"")))}async login(e,a){const n=this.contextCreator.createInstance("login");await r.login(n,e,a,async()=>{this.plugins=await o.initializePlugins(this.contextCreator.createInstance.bind(this.contextCreator))}),this.contextCreator.dispose(n),this.emitLoggedIn(e)}send(e,a={}){this.emitCommand(a.password?"*".repeat(e.length):e),this.telnet.send(e)}userInput(e){const a=this.handlers.find(a=>e.startsWith(a.id));return Boolean(!a||a.handler(e.substr(a.id.length)))}registerHandler(e,a){this.handlers.push({id:e,handler:a})}getPlugin(e){return(0,this.plugins[e])(this.contextCreator.createInstance(e))}daemon(e,a){this.runOnce(e,async e=>(await a(e),e.runForever()))}workflow(e,a){const n=new c.Workflow(e,a,this.createContextCreator());return this.workflows.set(n.name,n),this.emitWorkflowsChange([...this.workflows.values()]),n}runOnce(e,a){return new c.Workflow(e,a,this.createContextCreator()).execute()}stopAll(){for(const[,e]of this.workflows)e.stop()}getWorkflow(e){if(e instanceof c.Workflow)return e;if(!this.workflows.has(e))throw new Error(`Workflow "${e}" is not registered.`);return this.workflows.get(e)}createContextCreator(){return new s.WorkflowContextCreator(this,this.triggers.createChild(),this.plugins)}};let u=""},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.initializePlugins=void 0;const t=n(30),o=n(33),r=n(34),i=n(15),s=n(35),l=n(37),c={chat:t.chatPlugin,inventory:o.inventoryPlugin,navigation:r.navigationPlugin,prompt:i.promptPlugin,skills:s.skillsPlugin,stats:l.statsPlugin};a.initializePlugins=async function(e){const a=Object.entries(c).map(async([a,n])=>[a,await n(e(a))]),n=await Promise.all(a);return Object.fromEntries(n)}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.chatPlugin=void 0;const t=n(2),o=n(3),r=n(31),i=n(32),s=new Audio("data:audio/wav;base64,//uQRAAAAWMSLwUIYAAsYkXgoQwAEaYLWfkWgAI0wWs/ItAAAGDgYtAgAyN+QWaAAihwMWm4G8QQRDiMcCBcH3Cc+CDv/7xA4Tvh9Rz/y8QADBwMWgQAZG/ILNAARQ4GLTcDeIIIhxGOBAuD7hOfBB3/94gcJ3w+o5/5eIAIAAAVwWgQAVQ2ORaIQwEMAJiDg95G4nQL7mQVWI6GwRcfsZAcsKkJvxgxEjzFUgfHoSQ9Qq7KNwqHwuB13MA4a1q/DmBrHgPcmjiGoh//EwC5nGPEmS4RcfkVKOhJf+WOgoxJclFz3kgn//dBA+ya1GhurNn8zb//9NNutNuhz31f////9vt///z+IdAEAAAK4LQIAKobHItEIYCGAExBwe8jcToF9zIKrEdDYIuP2MgOWFSE34wYiR5iqQPj0JIeoVdlG4VD4XA67mAcNa1fhzA1jwHuTRxDUQ//iYBczjHiTJcIuPyKlHQkv/LHQUYkuSi57yQT//uggfZNajQ3Vmz+Zt//+mm3Wm3Q576v////+32///5/EOgAAADVghQAAAAA//uQZAUAB1WI0PZugAAAAAoQwAAAEk3nRd2qAAAAACiDgAAAAAAABCqEEQRLCgwpBGMlJkIz8jKhGvj4k6jzRnqasNKIeoh5gI7BJaC1A1AoNBjJgbyApVS4IDlZgDU5WUAxEKDNmmALHzZp0Fkz1FMTmGFl1FMEyodIavcCAUHDWrKAIA4aa2oCgILEBupZgHvAhEBcZ6joQBxS76AgccrFlczBvKLC0QI2cBoCFvfTDAo7eoOQInqDPBtvrDEZBNYN5xwNwxQRfw8ZQ5wQVLvO8OYU+mHvFLlDh05Mdg7BT6YrRPpCBznMB2r//xKJjyyOh+cImr2/4doscwD6neZjuZR4AgAABYAAAABy1xcdQtxYBYYZdifkUDgzzXaXn98Z0oi9ILU5mBjFANmRwlVJ3/6jYDAmxaiDG3/6xjQQCCKkRb/6kg/wW+kSJ5//rLobkLSiKmqP/0ikJuDaSaSf/6JiLYLEYnW/+kXg1WRVJL/9EmQ1YZIsv/6Qzwy5qk7/+tEU0nkls3/zIUMPKNX/6yZLf+kFgAfgGyLFAUwY//uQZAUABcd5UiNPVXAAAApAAAAAE0VZQKw9ISAAACgAAAAAVQIygIElVrFkBS+Jhi+EAuu+lKAkYUEIsmEAEoMeDmCETMvfSHTGkF5RWH7kz/ESHWPAq/kcCRhqBtMdokPdM7vil7RG98A2sc7zO6ZvTdM7pmOUAZTnJW+NXxqmd41dqJ6mLTXxrPpnV8avaIf5SvL7pndPvPpndJR9Kuu8fePvuiuhorgWjp7Mf/PRjxcFCPDkW31srioCExivv9lcwKEaHsf/7ow2Fl1T/9RkXgEhYElAoCLFtMArxwivDJJ+bR1HTKJdlEoTELCIqgEwVGSQ+hIm0NbK8WXcTEI0UPoa2NbG4y2K00JEWbZavJXkYaqo9CRHS55FcZTjKEk3NKoCYUnSQ0rWxrZbFKbKIhOKPZe1cJKzZSaQrIyULHDZmV5K4xySsDRKWOruanGtjLJXFEmwaIbDLX0hIPBUQPVFVkQkDoUNfSoDgQGKPekoxeGzA4DUvnn4bxzcZrtJyipKfPNy5w+9lnXwgqsiyHNeSVpemw4bWb9psYeq//uQZBoABQt4yMVxYAIAAAkQoAAAHvYpL5m6AAgAACXDAAAAD59jblTirQe9upFsmZbpMudy7Lz1X1DYsxOOSWpfPqNX2WqktK0DMvuGwlbNj44TleLPQ+Gsfb+GOWOKJoIrWb3cIMeeON6lz2umTqMXV8Mj30yWPpjoSa9ujK8SyeJP5y5mOW1D6hvLepeveEAEDo0mgCRClOEgANv3B9a6fikgUSu/DmAMATrGx7nng5p5iimPNZsfQLYB2sDLIkzRKZOHGAaUyDcpFBSLG9MCQALgAIgQs2YunOszLSAyQYPVC2YdGGeHD2dTdJk1pAHGAWDjnkcLKFymS3RQZTInzySoBwMG0QueC3gMsCEYxUqlrcxK6k1LQQcsmyYeQPdC2YfuGPASCBkcVMQQqpVJshui1tkXQJQV0OXGAZMXSOEEBRirXbVRQW7ugq7IM7rPWSZyDlM3IuNEkxzCOJ0ny2ThNkyRai1b6ev//3dzNGzNb//4uAvHT5sURcZCFcuKLhOFs8mLAAEAt4UWAAIABAAAAAB4qbHo0tIjVkUU//uQZAwABfSFz3ZqQAAAAAngwAAAE1HjMp2qAAAAACZDgAAAD5UkTE1UgZEUExqYynN1qZvqIOREEFmBcJQkwdxiFtw0qEOkGYfRDifBui9MQg4QAHAqWtAWHoCxu1Yf4VfWLPIM2mHDFsbQEVGwyqQoQcwnfHeIkNt9YnkiaS1oizycqJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU="),l={version:2},c=()=>(new Date).toISOString().replace("T"," ").replace(/\.\d\d\dZ/,""),u=(e,a)=>({groups:{name:n,message:t}})=>{console.log(`MESSAGE [${a}] ${c()} => ${n} =>`,t),p(e,{from:n,message:t}),n.startsWith("[Orden")||m(`${n}: ${t}`)},d=(e,a)=>({groups:{name:n,message:t}})=>{console.log(`SENT [${a}] ${c()} => ${n} =>`,t),p(e,{to:n,message:t})};async function m(e){return s.play(),await i.requestNotificationPermission(),new Notification(e)}function p(e,a){const n=[r.datetime(new Date),a.from||"me",a.to||"me",a.message];return e.set([...e.get()||[],n]),n}a.chatPlugin=o.createPlugin(({when:e,write:a})=>{const n=new t.ClientStorage("chat:global",l),o=new t.ClientStorage("chat:faction",l),r=new t.ClientStorage("chat:order",l),i=new t.ClientStorage("chat:novice",l),s=new t.ClientStorage("chat:tell",l),c=new t.ClientStorage("chat:whisper",l);window.chat=(e=0)=>({global:n.get()?n.get().slice(e):[],faction:o.get()?o.get().slice(e):[],order:r.get()?r.get().slice(e):[],novice:i.get()?i.get().slice(e):[],tell:s.get()?s.get().slice(e):[],whisper:c.get()?c.get().slice(e):[]}),h("General",n,/(?<name>\w+) charla '(?<message>[^']+)'/,/Charlas '(?<message>[^']+)'/),h("Novatos",i,/(?<name>\[Novatos: [^\]]+\]): '(?<message>[^']+)'/,/(?<name>\[Novatos\]): '(?<message>[^']+)'/),h("Order",r,/(?<name>\[Orden: [^\]]+\]): '(?<message>[^']+)'/,/(?<name>\[Orden\]): '(?<message>[^']+)'/),h("Faccion",o,/(?<name>\[Faccion: [^\]]+\]): '(?<message>[^']+)'/,/(?<name>\[Faccion\]): '(?<message>[^']+)'/),h("Whisper",c,/(?<name>.+) te susurra '(?<message>[^']+)'/,/Susurras a (?<name>.+) '(?<message>[^']+)'/);const p=u(s,"Tell");function h(a,n,t,o){e(t,u(n,a)),e(o,d(n,a))}e([/(?<name>.+) te cuenta '(?<message>[^']+)'/,/(?<name>.+) te responde '(?<message>[^']+)'/],e=>{p(e),function({name:e,message:n}){const t={re:/^porfa re(sponde(me)?)? /,["tell "+e]:/^porfa di(me)? /,["susurrar "+e]:/^porfa susurra(me)? /};for(const[e,o]of Object.entries(t))o.test(n)&&a(`${e} ${n.replace(o,"")}`)}(e.groups)}),e([/Cuentas a (?<name>.+) '(?<message>[^']+)'/,/Respondes a (?<name>.+) '(?<message>[^']+)'/],d(s,"Tell")),e(/(?<name>\w+) te ha desafiado a un combate en la arena!/,({groups:e})=>m("[ARENA] w/ "+e.name))},()=>()=>({}))},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.datetime=void 0;const t=e=>e<10?"0"+e:e;a.datetime=function(e){return`${e.getFullYear()}-${t(e.getMonth()+1)}-${t(e.getDate())} ${t(e.getHours())}:${t(e.getMinutes())}`}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.requestNotificationPermission=void 0,a.requestNotificationPermission=function(){if("Notification"in window){if("granted"===Notification.permission)return Promise.resolve(!0);if("denied"!==Notification.permission)return Notification.requestPermission().then(e=>"granted"===e)}else console.warn("This browser does not support desktop notification")}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.inventoryPlugin=void 0;const t=n(3),o=n(1),r=n(4),i=n(14),s=/\n(?<content>(?:.|\n)*)\n[^ ]/,l=o.concatRegexes(/Estas llevando:/,s),c=o.concatRegexesUnescaped("(?: \\(",r.int("amount"),"\\))?"),u=o.concatRegexes(/^/,/(?<effects>(?:\(\w[^\)]+\w\) )*)/,/(?<name>\w[^\(\)]*\w)/,c,/$/);a.inventoryPlugin=t.createPlugin(({when:e,write:a})=>{let n=!1,t={};const o=i.singleExecution(async()=>{a("inventario"),await e(l)});return e("No tienes ese objeto.",o),e(l,({groups:e})=>{n=!0,t=s(e.content)},{captureLength:1e3}),{refresh:o,parseItems:s,ensureInitialized:()=>n||o(),getItems:()=>t};function s(e){const a=e.split("\n").map(e=>e.trim()).filter(Boolean),n={};for(const e of a){if("Nada."===e)return{};const a=e.match(u);if(!a){console.error(`Can't match item "${e}"`);continue}const{effects:t,name:o,amount:i}=a.groups;n[o]={name:o,amount:i?r.toInt(i):1,effects:t.replace(/^\s*\(|\)\s*$/g,"").split(") (").filter(Boolean)}}return n}},({refresh:e,parseItems:a,ensureInitialized:n,getItems:t})=>({when:r,write:i})=>{return{refresh:e,has:async function(e){return await n(),c(t(),e)},hasIn:l,hasInBackpack:l.bind(null,"mochila"),getByEffect:async function(e){return await n(),Object.values(t()).filter(a=>a.effects.includes(e))}};async function l(e,n){i("examinar "+e);const t=await r.any(r("No ves eso aqui.").then(()=>null),r(o.concatRegexes(/Cuando miras dentro ves:\n.+ contiene:/,s),{captureLength:1e3}));if(!t)return!1;const l=a(t.groups.content);return console.log("IN",e,l),c(l,n)}function c(e,a){if("string"==typeof a)return e[a]?a:null;if(Array.isArray(a))return a.find(a=>e[a])||null;const n=Object.keys(a).find(a=>e[a]);return n?a[n]:null}})},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.navigationPlugin=void 0;const t=n(0),o=n(3),r=n(5),i=n(15),s="(cerrada)",l={s:"sur",n:"norte",e:"este",w:"oeste",o:"oeste",u:"arriba",d:"abajo",l:"sureste",k:"suroeste",j:"noreste",h:"noroeste"},c=[/Plaza de Darkhaven\s+/,/Templo de la Justicia\s+/,/Templo de las Tinieblas\s+/];a.navigationPlugin=o.createPlugin(({when:e,write:a})=>{let n=!1,o=[],r=!1,l=!1;const u=()=>e(i.PROMPT_DETECTOR),d=t.emitter();return e(c,()=>n=!0),e([/Puerta \w+ esta cerrada./,/Puertas? esta cerrada\./],async()=>{const n=o.find(e=>e.includes(s));if(n){const t=n.replace(s,"");a("abrir "+t);await e.any(e("Esta cerrada con llave.").then(()=>!1),e("Abres ").then(()=>!0))&&a(t)}}),e(/\nSalidas: ([^\.]+)/,async({captured:e})=>{o=e[1].split(" "),r=!1,l=n,n=!1,await u(),d(o)}),{getDirections:()=>o,getIsAtRecall:()=>l,getIsNavigating:()=>r,onRoomChange:d.subscribe,prompt:u,setIsNavigating:e=>r=e}},({getDirections:e,getIsAtRecall:a,getIsNavigating:n,onRoomChange:t,prompt:o,setIsNavigating:i})=>({log:u,when:d,write:m})=>{return{canGo:h,go:g,execute:async function(e,a){"r"===e[0]&&(await p(),e=e.substr(1));let n=!1,t="";for(const a of(o=e,o.replace(/(\d+)(\w)/g,(e,a,n)=>n.repeat(a))))if("X"!==a.toUpperCase()){if(n){for(;h(a);)if(await r(a))return!1;n=!1}else if(await r(a))return!1}else n=!0,t+="(X)";var o;return!0;async function r(n){try{if(!await g(n))return!0;t+=n}catch(a){throw new Error(`${a.message} - on ${e} - ${t}`)}if("function"==typeof a){return!1===await a()}}},getRealm:async function(){m("donde");return(await d(/Jugadores cerca de ti en [^,]+, Reino de (?<realm>\w+):/)).groups.realm},recall:p,waitForRecall:function(){return a()?new r.CancellablePromise(e=>e()):d(c).then()},onRoomChange:t,get isNavigating(){return n()},get isAtRecall(){return a()}};async function p(){if(a())return!0;m("recall"),await d(c),await o()}function h(e){return Boolean(A(e))}async function g(e){if(n())throw new Error("WTF DUDE");const a=A(e);if(!a)throw new Error(`Unknown direction '${e}'`);if(function(e){const a=A(e);return a&&a.includes(s)}(e)){m("abrir "+e);if(!await d.any(d([/Abres la puertas?\./,/Abres la puerta \w+\./]).then(()=>!0),d("Esta cerrada con llave.").then(()=>!1)))return u("Can\t open door"),!1}return m(a.replace(s,"").trim()),i(!0),await d("\nSalidas:"),await o(),i(!1),!0}function A(a){return a in l&&(a=l[a]),e().find(e=>e.startsWith(a))}})},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.skillsPlugin=void 0;const t=n(6),o=n(3),r=n(1),i=n(4),s=n(14),l=void 0,c=null,u=!1,d=!0,m=/((?:\w+ )+)\s+(\d+)%/g,p=r.concatRegexes(/-+\[(\w+)\]-+\n/,/(.|\n)+/,/Te quedan /,i.int("practices"),/ practicas?.\n/,/Tienes /,i.int("trainings"),/ entrenamientos?.\n/);a.skillsPlugin=o.createPlugin(({when:e,write:a})=>{let n=!1,t=0,o=0,r={};const l=s.singleExecution(()=>(a("practicar"),e(p)));return e(p,({captured:[e],groups:a})=>{t=i.toInt(a.practices),o=i.toInt(a.trainings);for(const a of e.matchAll(m))r[a[1].trim()]=parseInt(a[2],10);n=!0},{captureLength:5e3}),{getPractices:()=>t,getTrainings:()=>o,getSkills:()=>r,refresh:l,async ensureInitiated(){n||await l()}}},({getPractices:e,getTrainings:a,getSkills:n,refresh:o,ensureInitiated:r})=>({when:i,write:s})=>{let m=!1,p=!1;return{get practices(){return r().then(e)},get trainings(){return r().then(a)},can:h,canLearn:async function(e){return await r(),e in n()},castSpell:A,getPractices:e,getTrainings:a,refresh:o,meditate:async function(){return await h("meditar")?m?c:p?e():(p=!0,s("meditar"),e().finally(()=>p=!1)):l;function e(){return i.any(i("Meditas con total paz interior, recolectando mana del cosmos.").then(()=>d),i("Te pasas varios minutos en profunda concentracion, pero fallas en el intento de recolectar mana.").then(()=>u))}},polimorfar:async function(e){const a=[[20,"Gato"],[23,"Aguila"],[25,"Serpiente"],[30,"Lobo"],[35,"Tortuga"],[40,"Cocodrilo"],[45,"Oso"],[50,"Pegaso"],[55,"Elem aire"],[60,"Elem tierra"],[65,"Ent"]].reverse().find(([a])=>e>=a);return a&&A("polimorfar",a[1])},NOT_AVAILABLE:l,BUSY:c,FAILED:u,CASTED:d,ALREADY_APPLIED:1};async function h(e){return await r(),"string"==typeof e?g(e)?e:null:e.find(g)||null}function g(e){return n()[e]}async function A(e,a=""){const n=(Array.isArray(e)?e:[e]).map(t.getSpell).filter(Boolean),o=await h(n.map(e=>e.name));if(!o)return l;const r=n.find(e=>e.name===o),g=a?r.target:r.success;if(!g)throw new Error(`Unknown response for spell "${e}" (${r.name}).`+(a?` With target "${a}"`:""));if(m||p)return c;await h("crear baya");m=!0,s(`conjurar "${r.name}" ${a}`);const A=[i(g).then(()=>d),i(t.SPELL_NOT_POSSIBLE).then(()=>l),i(t.SPELL_ALREADY_APPLIED).then(()=>1),i(t.SPELL_FAILED).wait(4).then(()=>u)];r.target&&A.push(i(r.target).then(()=>d));const f=await i.any(...A);return m=!1,f}})},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=[{level:1,type:"Hechizo",name:"armadura",minPos:"luchando (evasivo)"},{level:1,type:"Hechizo",name:"causar leve",minPos:"luchando (defensivo)"},{level:1,type:"Habilidad",name:"carpinteria",minPos:"de pie"},{level:1,type:"Habilidad",name:"cocinar",minPos:"luchando (defensivo)"},{level:1,type:"Habilidad",name:"despellejar",minPos:"luchando (defensivo)"},{level:1,type:"Habilidad",name:"estilo estandar"},{level:1,type:"Habilidad",name:"estilo evasivo"},{level:1,type:"Habilidad",name:"forjar",minPos:"de pie"},{level:1,type:"Habilidad",name:"minar",minPos:"de pie"},{level:1,type:"Habilidad",name:"pescar",minPos:"de pie"},{level:1,type:"Habilidad",name:"talar",minPos:"de pie"},{level:1,type:"Habilidad",name:"tallar",minPos:"de pie"},{level:1,type:"Habilidad",name:"tejer",minPos:"de pie"},{level:1,type:"Arma",name:"armas cortas"},{level:1,type:"Arma",name:"armas flexibles"},{level:1,type:"Arma",name:"armas impacto"},{level:1,type:"Arma",name:"armas largas"},{level:1,type:"Arma",name:"garras"},{level:1,type:"Arma",name:"pugilismo"},{level:1,type:"Idioma",name:"comun"},{level:1,type:"Idioma",name:"elfico"},{level:1,type:"Idioma",name:"enano"},{level:1,type:"Idioma",name:"goblin"},{level:1,type:"Idioma",name:"ogro"},{level:1,type:"Idioma",name:"orco"},{level:1,type:"Idioma",name:"troll"},{level:2,type:"Hechizo",name:"crear agua",minPos:"luchando (evasivo)"},{level:2,type:"Hechizo",name:"curar leves",minPos:"luchando (defensivo)"},{level:2,type:"Hechizo",name:"luz eterna",minPos:"luchando (evasivo)"},{level:2,type:"Habilidad",name:"cartografia",minPos:"luchando (agresivo)"},{level:2,type:"Habilidad",name:"cavar",minPos:"de pie"},{level:3,type:"Hechizo",name:"crear comida",minPos:"luchando (evasivo)"},{level:3,type:"Hechizo",name:"detectar magia",minPos:"luchando (evasivo)"},{level:4,type:"Hechizo",name:"detectar invisible",minPos:"luchando (berserk)"},{level:4,type:"Hechizo",name:"fuego espectral",minPos:"luchando"},{level:4,type:"Habilidad",name:"montar",minPos:"de pie"},{level:5,type:"Hechizo",name:"bendecir",minPos:"luchando"},{level:5,type:"Hechizo",name:"causar grave",minPos:"luchando (agresivo)"},{level:5,type:"Hechizo",name:"ceguera",minPos:"luchando (berserk)"},{level:5,type:"Hechizo",name:"curar ceguera",minPos:"luchando"},{level:5,type:"Hechizo",name:"detectar maldad",minPos:"luchando (defensivo)"},{level:6,type:"Hechizo",name:"crear fuego",minPos:"luchando (evasivo)"},{level:6,type:"Hechizo",name:"flotar",minPos:"luchando"},{level:6,type:"Habilidad",name:"buscar",minPos:"de pie"},{level:6,type:"Habilidad",name:"escalar",minPos:"de pie"},{level:6,type:"Habilidad",name:"patada",minPos:"luchando (berserk)"},{level:6,type:"Habilidad",name:"primeros auxilios",minPos:"luchando (agresivo)"},{level:7,type:"Hechizo",name:"refrescar",minPos:"luchando"},{level:7,type:"Habilidad",name:"danyo incrementado",minPos:"luchando (berserk)"},{level:7,type:"Habilidad",name:"estilo agresivo"},{level:8,type:"Hechizo",name:"curar veneno",minPos:"luchando (defensivo)"},{level:8,type:"Hechizo",name:"detectar escondido",minPos:"de pie"},{level:8,type:"Hechizo",name:"detectar trampas",minPos:"de pie"},{level:8,type:"Hechizo",name:"terremoto",minPos:"luchando"},{level:9,type:"Hechizo",name:"causar critica",minPos:"luchando"},{level:9,type:"Hechizo",name:"conocer alineamiento",minPos:"luchando (defensivo)"},{level:9,type:"Hechizo",name:"misil magico",minPos:"luchando"},{level:9,type:"Hechizo",name:"volar",minPos:"luchando"},{level:10,type:"Hechizo",name:"crear baya",minPos:"ninguna"},{level:10,type:"Hechizo",name:"crear manantial",minPos:"luchando"},{level:10,type:"Hechizo",name:"curar graves",minPos:"luchando (defensivo)"},{level:10,type:"Hechizo",name:"invisibilidad",minPos:"de pie"},{level:10,type:"Hechizo",name:"invocar armadillo",minPos:"de pie"},{level:10,type:"Hechizo",name:"veneno",minPos:"luchando (evasivo)"},{level:11,type:"Hechizo",name:"niebla espectral",minPos:"de pie"},{level:11,type:"Hechizo",name:"proteccion",minPos:"luchando (evasivo)"},{level:12,type:"Hechizo",name:"curar criticas",minPos:"luchando"},{level:12,type:"Hechizo",name:"disipar maldad",minPos:"luchando (agresivo)"},{level:12,type:"Hechizo",name:"llamar rayo",minPos:"luchando"},{level:12,type:"Hechizo",name:"maldecir",minPos:"luchando (agresivo)"},{level:13,type:"Hechizo",name:"bola fuego",minPos:"luchando"},{level:13,type:"Hechizo",name:"control climatico",minPos:"de pie"},{level:13,type:"Hechizo",name:"detectar veneno",minPos:"de pie"},{level:13,type:"Hechizo",name:"identificar",minPos:"luchando (evasivo)"},{level:13,type:"Hechizo",name:"localizar objeto",minPos:"luchando (evasivo)"},{level:14,type:"Hechizo",name:"disipar magia",minPos:"luchando"},{level:14,type:"Hechizo",name:"piel robliza",minPos:"de pie"},{level:14,type:"Hechizo",name:"retirar invisibilidad",minPos:"de pie"},{level:14,type:"Hechizo",name:"saciar hambre",minPos:"luchando (evasivo)"},{level:15,type:"Hechizo",name:"debilitar",minPos:"luchando (agresivo)"},{level:15,type:"Hechizo",name:"relampago",minPos:"luchando (defensivo)"},{level:15,type:"Habilidad",name:"manotazo",minPos:"luchando"},{level:15,type:"Habilidad",name:"otear",minPos:"de pie"},{level:15,type:"Habilidad",name:"pisoton",minPos:"luchando (berserk)"},{level:15,type:"Habilidad",name:"segundo ataque",minPos:"luchando (berserk)"},{level:16,type:"Hechizo",name:"golpe flamigero",minPos:"luchando (defensivo)"},{level:16,type:"Habilidad",name:"meditar",minPos:"descansando"},{level:17,type:"Hechizo",name:"causar fatales",minPos:"luchando (agresivo)"},{level:17,type:"Hechizo",name:"retirar maldicion",minPos:"luchando (evasivo)"},{level:17,type:"Hechizo",name:"sonyar",minPos:"de pie"},{level:17,type:"Hechizo",name:"vista distancia",minPos:"luchando"},{level:17,type:"Habilidad",name:"estilo defensivo"},{level:17,type:"Habilidad",name:"sigilo",minPos:"de pie"},{level:18,type:"Hechizo",name:"agarron impactante",minPos:"luchando (berserk)"},{level:18,type:"Hechizo",name:"respiracion acuatica",minPos:"de pie"},{level:18,type:"Hechizo",name:"retirar trampa",minPos:"de pie"},{level:19,type:"Hechizo",name:"sanar",minPos:"luchando (agresivo)"},{level:20,type:"Hechizo",name:"fuerza vampirica",minPos:"luchando"},{level:20,type:"Hechizo",name:"invisibilidad grupo",minPos:"de pie"},{level:20,type:"Hechizo",name:"invocar lince",minPos:"de pie"},{level:20,type:"Hechizo",name:"invocar regreso",minPos:"descansando"},{level:20,type:"Hechizo",name:"polimorfar",minPos:"luchando (evasivo)"},{level:20,type:"Habilidad",name:"rescatar",minPos:"luchando (berserk)"},{level:21,type:"Habilidad",name:"desarmar",minPos:"luchando (agresivo)"},{level:22,type:"Hechizo",name:"rayo solar",minPos:"luchando (berserk)"},{level:24,type:"Hechizo",name:"atravesar puerta",minPos:"luchando (evasivo)"},{level:24,type:"Hechizo",name:"furia naturaleza",minPos:"ninguna"},{level:25,type:"Hechizo",name:"escudo hielo",minPos:"de pie"},{level:26,type:"Habilidad",name:"esquivar",minPos:"luchando (agresivo)"},{level:28,type:"Habilidad",name:"estilo berserk",minPos:"luchando (defensivo)"},{level:30,type:"Hechizo",name:"encantar arma",minPos:"de pie"},{level:30,type:"Hechizo",name:"invocar aguila",minPos:"de pie"},{level:30,type:"Hechizo",name:"santuario",minPos:"de pie"},{level:30,type:"Habilidad",name:"tercer ataque",minPos:"luchando (berserk)"},{level:31,type:"Hechizo",name:"viajar",minPos:"de pie"},{level:32,type:"Hechizo",name:"relentizar",minPos:"luchando"},{level:34,type:"Hechizo",name:"dormir",minPos:"de pie"},{level:35,type:"Hechizo",name:"atravesar vegetacion",minPos:"de pie"},{level:35,type:"Hechizo",name:"drenar energia",minPos:"luchando"},{level:35,type:"Hechizo",name:"escudo flamigero",minPos:"luchando (evasivo)"},{level:35,type:"Hechizo",name:"metal ardiente",minPos:"luchando"},{level:35,type:"Hechizo",name:"piel petrea",minPos:"luchando"},{level:35,type:"Habilidad",name:"rastrear",minPos:"de pie"},{level:40,type:"Hechizo",name:"escudo",minPos:"luchando"},{level:40,type:"Hechizo",name:"invocar lobo",minPos:"de pie"},{level:40,type:"Habilidad",name:"parada",minPos:"luchando (agresivo)"},{level:42,type:"Hechizo",name:"enredo vegetal",minPos:"ninguna"},{level:43,type:"Hechizo",name:"transporte arboreo",minPos:"ninguna"},{level:45,type:"Hechizo",name:"escudo electrico",minPos:"luchando (evasivo)"},{level:45,type:"Hechizo",name:"nube aturdidora",minPos:"de pie"},{level:45,type:"Habilidad",name:"cuarto ataque",minPos:"luchando (berserk)"},{level:45,type:"Habilidad",name:"esconderse",minPos:"de pie"},{level:48,type:"Hechizo",name:"vision verdadera",minPos:"de pie"},{level:50,type:"Hechizo",name:"invocar jaguar",minPos:"de pie"},{level:50,type:"Hechizo",name:"teleportar",minPos:"luchando (defensivo)"},{level:51,type:"Hechizo",name:"cantico",minPos:"luchando (evasivo)"},{level:51,type:"Habilidad",name:"punyo_helado",minPos:"luchando (agresivo)"},{level:52,type:"Hechizo",name:"crear arbol",minPos:"ninguna"},{level:52,type:"Hechizo",name:"destruir maldad",minPos:"luchando (defensivo)"},{level:52,type:"Habilidad",name:"punyo_electrico",minPos:"luchando (agresivo)"},{level:54,type:"Hechizo",name:"maremoto",minPos:"luchando"},{level:57,type:"Hechizo",name:"vara robliza",minPos:"ninguna"},{level:60,type:"Hechizo",name:"delirio caotico",minPos:"luchando"},{level:60,type:"Hechizo",name:"invocar oso",minPos:"de pie"},{level:60,type:"Hechizo",name:"rafaga viento",minPos:"luchando"},{level:62,type:"Hechizo",name:"relampago helado",minPos:"luchando (defensivo)"},{level:63,type:"Hechizo",name:"clonacion",minPos:"luchando (defensivo)"},{level:67,type:"Hechizo",name:"tormenta hielo",minPos:"luchando (berserk)"}]},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.statsPlugin=void 0;const t=n(3),o=n(1),r=n(4),i=3e3,s=(()=>{const e=o.concatRegexes,a=e=>e.toLowerCase(),n=/\-{78}/,t=/\s+/,i=/\s+\|\s+/,s=(...a)=>e(/\|\|\s*/,...a,/\s*\|\|\n/),l=n=>e(n,/\s+: /,r.int(a(n)),/\(/,r.int(a(n)+"Base"),/\)/),c=n=>e(n,/\s+: /,r.int(a(n)),/\s+\//,r.int(a(n)+"Base"),/\s+\(\s*/,r.int(a(n)+"Regen"),/%\) (?:Regen)?/);return e(n,/\n ?\/\s{78}\\\n/,s(/Ficha de (?<name>\w+)(?<principal> \(Personaje Principal\))\./),s(n),s(l("FUE"),t,l("DES"),i,c("Vida")),s(l("INT"),t,l("SAB"),i,c("Mana")),s(l("CON"),t,l("CAR"),i,c("Mov")),s(l("SUE"),t,i,t),/\|\|-{36}\+-{41}\|\|\n/,e(/\|\|\s*Nivel\s+: /,r.int("level"),/(?:.|\n)+?/))})();a.statsPlugin=t.createPlugin(({when:e,write:a})=>{let n=!1,t="",o=!1;const l={fue:0,fueBase:0,des:0,desBase:0,vida:0,vidaBase:0,vidaRegen:0,int:0,intBase:0,sab:0,sabBase:0,mana:0,manaBase:0,manaRegen:0,con:0,conBase:0,car:0,carBase:0,mov:0,movBase:0,movRegen:0,sue:0,sueBase:0,level:0};return e(s,({groups:e})=>{for(const a of Object.keys(l))l[a]=r.toInt(e[a]);t=e.name,o=Boolean(e.principal),n=!0},{captureLength:3e3}),{getLevel:async()=>(await async function(){n||(a("estado"),await e(s,{captureLength:i}))}(),l.level)}},e=>()=>e)},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.login=void 0;const t=n(16),o=(n(39),n(17));a.login=async function({when:e,write:a,log:n},r,i,s){await e("Entra el nombre de tu personaje o escribe Nuevo:"),a(r),n("Username sent, waiting for password request"),await Promise.any([e("Password:").then((function(){a(i,{password:!0}),n("Logged in as "+r)})),e("Ese jugador no existe").then((async function(){a("Nuevo");const n=t.conversation(e,a);await n({"Cual es tu sexo (H)ombre, (M)ujer o (N)eutral?":"N","Selecciona una profesion":"Druida","Escoge una raza o escribe ayuda [raza] para saber mas sobre ellas:":"elfo","Por favor escoge el nombre":r,"Estas seguro de querer escoger":"s","Escoge un buen password":i,"Vuelve a escribir el password para confirmarlo":i,"Tienes alguna otra ficha creada?":"s"}),n({"¿Cual es tu personaje principal?":"may","Escribe el password de tu personaje principal":await o.getPassword("may")});n({"Quieres calcular tus caracteristicas al azar o repartir manualmente":"a"});let s={roll:0,total:0};const l=e(/^\|\s+(?<roll>\d+).+?(?<total>\d+) \|$/m,({groups:e})=>{parseInt(e.total,10)>s.total&&(s=e)});await e("Con qué numero de tirada quieres quedarte?"),a(""+s.roll),l.unsubscribe(),!1}))]),e("Pulsa [ENTER]",()=>a("")),await e.any(e("Reconectando.",{blockProcessingUntil:s}),e("Bienvenido a Balzhur...",{blockProcessingUntil:s}))}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.getEmail=void 0;const t=n(2);a.getEmail=function(e){const a=new t.ClientStorage("email:"+e),n=a.get();if(n)return n;const o=prompt(`Email for ${e}?`);if(!o)throw new Error("Email is required to create a user");return a.set(o),o}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.WorkflowContextCreator=void 0;const t=n(18);class o extends t.BasicContextCreator{constructor(e,a,n){super(a,e.send.bind(e)),this.plugins=n,this.register=e.workflow.bind(e),this.getWorkflow=e.getWorkflow.bind(e)}createInstance(e){const a=super.createInstance(e),{log:n,abort:t}=a,{checkNotAborted:o,register:i,getWorkflow:s}=this,l=[];let c;return Object.assign(a,{plugins:r(this.plugins,a),register:i,isRunning:e=>s(e).isRunning,run(e,...t){o(a),n(`Invoke workflow "${e}" with`,...t);const r=s(e).execute(...t);return l.push(r),r.then(a=>n(`Invocation "${e}" returned `,a),a=>n(`Invocation "${e}" failed `,a)),r},runForever:()=>(o(a),new Promise(e=>c=e)),abort(e){a.isAborted||(l.forEach(e=>e.cancel()),t(),c&&c("Workflow aborted from "+(e?"execution":"context")))}})}}function r(e,a){return new Proxy(e,{get(e,n){if(!(n in e))throw a.log("Failed to get plugin "+n),new Error(`Plugin ${n} is not registered.`);return a.log("Requires plugin "+n),e[n](a)}})}a.WorkflowContextCreator=o},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.RootTriggerCollection=void 0;const t=n(0),o=n(42),r=n(43),i=n(46);a.RootTriggerCollection=class{constructor(){this.children=[],this.patterns=new Set,this.queue=[],this.isProcessing=!1,this.emitChange=t.emitter(),this.onChange=this.emitChange.subscribe}get list(){return Array.from(this.patterns)}createChild(){const e=new o.ChildTriggerCollection(this.add);return this.children.push(e),e}add(e,a,n){return"function"!=typeof a&&2===arguments.length&&(n=a,a=void 0),new i.PatternSubscription(t=>{const o=new r.PatternMatcher(e,n);let i=!0;const s=()=>!!i&&(i=!1,c(),o.dispose(),this.patterns.delete(o),this.emitChange(this.list),!0),l="function"==typeof a?a:s,c=o.onMatch(e=>{t(e),l(e)});return this.patterns.add(o),this.emitChange(this.list),s})}async process(e){if(this.isProcessing)return void this.queue.push(e);this.isProcessing=!0;const a=e.split("\n"),n=a.pop(),t=[...a.map(e=>e+"\n"),n];for(const e of t)try{for(const a of this.patterns)await a.process(e);for(const a of this.children)await a.process(e)}catch(a){throw console.error(`Line "${e}" produced error: ${a&&a.message?a.message:a}`),a}return this.isProcessing=!1,this.queue.length?this.process(this.queue.pop()):void 0}}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.ChildTriggerCollection=void 0;const t=n(0);a.ChildTriggerCollection=class{constructor(e){this.add=e,this.patterns=new Set,this.emitChange=t.emitter(),this.onChange=this.emitChange.subscribe}get list(){return Array.from(this.patterns)}async process(e){for(const a of this.patterns)await a.process(e)}}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.PatternMatcher=void 0;const t=n(0),o=n(44),r=n(45);a.PatternMatcher=class{constructor(e,a={}){this.options=a,this._isEnabled=!0,this.emitMatch=t.emitter(),this.onMatch=this.emitMatch.subscribe,this.patterns=Array.isArray(e)?e:[e],this.length=a.captureLength||10*Math.max(...this.patterns.map(e=>String(e).length)),this.buffer=function(e){let a="";const n=()=>a="",t=n=>a=o.trimEnd(`${a}${n}`,e);return Object.assign(t,{clear:n})}(this.length)}get isEnabled(){return this._isEnabled}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1,this.buffer.clear()}process(e){if(!this._isEnabled)return;const a=this.buffer(e),n=this.patterns.filter(e=>this.testPattern(a,e));if(!n.length)return;this.buffer.clear();const t=new r.PatternResult(n,a),{logger:o}=this.options,{blockProcessingUntil:i}=this.options;return o&&o(),this.emitMatch(t),i?i():void 0}dispose(){this.buffer.clear(),Object.assign(this,{buffer:null,emitMatch:null,onMatch:null,options:null})}testPattern(e,a){return"string"==typeof a?e.indexOf(a)>-1:a.test(e)}}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.trimEnd=void 0,a.trimEnd=function(e,a){return e.length>a?e.substr(e.length-a):e}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.PatternResult=void 0;function t(e){return e instanceof RegExp}function o(e,a){return{...e,...a}}a.PatternResult=class{constructor(e,a){this.patterns=e,this.haystack=a}get regexes(){return this.patterns.filter(t)}get stringPatterns(){return this.patterns.filter(e=>!t(e))}get fullMatch(){return this.stringPatterns[0]}get captured(){return this.regexes.map(e=>this.haystack.match(e)).filter(Boolean).map(e=>Array.from(e))[0]}get groups(){return this.regexes.map(e=>this.haystack.match(e)).filter(Boolean).map(e=>e.groups).filter(Boolean).reduce(o,{})}}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.PatternSubscription=void 0;const t=n(5),o=n(19);a.PatternSubscription=class{constructor(e){let a;const n=new t.CancellablePromise(e=>a=e);n.onCancel(()=>this.stop()),this.stop=e(a),this.then=n.then.bind(n)}timeout(e){return t.CancellablePromise.race([this.then(),o.wait(e).then(()=>{throw this.stop(),new Error("Timeout: "+e)})])}wait(e){return t.CancellablePromise.race([this.then(),o.wait(e).then(()=>this.stop())])}unsubscribe(){return this.stop()}}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.Workflow=void 0;const t=n(0),o=n(5);a.Workflow=class{constructor(e,a,n){this.name=e,this.run=a,this.contextCreator=n,this.executions=new Set,this.executionCount=0,this._isEnabled=!0,this.emitChange=t.emitter(),this.onChange=this.emitChange.subscribe}get isRunning(){return Boolean(this.executions.size)}get instancesRunning(){return this.executions.size}get timesExecuted(){return this.executionCount}get isEnabled(){return this._isEnabled}get triggers(){return this.contextCreator.triggerList}onTriggersChange(e){return this.contextCreator.onTriggersChange(e)}owns(e){return this.executions.has(e)}execute(...e){if(!this._isEnabled)throw new Error(`Workflow "${this.name}" is disabled`);const a=this.executionCount++,n=this.contextCreator.createInstance(this.name);n.log(`[Exe(${a})]`,...e);const t=new o.CancellablePromise((a,t,o)=>{o(()=>{n.abort(),t()}),Promise.resolve(this.run(n,...e)).then(a,t)});this.executions.add(t);const r=t.then(e=>(n.log(`[Res(${a})]`,e),e),e=>{throw n.log(`[ERR(${a})]`,e),e}).finally(()=>{this.executions.delete(t),this.contextCreator.dispose(n),this.emitChange(this)});return this.emitChange(this),r}stop(){this.executions.forEach(e=>e.cancel()),this.emitChange(this)}enable(){this._isEnabled=!0,this.emitChange(this)}disable(){this._isEnabled=!1,this.emitChange(this)}}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.RemoteTelnet=void 0;const t=n(0),o=n(49);a.RemoteTelnet=class{constructor(e){this.socket=e,this._isConnected=!1,this.emitClose=t.emitter(),this.onClose=this.emitClose.subscribe,this.emitData=t.emitter(),this.onData=this.emitData.subscribe,e.addEventListener("close",this.emitClose),e.addEventListener("message",this.onMessage.bind(this)),this.onData(()=>this._isConnected=!0),this.onClose(()=>this._isConnected=!1)}get isConnected(){return this._isConnected}connect(e,a){this.proxy("OPEN",{host:e,port:a})}send(e){this.socket.send(function(e){const a=new TextEncoder,n=e.normalize("NFD").replace(/[\u0300-\u036f]/g,"");return a.encode(n)}(e))}close(){this.socket.close()}proxy(e,a){this.socket.send(JSON.stringify({type:e,payload:a}))}async onMessage(e){const a=new FileReader;a.onloadend=()=>this.processor(a.result),a.readAsText(e.data,"ISO-8859-1")}processor(e){const a=/!!SOUND\((?<path>[\w\/\.]+) U=http:\/\/(?<host>[\w\/\.]+)\)/g;if(e.match(a)){for(const n of e.matchAll(a))o.playAudio("/assets/"+n.groups.path);e=e.replace(a,"")}this.emitData(e)}}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.playAudio=void 0;const t=new(n(2).ClientStorage)("invalid-audio"),o=new Set(t.get()||[]);a.playAudio=function(e){if(o.has(e))return;const a=new Audio(e);console.debug("AUDIO",e),a.volume=.05,a.play(),a.onerror=()=>{o.add(e),t.set([...o])}}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.registerWorkflows=void 0;const t=n(51),o=n(52),r=n(53),i=n(55),s=n(56),l=n(57),c=n(58),u=n(59),d=n(60),m=n(61),p=n(62),h=n(63),g=n(64),A=n(65),f=n(66),v=n(68),w=n(69),b=n(71),E=n(72),y=n(73),C=n(74);a.registerWorkflows=function(e){e.daemon("code",t.code),e.daemon("defend",o.defend),e.daemon("dope",r.dope),e.daemon("drink",i.drink),e.daemon("eat",s.eat),e.daemon("idle",l.idle),e.daemon("quest",c.quest),e.daemon("repair",u.repair),e.daemon("rest",d.rest),e.daemon("shop",m.shop),e.workflow("afk",p.afk),e.workflow("bank",h.bank),e.workflow("cast",g.cast),e.workflow("donations",A.donations),e.workflow("kill",v.kill),e.workflow("go",f.go),e.workflow("learn",w.learn),e.workflow("recover",b.recover),e.workflow("train",E.train),e.workflow("tutorial",y.tutorial),e.workflow("wear",C.wear)}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.code=void 0;const t=new(n(2).ClientStorage)("things-in-rooms");a.code=function({when:e}){e(/Salidas: [^\.]+\.\n\n([^<]+)\n<\d+/,({captured:e})=>{if(e[1].includes("Solo puedes leer mails de ese buzon."))return;const a=e[1].split(/\n/).map(e=>e.trim()),n=t.get()||{};a.forEach(e=>n[e]=(n[e]||0)+1),t.set(n)},{captureLength:5e3})}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.defend=void 0;const t=n(9),o=n(6);a.defend=async function({isRunning:e,run:a,when:n,write:r,plugins:{prompt:i,skills:s,navigation:l}}){n("Estas demasiado exhausto para huir del combate!",()=>l.recall()),n(["Sientes escalofrios a la vez que tiemblas.","No te encuentras nada bien."],()=>a("cast","curar veneno")),n(" te DESARMA!",()=>r("vestir todo")),n(t.ATTACK_RECEIVED,async({groups:a})=>{if(e("kill"))return;const n=i.getPercent("mana"),r=a.mob;if(!r||n<=.1)return;const l=t.getMobIn(r),c=i.getPercent("hp")<.5?[...o.SPELLS_BY_TYPE.massAttack,...o.SPELLS_BY_TYPE.attack]:o.SPELLS_BY_TYPE.attack;await s.castSpell(c,l?l.name:r)}),n(".. Todo empieza a volverse negro.\n",async()=>{const e="Tu cuerpo aparece de repente, rodeado por una divina presencia...";let a=0;const t=n(e,()=>a++);for(await i.until(),await r("despertar"),await r("suplicar cuerpo"),await n(e).timeout(5),t.unsubscribe(),n("El cadaver de May pasa a convertirse en polvo",()=>a--);a;)r("coger todo may"),await i.until(),r("vestir todo"),await i.until(),await i.until()}),n("Esta completamente oscuro ...",async()=>{await s.can("luz eterna")&&(await a("cast","luz eterna"),r("vestir luz"),r("mirar"))}),n("Estas maldito y no puedes usar el regresar!",async()=>{await s.can("retirar maldicion")&&(await a("cast","retirar maldicion"),await l.recall())}),n(/El cadaver de.* contiene:(?<items>(?:.|\n)+)\n[^ ]/,({groups:e})=>{e.items.toLowerCase().split(/\n/).map(e=>e.trim()).filter(e=>e&&"nada."!==e).some(e=>e.includes("llave"))&&r("coger llave cuerpo")}),n("Tragas agua al intentar respirar!",async()=>{await s.can("respiracion acuatica")&&s.castSpell("respiracion acuatica")})}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.dope=void 0;const t=n(2),o=n(6),r=n(54),i=new t.ClientStorage("dope:casting"),s=Object.values(o.SPELLS_BY_TYPE);a.dope=async function({when:e,register:a,run:n,plugins:{prompt:t,skills:l}}){const c=h(.2),u=h(.1,.8),d=new Set(i.get()),m=o.getSpells();let p=null;function h(e,a=1){const n=1/(a-e);return(t,o)=>{if(0===t||o>a)return!1;if(o<e)return!0;const r=(o-e)*n;return Math.hypot(t,1-r)>1}}function g(e){const a=s.find(a=>a.includes(e));return a||[e]}m.filter(e=>e.end).forEach((async function(a){const t=g(a.name),o=()=>n("cast",t).catch(()=>null);e(a.end,async()=>{d.add(t),i.set([...d]);const e=p||Promise.resolve();p=e.then(o);await p&&(d.delete(t),i.set([...d]))})})),t.onUpdate(async({isFighting:e,mana:{percent:a},hp:{percent:n},mv:{percent:t}})=>{if(e)return;const r=await l.can("meditar");return a<.1&&!r?void 0:a<.7&&r?l.meditate():n>0&&c(a,n)?l.castSpell(o.SPELLS_BY_TYPE.heal):n>0&&u(a,t)?l.castSpell("refrescar"):void 0}),e("No puedes mantener un pensamiento fijo.",async()=>{await l.can("curar veneno")}),a("dope",async({run:e},a)=>{const n=m.filter(e=>e.effect&&(!a||e.target)).map(e=>g(e.name)),t=r.uniq(n.map(e=>e.join("|"))).map(e=>e.split("|"));for(const n of t)await l.can(n)&&await e("cast",n,a)})}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.uniq=void 0,a.uniq=function(e){return[...new Set(e)]}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.drink=void 0,a.drink=async function({run:e,when:a,write:n,plugins:{inventory:t,navigation:o,skills:r}}){let i=!1,s=!1,l=!0;async function c(){return t.has({"un odre de cuero":"odre","una cantimplora":"cantimplora"})}o.onRoomChange(()=>i=!1),a(["Un manantial magico esta aqui.","Una hermosa fuente de marmol blanco esta aqui.","Trazas un circulo delante tuyo del cual emerge un manantial de agua cristalina."],async()=>{if(setTimeout(()=>i=!0,100),!s){const e=await c();e&&(n("llenar "+e),s=!0)}l&&(n("beber"),l=!1)}),a(["Te apetece dar un sorbo a algo refrescante.","Tienes sed.","Estas realmente sediento.","Estas MUERTO de SED!","Estas en peligro de deshidratacion."],async()=>{if(i||await async function(){if(await r.can("crear manantial"))return e("cast","crear manantial")}())return void n("beber");const a=await c();if(!a)return console.log("No hay fuente de agua"),void(l=!0);n("beber "+a),s=!1,await r.can("crear agua")&&await r.castSpell("crear agua",a)===r.CASTED&&(s=!0)})}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.eat=void 0,a.eat=async function({run:e,when:a,write:n,plugins:{inventory:t,navigation:o,skills:r}}){async function i(){const o=await async function(){return await s(),await t.has({"una seta magica":"seta","un chorizo":"chorizo","pavo cocinado":"pavo","una chuleta de cordero":"chuleta","loncha de salami":"salami","pierna de cordero":"pierna","ricas longanizas":"longanizas","un extranyo hongo":"hongo"})}();return o?(n("comer "+o),t.refresh(),!0):await async function(){if(!await r.can("crear comida")||!await e("cast","crear comida"))return!1;n("coger seta");try{return await a("Coges una seta magica.").timeout(3),n("comer seta"),!0}catch(e){return!1}}()}async function s(){if(await t.has("una bolsa")){n("coger todo bolsa"),n("examinar bolsa");const{captured:e}=await a(/Una bolsa contiene:\n\s+(Nada)?/);e[1]&&n("tirar bolsa")}}a(["Tienes hambre.","Estas realmente hambriento."],i),a(["Estas terriblemente hambriento.","Estas HAMBRIENTO!"],async()=>{await i()||o.isAtRecall&&(await async function(){await o.execute("2sen"),n("comprar 1 chuleta"),await a.any(a("Compras una chuleta de cordero."),a("El carnicero pone todo en una bolsa y te la da.").then(s)),await o.execute("sw2n")}(),await i())})}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.idle=void 0,a.idle=async function({when:e,write:a,run:n,plugins:{navigation:t,skills:o}}){e("Escribe MIRAR CARTEL para empezar el aprendizaje",()=>n("tutorial")),e("Desapareces en la nada.",async()=>{console.log("IDLE"),t.isAtRecall?(await n("train"),await o.can("invisibilidad")&&await n("cast","invisibilidad")):a("estado")})}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.quest=void 0,a.quest=async function({when:e,write:a,plugins:{navigation:n}}){e(/El tesoro parece estar(?: al) (?<dir>\w+) de aqui.../,async({groups:e})=>{await n.go(e.dir),a("carto mapa")}),e("No has desenterrado nada a pesar de haber cavado bien hondo.",()=>a("cavar"))}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.repair=void 0;const t=n(10),o={Calimhar:"r2ses",Earand:null,Valmorag:"r4swd2n",Niruk:null},r=["El herrero","Grimloz"];a.repair=async function({isRunning:e,sleep:a,when:n,write:i,register:s,plugins:{inventory:l,navigation:c,prompt:u}}){async function d(e){for(const a of e)i("guardar "+a),await n(t.UNWEAR);return await p(),c.execute("nw2n")}async function m(){const e=[...(await l.getByEffect("ROTO")).map(e=>t.getItemSustantive(e.name)).filter(Boolean)];i("equipo");const a=n(/>\s+\[\+*[^+]+\] (?<item>.*)/,({groups:a})=>{const n=t.getItemSustantive(a.item);n&&e.push(n)});return await n("Estas usando:"),await u.until(),a.unsubscribe(),e.length?e:null}async function p(){i("reparar todo"),await n.any(n(r.map(e=>e+" te cobra")).then(()=>!0),n(r.map(e=>e+" te cuenta")).then(()=>!1),a(5).then(()=>null)),i("vestir todo")}s("repair",async()=>{const e=await m();if(e){const a=await c.getRealm(),n=o[a];if(!n)throw new Error("No repair shop known in "+a);return await c.execute(n),d(e)}}),n("No puedes vestir eso, necesita repararse.",async()=>{if(e("donations"))return;await c.execute("r2ses"),await p();const a=await m();return a?d(a):void 0})}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.rest=void 0,a.rest=async function({when:e,write:a}){e(["Nah... Estas demasiado relajado...","En tus suenyos o que?","Estas demasiado relajado para lanzar ese conjuro."],()=>a("despertar"))}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.shop=void 0;const t={viajar:{path:{Calimhar:"r2s3wn"},amount:5}};a.shop=async function({when:e,write:a,register:n}){e(/pone todo en una bolsa y te la da\./,async()=>{a("coger todo bolsa"),a("examinar bolsa"),await e(/Una bolsa contiene:\n\s+Nada\./),a("tirar bolsa")}),n("buy",async({when:e,write:a,plugins:{navigation:n}},o,r)=>{if(!(o in t))throw new Error(`Unknown item type "${o}"`);const i=await n.getRealm(),s=t[o],l=s.path[i],c=s.name||o;if(r||(r=s.amount||1),!l)throw new Error(`Can't find shop for ${o} on realm ${i}`);return await n.execute(l),a(`comprar ${r} ${c}`),e.any(e("Lo siento, esta cerrado, vuelve mas tarde.").then(()=>!1),e(["Compras ","pone todo en una bolsa y te la da"]).then(()=>!0))})}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.afk=void 0,a.afk=async function({abort:e,log:a,run:n,when:t,write:o,plugins:{navigation:r,prompt:i}},...s){const l=i.getValue("exp");let c=!1;for(console.log({initialExp:l}),t(".. Todo empieza a volverse negro.\n",async()=>{c=!0,await i.until();i.getValue("exp")>l&&e()});;)c&&(await t("El cadaver de May pasa a convertirse en polvo"),c=!1),await u(),a("AFK Completed. Restarting...");async function u(){try{await n("recover"),await n("repair"),await n("learn"),await n("dope"),await n("recover")}catch(e){console.log("Preparation error",e)}try{await n("train",(e=s||[],e[Math.floor(Math.random()*e.length)]))}catch(e){console.log("Train error",e)}var e;try{"Calimhar"===await r.getRealm()&&r.isAtRecall&&await n("bank")}catch(e){console.log("Bank error",e)}}}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.bank=void 0;const t=n(1),o=n(4);a.bank=async function({when:e,write:a,plugins:{navigation:n}},r){const i=t.concatRegexes(/Ingresas /,o.int(),/ monedas? de oro en tu cuenta bancaria./),s=t.concatRegexes(/Retiras /,o.int(),/ monedas? de oro de tu cuenta bancaria./);await n.execute("r4s2en"),a("banco saldo");const{groups:l}=await e(t.concatRegexes(/Estas llevando /,o.int("carring"),/ monedas de oro.\n/,/Tienes /,o.int("balance"),/ monedas de oro en el banco.\n/,/Lo que hace un total de /,o.int("total"),/ monedas de oro.\n/)),c=o.toInt(l.carring),u=o.toInt(l.total),d=null==r?Math.max(Math.ceil(.01*u),2e3):r;c<d?(a("banco retirar "+(d-c)),await e(s)):c>d&&(a("banco ingresar "+(c-d)),await e(i)),await n.execute("s2w4n")}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.cast=void 0,a.cast=async function({sleep:e,when:a,write:n,plugins:{prompt:t,skills:o}},r,...i){let s=!1;a("Tienes un bonito sueño donde eres el mejor mago del mundo.",()=>{s=!0,n("despertar")});const l=await async function a(){t.isFighting&&await t.until(e=>!e.isFighting);switch(await o.castSpell(r,i.join(" "))){case o.CASTED:case o.ALREADY_APPLIED:return!0;case o.NOT_AVAILABLE:return!1;case o.BUSY:await e(3);case o.FAILED:return a()}throw new Error("WTF DUDE")}();return!1===l&&console.warn(`Unable to cast "${r}"`),s&&(n("dormir"),await a(["Cierras los ojos y caes en un profundo suenyo.","Ya estas durmiendo."])),l}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.donations=void 0;const t=n(10),o=[{from:31,to:40,path:"4wn"},{from:21,to:30,path:"3wn"},{from:11,to:20,path:"2wn"},{from:1,to:10,path:"wn"},{from:41,to:50,path:"en"},{from:51,to:60,path:"2en"},{from:61,to:70,path:"3en"},{from:71,to:80,path:"4en"}];a.donations=async function({when:e,write:a,run:n,plugins:{navigation:r,stats:i}}){a("estado");const s=await i.getLevel(),l=o.find(e=>e.from<=s&&e.to>=s);if(!l)throw new Error(`No room for level "${s}"`);await r.execute("rh2w4n");const c=e(/Salidas: sur\.\n\n((?:.|\n)*)\n\n/,{captureLength:Number.MAX_VALUE});await r.execute(l.path);const{captured:u}=await c,d=u[1].split("\n").map(e=>e.trim());for(const e of Object.values(t.ITEM_SUSTANTIVES)){d.some(a=>a.includes(e)&&!a.includes("mallas"))&&await n("wear",e)}await r.recall()}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.go=void 0;const t=n(20),o=/^r?((?:x|\d+)?[nsewudohjkl])+$/i,r="un pergamino de viajar",i={Calimhar:"DarkHaven",Earand:"Justicia",Valmorag:"Tinieblas",Niruk:null};a.go=async function({run:e,when:a,write:n,plugins:{navigation:s,inventory:l,skills:c}},u){if(o.test(u))return s.execute(u);const d=t.getAreaMetadata(u);if(!d)throw new Error(`Can't resolve path or area "${u}"`);if(!d.path)throw new Error(`Area ${d.name} doesn't have a path`);const m=await s.getRealm();if(d.realm===m)return s.execute(d.path);const p=i[d.realm];if(!p)throw new Error(`Realm ${d.realm} doesn't have recall.`);if(await c.can("viajar")&&await e("cast","viajar",p))return s.execute(d.path);let h=!1;if(await l.has(r)?h=!0:await l.hasInBackpack(r)&&(n("coger viajar mochila"),h=await a.any(a("Coges un pergamino de viajar de").then(()=>!0),a("No hay nada parecido a eso en").then(()=>!1))),h)return n("recitar viajar "+p),await a("Recitas un pergamino de viajar.").timeout(3),s.execute(d.path);throw new Error(`No way to travel to ${d.name} in ${d.realm}`)}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=[{realm:"Calimhar",name:"Academia de Darkhaven",path:"rd",from:1,to:5,min:0,max:95},{realm:"Calimhar",name:"Bosque de las Hadas",path:"r6w2nwk2wh",from:1,to:5,min:0,max:95},{realm:"Calimhar",name:"Catacumbas de la Capilla",path:"r6w8se7s",from:15,to:25,min:0,max:95},{realm:"Calimhar",name:"Cementerio Oscuro",path:"r4s4ws",clan:"Legends",from:5,to:15,min:0,max:95},{realm:"Calimhar",name:"Ciudad Imperial",path:"r8e2n4el3e2sj",from:0,to:95,min:0,max:95},{realm:"Calimhar",name:"DarkHaven",path:"rd",from:0,to:95,min:0,max:95},{realm:"Calimhar",name:"El Campamento Goblin",path:"r10s4en3e2n",from:1,to:10,min:0,max:95},{realm:"Calimhar",name:"El Cementerio",path:"r6w8ses",from:5,to:10,min:0,max:95},{realm:"Calimhar",name:"El Centinela",path:"r7ws",from:5,to:10,min:0,max:95},{realm:"Calimhar",name:"El Gran Estadio",path:"r8e2n4el3e2s2jn",from:10,to:20,min:0,max:95},{realm:"Calimhar",name:"El Imperio Orco",path:"r13s2wn",clan:"Legends",from:10,to:20,min:0,max:95},{realm:"Calimhar",name:"El Jardin de los Heroes",path:"r8e2n4el3e2s2j8l8e5j4els",from:75,to:80,min:0,max:95},{realm:"Calimhar",name:"El Pantano Orco",path:"r13s2en",clan:"DarkAngels",from:5,to:30,min:0,max:95},{realm:"Calimhar",name:"El Refugio Destruido",path:"r8e2ne",from:5,to:20,min:0,max:95},{realm:"Calimhar",name:"Exportaciones de Dragones",path:"r4sen",clan:"Legends",from:5,to:25,min:0,max:95},{realm:"Calimhar",name:"Foire de Reves",path:"r8n3ene",from:0,to:50,min:0,max:95},{realm:"Calimhar",name:"Galeria de arte",path:"r4swn",from:10,to:50,min:0,max:95},{realm:"Calimhar",name:"Guarderia Enana",path:"r8ejs",from:1,to:5,min:0,max:95},{realm:"Calimhar",name:"Haon Dor",path:"r7w",from:5,to:10,min:0,max:95},{realm:"Calimhar",name:"Holy Grove",path:"r9e",from:5,to:20,min:0,max:95},{realm:"Calimhar",name:"Kharadest, Baluarte de Platino",from:78,to:80,min:77,max:95},{realm:"Calimhar",name:"La Fortaleza de Valor",path:"r11n2en",clan:"DragonSlayers",from:5,to:30,min:0,max:95},{realm:"Calimhar",name:"La Mansion de Marmol",path:"r9w3s",from:5,to:15,min:0,max:95},{realm:"Calimhar",name:"La Mansion de Tullfuhrzky",path:"r6w2nwk2wh4nj",from:1,to:10,min:0,max:95},{realm:"Calimhar",name:"La Torre del Brujo",path:"r9w2sese2s",clan:"Legends",from:10,to:20,min:0,max:95},{realm:"Calimhar",name:"Las Alcantarillas",path:"r4sd",from:5,to:20,min:0,max:95},{realm:"Calimhar",name:"Las Llanuras del Norte",path:"r7n",from:1,to:20,min:0,max:95},{realm:"Calimhar",name:"Miden'nir",path:"r7s",from:5,to:15,min:0,max:95},{realm:"Calimhar",name:"Residencias de Mortales",from:0,to:95,min:0,max:95},{realm:"Calimhar",name:"Sindaliore",clan:"Legends",from:75,to:80,min:77,max:95},{realm:"Earand",name:"Armageddon",path:"r3s7w6n2wsl2sejls",clan:"Conclave",from:50,to:80,min:0,max:95},{realm:"Earand",name:"Asgard",path:"r3s7w11ne2n2enhjn;entrar;.s",clan:"El Santuario",from:40,to:60,min:0,max:95},{realm:"Earand",name:"Asoinwan, ciudad de las hadas",path:"r3s7w11ne2n",clan:"DragonSlayers",from:5,to:30,min:0,max:95},{realm:"Earand",name:"Camelot",path:"r3s7w11ne2n2ej",from:65,to:80,min:50,max:95},{realm:"Earand",name:"Dregoria",path:"r3s5e10n3wn",clan:"Cantico",from:40,to:65,min:0,max:95},{realm:"Earand",name:"El Calabozo de la Muerte",path:"ruse7n",from:10,to:35,min:0,max:95},{realm:"Earand",name:"El Campo de Batalla Desolado",path:"r3s7w6n2wsl2se",from:15,to:25,min:0,max:95},{realm:"Earand",name:"El Plano Astral",path:"r2su",clan:"DarkAngels",from:15,to:35,min:0,max:95},{realm:"Earand",name:"El Pueblo Fantasma",path:"r3s5e2j",clan:"DragonSlayers",from:35,to:50,min:0,max:95},{realm:"Earand",name:"El Reino de Yggdrasil",path:"r3s7w11ne2n2enhjn;entrar",from:15,to:50,min:0,max:95},{realm:"Earand",name:"El Yunque del Sol",path:"r3s7w6n2wsl2sejl2s5e4n3w2n4w",clan:"Legends",from:60,to:80,min:0,max:95},{realm:"Earand",name:"Estroglia, coraz�n del Yunque",clan:"DarkAngels",from:75,to:80,min:75,max:95},{realm:"Earand",name:"Ghotiamir",path:"r",from:0,to:95,min:0,max:95},{realm:"Earand",name:"La Ciudad de Velas",path:"r3s7wn",from:45,to:55,min:0,max:95},{realm:"Earand",name:"La Fortaleza de Lord Krothgar",path:"r3s5e3n",from:35,to:60,min:0,max:95},{realm:"Earand",name:"La Fortaleza Enana",path:"r3s5el2nj",clan:"El Santuario",from:35,to:65,min:0,max:95},{realm:"Earand",name:"La Guarida de Kotegaesi",path:"r3s7w6n2wslsk",from:30,to:45,min:0,max:95},{realm:"Earand",name:"La tumba de Damara",path:"r3s5w3n",clan:"Shinsent",from:15,to:25,min:0,max:95},{realm:"Earand",name:"Las Ruinas de los Antiguos",from:78,to:80,min:77,max:95},{realm:"Earand",name:"Observatorio del Ojo Celeste",path:"r3s3e2s",clan:"Cantico",from:25,to:65,min:0,max:95},{realm:"Earand",name:"Valle de Rivendel",path:"r3s7w11ne2n2e2n",from:60,to:80,min:0,max:95},{realm:"Earand",name:"Villa Enana",path:"r3s5el",from:10,to:35,min:0,max:95},{realm:"Niruk",name:"La casa de Anarion",from:75,to:80,min:75,max:95},{realm:"Niruk",name:"Las Tierras Desoladas",clan:"DarkAngels",from:10,to:80,min:0,max:95},{realm:"Niruk",name:"Residencia de Inmortales",from:81,to:95,min:0,max:95},{realm:"Niruk",name:"Tiempo de L'Hopital",from:75,to:80,min:75,max:95},{realm:"Valmorag",name:"Bosque de los Muertos",path:"r3s5e2n2e2ses2en",from:20,to:40,min:0,max:95},{realm:"Valmorag",name:"Dhusebark",path:"r",from:0,to:95,min:0,max:95},{realm:"Valmorag",name:"El Devorador de Mundos",path:"r3s5e2n2e2ses2e3n2wkwnwhne6nunj",from:30,to:50,min:0,max:95},{realm:"Valmorag",name:"El Legado de Xchantharus",path:"r3s5e2n2e3swse3sd9sh",clan:"El Santuario",from:30,to:50,min:0,max:95},{realm:"Valmorag",name:"El Mausoleo del Minotauro",path:"r3s5e2n2en",from:40,to:65,min:0,max:95},{realm:"Valmorag",name:"Guarida de Gigantes de Fuego",path:"r3s5wh2w",from:40,to:50,min:0,max:95},{realm:"Valmorag",name:"Infierno",path:"r4sd",from:30,to:80,min:0,max:95},{realm:"Valmorag",name:"La Ciudad Maldita",path:"r9sk3esek",clan:"Sindicato",from:40,to:80,min:0,max:95},{realm:"Valmorag",name:"La Fortaleza de Lilith",path:"r9sk2w3usw",clan:"Torre Arcana",from:65,to:80,min:55,max:95},{realm:"Valmorag",name:"La Fortaleza de Mahn-Tor",path:"r3s5e2n2e",from:5,to:35,min:0,max:95},{realm:"Valmorag",name:"La Gran Torre de la Hechiceria",path:"r3s5e2nj",from:10,to:30,min:0,max:95},{realm:"Valmorag",name:"La Maldicion del Nigromante",path:"r3s5e2n2e2s2e",clan:"Cantico",from:30,to:55,min:0,max:95},{realm:"Valmorag",name:"La Residencia de Redferne",path:"r9sk2w",from:20,to:30,min:0,max:95},{realm:"Valmorag",name:"Los Pozos de la Reina Aranya",from:40,to:55,min:0,max:95},{realm:"Valmorag",name:"Los Usurpadores de Hochenyana",path:"r3s6ele",clan:"Shinsent",from:20,to:35,min:0,max:95},{realm:"Valmorag",name:"Profundidades Umbrias",path:"r3s5e2n2e3swse3sd9sd",from:20,to:50,min:0,max:95},{realm:"Valmorag",name:"Puerto Libre",path:"r9ske",from:10,to:55,min:0,max:95},{realm:"Valmorag",name:"Valle de Morgul",path:"r9sk2w3us",clan:"Shinsent",from:30,to:55,min:0,max:95}]},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.kill=void 0;const t=n(9),o=n(6),r=n(1);a.kill=async function({sleep:e,when:a,write:n,plugins:{prompt:i,navigation:s,skills:l}},c){const{dedope:u}=o.SPELLS_BY_TYPE,d=c.startsWith("!");d&&(c=c.substr(1)),await async function a(n,t){if(i.getPercent("mana")<.1)return!1;switch(await l.castSpell(n,t)){case l.CASTED:case l.ALREADY_APPLIED:return!0;case l.NOT_AVAILABLE:return!1;case l.BUSY:await e(3);case l.FAILED:return a(n,t)}throw new Error("WTF DUDE")}(u,c)||n("matar "+c);const m=i.onUpdate(e=>{e.hp.percent<=.4&&s.recall()});await l.can("segundo ataque")&&a(t.ATTACK_RECEIVED,async({groups:e})=>{if(i.getPercent("mana")<.2)return;const a=e.mob,n=t.getMobIn(a),r=n?n.name:a||c,s=d?o.SPELLS_BY_TYPE.attack:[...o.SPELLS_BY_TYPE.massAttack,...o.SPELLS_BY_TYPE.attack];await l.castSpell(s,r)});const p=await a.any(s.waitForRecall().then(()=>"flee"),a([r.concatRegexes(c,/(?:\w|�| )* (ha)|(cae al suelo) MUERTO!!/i),"monedas de oro de el cadaver de un ladron"]).then(()=>"win"),a("No esta aqui.").timeout(3).then(()=>"missing"),a(["Huyes como un cobarde del combate.","Estas demasiado malherido para hacer eso.","Estas demasiado aturdido para hacer eso."]).then(()=>"flee"));return"win"===p&&setTimeout(()=>async function(e){n("sacrificar cuerpo")}()),m(),p}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.learn=void 0;const t=n(70);a.learn=async function({when:e,write:a,plugins:{navigation:n,skills:o}},...r){let i=await o.practices;if(!i)return void console.warn("No practices left");const s=r.join(" ");if(s)return await o.can(s)?void console.warn(s+" already known!"):c(()=>u(s));const l=await async function(){const e=[];for(const a of t.SKILL_LEARN_ORDER)if(Array.isArray(a))for(const n of a){if(await o.can(n))break;if(await o.canLearn(n)){e.push(n);break}}else await d(a)&&e.push(a);return e}();if(l.length)return c(async()=>{for(const e of l)if(await u(e),i--,!i)break;return o.refresh()});async function c(e){await n.execute("rdnne"),await e(),await n.execute("wssu")}async function u(n){a("practicar "+n),await e.any(e("Ahora deberas practicarlo por tu cuenta...").then(()=>!0),e(["Tienes que conseguir mas sesiones de practicas.","Ya te he enseñado cuanto podia sobre"]).then(()=>!1))}async function d(e){return!await o.can(e)&&o.canLearn(e)}console.warn("Nothing to learn")}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.SKILL_LEARN_ORDER=void 0,a.SKILL_LEARN_ORDER=["estilo evasivo","armas impacto",["crear manantial","crear agua"],["crear baya","crear comida","saciar hambre"],"luz eterna","refrescar",["invocar oso","invocar jaguar","invocar lobo","invocar aguila","invocar lince","invocar armadillo"],"identificar","meditar","proteccion","polimorfar","viajar","dormir",["sanar","curar criticas","curar graves","curar leves"],"curar ceguera","curar veneno","danyo incrementado",["cuarto ataque","tercer ataque","segundo ataque"],["parada","esquivar"],["manotazo","patada","pisoton","agarron impactante"],["causar fatales","causar critica","causar grave","causar leve"],["ceguera","veneno","maldecir","debilitar","desarmar","relentizar"],["terremoto","maremoto"],["tormenta hielo","rafaga viento","relampago helado","relampago","llamar rayo","bola fuego","misil magico","golpe flamigero","rayo solar","drenar energia","metal ardiente","enredo vegetal"],["punyo_helado","punyo_electrico"],["esconderse","invisibilidad"],"armadura","bendecir",["piel petrea","piel robliza"],["volar","flotar"],"vision verdadera","detectar invisible","detectar escondido","detectar magia","detectar maldad","detectar trampas","sigilo","respiracion acuatica","fuerza vampirica","atravesar puerta","furia naturaleza",["escudo electrico","escudo hielo","escudo flamigero"],"encantar arma","santuario","atravesar vegetacion","escudo","delirio caotico","cavar","cartografia","despellejar","carpinteria","fuego espectral","montar","crear fuego","buscar","escalar","primeros auxilios","conocer alineamiento","niebla espectral","disipar maldad","control climatico","detectar veneno","localizar objeto","disipar magia","retirar invisibilidad","otear","retirar maldicion","sonyar","vista distancia","estilo defensivo","retirar trampa","invisibilidad grupo","invocar regreso","rastrear","vara robliza","clonacion"]},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.recover=void 0;const t=n(6);a.recover=async function({run:e,sleep:a,plugins:{skills:n,prompt:o}}){const r=t.SPELLS_BY_TYPE.heal,i="refrescar",s="invisibilidad",l=await n.can(r),c=await n.can(i),u=await n.can("meditar"),d=await n.can(s),m=()=>o.getPercent("mana"),p=()=>o.getPercent("hp")<(u?1:Math.max(m(),.5)),h=()=>m()<.8,g=()=>o.getPercent("mv")<1,A=()=>u?m()>.3:m()>.1;for(;l&&p()||u&&h()||c&&g();){let t=!1;if(d&&!o.isInvisible&&(t=!0,await e("cast",s)),l&&p()&&A()&&(t=!0,await e("cast",r)),c&&g()&&A()&&(t=!0,await e("cast",i)),u&&h()){t=!0;await n.meditate()===n.BUSY&&await a(2)}if(!t)break}await o.until(()=>{const e=!p()&&!h()&&!g();return e||console.log("Resting..."),e})}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.train=void 0;const t=n(20),o=n(9),r=["Un hombre desnudo yace sobre sus propios excrementos.","Una figura humanoide resplandece detras de un brillante campo de fuerza."];a.train=async function({log:e,run:a,when:n,write:i,plugins:{navigation:s,prompt:l,stats:c}},u){if("test"===u){const e=await w();return void console.log(e.name,e)}const d=await async function(e){const a=e?t.getAreaMetadata(e):await w();if(console.log("Train at",a),!a)throw new Error(`NO AREA "${e}"`);if(!a.arena)throw new Error(`"${a.name}" training path is unknown`);const n=a.path.split(""),o=n.pop(),r=Array.isArray(a.arena)?a.arena.join(""):a.arena;return{path:n.join(""),arena:`${o}${r}`}}(u),m=o.getMobIn("ladron"),p=[];let h=!1;n(o.getMobsPresence(),({patterns:e,fullMatch:a,captured:n})=>{if(!e.some(e=>r.includes(e)))return A(o.getMobFromPresence(e)||o.getMobIn(a||n[0]));h=!0}),n(o.MOB_ARRIVES,({groups:e})=>A(o.getMobIn(e.mob))),n(o.MOB_LEAVES,({groups:e})=>e.mob&&f(o.getMobIn(e.mob))),n(o.MOB_DIES,({groups:e})=>e.mob&&f(o.getMobIn(e.mob)));const g=`${d.path}${d.arena}`;return i("visible"),i("huida"),console.log({route:g}),await s.execute(g,(async function(){if(h)return h=!1,!0;e("ENTER_ROOM"),await l.until(({mv:{current:e}})=>e>50);for(;p.length;){if(await v())return!1;const t=a("recover");await n.any(t,n(o.MOB_ARRIVES).then(()=>t.cancel())),e("READY_TO_FIGHT!!!")}})),s.recall();function A(e=null){!e||e===m&&p.includes(m)||p.push(e)}function f(e=null){if(e){const a=p.indexOf(e);a>-1&&p.splice(a,1)}}async function v(){for(e("CHECK_ENEMIES",p.length);p.length;){const e=p[0],n=await a("kill",e.name);if("flee"===n)return console.log("Had to run. Train over."),await s.recall(),!0;"missing"===n&&p.shift()}}async function w(){const[e,a]=await Promise.all([s.getRealm(),c.getLevel()]),n=t.getAreasForLevel(e,a),[o,...r]=n.filter(e=>e.arena);return console.log("Selected arena",o.name,r.map(e=>e.name)),o}}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.tutorial=void 0;const t=n(16);a.tutorial=async function({when:e,write:a,run:n,plugins:{prompt:o}}){const r=t.conversation(e,a);async function i(t,r){await e("Combates para ");let i=0;const s=e(r,()=>i++);await o.until(),s.unsubscribe();for(let e=0;e<i;e++)await n("kill",[t]),await o.until(),a("coger todo cuerpo"),await o.until(),a("vestir todo"),await o.until()}await r({"Escribe MIRAR CARTEL para empezar el aprendizaje":"mirar cartel","Para continuar el aprendizaje escribe NORTE":"norte","mirame con el comando MIRAR POLARD":"mirar polard","Escribe esto: DECIR HOLA":"decir hola","Ahora puedes ir hacia el NORTE":"norte","escribe COGER HOJA para cogerlo del suelo":"coger hoja","Escribe: DAR HOJA VERNER":"dar hoja verner","Para usarla escribe: VESTIR ARMADURA":"vestir armadura","Ahora continua hacia el ESTE":"este","cuando termines escribe: DECIR LISTO":"decir listo","Ahora escribe: TIRAR MASCARA":"tirar mascara","Ahora escribe: COGER MASCARA":"coger mascara","Ahora escribe: VESTIR MASCARA":"vestir mascara","Escribe ESTE para pasar al siguiente nivel de aprendizaje":"este","para ello ves al NORTE y escribe MATAR ORCO":"norte","Un asqueroso orco aparece para enfrentarse a ti":"matar orco","El cadaver de el orco contiene":"sur","Ves al ESTE para continuar tu aprendizaje":"este","Escribiendo PRACTICAR veras la lista":"practicar","PRACTICA lo que creas necesario":"practicar luz","Practicas luz eterna":"practicar estilo evasivo","Practicas estilo evasivo":"decir listo","Para continuar, escribe DECIR LISTO":"decir listo","Para ello escribe ENTRENAR CON":"entrenar con","Sientes como tu con":"entrenar sab","Sientes como tu sab":"decir listo","Te llevare cuando digas DECIR LLEVAME":"decir llevame","Ves al NORTE a matarlos":"norte"}),a("estilo evasivo"),await i("monstruito","Un monstruito que te mira mientras babea"),a("sur"),await e("que te encargues de los bichos del ESTE"),a("este"),await i("kobold","Un kobold con las manos atadas te mira fijamente"),a("oeste"),await e("Ahora a por los del OESTE"),a("oeste"),await i("minotauro","Un minotauro grunye mientras te mira fijamente"),a("este"),await e("Ya solo te quedan los del SUR"),a("sur"),await i("gnoll","Un joven gnoll esta aqui preparado para atacarte"),a("tirar todo"),a("norte"),await r({"Continua hacia ABAJO":"abajo","escribe COMPRAR":"lista","Un odre de cuero":"comprar odre","Escribe BEBER ODRE":"beber odre","Bebes agua de un odre de cuero":"norte","Quieres escucharlos?":"decir no","Si quieres irte simplemente escribe RECALL":"recall"})}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.wear=void 0;const t=n(10),o=n(1);a.wear=async function({run:e,sleep:a,when:n,write:r,plugins:{skills:i}},...s){const l=s.length?s:t.ITEM_SUSTANTIVES;for(const e of l)for(let a=0;a<5&&!await c(e);a++);async function c(s){r(`coger "${s}"`);if(!await n.any(n(`No hay ningun ${s} aqui.`).wait(8).then(()=>!1),n(o.concatRegexes(/Coges/,t.ITEM_ARTICLE,/(?: (?:\\w|�)+)* /i,s)).then(()=>!0)))return console.warn(`Couldn't pick up "${s}"`),!0;if(await i.can("identificar")){let t=!1;const o=n(" es un(a) armadura_metalica,",()=>t=!0),r=await e("cast","identificar",s);if(await a(1),o.unsubscribe(),!r)return console.warn(`Couldn't identifiy "${s}"`),await u(s),!1;if(t)return await u(s),!1}r(`vestir "${s}"`);const l=await n.any(n(t.WEAR).then(()=>!0),n(t.UNWEAR).then(({groups:e})=>e.item),n(["No tienes ese objeto.",/Debes ser nivel \w+ para usar este objeto./,"No puedes vestir eso, necesita repararse.","Te esta prohibido usar ese objeto.","No puedes vestir un objeto que no te pertenece."]).then(()=>!1));if(!1===l)return await u(s),!1;if("string"==typeof l){const a=t.getItemSustantive(l);a&&(await e("cast","identificar",a),r(`poner ${a} mochila`),await n(" en una mochila "))}return!0}function u(e){return r(`tirar "${e}"`),n("Tiras ")}}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.renderUserInterface=void 0,n(76);const t=n(2),o=n(11),r=n(21),i=n(77),s=n(80),l=n(12),c=n(81),u=n(82);a.renderUserInterface=function(e){const a=function(){const e=new t.ClientStorage("ui:state");e.get()||e.set({showControls:!1});return e}(),n=a.get(),d=new u.Terminal,m=new s.Hamburger(n.showControls);m.onChange(g);const p=o.dom`
    <div class="container">
      ${d.render()}
    </div>
  `;function h(){l.render(l.html`
        <${i.Controls} ...${r.getControlsProps()} />
        <${c.Sidebar} ...${r.getSidebarProps()} />
      `,p)}return r.onStateChange(h),h(),e.appendChild(p),e.appendChild(m.render()),g(n.showControls),d;function g(e){e?(p.classList.add("show-controls"),n.showControls=!0):(p.classList.remove("show-controls"),n.showControls=!1),a.set(n)}}},function(e,a,n){"use strict";n.r(a);var t=n(24),o=n.n(t),r=n(13),i={insert:"head",singleton:!1};o()(r.a,i);a.default=r.a.locals||{}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.Controls=void 0;const t=n(12);a.Controls=function(e){const a=e.meters.map(e=>t.html`
      <div class="meter">
        <div
          class="bar"
          style="
          width: ${Math.round(100*e.value)}%;
          background-color: ${e.color}
        "
        ></div>
      </div>
    `),n=e.buttons.map(e=>t.html`
      <button class="ui-button" onclick="${e.onClick}">${e.name}</button>
    `);return t.html`
    <header class="controls">
      <div class="meters">
        ${a}
      </div>

      ${n}
    </div>
  `}},,,function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.Hamburger=void 0;const t=n(11),o=n(0);a.Hamburger=class{constructor(e=!1){this.$checkbox=t.dom`<input type="checkbox" />`,this.$el=t.dom`
    <div class="hamburger">
      ${this.$checkbox}
      <span></span>
      <span></span>
      <span></span>
    </div>
  `,this.emitChange=o.emitter(),this.onChange=this.emitChange.subscribe,this.toggle=this.toggle.bind(this),this.$checkbox.checked=e}render(){return this.$checkbox.addEventListener("change",this.toggle),this.$checkbox.checked&&this.toggle(),this.$el}toggle(){this.emitChange(this.$checkbox.checked)}}},function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.Sidebar=void 0;const t=n(12);function o({workflow:e}){const{isEnabled:a,isRunning:n,instancesRunning:o}=e,i=o>1?` (${o})`:"",l=`${e.name}${i}`,c=["workflow",n?"running":"idle",a?"enabled":"disabled","expanded"];return t.html`
    <li class="${c.join(" ")}">
      <div class="workflow-content">
        <header>
          <h3 class="name">${l}</h3>
          <${r} workflow=${e} />
        </header>

        <${s} workflow=${e} />
      </div>
    </li>
  `}function r({workflow:e}){const{isEnabled:a,isRunning:n}=e,o=[a?t.html`
        <${l} className="enable-control" onClick=${()=>e.disable()}>
          <${c} name="check" />
          <${c} name="times" />
        </Button>
      `:t.html`
        <${l} className="enable-control" onClick=${()=>e.enable()}>
          <${c} name="times" />
          <${c} name="check" />
        </Button>
      `];return a&&o.push(n?t.html`
          <${l} onClick=${()=>e.stop()}>
            <${c} name="stop" />
          </Button>
        `:t.html`
          <${l} onClick=${()=>e.execute()}>
            <${c} name="play" />
          </Button>
        `),o}a.Sidebar=function(e){return t.html`
    <aside class="sidebar">
      <div class="workflows">
        <h1 class="title">Workflows</h1>
        <ul class="workflow-list">
          ${e.workflows.map(e=>t.html`<${o} workflow=${e} />`)}
        </ul>
      </div>
    </aside>
  `};const i=new WeakMap;function s({workflow:{triggers:e}}){const a=e.map(e=>{const a=e.patterns.map(e=>{const a=u.has(e)?"blink":"";return t.html`<span class="pattern ${a}">${e}</span>`});return i.has(e)||(e.onMatch(({patterns:e})=>e.forEach(d)),i.set(e,!0)),t.html`<li class="trigger">${a}</li>`});return t.html`<ul class="triggers">
    ${a}
  </ul>`}function l({children:e,className:a,onClick:n}){return t.html`
    <button class="action ${a}" onClick="${n}">
      ${e}
    </button>
  `}function c({name:e}){return t.html`<i class="fas fa-${e}"></i>`}const u=new Map;function d(e){u.has(e)&&clearTimeout(u.get(e)),u.set(e,setTimeout(()=>u.delete(e)))}},function(e,a,n){"use strict";var t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(a,"__esModule",{value:!0}),a.Terminal=void 0;const o=t(n(83)),r=n(2),i=n(11),s=n(0),l=new o.default,c=new r.ClientStorage("mud:command-history");function u(e){const a=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/  +/g,e=>"&nbsp;".repeat(e.length));return l.toHtml(a).replace(/\n/g,"<br>")}a.Terminal=class{constructor(){this.$log=i.dom`<span class="log" aria-live></span>`,this.$input=i.dom`<input type="text" size="${3}" autofocus>`,this.$el=i.dom`
    <main class="terminal">
      <div class="scroll-bottom">
        ${this.$log}
        ${this.$input}
      </div>
    </main>
  `,this.history=c.get()||[],this.lastChunk="",this.histPos=0,this.emitSubmit=s.emitter(),this.onSubmit=this.emitSubmit.subscribe,this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this)}focus(){this.$input.focus()}render(){return this.$el.addEventListener("click",()=>setTimeout(()=>!function(){const e=getSelection();return e&&"Range"===e.type}()&&this.$input.focus(),80)),this.$input.addEventListener("keydown",this.onKeyDown),this.$input.addEventListener("keyup",this.onKeyUp),this.$el}write(e){const a=`${this.lastChunk}${n=e,n.replace(/\r/g,"")}`.split(/\n\n+/);var n;this.lastChunk=a.pop();for(const e of a)this.$log.before(i.dom`<p>${{__html__:u(e)}}</p>`);this.$log.innerHTML=u(this.lastChunk),this.clearLog()}clearLog(){const e=this.$log.parentElement,a=e.children.length-2e3;for(let n=0;n<a;n++)e.removeChild(e.firstChild)}onKeyDown(e){"Enter"===e.code&&this.submit(),"ArrowUp"===e.code&&this.loadHistory(1),"ArrowDown"===e.code&&this.loadHistory(-1),this.onKeyUp(e)}onKeyUp(e){const a=this.$input.value;this.history[0]=a,this.$input.size=a.length+3}submit(){const{value:e}=this.$input;this.$input.value="",this.histPos=0,e&&e!==this.history[1]&&(this.history.shift(),this.history.unshift(e),this.history.unshift(""),c.set(this.history));for(const a of e.split(/;\s+/))this.emitSubmit(a)}loadHistory(e){var a,n,t;this.history.length&&(this.history[this.histPos]=this.$input.value,this.histPos=(a=this.histPos+e,n=0,t=this.history.length-1,a<n?n:a>t?t:a),this.$input.value=this.history[this.histPos])}}},,,,,,,,function(e,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.getQueryParams=void 0,a.getQueryParams=function(){const e={};return window.location.search.substr(1).split("&").map(e=>e.split("=").map(decodeURIComponent)).forEach(([a,n])=>e[a]=n),e}}]);
//# sourceMappingURL=main.js.map
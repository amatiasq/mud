!function(e){function n(n){for(var a,s,i=n[0],c=n[1],l=n[2],d=0,m=[];d<i.length;d++)s=i[d],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&m.push(r[s][0]),r[s]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);for(u&&u(n);m.length;)m.shift()();return o.push.apply(o,l||[]),t()}function t(){for(var e,n=0;n<o.length;n++){for(var t=o[n],a=!0,i=1;i<t.length;i++){var c=t[i];0!==r[c]&&(a=!1)}a&&(o.splice(n--,1),e=s(s.s=t[0]))}return e}var a={},r={0:0},o=[];function s(n){if(a[n])return a[n].exports;var t=a[n]={i:n,l:!1,exports:{}};return e[n].call(t.exports,t,t.exports,s),t.l=!0,t.exports}s.m=e,s.c=a,s.d=function(e,n,t){s.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,n){if(1&n&&(e=s(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(s.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var a in e)s.d(t,a,function(n){return e[n]}.bind(null,a));return t},s.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(n,"a",n),n},s.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},s.p="";var i=window.webpackJsonp=window.webpackJsonp||[],c=i.push.bind(i);i.push=n,i=i.slice();for(var l=0;l<i.length;l++)n(i[l]);var u=c;o.push([26,1]),t()}([,,,function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.concatRegexesUnescaped=n.concatRegexes=void 0;const a=e=>(...n)=>{const t=n.map(n=>n instanceof RegExp?n.toString().replace(/^\/|\/[gi]*$/g,""):e(n)).join(""),a=n.map(e=>e instanceof RegExp&&e.flags).filter(Boolean).join(""),r=[...new Set(a)].join("");return new RegExp(t,r)};function r(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/\n/g,"\\n")}n.concatRegexes=a(r),n.concatRegexesUnescaped=a(String)},,,function(e,n,t){"use strict";function a(e){return e.cloneNode(!0)}Object.defineProperty(n,"__esModule",{value:!0}),n.render=void 0,n.render=function(e,n){"string"==typeof e&&(e=function(e){const n=document.createElement("template");return n.innerHTML=e,n}(e));const t=e instanceof HTMLTemplateElement?a(e.content):a(e);if(n)for(const[e,a]of Object.entries(n)){const n=t.querySelector(e);n?a(n):console.error(`Selector ${e} returned no results`)}return Object.assign(t,{$:e=>t.querySelector(e)})}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.wait=void 0,n.wait=function(e){return new Promise(n=>setTimeout(n,1e3*e))}},function(e,n,t){"use strict";function a(){return Object.entries(r).filter(([e,n])=>n).map(([e,n])=>({...n,name:e}))}Object.defineProperty(n,"__esModule",{value:!0}),n.getSpell=n.getSpells=n.SPELL_LEARN_ORDER=n.SPELLS_BY_TYPE=n.SPELL_NOT_POSSIBLE=n.SPELL_ALREADY_APPLIED=n.SPELL_FAILED=n.UNKNOWN=void 0,n.UNKNOWN=null,n.SPELL_FAILED=["Algo te distrae y pierdes la concentracion.","Has perdido la concentracion.","Has tenido una laguna mental mientras invocabas el hechizo.","Pierdes la concentracion.","Un picor en la nariz te impide mantener la concentracion.","Un pinchazo en tu pierna te impide lanzar el conjuro adecuadamente.","Una mota de polvo en el ojo rompe tu concentracion por un momento."],n.SPELL_ALREADY_APPLIED=["Has fallado.","Eso no parece tener ningun efecto."],n.SPELL_NOT_POSSIBLE=["No tienes suficiente mana.","Sobre que quieres lanzar este conjuro?","No puedes encontrar ningun ","Este estilo de lucha pide demasiado atencion para hacer eso!","Este asalto del combate es demasiado febril para concentrarte adecuadamente.","No has tenido suficiente tiempo en este asalto para completar el conjuro.","Estas demasiado malherido para hacer eso.","Estas demasiado aturdido para hacer eso."],n.SPELLS_BY_TYPE={food:["crear baya","crear comida"],water:["crear manantial","crear agua"],levitate:["volar","flotar"],heal:["curar criticas","curar graves","curar leves"],attack:["causar critica","causar grave","causar leve"],dedope:["ceguera","veneno"]},n.SPELL_LEARN_ORDER=[n.SPELLS_BY_TYPE.food,n.SPELLS_BY_TYPE.water,n.SPELLS_BY_TYPE.dedope,"luz eterna","invisibilidad","invocar armadillo","armadura","bendecir","detectar escondido","detectar invisible","detectar magia",n.SPELLS_BY_TYPE.levitate,"curar ceguera",n.SPELLS_BY_TYPE.heal,"refrescar",n.SPELLS_BY_TYPE.attack,"crear fuego"],n.getSpells=a,n.getSpell=function(e){const n=e.toLowerCase();return a().find(e=>e.name.toLowerCase().startsWith(n))};const r={armadura:{success:"Tu armadura brilla suavemente al ser mejorada por un conjuro.",target:/La armadura de (?<target>(?:\w+ )+)brilla suavemente al ser mejorada por un conjuro\./,endEffect:"Tu armadura vuelve a su valor normal.",dope:!0},bendecir:{success:"Tu dios te otorga una poderosa bendicion.",endEffect:"La bendicion desaparece."},"bola fuego":n.UNKNOWN,"causar critica":n.UNKNOWN,"causar grave":{success:/Tu conjuro [^\n]+ a( w+)+!/},"causar leve":n.UNKNOWN,ceguera:{success:/Lanzas un conjuro de ceguera contra ([^.]+)./},"conocer alineamiento":n.UNKNOWN,"control climatico":n.UNKNOWN,"crear agua":{success:" esta lleno.\n"},"crear baya":n.UNKNOWN,"crear comida":{success:"Una seta magica aparece de repente."},"crear fuego":{success:"Una gran hoguera se enciende en el suelo delante tuyo."},"crear manantial":{success:"Trazas un circulo delante tuyo del cual emerge un manantial de agua cristalina.",endEffect:"Un manantial magico se seca."},"curar ceguera":n.UNKNOWN,"curar criticas":n.UNKNOWN,"curar graves":n.UNKNOWN,"curar leves":{success:"Tus heridas leves se cierran y el dolor desaparece."},"curar veneno":n.UNKNOWN,"detectar escondido":{success:"Tus sentidos cobran la viveza de los del mejor predador.",target:!1,endEffect:"Te sientes menos consciente de lo que te rodea.",dope:!0},"detectar invisible":{success:"Tus ojos brillan, siendo capaces ahora de ver lo invisible.",target:!1,endEffect:"Ya no ves objetos invisibles.",dope:!0},"detectar magia":{success:"Delgadas lineas azules reseguiran las siluetas de los objetos magicos que te encuentres.",target:!1,endEffect:"Las lineas azules desaparecen de tu vision",dope:!0},"detectar maldad":{success:"Delgadas lineas rojas reseguiran las siluetas de los seres malvados que te encuentres.",target:!1,endEffect:"Las lineas rojas desaparecen de tu vision.",dope:!0},"detectar trampas":{success:"De repente te sientes mas alerta de los peligros que te rodean.",target:!1,endEffect:"Te sientes menos alerta de los peligros que te rodean.",dope:!0},"detectar veneno":n.UNKNOWN,"disipar magia":n.UNKNOWN,"disipar maldad":n.UNKNOWN,flotar:{success:"Empiezas a flotar a unos centimetros del suelo...",endEffect:"Tus pies aterrizan suavemente en el suelo.",dope:["volar","flotar"]},"fuego espectral":n.UNKNOWN,identificar:{success:/El objeto '(?<name>[^']+)' es un\(a\) (?<type>\w+), propiedades especiales: (?<properties>[^\n]+)\n/},invisibilidad:{success:"Te desvaneces en el aire.",target:/(?<target>(?:\w+ )+)se desvanece en el aire./,endEffect:"Ya no eres invisible.",dope:!0},"invocar armadillo":{success:"Agitas tus brazos a la vez que te concentras para invocar un pequenyo armadillo.",endEffect:n.UNKNOWN},"llamar rayo":n.UNKNOWN,"localizar objeto":n.UNKNOWN,"luz eterna":{success:"Rayos de luz iridiscente colisionan para formar una bola de luz eterna...",endEffect:"Esta completamente oscuro ...",afterDope:["vestir luz","mirar"]},maldecir:n.UNKNOWN,"misil magico":n.UNKNOWN,"niebla espectral":n.UNKNOWN,"piel robliza":{success:"Tu piel se oscurece a la vez que adquiere la dureza del roble.",target:!1,endEffect:"Tu piel vuelve a su estado normal...",dope:!0},proteccion:n.UNKNOWN,refrescar:{success:"Nueva vitalidad fluye hacia ti."},"retirar invisibilida":n.UNKNOWN,"saciar hambre":n.UNKNOWN,terremoto:n.UNKNOWN,veneno:n.UNKNOWN,volar:{success:"Te elevas entre las corrientes de aire...",target:/(?<target>(?:\w+ )+)se eleva entre las corrientes de aire.../,endEffect:"Aterrizas suavemente en el suelo.",dope:["volar","flotar"]}}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.int=n.toInt=void 0;const a=t(3),r=/-?\d+(?:,\d{3})*/;n.toInt=function(e){return parseInt(e.replace(/,/g,""),10)},n.int=function(e){return e?a.concatRegexesUnescaped(`(?<${e}>`,r,")"):r}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getItemSustantive=n.ITEM_SUSTANTIVES=n.UNWEAR=n.WEAR=n.ITEM_ARTICLE=void 0;const a=t(3);n.ITEM_ARTICLE=/(?: (?:un|una|el|la|los|las|unos|unas))?/,n.WEAR=["Te colocas ","Te pones ","Metes las piernas ","Vistes "],n.UNWEAR=a.concatRegexes(/Dejas de usar/,n.ITEM_ARTICLE,/ (?<item>[^.]+?)\./),n.ITEM_SUSTANTIVES=["amuleto","anillo","anteojos","armadura","baculo","baston","bola","botas","brazal","brazalete","brazaletes","brigandina","capa","capote","casco","cetro","cinto","coderas","colgante","collar","coraza","cota","cubrepiernas","daga","escudo","espada","faja","faldones","grebas","guanteletes","guantes","hacha","lanza","luz","mangas","manoplas","martillo","maza","mocasines","pendiente","perneras","peto","pica","placa","polainas","pulsera","ropaje","sombrero","tobillera","vara","varita","visera","yelmo"],n.getItemSustantive=function(e){const t=e.toLowerCase();return n.ITEM_SUSTANTIVES.find(e=>t.includes(e))||null}},function(e,n,t){"use strict";var a=t(1),r=t.n(a),o=t(2),s=t.n(o)()(r.a);s.push([e.i,"body {\n  --background-color: #1c1c1c;\n  --border-color: #484848;\n  background-color: black;\n  color: white;\n}\n\n.container {\n  height: 100%;\n  display: grid;\n  grid-template-rows: 1fr;\n  grid-template-columns: 1fr;\n  grid-template-areas: 'terminal';\n}\n\n.container.show-controls {\n  grid-template-rows: 50px auto;\n  grid-template-columns: 9fr 3fr;\n  grid-template-areas:\n    'controls sidebar'\n    'terminal sidebar';\n}\n\n.terminal {\n  grid-area: terminal;\n}\n\n.sidebar {\n  grid-area: sidebar;\n  background-color: var(--background-color);\n  border-left: 1px solid var(--border-color);\n}\n\n.controls {\n  grid-area: controls;\n  background-color: var(--background-color);\n  border-bottom: 1px solid var(--border-color);\n}\n\n.container:not(.show-controls) .sidebar,\n.container:not(.show-controls) .controls {\n  display: none;\n}\n","",{version:3,sources:["webpack://src/ui/index.css"],names:[],mappings:"AAAA;EACE,2BAA2B;EAC3B,uBAAuB;EACvB,uBAAuB;EACvB,YAAY;AACd;;AAEA;EACE,YAAY;EACZ,aAAa;EACb,uBAAuB;EACvB,0BAA0B;EAC1B,+BAA+B;AACjC;;AAEA;EACE,6BAA6B;EAC7B,8BAA8B;EAC9B;;sBAEoB;AACtB;;AAEA;EACE,mBAAmB;AACrB;;AAEA;EACE,kBAAkB;EAClB,yCAAyC;EACzC,0CAA0C;AAC5C;;AAEA;EACE,mBAAmB;EACnB,yCAAyC;EACzC,4CAA4C;AAC9C;;AAEA;;EAEE,aAAa;AACf",sourcesContent:["body {\n  --background-color: #1c1c1c;\n  --border-color: #484848;\n  background-color: black;\n  color: white;\n}\n\n.container {\n  height: 100%;\n  display: grid;\n  grid-template-rows: 1fr;\n  grid-template-columns: 1fr;\n  grid-template-areas: 'terminal';\n}\n\n.container.show-controls {\n  grid-template-rows: 50px auto;\n  grid-template-columns: 9fr 3fr;\n  grid-template-areas:\n    'controls sidebar'\n    'terminal sidebar';\n}\n\n.terminal {\n  grid-area: terminal;\n}\n\n.sidebar {\n  grid-area: sidebar;\n  background-color: var(--background-color);\n  border-left: 1px solid var(--border-color);\n}\n\n.controls {\n  grid-area: controls;\n  background-color: var(--background-color);\n  border-bottom: 1px solid var(--border-color);\n}\n\n.container:not(.show-controls) .sidebar,\n.container:not(.show-controls) .controls {\n  display: none;\n}\n"],sourceRoot:""}]),n.a=s},function(e,n,t){"use strict";var a=t(1),r=t.n(a),o=t(2),s=t.n(o)()(r.a);s.push([e.i,".controls {\n  display: flex;\n  align-items: stretch;\n}\n\n.controls .meter {\n  width: 100px;\n  margin: 8px;\n  margin-right: 0;\n  border: 1px solid var(--border-color);\n  --color: white;\n  --value: 100%;\n}\n\n.controls .meter .bar {\n  height: 100%;\n  width: var(--value);\n  background-color: var(--color);\n}\n","",{version:3,sources:["webpack://src/ui/Controls/Controls.css"],names:[],mappings:"AAAA;EACE,aAAa;EACb,oBAAoB;AACtB;;AAEA;EACE,YAAY;EACZ,WAAW;EACX,eAAe;EACf,qCAAqC;EACrC,cAAc;EACd,aAAa;AACf;;AAEA;EACE,YAAY;EACZ,mBAAmB;EACnB,8BAA8B;AAChC",sourcesContent:[".controls {\n  display: flex;\n  align-items: stretch;\n}\n\n.controls .meter {\n  width: 100px;\n  margin: 8px;\n  margin-right: 0;\n  border: 1px solid var(--border-color);\n  --color: white;\n  --value: 100%;\n}\n\n.controls .meter .bar {\n  height: 100%;\n  width: var(--value);\n  background-color: var(--color);\n}\n"],sourceRoot:""}]),n.a=s},function(e,n,t){"use strict";var a=t(1),r=t.n(a),o=t(2),s=t.n(o)()(r.a);s.push([e.i,".hamburger {\n  display: inline-block;\n  position: absolute;\n  top: 24px;\n  right: 40px;\n  z-index: 1;\n  -webkit-user-select: none;\n  user-select: none;\n}\n\n.hamburger input {\n  display: block;\n  width: 40px;\n  height: 32px;\n  position: absolute;\n  top: -7px;\n  left: -5px;\n  cursor: pointer;\n  opacity: 0; /* hide this */\n  z-index: 2; /* and place it over the hamburger */\n  -webkit-touch-callout: none;\n}\n\n.hamburger span {\n  display: block;\n  width: 33px;\n  height: 4px;\n  margin-bottom: 5px;\n  position: relative;\n  background: #cdcdcd;\n  border-radius: 3px;\n  z-index: 1;\n  transform-origin: center right;\n  transition: transform 0.5s cubic-bezier(0.77, 0.2, 0.05, 1),\n    background 0.5s cubic-bezier(0.77, 0.2, 0.05, 1), opacity 0.55s ease;\n}\n\n/*\n * Transform all the slices of hamburger\n * into a crossmark.\n */\n.hamburger input:checked ~ span:nth-of-type(2) {\n  opacity: 0;\n  transform: rotate(0deg) scale(0.2, 0.2);\n}\n\n.hamburger input:checked ~ span:first-of-type {\n  transform: rotate(-45deg) translate(0, -4px);\n}\n\n.hamburger input:checked ~ span:last-of-type {\n  transform: rotate(45deg) translate(0, 4px);\n}\n","",{version:3,sources:["webpack://src/ui/Hamburger/Hamburger.css"],names:[],mappings:"AAAA;EACE,qBAAqB;EACrB,kBAAkB;EAClB,SAAS;EACT,WAAW;EACX,UAAU;EACV,yBAAyB;EACzB,iBAAiB;AACnB;;AAEA;EACE,cAAc;EACd,WAAW;EACX,YAAY;EACZ,kBAAkB;EAClB,SAAS;EACT,UAAU;EACV,eAAe;EACf,UAAU,EAAE,cAAc;EAC1B,UAAU,EAAE,oCAAoC;EAChD,2BAA2B;AAC7B;;AAEA;EACE,cAAc;EACd,WAAW;EACX,WAAW;EACX,kBAAkB;EAClB,kBAAkB;EAClB,mBAAmB;EACnB,kBAAkB;EAClB,UAAU;EACV,8BAA8B;EAC9B;wEACsE;AACxE;;AAEA;;;EAGE;AACF;EACE,UAAU;EACV,uCAAuC;AACzC;;AAEA;EACE,4CAA4C;AAC9C;;AAEA;EACE,0CAA0C;AAC5C",sourcesContent:[".hamburger {\n  display: inline-block;\n  position: absolute;\n  top: 24px;\n  right: 40px;\n  z-index: 1;\n  -webkit-user-select: none;\n  user-select: none;\n}\n\n.hamburger input {\n  display: block;\n  width: 40px;\n  height: 32px;\n  position: absolute;\n  top: -7px;\n  left: -5px;\n  cursor: pointer;\n  opacity: 0; /* hide this */\n  z-index: 2; /* and place it over the hamburger */\n  -webkit-touch-callout: none;\n}\n\n.hamburger span {\n  display: block;\n  width: 33px;\n  height: 4px;\n  margin-bottom: 5px;\n  position: relative;\n  background: #cdcdcd;\n  border-radius: 3px;\n  z-index: 1;\n  transform-origin: center right;\n  transition: transform 0.5s cubic-bezier(0.77, 0.2, 0.05, 1),\n    background 0.5s cubic-bezier(0.77, 0.2, 0.05, 1), opacity 0.55s ease;\n}\n\n/*\n * Transform all the slices of hamburger\n * into a crossmark.\n */\n.hamburger input:checked ~ span:nth-of-type(2) {\n  opacity: 0;\n  transform: rotate(0deg) scale(0.2, 0.2);\n}\n\n.hamburger input:checked ~ span:first-of-type {\n  transform: rotate(-45deg) translate(0, -4px);\n}\n\n.hamburger input:checked ~ span:last-of-type {\n  transform: rotate(45deg) translate(0, 4px);\n}\n"],sourceRoot:""}]),n.a=s},function(e,n,t){"use strict";var a=t(1),r=t.n(a),o=t(2),s=t.n(o)()(r.a);s.push([e.i,".sidebar {\n}\n","",{version:3,sources:["webpack://src/ui/Sidebar/Sidebar.css"],names:[],mappings:"AAAA;AACA",sourcesContent:[".sidebar {\n}\n"],sourceRoot:""}]),n.a=s},function(e,n,t){"use strict";var a=t(1),r=t.n(a),o=t(2),s=t.n(o)()(r.a);s.push([e.i,".terminal {\n  grid-area: terminal;\n  overflow-x: hidden;\n  overflow-y: auto;\n  -ms-overflow-style: none; /* IE and Edge */\n  scrollbar-width: none; /* Firefox */\n}\n\n.terminal::-webkit-scrollbar {\n  display: none;\n}\n\n.terminal p {\n  margin: 1em 0;\n}\n\n.terminal input {\n  background-color: transparent;\n  border: none;\n  color: white;\n  display: inline-block;\n  font-family: monospace;\n  outline: none;\n}\n","",{version:3,sources:["webpack://src/ui/Terminal/Terminal.css"],names:[],mappings:"AAAA;EACE,mBAAmB;EACnB,kBAAkB;EAClB,gBAAgB;EAChB,wBAAwB,EAAE,gBAAgB;EAC1C,qBAAqB,EAAE,YAAY;AACrC;;AAEA;EACE,aAAa;AACf;;AAEA;EACE,aAAa;AACf;;AAEA;EACE,6BAA6B;EAC7B,YAAY;EACZ,YAAY;EACZ,qBAAqB;EACrB,sBAAsB;EACtB,aAAa;AACf",sourcesContent:[".terminal {\n  grid-area: terminal;\n  overflow-x: hidden;\n  overflow-y: auto;\n  -ms-overflow-style: none; /* IE and Edge */\n  scrollbar-width: none; /* Firefox */\n}\n\n.terminal::-webkit-scrollbar {\n  display: none;\n}\n\n.terminal p {\n  margin: 1em 0;\n}\n\n.terminal input {\n  background-color: transparent;\n  border: none;\n  color: white;\n  display: inline-block;\n  font-family: monospace;\n  outline: none;\n}\n"],sourceRoot:""}]),n.a=s},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.singleExecution=void 0,n.singleExecution=function(e){let n=null;return()=>n||(n=e().then(e=>(n=null,e)),n)}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PatternPromise=void 0;const a=t(7),r=t(34);n.PatternPromise=class extends Promise{constructor(e){let n;super((t,a)=>{n=a,e(t,a)}),this.forceReject=n}timeout(e){return a.wait(e).then(()=>this.forceReject(new r.PatternPromiseTimeoutError)),this}wait(e){return Promise.race([this,a.wait(e)])}unsubscribe(){this.forceReject("aborted")}once(){return this}}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.promptPlugin=n.PROMPT_DETECTOR=void 0;const a=t(4),r=t(3),o=t(9),s=["&W<","&R%h/%Hhp ","&C%m/%Mm ","&G%v/%Vmv ","&P%Xxp ","&Y%gg","&W> ","&W%A ","\n"].join(""),i=s.replace("&W>"," &R%E&W>"),c=e=>r.concatRegexes(o.int(e+"Curr"),"/",o.int(e+"Total"),e+" ");n.PROMPT_DETECTOR=r.concatRegexes(/</,c("hp"),c("m"),c("mv"),o.int("exp"),/xp /,o.int("gold"),/g/,/( \((?<enemy>\d+)%\))?/,/> (?<invis>I)?/);class l{constructor(){this.total=0,this.current=0}get percent(){const e=this.total?1/this.total*this.current:0;return Math.round(100*e)/100}}n.promptPlugin=async function({when:e,write:t}){let r=!1;const c={hp:new l,mana:new l,mv:new l,exp:0,gold:0,enemy:null,get isFighting(){return null!==c.enemy}},u=a.emitter();return e(n.PROMPT_DETECTOR).timeout(1).catch((function(){t("prompt "+s),t("fprompt "+i)})).finally(()=>{e(n.PROMPT_DETECTOR,({groups:e})=>{c.hp.current=o.toInt(e.hpCurr),c.hp.total=o.toInt(e.hpTotal),c.mana.current=o.toInt(e.mCurr),c.mana.total=o.toInt(e.mTotal),c.mv.current=o.toInt(e.mvCurr),c.mv.total=o.toInt(e.mvTotal),c.exp=o.toInt(e.exp),c.gold=o.toInt(e.gold),c.enemy=e.enemy?o.toInt(e.enemy):null,r=Boolean(e.invis),u(c)})}),{getPercent:function(e){return c[e].percent},until:d,whenFresh:function(){return d(e=>(console.log(e.hp.percent,e.mana.percent,e.mv.percent,1===e.hp.percent&&1===e.mana.percent&&1===e.mv.percent),1===e.hp.percent&&1===e.mana.percent&&1===e.mv.percent))},onUpdate:u.subscribe,get isFighting(){return c.isFighting},get isInvisible(){return r}};function d(t){return t?!!t(c)||new Promise(e=>{const n=u.subscribe(a=>{t(a)&&(n(),e(a))})}):e(n.PROMPT_DETECTOR)}}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PluginContext=void 0;const a=t(20),r=t(21),o=t(7);class s{constructor(e,n,t,a){this.name=e,this.username=n,this.triggers=t,this.send=a,this.subscriptions=[],this.isPrintingLogs=!1,this.isAborted=!1,r.bindAll(this,s)}get printLogs(){return this.isPrintingLogs=!0,null}write(e,n){this.checkNotAborted(),this.log("[WRITE]",e),this.send(e,n)}when(e,n,t){return this.checkNotAborted(),this.log("[WATCH]",e),"function"==typeof n?this.triggers.add(e,n,t):this.triggers.add(e,n)}sleep(e){return this.checkNotAborted(),this.log("[SLEEP]",e),o.wait(e)}abort(){this.isAborted=!0}dispose(){this.log("DISPOSE"),this.subscriptions.forEach(e=>e.unsubscribe())}log(...e){this.checkNotAborted(),this.isPrintingLogs&&console.log(`[${this.name}]`,...e)}checkNotAborted(){if(this.isAborted)throw new a.ExecutionAbortedError}}n.PluginContext=s},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ExecutionAbortedError=void 0;class a extends Error{}n.ExecutionAbortedError=a},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.bindAll=void 0,n.bindAll=function(e,n){const t=n.prototype;Object.getOwnPropertyNames(t).filter(e=>"function"==typeof Object.getOwnPropertyDescriptor(t,e).value).forEach(n=>{e[n]=e[n].bind(e)})}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MOB_PRESENT=n.MOB_LEAVES=n.MOB_ARRIVES=n.getMobIn=void 0;const a=t(3),r=/(?:un|una|el|la|los|las|unos|unas)/,o=["armadillo"],s=["adorador","buitre","caracol","ciervo","conejo","cultista","dragon","empleado","fanat","goblin","guardia","ladron","lobo","merodeador","murcielago","ogro","orco","pantera","serpiente"];n.getMobIn=function(e){const n=e.toLowerCase();if(o.some(e=>n.includes(e)))return null;const t=s.find(e=>n.includes(e));return t||console.warn(`Unknown sustantive for "${e}"`),t},n.MOB_ARRIVES=a.concatRegexes(r,/ (?<mob>(?: \w+)) llega desde el (?<direction>\w+)/),n.MOB_LEAVES=a.concatRegexes(r,/ (?<mob>(?: \w+)) (?:se va)|(?:vuela) hacia (?:el )?(?<direction>\w+)/),n.MOB_PRESENT=["Un buitre carronyero esta aqui.","Un corpulento orco esta aqui de guardia.","Un deforme humano, un engendro de la magia, quiere descargar su agresividad.","Un gran lobo negro, te muestra los colmillos hambriento.","Un lobo feroz esta aqui y grunye muy enojado.","Un lobo hambriento te esta mirando","Un orco fuera de servicio esta sentado aqui jugando a las cartas.","Un pequenyo caracol esta aqui haciendo trompos.","Un pequenyo orco se sienta en una de las sillas roncando.","Un sargento orco mantiene vigilada la chusma a la que comanda.","Una joven cultista parece bastante serena, mientras no vea a nadie m","Una serpiente que parece venenosa te mira fijamente.",/Kivon, el l.der del culto, no est. nada contento con intromisiones\./,/Nejane, la l.der, parece estar en trance\./,/Un adorador mira con c.lera a su alrededor\./,/Un devoto adorador mira con c.lera a su alrededor\./,/Un Guardia Real est. aqu. velando por la seguridad del estadio/,/Un humano pose.do por el fanatismo busca 'herejes'\./]},function(e,n,t){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.getAreaMetadata=n.getAreasForLevel=void 0;const r=a(t(61)),o=Object.values(r.default).flat(),s={"Academia de Darkhaven":{path:"rd",arena:["Xse","Xne","Xse","Xne","Xse"]},"Bosque de las Hadas":{path:"r6w2nwk2wh"},"Catacumbas de la Capilla":{path:"r6w8se7s"},"Cementerio Oscuro":{path:"r4s4ws"},"Ciudad Imperial":{path:"r8e2n4el3e2sj"},DarkHaven:{path:"r"},"El Campamento Goblin":{path:"r10s4en3e2n"},"El Cementerio":{path:"r6w8ses"},"El Centinela":{path:"r7ws"},"El Gran Estadio":{path:"r8e2n4el3e2s2jn",arena:"j"},"El Imperio Orco":{path:"r13s2wn",arena:["Xnu","Xsu","ne2wene2weXsu","ne2wenXsnu","3ne2we2nu"]},"El Jardin de los Heroes":{path:"r8e2n4el3e2s2j8l8e5j4els"},"El Pantano Orco":{path:"r13s2en"},"El Refugio Destruido":{path:"r8e2ne"},"Exportaciones de Dragones":{path:"r4sen"},"Foire de Reves":{path:"r8n3ene"},"Galeria de arte":{path:"r4swn"},"Guarderia Enana":{path:"r8ejs"},"Haon Dor":{path:"r7w"},"Holy Grove":{path:"r9e"},"La Fortaleza de Valor":{path:"r11n2en"},"La Mansion de Marmol":{path:"r9w3s",arena:["e2n","n2d","3n3s","3e3w","3s3n","2us","2e2w","4w4e"]},"La Mansion de Tullfuhrzky":{path:"r6w2nwk2wh4nj"},"La Torre del Brujo":{path:"r9w2sese2s"},"Las Alcantarillas":{path:"r4sd"},"Las Llanuras del Norte":{path:"r7n"},"Miden'nir":{path:"r7s"}};function i(e,n){return Math.abs(n-e.from+(n-e.to))}function c(e){return e.name in s?{...e,...s[e.name]}:e}n.getAreasForLevel=function(e){return r.default.Calimhar.filter(n=>n.from<=e&&n.to>=e).sort((n,t)=>i(n,e)-i(t,e)).map(c)},n.getAreaMetadata=function(e){const n=e.toLowerCase(),[t,...a]=o.filter(e=>e.name.toLocaleLowerCase().includes(n));return a.length&&console.warn(`Many areas detected for ${e}:\n- ${[t,...a].map(e=>e.name).join("\n- ")}`),t&&c(t)}},,,function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const a=t(4),r=t(27),o=t(46),s=t(47),i=t(65),c=t(87),l=t(88),u=t(89);const d="https://amatiasq.github.io"===location.origin?"wss://mudOS.amatiasq.com":"ws://localhost:"+u.DEFAULT_PORT,{host:m,port:p,user:f,pass:h}=function(){const{user:e,server:n}=l.getQueryParams(),[t,a]=n.split(":"),r=c.getPassword(e);return{host:t,port:parseInt(a,10),user:e,pass:r}}(),{terminal:g,controls:w}=i.renderUserInterface(document.body);!function(){const e=new WebSocket(d);e.addEventListener("open",()=>{const n=new o.RemoteTelnet(e);n.connect(m,p),g.write(`Connecting to ${m}:${p} as ${f}\n`),async function(e){const n=new r.Mud(e);async function t(){const e=a.emitter();w.addMeter("red",e.subscribe);const t=a.emitter();w.addMeter("blue",t.subscribe);const r=a.emitter();w.addMeter("green",r.subscribe),n.getPlugin("prompt").onUpdate(n=>{e(n.hp.percent),t(n.mana.percent),r(n.mv.percent)})}function o(){w.addButton("Entrenar",()=>n.run("train"))}function i(e,t){const a=`"${e}" with "${t.join(" ")}"`;g.write(`-> Running ${a}\n`),n.run(e,t).then(e=>g.write(`\n<- Done ${a}: ${e}\n`),e=>g.write(`\n\n<! FAILED ${a}: ${e.message}\n\n`))}n.onCommand(e=>g.write(e+"\n")),e.onData(e=>g.write(e)),window.onbeforeunload=()=>{e.isConnected&&e.send("abandonar"),e.close()},g.onSubmit(t=>{if(g.write(t+"\n"),t.startsWith("!")){const[e,...n]=t.substr(1).split(/\s+/);i(e,n)}else e.send(t),n.userInput(t)}),await n.login(f,h),s.registerWorkflows(n),await t(),o(),Object.assign(window,{mud:n})}(n)})}()},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Mud=void 0;const a=t(4),r=t(28),o=t(37),s=t(19),i=t(38),c=t(42),l=t(44),u=t(45);n.Mud=class{constructor(e){this.telnet=e,this.triggers=new i.TriggerCollection,this.workflows={},this.emitCommand=a.emitter(),this.onCommand=this.emitCommand.subscribe,this.whenLoggedIn=new Promise(e=>this.emitLoggedIn=e),this.workflow=this.workflow.bind(this),this.send=this.send.bind(this),this.run=this.run.bind(this),this.telnet.onData(e=>this.triggers.process(function(e){return e.replace(/\u001b\[.*?m/g,"")}(e).replace(/\r/g,"")))}async login(e,n){const t=new s.PluginContext("login","N/A",this.triggers,this.send);await o.login(t,e,n,async()=>{this.plugins=await r.initializePlugins(n=>new s.PluginContext(n,e,this.triggers,this.send))}),t.dispose(),this.username=e,this.emitLoggedIn(e)}send(e,n={}){this.emitCommand(n.password?"*".repeat(e.length):e),this.telnet.send(e)}userInput(e){}getPlugin(e){return this.plugins[e]}daemon(e,n,t,a){const r=new l.Workflow(e,async e=>(await n(e),e.runForever()));return this.executeWorkflow(r,t,a)}workflow(e,n){const t=new l.Workflow(e,n);return this.workflows[t.name]=t,t}async run(e,n,t){if(!(e in this.workflows))throw new u.WorkflowNotFoundError(`Workflow "${e}" is not registered.`);const a=this.workflows[e];return this.executeWorkflow(a,n,t)}executeWorkflow(e,n=[],{logs:t}={}){const a=this.createWorkflowContext(e.name);t&&a.printLogs;const r=e.execute(a,...n).then(e=>(a.dispose(),e));return Object.assign(r,{abort(){a.abort()}})}createWorkflowContext(e){return new c.Context(e,this.username,this.triggers,this.plugins,this.send,this.workflow,this.run)}}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.initializePlugins=void 0;const a=t(29),r=t(32),o=t(33),s=t(18),i=t(35),c=t(36),l={chat:a.chatPlugin,inventory:r.inventoryPlugin,navigation:o.navigationPlugin,prompt:s.promptPlugin,skills:i.skillsPlugin,stats:c.statsPlugin};n.initializePlugins=async function(e){const n=Object.entries(l).map(async([n,t])=>[n,await t(e(n))]),t=await Promise.all(n);return Object.fromEntries(t)}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.chatPlugin=void 0;const a=t(5),r=t(30),o=t(31),s={version:2},i=e=>({groups:{name:n,message:t}})=>{console.log(`[MESSAGE(${n})]:`,t),l(e,{from:n,message:t}),async function(e,n){if(await o.requestNotificationPermission(),!e.startsWith("[Orden"))new Notification(`${e}=>${n}`)}(n,t)},c=e=>({groups:{name:n,message:t}})=>l(e,{to:n,message:t});function l(e,n){const t=[r.datetime(new Date),n.from||"me",n.to||"me",n.message];return e.set([...e.get()||[],t]),t}n.chatPlugin=function({when:e}){const n=new a.ClientStorage("chat:order",s),t=new a.ClientStorage("chat:tell",s),r=new a.ClientStorage("chat:whisper",s);window.chat=()=>({tell:t.get(),order:n.get(),whisper:r.get()}),e(/(?<name>\[Orden: [^\]]+\]): '(?<message>[^']+)'/,i(n)),e(/(?<name>\[Orden\]): '(?<message>[^']+)'/,c(n)),e(/(?<name>.+) te susurra '(?<message>[^']+)'/,i(r)),e(/Susurras a (?<name>.+) '(?<message>[^']+)'/,c(r)),e([/(?<name>.+) te cuenta '(?<message>[^']+)'/,/(?<name>.+) te responde '(?<message>[^']+)'/],i(t)),e([/Cuentas a (?<name>.+) '(?<message>[^']+)'/,/Respondes a (?<name>.+) '(?<message>[^']+)'/],c(t))}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.datetime=void 0;const a=e=>e<10?"0"+e:e;n.datetime=function(e){return`${e.getFullYear()}-${a(e.getMonth()+1)}-${a(e.getDate())} ${a(e.getHours())}:${a(e.getMinutes())}`}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.requestNotificationPermission=void 0,n.requestNotificationPermission=function(){if("Notification"in window){if("granted"===Notification.permission)return Promise.resolve(!0);if("denied"!==Notification.permission)return Notification.requestPermission().then(e=>"granted"===e)}else console.warn("This browser does not support desktop notification")}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.inventoryPlugin=void 0;const a=t(16),r=/Estas llevando:(\n.*)+?\n\n/;n.inventoryPlugin=function({when:e,write:n}){let t=!1,o={};const s=a.singleExecution(async()=>{n("inventario"),await e(r)});return e("No tienes ese objeto.",s),e(r,({captured:e})=>{const[n,...a]=e[0].split("\n").map(e=>e.trim()).filter(Boolean);t=!0,o={};for(const e of a){if("Nada."===e)return;const n=e.match(/(.*) \((\d+)\)$/);n?o[n[1]]=parseInt(n[2],10):o[e]=1}},{captureLength:1e3}),{refresh:s,has:async function(e){t||await s();if("string"==typeof e)return i(e)?e:null;if(Array.isArray(e))return e.find(i)||null;const n=Object.keys(e).find(i);return n?e[n]:null}};function i(e){return o[e]}}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.navigationPlugin=void 0;const a=t(4),r=t(17),o=t(18),s="(cerrada)",i={s:"sur",n:"norte",e:"este",w:"oeste",o:"oeste",u:"arriba",d:"abajo",l:"sureste",k:"suroeste",j:"noreste",h:"noroeste"};n.navigationPlugin=function({log:e,when:n,write:t}){let c=!1,l=!1,u=!1,d=[];const m=()=>n(o.PROMPT_DETECTOR),p=a.emitter();return n(/Plaza de Darkhaven\s+/,()=>l=!0),n("Puertas? esta cerrada.",async()=>{const e=d.find(e=>e.includes(s));if(e){const a=e.replace(s,"");t("abrir "+a);await Promise.any([n("Esta cerrada con llave.").then(()=>!1),n("Abres ").then(()=>!0)])&&t(a)}}),n(/\nSalidas: ([^\.]+)/,async({captured:e})=>{d=e[1].split(" "),c=!1,u=l,l=!1,await m(),p(d)}),{canGo:h,go:g,execute:async function(e,n){"r"===e[0]&&(await f(),e=e.substr(1));let t=!1;for(const n of(a=e,a.replace(/(\d+)(\w)/g,(e,n,t)=>t.repeat(n))))if("X"!==n.toUpperCase()){if(t){for(;h(n);)if(await r(n))return!1;t=!1}else if(await r(n))return!1}else t=!0;var a;return!0;async function r(t){try{if(!await g(t))return!0}catch(n){throw new Error(`${n.message} - on ${e}`)}if("function"==typeof n){return!1===await n()}}},recall:f,waitForRecall:function(){if(u)return new r.PatternPromise(e=>e());return n("Plaza de Darkhaven")},onRoomChange:p.subscribe,get isNavigating(){return c},get isAtRecall(){return u}};async function f(){if(u)return!0;t("recall"),await n("Plaza de Darkhaven"),await m()}function h(e){return Boolean(w(e))}async function g(a){if(c)throw new Error("WTF DUDE");const r=w(a);if(!r)throw new Error(`Unknown direction '${a}'`);if(function(e){const n=w(e);return n&&n.includes(s)}(a)){t("abrir "+a);if(!await Promise.any([n(/Abres la puertas?\./).then(()=>!0),n("Esta cerrada con llave.").then(()=>!1)]))return e("Can\t open door"),!1}return t(r.replace(s,"").trim()),c=!0,await n("\nSalidas:"),await m(),c=!1,!0}function w(e){return e in i&&(e=i[e]),d.find(n=>n.startsWith(e))}}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PatternPromiseTimeoutError=void 0;class a extends Error{}n.PatternPromiseTimeoutError=a},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.skillsPlugin=void 0;const a=t(8),r=t(3),o=t(16),s=void 0,i=!0,c=/((?:\w+ )+)\s+(\d+)%/g,l=r.concatRegexes(/-+\[(\w+)\]-+\n/,/(.|\n)+/,/Te quedan \d+ practicas.\n/,/Tienes \d+ entrenamientos.\n/);n.skillsPlugin=function({when:e,write:n}){let t=!1,r=!1,u={};const d=o.singleExecution(()=>(n("practicar"),e(l)));return e(l,({captured:[e]})=>{t=!0;for(const n of e.matchAll(c))u[n[1].trim()]=parseInt(n[2],10);t=!0,console.log(u)},{captureLength:5e3}),{has:m,canLearn:async function(e){return await f(),e in u},castSpell:async function(t,o=""){const c=(Array.isArray(t)?t:[t]).map(a.getSpell).filter(Boolean),l=await m(c.map(e=>e.name));if(!l)return s;const u=c.find(e=>e.name===l);if(!u.success)throw new Error(`Unknown response for spell "${t}" (${u.name}).`);if(r)return null;r=!0,n(`conjurar "${u.name}" ${o}`);const d=[e(u.success).then(()=>i),e(a.SPELL_NOT_POSSIBLE).then(()=>s),e(a.SPELL_ALREADY_APPLIED).then(()=>1),e(a.SPELL_FAILED).wait(4).then(()=>false)];u.target&&d.push(e(u.target).then(()=>i));const p=await Promise.any(d);return r=!1,p},NOT_AVAILABLE:s,BUSY:null,FAILED:false,CASTED:i,ALREADY_APPLIED:1};async function m(e){return await f(),"string"==typeof e?p(e)?e:null:e.find(p)||null}function p(e){return u[e]}function f(){if(!t)return d()}}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.statsPlugin=void 0;const a=t(3),r=t(9),o=3e3,s=(()=>{const e=a.concatRegexes,n=e=>e.toLowerCase(),t=/(?:.|\n)+?/,o=/\-{78}/,s=/\s+/,i=/\s+\|\s+/,c=(...n)=>e(/\|\|\s*/,...n,/\s*\|\|\n/),l=t=>e(t,/\s+: /,r.int(n(t)),/\(/,r.int(n(t)+"Base"),/\)/),u=t=>e(t,/\s+: /,r.int(n(t)),/\s+\//,r.int(n(t)+"Base"),/\s+\(\s*/,r.int(n(t)+"Regen"),/%\) (?:Regen)?/);return e(o,/\n\/\s{78}\\\n/,c(/Ficha de (?<name>\w+)(?<principal> \(Personaje Principal\))\./),c(o),c(l("FUE"),s,l("DES"),i,u("Vida")),c(l("INT"),s,l("SAB"),i,u("Mana")),c(l("CON"),s,l("CAR"),i,u("Mov")),c(l("SUE"),s,i,s),/\|\|-{36}\+-{41}\|\|\n/,c(/Nivel\s+: /,r.int("level"),t),t,/ \|\|\n\\\s{78}\/\n  /,o)})();n.statsPlugin=function({when:e,write:n}){let t=!1;const a={name:0,principal:0,fue:0,fueBase:0,des:0,desBase:0,vida:0,vidaBase:0,vidaRegen:0,int:0,intBase:0,sab:0,sabBase:0,mana:0,manaBase:0,manaRegen:0,con:0,conBase:0,car:0,carBase:0,mov:0,movBase:0,movRegen:0,sue:0,sueBase:0,level:0};return e(s,({groups:e})=>{for(const n of Object.keys(a))a[n]=r.toInt(e[n]);console.log(a),t=!0},{captureLength:3e3}),{getLevel:async()=>(await async function(){t||(n("estado"),await e(s,{captureLength:o}))}(),a.level)}}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.login=void 0,n.login=async function({when:e,write:n,log:t},a,r,o){await e("Entra el nombre de tu personaje o escribe Nuevo:"),n(a),t("Username sent, waiting for password request"),await e("Password:"),n(r,{password:!0}),t("Logged in as "+a),await Promise.any([(async()=>{await e("Reconectando."),await o()})(),(async()=>{await e("Pulsa [ENTER]"),n(""),await e("Pulsa [ENTER]"),n(""),await e("Bienvenido a Balzhur...",o,{await:!0}).once()})()])}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TriggerCollection=void 0;const a=t(39),r=t(17);n.TriggerCollection=class{constructor(){this.patterns=new Set,this.queue=[],this.isProcessing=!1}add(e,n,t){return 1===arguments.length?this.once(e):3===arguments.length?this.watch(e,n,t):"function"==typeof n?this.watch(e,n):this.once(e,n)}watch(e,n,t){const o=new a.PatternMatcher(e,e=>n(e),t);this.patterns.add(o);const s=()=>this.patterns.delete(o);return{unsubscribe:s,once:()=>new r.PatternPromise(e=>{const a=n;n=async n=>{s(),a&&(t&&t.await?await a(n):a(n)),e(n)}})}}once(e,n){return new r.PatternPromise(t=>{const a=this.add(e,(function(e){a.unsubscribe(),t(e)}),n)})}async process(e){if(this.isProcessing)return void this.queue.push(e);this.isProcessing=!0;const n=e.split("\n"),t=n.pop(),a=[...n.map(e=>e+"\n"),t];for(const e of a)for(const n of this.patterns)await n.process(e);return this.isProcessing=!1,this.queue.length?this.process(this.queue.pop()):void 0}}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PatternMatcher=void 0;const a=t(40),r=t(41);n.PatternMatcher=class{constructor(e,n,t={}){this.handler=n,this.options=t,this.patterns=Array.isArray(e)?e:[e],this.length=t.captureLength||10*Math.max(...this.patterns.map(e=>String(e).length)),this.buffer=function(e){let n="";const t=()=>n="",r=t=>n=a.trimEnd(`${n}${t}`,e);return Object.assign(r,{clear:t})}(this.length)}process(e){const n=this.buffer(e),t=this.patterns.filter(e=>this.testPattern(n,e));if(!t.length)return;this.buffer.clear();const a=new r.PatternResult(t,n),o=this.handler(a);return this.options.await?o:null}testPattern(e,n){return"string"==typeof n?e.indexOf(n)>-1:n.test(e)}}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.trimEnd=void 0,n.trimEnd=function(e,n){return e.length>n?e.substr(e.length-n):e}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PatternResult=void 0;function a(e){return e instanceof RegExp}function r(e,n){return{...e,...n}}n.PatternResult=class{constructor(e,n){this.patterns=e,this.haystack=n}get regexes(){return this.patterns.filter(a)}get stringPatterns(){return this.patterns.filter(e=>!a(e))}get fullMatch(){return this.stringPatterns[0]}get captured(){return this.regexes.map(e=>this.haystack.match(e)).filter(Boolean).map(e=>Array.from(e))[0]}get groups(){return this.regexes.map(e=>this.haystack.match(e)).filter(Boolean).map(e=>e.groups).filter(Boolean).reduce(r,{})}}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Context=void 0;const a=t(20),r=t(19),o=t(21),s=t(43);class i extends r.PluginContext{constructor(e,n,t,a,r,c,l){var u,d;super(`W(${e})`,n,t,r),this.register=c,this.runWorkflow=l,this.finish=null,this.plugins=(u=a,d=this.log.bind(this),new Proxy(u,{get(e,n){if(!(n in e))throw d("Failed to get plugin "+n),new s.MissingPluginError(`Plugin ${n} is not registered.`);return d("Requires plugin "+n),e[n]}})),o.bindAll(this,i)}async run(e,n=[]){this.checkNotAborted(),this.log(`Invoke workflow "${e}" with`,...n);try{const t=await this.runWorkflow(e,n,{logs:this.isPrintingLogs});return this.log(`Invocation "${e}" returned `,t),t}catch(n){this.log(`Invocation "${e}" failed `,n)}}runForever(){return new Promise(e=>this.finish=e)}abort(){super.abort(),this.finish&&this.finish(new a.ExecutionAbortedError)}}n.Context=i},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MissingPluginError=void 0;class a extends Error{}n.MissingPluginError=a},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Workflow=void 0;n.Workflow=class{constructor(e,n){this.name=e,this.run=n,this.executionCount=0,this.currentExecutions=0}get isRunning(){return this.currentExecutions>0}get timesExecuted(){return this.executionCount}async execute(e,...n){this.currentExecutions++;const t=this.executionCount++;e.log(`[Exe(${t})]`,...n);try{const a=await this.run(e,...n);return e.log(`[Res(${t}]`,a),a}catch(n){throw e.log(`[ERR(${t})]`,n),n}finally{this.currentExecutions--}}}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.WorkflowNotFoundError=void 0;class a extends Error{}n.WorkflowNotFoundError=a},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.RemoteTelnet=void 0;const a=t(4);n.RemoteTelnet=class{constructor(e){this.socket=e,this._isConnected=!1,this.emitClose=a.emitter(),this.onClose=this.emitClose.subscribe,this.emitData=a.emitter(),this.onData=this.emitData.subscribe,e.addEventListener("close",this.emitClose),e.addEventListener("message",this.onMessage.bind(this)),this.onData(()=>this._isConnected=!0),this.onClose(()=>this._isConnected=!1)}get isConnected(){return this._isConnected}connect(e,n){this.proxy("OPEN",{host:e,port:n})}send(e){this.proxy("INPUT",e)}close(){this.socket.close()}proxy(e,n){this.socket.send(JSON.stringify({type:e,payload:n}))}async onMessage(e){const n=(await e.data.text()).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");this.emitData(n)}}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.registerWorkflows=void 0;const a=t(48),r=t(49),o=t(51),s=t(52),i=t(53),c=t(54),l=t(55),u=t(56),d=t(57),m=t(58),p=t(59),f=t(60),h=t(62),g=t(63),w=t(64);n.registerWorkflows=function(e){e.workflow("afk",u.afk),e.workflow("bank",d.bank),e.workflow("cast",m.cast),e.workflow("donations",p.donations),e.workflow("kill",h.kill),e.workflow("go",f.go),e.workflow("train",g.train),e.workflow("wear",w.wear),e.daemon("defend",a.defend),e.daemon("dope",r.dope),e.daemon("drink",o.drink),e.daemon("eat",s.eat),e.daemon("idle",i.idle),e.daemon("repair",c.repair),e.daemon("rest",l.rest)}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.defend=void 0;const a=t(22),r=t(8);n.defend=async function({log:e,when:n,write:t,plugins:{prompt:o,skills:s,navigation:i}}){n("Estas demasiado exhausto para huir del combate!",()=>i.recall()),n(/El \w+ de (?:el|la|un|una) ((?: |\w)+) te /,async({captured:n})=>{const c=o.getPercent("hp");if(c<.1)await i.recall();else if(o.getPercent("mv")<.1||c<.3)t("huir");else if(o.getPercent("mana")>.1){const e=n[1],t=a.getMobIn(e);await s.castSpell(r.SPELLS_BY_TYPE.attack,t||e)}else e("Nothing")}),n(".. Todo empieza a volverse negro.\n",async()=>{const e="Tu cuerpo aparece de repente, rodeado por una divina presencia...";let a=0;const r=n(e,()=>a++);for(await t("suplicar cuerpo"),await n(e).timeout(5),r.unsubscribe(),n("El cadaver de May pasa a convertirse en polvo",()=>a--);a;)t("coger todo may"),await o.until(),t("vestir todo"),await o.until(),await o.until()})}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.dope=void 0;const a=t(5),r=t(8),o=t(50),s=new a.ClientStorage("dope:casting");n.dope=async function({when:e,write:n,register:t,run:a,plugins:{prompt:i,skills:c}}){const l=f(.2),u=f(.1,.8),d=(e,...n)=>a("cast",[e,...n]).catch(()=>null),m=new Set(s.get()),p=r.getSpells();function f(e,n=1){const t=1/(n-e);return(a,r)=>{if(0===a||r>n)return!1;if(r<e)return!0;const o=(r-e)*t;return Math.hypot(a,1-o)>1}}p.filter(e=>e.endEffect).forEach((async function(t){const a=Array.isArray(t.dope)?t.dope:t.name;e(t.endEffect,async()=>{m.add(a),s.set([...m]);if(await d(a)){m.delete(a),s.set([...m]);const e=t.afterDope;Array.isArray(e)?e.forEach(e=>n(e)):e&&n(e)}})})),i.onUpdate(async({isFighting:e,mana:{percent:n},hp:{percent:t},mv:{percent:a}})=>{if(!e&&0!==n)return t>0&&l(n,t)?c.castSpell(r.SPELLS_BY_TYPE.heal):t>0&&u(n,a)?c.castSpell("refrescar"):void 0}),t("dope",async(e,n)=>{const t=p.filter(e=>e.dope&&(!n||e.target)).map(e=>Array.isArray(e.dope)?e.dope.join("|"):e.name);for(const e of o.uniq(t))await d(e.split("|"),n)})}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.uniq=void 0,n.uniq=function(e){return[...new Set(e)]}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.drink=void 0,n.drink=async function({when:e,write:n,plugins:{inventory:t,navigation:a,skills:r}}){let o=!1,s=!1;async function i(){return t.has({"un odre de cuero":"odre","una cantimplora":"cantimplora"})}a.onRoomChange(()=>o=!1),e(["Un manantial magico esta aqui.","Una hermosa fuente de marmol blanco esta aqui.","Trazas un circulo delante tuyo del cual emerge un manantial de agua cristalina."],async()=>{if(o=!0,!s){const e=await i();e&&(n("llenar "+e),s=!0)}}),e(["Te apetece dar un sorbo a algo refrescante.","Tienes sed.","Estas realmente sediento.","Estas MUERTO de SED!","Estas en peligro de deshidratacion."],async()=>{if(o||await r.castSpell("crear manantial"))return void n("beber");const e=await i();e?(n("beber "+e),await r.castSpell("crear agua",e)):console.log("No hay fuente de agua")})}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.eat=void 0,n.eat=async function({when:e,write:n,plugins:{inventory:t,navigation:a,skills:r}}){async function o(){const a=await async function(){return await s(),await t.has({"un chorizo":"chorizo","pavo cocinado":"pavo","una chuleta de cordero":"chuleta","loncha de salami":"salami","pierna de cordero":"pierna","ricas longanizas":"longanizas","un extranyo hongo":"hongo"})}();return a?(n("comer "+a),t.refresh(),!0):await async function(){if(!await r.castSpell("crear comida"))return!1;n("coger seta");try{return await e("Coges una seta magica.").timeout(3),n("comer seta"),!0}catch(e){return!1}}()}async function s(){if(await t.has("una bolsa")){n("coger todo bolsa"),n("examinar bolsa");const{captured:t}=await e(/Una bolsa contiene:\n\s+(Nada)?/);t[1]&&n("tirar bolsa")}}e(["Tienes hambre.","Estas realmente hambriento."],o),e(["Estas terriblemente hambriento.","Estas HAMBRIENTO!"],async()=>{await o()||a.isAtRecall&&(await async function(){await a.execute("2sen"),n("comprar 1 chuleta"),await Promise.any([e("Compras una chuleta de cordero."),e("El carnicero pone todo en una bolsa y te la da.").then(s)]),await a.execute("sw2n")}(),await o())})}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.idle=void 0,n.idle=async function({when:e,write:n,run:t,plugins:{navigation:a,skills:r}}){e("Desapareces en la nada.",async()=>{console.log("IDLE"),a.isAtRecall?(await t("train"),r.has("invisibilidad")&&await t("cast",["invisibilidad"])):n("estado")})}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.repair=void 0;const a=t(10),r=t(7);n.repair=async function({when:e,write:n,register:t,plugins:{navigation:o,prompt:s}}){async function i(t){for(const r of t)n("guardar "+r),await e(a.UNWEAR);return await l(),o.execute("nw2n")}async function c(){const t=[];n("equipo");const r=e(/>\s+\[\+*[^+]+\] (?<item>.*)/,({groups:e})=>{const n=a.getItemSustantive(e.item);n&&t.push(n)});return await e("Estas usando:"),await s.until(),r.unsubscribe(),t.length?t:null}async function l(){n("reparar todo"),await Promise.any([e("El herrero te cobra").then(()=>!0),e("El herrero te cuenta").then(()=>!1),r.wait(5).then(()=>null)]),n("vestir todo")}t("repair",async()=>{const e=await c();if(e)return await o.execute("r2ses"),i(e)}),e("No puedes vestir eso, necesita repararse.",async()=>{await o.execute("r2ses"),await l();const e=await c();if(e)return i(e)})}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.rest=void 0,n.rest=async function({when:e,write:n}){e(["Nah... Estas demasiado relajado...","En tus suenyos o que?","Estas demasiado relajado para lanzar ese conjuro."],()=>n("despertar"))}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.afk=void 0,n.afk=async function({abort:e,run:n,when:t,plugins:{prompt:a,navigation:r}},...o){t(".. Todo empieza a volverse negro.\n",e),await async function e(){await a.whenFresh(),await n("repair"),await n("dope"),await a.whenFresh(),console.log("Stats 100%. Start train...");try{await n("train",[(t=o||[],t[Math.floor(Math.random()*t.length)])]),console.log("workflow completed")}catch(e){console.log("workflow failed")}var t;r.isAtRecall&&await n("bank");return e()}()}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.bank=void 0;const a=t(3),r=t(9);n.bank=async function({when:e,write:n,plugins:{navigation:t}},o){const s=a.concatRegexes(/Ingresas /,r.int(),/ monedas? de oro en tu cuenta bancaria./),i=a.concatRegexes(/Retiras /,r.int(),/ monedas? de oro de tu cuenta bancaria./);await t.execute("r4s2en"),n("banco saldo");const{groups:c}=await e(a.concatRegexes(/Estas llevando /,r.int("carring"),/ monedas de oro.\n/,/Tienes /,r.int("balance"),/ monedas de oro en el banco.\n/,/Lo que hace un total de /,r.int("total"),/ monedas de oro.\n/)),l=r.toInt(c.carring),u=(r.toInt(c.balance),r.toInt(c.total)),d=null==o?Math.ceil(.01*u):o;l<d?(n("banco retirar "+(d-l)),await e(i)):l>d&&(n("banco ingresar "+(l-d)),await e(s)),await t.execute("s2w4n")}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.cast=void 0;const a=t(7);n.cast=async function({plugins:{prompt:e,skills:n}},t,...r){const o=await async function o(){e.isFighting&&await e.until(e=>!e.isFighting);switch(await n.castSpell(t,r.join(" "))){case n.CASTED:case n.ALREADY_APPLIED:return!0;case n.NOT_AVAILABLE:return!1;case n.BUSY:await a.wait(3);case n.FAILED:return o()}throw new Error("WTF DUDE")}();if(!1===o)throw new Error(`Unable to cast "${t}"`);return o}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.donations=void 0;const a=t(10),r=[{from:31,to:40,path:"4wn"},{from:21,to:30,path:"3wn"},{from:11,to:20,path:"2wn"},{from:1,to:10,path:"wn"},{from:41,to:50,path:"en"},{from:51,to:60,path:"2en"},{from:61,to:70,path:"3en"},{from:71,to:80,path:"4en"}];n.donations=async function({when:e,write:n,run:t,plugins:{navigation:o,stats:s}}){n("estado");const i=await s.getLevel(),c=r.find(e=>e.from<=i&&e.to<=i);if(!c)throw new Error(`No room for level "${i}"`);await o.execute("rh2w4n");const l=e(/Salidas: sur\.\n\n((?:.|\n)*)\n\n/,{captureLength:Number.MAX_VALUE});await o.execute(c.path);const{captured:u}=await l,d=u[1].split("\n").map(e=>e.trim());for(const e of Object.values(a.ITEM_SUSTANTIVES)){d.some(n=>n.includes(e)&&!n.includes("mallas"))&&await t("wear",[e])}await o.recall()}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.go=void 0;const a=t(23),r=/^r?((?:x|\d+)?nsewudohjkl)+$/;n.go=function({plugins:{navigation:e}},n){const t=r.test(n)?null:a.getAreaMetadata(n);return t&&t.path&&(n=t.path,console.log("Going "+t.name)),e.execute(n)}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default={Calimhar:[{name:"Academia de Darkhaven",from:1,to:5,min:0,max:95},{name:"Bosque de las Hadas",from:1,to:5,min:0,max:95},{name:"Catacumbas de la Capilla",from:15,to:25,min:0,max:95},{name:"Cementerio Oscuro",clan:"Legends",from:5,to:15,min:0,max:95},{name:"Ciudad Imperial",from:0,to:95,min:0,max:95},{name:"DarkHaven",from:0,to:95,min:0,max:95},{name:"El Campamento Goblin",from:1,to:10,min:0,max:95},{name:"El Cementerio",from:5,to:10,min:0,max:95},{name:"El Centinela",from:5,to:10,min:0,max:95},{name:"El Gran Estadio",from:10,to:20,min:0,max:95},{name:"El Imperio Orco",clan:"Legends",from:10,to:20,min:0,max:95},{name:"El Jardin de los Heroes",from:75,to:80,min:0,max:95},{name:"El Pantano Orco",clan:"DarkAngels",from:5,to:30,min:0,max:95},{name:"El Refugio Destruido",from:5,to:20,min:0,max:95},{name:"Exportaciones de Dragones",clan:"Legends",from:5,to:25,min:0,max:95},{name:"Foire de Reves",from:0,to:50,min:0,max:95},{name:"Galeria de arte",from:10,to:50,min:0,max:95},{name:"Guarderia Enana",from:1,to:5,min:0,max:95},{name:"Haon Dor",from:5,to:10,min:0,max:95},{name:"Holy Grove",from:5,to:20,min:0,max:95},{name:"Kharadest, Baluarte de Platino",from:78,to:80,min:77,max:95},{name:"La Fortaleza de Valor",clan:"DragonSlayers",from:5,to:30,min:0,max:95},{name:"La Mansion de Marmol",from:5,to:15,min:0,max:95},{name:"La Mansion de Tullfuhrzky",from:1,to:10,min:0,max:95},{name:"La Torre del Brujo",clan:"Legends",from:10,to:20,min:0,max:95},{name:"Las Alcantarillas",from:5,to:20,min:0,max:95},{name:"Las Llanuras del Norte",from:1,to:20,min:0,max:95},{name:"Miden'nir",from:5,to:15,min:0,max:95},{name:"Residencias de Mortales",from:0,to:95,min:0,max:95},{name:"Sindaliore",clan:"Legends",from:75,to:80,min:77,max:95}],Earand:[{name:"Armageddon",clan:"Conclave",from:50,to:80,min:0,max:95},{name:"Asgard",clan:"El Santuario",from:40,to:60,min:0,max:95},{name:"Asoinwan, ciudad de las hadas",clan:"DragonSlayers",from:5,to:30,min:0,max:95},{name:"Camelot",from:65,to:80,min:50,max:95},{name:"Dregoria",clan:"Cantico",from:40,to:65,min:0,max:95},{name:"El Calabozo de la Muerte",from:10,to:35,min:0,max:95},{name:"El Campo de Batalla Desolado",from:15,to:25,min:0,max:95},{name:"El Plano Astral",clan:"DarkAngels",from:15,to:35,min:0,max:95},{name:"El Pueblo Fantasma",clan:"DragonSlayers",from:35,to:50,min:0,max:95},{name:"El Reino de Yggdrasil",from:15,to:50,min:0,max:95},{name:"El Yunque del Sol",clan:"Legends",from:60,to:80,min:0,max:95},{name:"Estroglia, corazn del Yunque",clan:"DarkAngels",from:75,to:80,min:75,max:95},{name:"Ghotiamir",from:0,to:95,min:0,max:95},{name:"La Ciudad de Velas",from:45,to:55,min:0,max:95},{name:"La Fortaleza de Lord Krothgar",from:35,to:60,min:0,max:95},{name:"La Fortaleza Enana",clan:"El Santuario",from:35,to:65,min:0,max:95},{name:"La Guarida de Kotegaesi",from:30,to:45,min:0,max:95},{name:"La tumba de Damara",clan:"Shinsent",from:15,to:25,min:0,max:95},{name:"Las Ruinas de los Antiguos",from:78,to:80,min:77,max:95},{name:"Observatorio del Ojo Celeste",clan:"Cantico",from:25,to:65,min:0,max:95},{name:"Valle de Rivendel",from:60,to:80,min:0,max:95},{name:"Villa Enana",from:10,to:35,min:0,max:95}],Niruk:[{name:"La casa de Anarion",from:75,to:80,min:75,max:95},{name:"Las Tierras Desoladas",clan:"DarkAngels",from:10,to:80,min:0,max:95},{name:"Residencia de Inmortales",from:81,to:95,min:0,max:95},{name:"Tiempo de L'Hopital",from:75,to:80,min:75,max:95}],Valmorag:[{name:"Bosque de los Muertos",from:20,to:40,min:0,max:95},{name:"Dhusebark",from:0,to:95,min:0,max:95},{name:"El Devorador de Mundos",from:30,to:50,min:0,max:95},{name:"El Legado de Xchantharus",clan:"El Santuario",from:30,to:50,min:0,max:95},{name:"El Mausoleo del Minotauro",from:40,to:65,min:0,max:95},{name:"Guarida de Gigantes de Fuego",from:40,to:50,min:0,max:95},{name:"Infierno",from:30,to:80,min:0,max:95},{name:"La Ciudad Maldita",clan:"Sindicato",from:40,to:80,min:0,max:95},{name:"La Fortaleza de Lilith",clan:"Torre Arcana",from:65,to:80,min:55,max:95},{name:"La Fortaleza de Mahn-Tor",from:5,to:35,min:0,max:95},{name:"La Gran Torre de la Hechiceria",from:10,to:30,min:0,max:95},{name:"La Maldicion del Nigromante",clan:"Cantico",from:30,to:55,min:0,max:95},{name:"La Residencia de Redferne",from:20,to:30,min:0,max:95},{name:"Los Pozos de la Reina Aranya",from:40,to:55,min:0,max:95},{name:"Los Usurpadores de Hochenyana",clan:"Shinsent",from:20,to:35,min:0,max:95},{name:"Profundidades Umbrias",from:20,to:50,min:0,max:95},{name:"Puerto Libre",from:10,to:55,min:0,max:95},{name:"Valle de Morgul",clan:"Shinsent",from:30,to:55,min:0,max:95}]}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.kill=void 0;const a=t(8),r=t(3);n.kill=async function({when:e,write:n,plugins:{navigation:t,skills:o}},s){const i=[...a.SPELLS_BY_TYPE.dedope,...a.SPELLS_BY_TYPE.attack];await async function(e,n){for(let t=0;t<e;t++)if(await n())return!0;return!1}(3,()=>o.castSpell(i,s))||n("matar "+s);const c=await Promise.any([t.waitForRecall().then(()=>"flee"),e(r.concatRegexes(s,/(?:\w| )* ha MUERTO!!/)).then(()=>"win"),e("No esta aqui.").timeout(3).then(()=>"missing"),e(["Huyes como un cobarde del combate.","Estas demasiado malherido para hacer eso.","Estas demasiado aturdido para hacer eso."]).then(()=>"flee")]);return"win"===c&&(n("sacrificar cuerpo"),await e("te da una moneda de oro por tu sacrificio.")),c}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.train=void 0;const a=t(23),r=t(22);n.train=async function({log:e,run:n,when:t,write:o,printLogs:s,plugins:{navigation:i,prompt:c,stats:l}},u){const d=await async function(e){const n=e?a.getAreaMetadata(e):await async function(){const e=await l.getLevel(),n=a.getAreasForLevel(e),[t,...r]=n.filter(e=>e.arena);r.length&&console.warn("Multiple arenas available");return t}();if(!n)throw new Error(`NO AREA "${e}"`);if(!n.arena)throw new Error(`"${n.name}" is unknown`);const t=n.path.split(""),r=t.pop(),o=Array.isArray(n.arena)?n.arena.join(""):n.arena;return{path:t.join(""),arena:`${r}${o}`}}(u),m=[];t(r.MOB_PRESENT,({captured:e,fullMatch:n})=>h(n||e[0])),t(r.MOB_ARRIVES,({groups:e})=>h(e.mob)),t(r.MOB_LEAVES,e=>{const{mob:n}=e.groups;n?function(e){const n=r.getMobIn(e);if(n){const e=m.indexOf(n);e>-1&&m.splice(e,1)}}(e.groups.mob):console.warn("No MOB detected in",e.captured)});const p=`${d.path}${d.arena}`;return o("visible"),await i.execute(p,(async function(){await c.until(({mv:{current:e}})=>e>50);for(;m.length;){if(await g())return!1;await Promise.any([t(r.MOB_ARRIVES),f()])}})),i.recall();async function f(){return c.until(({hp:{percent:e},mana:{percent:n}})=>e>.7&&n>.5)}function h(e){const n=r.getMobIn(e);n&&m.push(n)}async function g(){for(;m.length;){const t=await n("kill",[m.pop()]);if("flee"===t)return console.log("Had to run. Train over."),await i.recall(),!0;e("Fight result: "+t)}}}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.wear=void 0;const a=t(10),r=t(3);n.wear=async function({run:e,when:n,write:t},...o){const s=o.length?o:a.ITEM_SUSTANTIVES;for(const e of s)for(let n=0;n<5&&!await i(e);n++);async function i(o){t(`coger "${o}"`);if(!await Promise.any([n(`No hay ningun ${o} aqui.`).wait(8).then(()=>!1),n(r.concatRegexes(/Coges/,a.ITEM_ARTICLE,/(?: (?:\\w|)+)* /i,o)).then(()=>!0)]))throw new Error(`Couldn't pick up "${o}"`);let s=!1;const i=n(" es un(a) armadura_metalica,",()=>s=!0),l=await e("cast",["identificar",o]);if(i.unsubscribe(),!l)throw new Error(`Couldn't identifiy "${o}"`);if(s)return await c(o),!1;t(`vestir "${o}"`);const u=await Promise.any([n(a.WEAR).then(()=>!0),n(a.UNWEAR).then(({groups:e})=>e.item),n([/Debes ser nivel \w+ para usar este objeto./,"No puedes vestir eso, necesita repararse."]).then(()=>!1)]);if(!1===u)return await c(o),!1;if("string"==typeof u){const r=a.getItemSustantive(u);r&&(await e("cast",["identificar",r]),t(`poner ${r} mochila`),await n("Pones "))}return!0}function c(e){return t(`tirar "${e}"`),n("Tiras ")}}},function(e,n,t){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.renderUserInterface=void 0;const r=t(5);t(66);const o=t(67),s=t(70),i=a(t(73)),c=t(6),l=t(74),u=t(77);n.renderUserInterface=function(e){const n=function(){const e=new r.ClientStorage("ui:state");e.get()||e.set({showControls:!1});return e}(),t=n.get(),a=c.render(i.default),d=a.$(".container"),m=new l.Sidebar;m.render(d);const p=new o.Controls;p.render(d);const f=new u.Terminal;f.render(d),e.appendChild(a);const h=new s.Hamburger(t.showControls);return h.render(e),h.onChange(e=>{e?(d.classList.add("show-controls"),t.showControls=!0):(d.classList.remove("show-controls"),t.showControls=!1),n.set(t)}),{controls:p,sidebar:m,terminal:f}}},function(e,n,t){"use strict";t.r(n);var a=t(0),r=t.n(a),o=t(11),s={insert:"head",singleton:!1};r()(o.a,s);n.default=o.a.locals||{}},function(e,n,t){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.Controls=void 0,t(68);const r=t(6),o=a(t(69));n.Controls=class{constructor(){this.dom=r.render(o.default),this.meterTpl=this.dom.$(".meter-template"),this.buttonTpl=this.dom.$(".button-template")}render(e){e.appendChild(this.dom)}addMeter(e,n){const t=r.render(this.meterTpl,{".meter":t=>{t.style.setProperty("--color",e),t.style.setProperty("--value","100%"),n(e=>{const n=Math.round(100*e);t.style.setProperty("--value",n+"%")})}});this.dom.appendChild(t)}addButton(e,n){const t=r.render(this.buttonTpl,{button:t=>{t.textContent=e,t.addEventListener("click",n)}});this.dom.appendChild(t)}}},function(e,n,t){"use strict";t.r(n);var a=t(0),r=t.n(a),o=t(12),s={insert:"head",singleton:!1};r()(o.a,s);n.default=o.a.locals||{}},function(e,n){e.exports='<header class="controls"></header> <template class="meter-template"> <div class="meter" data-color="white" data-value="100%"> <div class="bar"></div> </div> </template> <template class="button-template"> <button class="ui-button"></button> </template> '},function(e,n,t){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.Hamburger=void 0,t(71);const r=t(4),o=t(6),s=a(t(72));n.Hamburger=class{constructor(e=!1){this.dom=o.render(s.default),this.checkbox=this.dom.$("input"),this.emitChange=r.emitter(),this.onChange=this.emitChange.subscribe,this.toggle=this.toggle.bind(this),this.checkbox.checked=e}render(e){this.checkbox.addEventListener("change",this.toggle),e.appendChild(this.dom),this.checkbox.checked&&this.toggle()}toggle(){this.emitChange(this.checkbox.checked)}}},function(e,n,t){"use strict";t.r(n);var a=t(0),r=t.n(a),o=t(13),s={insert:"head",singleton:!1};r()(o.a,s);n.default=o.a.locals||{}},function(e,n){e.exports='<div class="hamburger"> <input type="checkbox"/> <span></span> <span></span> <span></span> </div> '},function(e,n){e.exports='<div class="container"></div> '},function(e,n,t){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.Sidebar=void 0,t(75);const r=t(6),o=a(t(76));n.Sidebar=class{constructor(){this.dom=r.render(o.default)}render(e){e.appendChild(this.dom)}}},function(e,n,t){"use strict";t.r(n);var a=t(0),r=t.n(a),o=t(14),s={insert:"head",singleton:!1};r()(o.a,s);n.default=o.a.locals||{}},function(e,n){e.exports='<aside class="sidebar"></aside> '},function(e,n,t){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.Terminal=void 0;const r=t(5);t(78);const o=a(t(79)),s=t(4),i=t(6),c=a(t(86)),l=new o.default,u=new r.ClientStorage("mud:command-history");function d(e){const n=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/  +/g,e=>"&nbsp;".repeat(e.length));return l.toHtml(n).replace(/\n/g,"<br>")}function m(){const e=getSelection();return e&&"Range"===e.type}n.Terminal=class{constructor(){this.dom=i.render(c.default),this.$log=this.dom.$(".log"),this.$input=this.dom.$("input"),this.log=[],this.history=u.get()||[],this.histPos=0,this.emitSubmit=s.emitter(),this.onSubmit=this.emitSubmit.subscribe,this.onKey=this.onKey.bind(this)}focus(){this.$input.focus()}render(e){this.dom.$(".terminal").addEventListener("click",()=>{m()||this.$input.focus()}),this.$input.addEventListener("keydown",this.onKey),e.appendChild(this.dom)}write(e){const n=this.$log.parentElement,t=`${this.log.length?this.log.pop():""}${a=e,a.replace(/\r/g,"")}`.split(/\n\n+/);var a;const r=t.pop();for(const e of t){this.log.push(e);const t=document.createElement("p");t.innerHTML=d(e),n.insertBefore(t,this.$log)}this.log.push(r),this.$log.innerHTML=d(r),m()||(n.scrollTop=n.scrollHeight)}onKey(e){"Enter"===e.code&&this.submit(),"ArrowUp"===e.code&&this.loadHistory(1),"ArrowDown"===e.code&&this.loadHistory(-1),this.$input.size=this.$input.value.length+1}submit(){const{value:e}=this.$input;this.$input.value="",this.histPos=0;for(const n of e.split(/\s+;\s+/))n&&(this.history.shift(),this.history.unshift(n),this.history.unshift(""),u.set(this.history)),this.emitSubmit(n)}loadHistory(e){var n,t,a;this.history.length&&(this.history[this.histPos]=this.$input.value,this.histPos=(n=this.histPos+e,t=0,a=this.history.length-1,n<t?t:n>a?a:n),this.$input.value=this.history[this.histPos])}}},function(e,n,t){"use strict";t.r(n);var a=t(0),r=t.n(a),o=t(15),s={insert:"head",singleton:!1};r()(o.a,s);n.default=o.a.locals||{}},,,,,,,,function(e,n){e.exports='<main class="terminal"> <span class="log"></span> <input type="text" size="1" autofocus> </main>'},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getPassword=void 0;const a=t(5);n.getPassword=function(e){const n=new a.ClientStorage("pass:"+e),t=n.get();if(t)return t;const r=prompt("Password for "+e);if(!r)throw new Error("Password required");return n.set(r),r}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getQueryParams=void 0,n.getQueryParams=function(){const e={};return window.location.search.substr(1).split("&").map(e=>e.split("=").map(decodeURIComponent)).forEach(([n,t])=>e[n]=t),e}},function(e){e.exports=JSON.parse('{"DEFAULT_PORT":53472}')}]);
//# sourceMappingURL=main.js.map
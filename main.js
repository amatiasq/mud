!function(e){function t(t){for(var r,i,a=t[0],c=t[1],l=t[2],d=0,p=[];d<a.length;d++)i=a[d],Object.prototype.hasOwnProperty.call(o,i)&&o[i]&&p.push(o[i][0]),o[i]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);for(u&&u(t);p.length;)p.shift()();return s.push.apply(s,l||[]),n()}function n(){for(var e,t=0;t<s.length;t++){for(var n=s[t],r=!0,a=1;a<n.length;a++){var c=n[a];0!==o[c]&&(r=!1)}r&&(s.splice(t--,1),e=i(i.s=n[0]))}return e}var r={},o={0:0},s=[];function i(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var a=window.webpackJsonp=window.webpackJsonp||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var l=0;l<a.length;l++)t(a[l]);var u=c;s.push([21,1]),n()}([,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSpells=t.SPELL_LEARN_ORDER=t.SPELLS_BY_TYPE=t.SPELL_NOT_POSSIBLE=t.SPELL_ALREADY_APPLIED=t.SPELL_FAILED=t.UNKNOWN=void 0,t.UNKNOWN=null,t.SPELL_FAILED=["Algo te distrae y pierdes la concentracion.","Has perdido la concentracion.","Has tenido una laguna mental mientras invocabas el hechizo.","Pierdes la concentracion.","Un picor en la nariz te impide mantener la concentracion.","Un pinchazo en tu pierna te impide lanzar el conjuro adecuadamente.","Una mota de polvo en el ojo rompe tu concentracion por un momento."],t.SPELL_ALREADY_APPLIED=["Has fallado.","Eso no parece tener ningun efecto."],t.SPELL_NOT_POSSIBLE=["No tienes suficiente mana.","Este estilo de lucha pide demasiado atencion para hacer eso!","Este asalto del combate es demasiado febril para concentrarte adecuadamente.","No has tenido suficiente tiempo en este asalto para completar el conjuro."],t.SPELLS_BY_TYPE={food:["crear baya","crear comida"],water:["crear manantial","crear agua"],levitate:["volar","flotar"],heal:["curar criticas","curar graves","curar leves"],attack:["causar critica","causar grave","causar leve"],dedope:["ceguera","veneno"]},t.SPELL_LEARN_ORDER=[t.SPELLS_BY_TYPE.food,t.SPELLS_BY_TYPE.water,t.SPELLS_BY_TYPE.dedope,"luz eterna","invisibilidad","invocar armadillo","armadura","bendecir","detectar escondido","detectar invisible","detectar magia",t.SPELLS_BY_TYPE.levitate,"curar ceguera",t.SPELLS_BY_TYPE.heal,"refrescar",t.SPELLS_BY_TYPE.attack,"crear fuego"],t.getSpells=function(){return Object.entries(r).filter(([e,t])=>t).map(([e,t])=>({...t,name:e}))};const r={armadura:{success:"Tu armadura brilla suavemente al ser mejorada por un conjuro.",endEffect:"Tu armadura vuelve a su valor normal.",dope:!0},bendecir:{success:"Tu dios te otorga una poderosa bendicion.",endEffect:t.UNKNOWN},"causar critica":t.UNKNOWN,"causar grave":{success:/Tu conjuro [^\n]+ a( w+)+!/},"causar leve":t.UNKNOWN,ceguera:{success:/Lanzas un conjuro de ceguera contra ([^.]+)./},"conocer alineamiento":t.UNKNOWN,"crear agua":{success:" esta lleno.\n"},"crear baya":t.UNKNOWN,"crear comida":{success:"Una seta magica aparece de repente."},"crear fuego":{success:"Una gran hoguera se enciende en el suelo delante tuyo."},"crear manantial":{success:"Trazas un circulo delante tuyo del cual emerge un manantial de agua cristalina.",endEffect:"Un manantial magico se seca."},"curar ceguera":t.UNKNOWN,"curar criticas":t.UNKNOWN,"curar graves":t.UNKNOWN,"curar leves":{success:"Tus heridas leves se cierran y el dolor desaparece."},"curar veneno":t.UNKNOWN,"detectar escondido":{success:"Tus sentidos cobran la viveza de los del mejor predador.",endEffect:"Te sientes menos consciente de lo que te rodea.",dope:!0},"detectar invisible":{success:"Tus ojos brillan, siendo capaces ahora de ver lo invisible.",endEffect:"Ya no ves objetos invisibles.",dope:!0},"detectar magia":{success:"Delgadas lineas azules reseguiran las siluetas de los objetos magicos que te encuentres.",endEffect:"Las lineas azules desaparecen de tu vision",dope:!0},"detectar maldad":{success:"Delgadas lineas rojas reseguiran las siluetas de los seres malvados que te encuentres.",endEffect:t.UNKNOWN,dope:!0},"detectar trampas":{success:"De repente te sientes mas alerta de los peligros que te rodean.",endEffect:"Te sientes menos alerta de los peligros que te rodean.",dope:!0},"disipar maldad":t.UNKNOWN,flotar:{success:"Empiezas a flotar a unos centimetros del suelo...",endEffect:"Tus pies aterrizan suavemente en el suelo.",dope:["volar","flotar"]},"fuego espectral":t.UNKNOWN,invisibilidad:{success:"Te desvaneces en el aire.",endEffect:"Ya no eres invisible.",dope:!0},"invocar armadillo":{success:"Agitas tus brazos a la vez que te concentras para invocar un pequenyo armadillo.",endEffect:t.UNKNOWN},"llamar rayo":t.UNKNOWN,"luz eterna":{success:"Rayos de luz iridiscente colisionan para formar una bola de luz eterna...",endEffect:"Esta completamente oscuro ...",afterDope:["vestir luz","mirar"]},maldecir:t.UNKNOWN,"misil magico":t.UNKNOWN,"niebla espectral":t.UNKNOWN,proteccion:t.UNKNOWN,refrescar:{success:"Nueva vitalidad fluye hacia ti."},terremoto:t.UNKNOWN,veneno:t.UNKNOWN,volar:{success:"Te elevas entre las corrientes de aire...",endEffect:"Aterrizas suavemente en el suelo.",dope:["volar","flotar"]}}},function(e,t,n){"use strict";function r(e){return e.cloneNode(!0)}Object.defineProperty(t,"__esModule",{value:!0}),t.render=void 0,t.render=function(e,t){"string"==typeof e&&(e=function(e){const t=document.createElement("template");return t.innerHTML=e,t}(e));const n=e instanceof HTMLTemplateElement?r(e.content):r(e);if(t)for(const[e,r]of Object.entries(t)){const t=n.querySelector(e);t?r(t):console.error(`Selector ${e} returned no results`)}return Object.assign(n,{$:e=>n.querySelector(e)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wait=void 0,t.wait=function(e){return new Promise(t=>setTimeout(t,1e3*e))}},function(e,t,n){"use strict";var r=n(1),o=n.n(r),s=n(2),i=n.n(s)()(o.a);i.push([e.i,"body {\n  --background-color: #1c1c1c;\n  --border-color: #484848;\n}\n\n.container {\n  height: 100%;\n  display: grid;\n  grid-template-rows: 1fr;\n  grid-template-columns: 1fr;\n  grid-template-areas: 'terminal';\n}\n\n.container.show-controls {\n  grid-template-rows: 50px auto;\n  grid-template-columns: 9fr 3fr;\n  grid-template-areas:\n    'controls sidebar'\n    'terminal sidebar';\n}\n\n.terminal {\n  grid-area: terminal;\n}\n\n.sidebar {\n  grid-area: sidebar;\n  background-color: var(--background-color);\n  border-left: 1px solid var(--border-color);\n}\n\n.controls {\n  grid-area: controls;\n  background-color: var(--background-color);\n  border-bottom: 1px solid var(--border-color);\n}\n\n.container:not(.show-controls) .sidebar,\n.container:not(.show-controls) .controls {\n  display: none;\n}\n","",{version:3,sources:["webpack://src/ui/index.css"],names:[],mappings:"AAAA;EACE,2BAA2B;EAC3B,uBAAuB;AACzB;;AAEA;EACE,YAAY;EACZ,aAAa;EACb,uBAAuB;EACvB,0BAA0B;EAC1B,+BAA+B;AACjC;;AAEA;EACE,6BAA6B;EAC7B,8BAA8B;EAC9B;;sBAEoB;AACtB;;AAEA;EACE,mBAAmB;AACrB;;AAEA;EACE,kBAAkB;EAClB,yCAAyC;EACzC,0CAA0C;AAC5C;;AAEA;EACE,mBAAmB;EACnB,yCAAyC;EACzC,4CAA4C;AAC9C;;AAEA;;EAEE,aAAa;AACf",sourcesContent:["body {\n  --background-color: #1c1c1c;\n  --border-color: #484848;\n}\n\n.container {\n  height: 100%;\n  display: grid;\n  grid-template-rows: 1fr;\n  grid-template-columns: 1fr;\n  grid-template-areas: 'terminal';\n}\n\n.container.show-controls {\n  grid-template-rows: 50px auto;\n  grid-template-columns: 9fr 3fr;\n  grid-template-areas:\n    'controls sidebar'\n    'terminal sidebar';\n}\n\n.terminal {\n  grid-area: terminal;\n}\n\n.sidebar {\n  grid-area: sidebar;\n  background-color: var(--background-color);\n  border-left: 1px solid var(--border-color);\n}\n\n.controls {\n  grid-area: controls;\n  background-color: var(--background-color);\n  border-bottom: 1px solid var(--border-color);\n}\n\n.container:not(.show-controls) .sidebar,\n.container:not(.show-controls) .controls {\n  display: none;\n}\n"],sourceRoot:""}]),t.a=i},function(e,t,n){"use strict";var r=n(1),o=n.n(r),s=n(2),i=n.n(s)()(o.a);i.push([e.i,".controls {\n  display: flex;\n  align-items: stretch;\n}\n\n.controls .meter {\n  width: 100px;\n  margin: 8px;\n  margin-right: 0;\n  border: 1px solid var(--border-color);\n  --color: white;\n  --value: 100%;\n}\n\n.controls .meter .bar {\n  height: 100%;\n  width: var(--value);\n  background-color: var(--color);\n}\n","",{version:3,sources:["webpack://src/ui/Controls/Controls.css"],names:[],mappings:"AAAA;EACE,aAAa;EACb,oBAAoB;AACtB;;AAEA;EACE,YAAY;EACZ,WAAW;EACX,eAAe;EACf,qCAAqC;EACrC,cAAc;EACd,aAAa;AACf;;AAEA;EACE,YAAY;EACZ,mBAAmB;EACnB,8BAA8B;AAChC",sourcesContent:[".controls {\n  display: flex;\n  align-items: stretch;\n}\n\n.controls .meter {\n  width: 100px;\n  margin: 8px;\n  margin-right: 0;\n  border: 1px solid var(--border-color);\n  --color: white;\n  --value: 100%;\n}\n\n.controls .meter .bar {\n  height: 100%;\n  width: var(--value);\n  background-color: var(--color);\n}\n"],sourceRoot:""}]),t.a=i},function(e,t,n){"use strict";var r=n(1),o=n.n(r),s=n(2),i=n.n(s)()(o.a);i.push([e.i,".hamburger {\n  display: inline-block;\n  position: absolute;\n  top: 24px;\n  right: 40px;\n  z-index: 1;\n  -webkit-user-select: none;\n  user-select: none;\n}\n\n.hamburger input {\n  display: block;\n  width: 40px;\n  height: 32px;\n  position: absolute;\n  top: -7px;\n  left: -5px;\n  cursor: pointer;\n  opacity: 0; /* hide this */\n  z-index: 2; /* and place it over the hamburger */\n  -webkit-touch-callout: none;\n}\n\n.hamburger span {\n  display: block;\n  width: 33px;\n  height: 4px;\n  margin-bottom: 5px;\n  position: relative;\n  background: #cdcdcd;\n  border-radius: 3px;\n  z-index: 1;\n  transform-origin: center right;\n  transition: transform 0.5s cubic-bezier(0.77, 0.2, 0.05, 1),\n    background 0.5s cubic-bezier(0.77, 0.2, 0.05, 1), opacity 0.55s ease;\n}\n\n/*\n * Transform all the slices of hamburger\n * into a crossmark.\n */\n.hamburger input:checked ~ span:nth-of-type(2) {\n  opacity: 0;\n  transform: rotate(0deg) scale(0.2, 0.2);\n}\n\n.hamburger input:checked ~ span:first-of-type {\n  transform: rotate(-45deg) translate(0, -4px);\n}\n\n.hamburger input:checked ~ span:last-of-type {\n  transform: rotate(45deg) translate(0, 4px);\n}\n","",{version:3,sources:["webpack://src/ui/Hamburger/Hamburger.css"],names:[],mappings:"AAAA;EACE,qBAAqB;EACrB,kBAAkB;EAClB,SAAS;EACT,WAAW;EACX,UAAU;EACV,yBAAyB;EACzB,iBAAiB;AACnB;;AAEA;EACE,cAAc;EACd,WAAW;EACX,YAAY;EACZ,kBAAkB;EAClB,SAAS;EACT,UAAU;EACV,eAAe;EACf,UAAU,EAAE,cAAc;EAC1B,UAAU,EAAE,oCAAoC;EAChD,2BAA2B;AAC7B;;AAEA;EACE,cAAc;EACd,WAAW;EACX,WAAW;EACX,kBAAkB;EAClB,kBAAkB;EAClB,mBAAmB;EACnB,kBAAkB;EAClB,UAAU;EACV,8BAA8B;EAC9B;wEACsE;AACxE;;AAEA;;;EAGE;AACF;EACE,UAAU;EACV,uCAAuC;AACzC;;AAEA;EACE,4CAA4C;AAC9C;;AAEA;EACE,0CAA0C;AAC5C",sourcesContent:[".hamburger {\n  display: inline-block;\n  position: absolute;\n  top: 24px;\n  right: 40px;\n  z-index: 1;\n  -webkit-user-select: none;\n  user-select: none;\n}\n\n.hamburger input {\n  display: block;\n  width: 40px;\n  height: 32px;\n  position: absolute;\n  top: -7px;\n  left: -5px;\n  cursor: pointer;\n  opacity: 0; /* hide this */\n  z-index: 2; /* and place it over the hamburger */\n  -webkit-touch-callout: none;\n}\n\n.hamburger span {\n  display: block;\n  width: 33px;\n  height: 4px;\n  margin-bottom: 5px;\n  position: relative;\n  background: #cdcdcd;\n  border-radius: 3px;\n  z-index: 1;\n  transform-origin: center right;\n  transition: transform 0.5s cubic-bezier(0.77, 0.2, 0.05, 1),\n    background 0.5s cubic-bezier(0.77, 0.2, 0.05, 1), opacity 0.55s ease;\n}\n\n/*\n * Transform all the slices of hamburger\n * into a crossmark.\n */\n.hamburger input:checked ~ span:nth-of-type(2) {\n  opacity: 0;\n  transform: rotate(0deg) scale(0.2, 0.2);\n}\n\n.hamburger input:checked ~ span:first-of-type {\n  transform: rotate(-45deg) translate(0, -4px);\n}\n\n.hamburger input:checked ~ span:last-of-type {\n  transform: rotate(45deg) translate(0, 4px);\n}\n"],sourceRoot:""}]),t.a=i},function(e,t,n){"use strict";var r=n(1),o=n.n(r),s=n(2),i=n.n(s)()(o.a);i.push([e.i,".sidebar {\n}\n","",{version:3,sources:["webpack://src/ui/Sidebar/Sidebar.css"],names:[],mappings:"AAAA;AACA",sourcesContent:[".sidebar {\n}\n"],sourceRoot:""}]),t.a=i},function(e,t,n){"use strict";var r=n(1),o=n.n(r),s=n(2),i=n.n(s)()(o.a);i.push([e.i,".terminal {\n  grid-area: terminal;\n  overflow-x: hidden;\n  overflow-y: auto;\n  -ms-overflow-style: none; /* IE and Edge */\n  scrollbar-width: none; /* Firefox */\n}\n\n.terminal::-webkit-scrollbar {\n  display: none;\n}\n\n.terminal p {\n  margin: 1em 0;\n}\n\n.terminal input {\n  background-color: transparent;\n  border: none;\n  color: white;\n  display: inline-block;\n  font-family: monospace;\n  outline: none;\n}\n","",{version:3,sources:["webpack://src/ui/Terminal/Terminal.css"],names:[],mappings:"AAAA;EACE,mBAAmB;EACnB,kBAAkB;EAClB,gBAAgB;EAChB,wBAAwB,EAAE,gBAAgB;EAC1C,qBAAqB,EAAE,YAAY;AACrC;;AAEA;EACE,aAAa;AACf;;AAEA;EACE,aAAa;AACf;;AAEA;EACE,6BAA6B;EAC7B,YAAY;EACZ,YAAY;EACZ,qBAAqB;EACrB,sBAAsB;EACtB,aAAa;AACf",sourcesContent:[".terminal {\n  grid-area: terminal;\n  overflow-x: hidden;\n  overflow-y: auto;\n  -ms-overflow-style: none; /* IE and Edge */\n  scrollbar-width: none; /* Firefox */\n}\n\n.terminal::-webkit-scrollbar {\n  display: none;\n}\n\n.terminal p {\n  margin: 1em 0;\n}\n\n.terminal input {\n  background-color: transparent;\n  border: none;\n  color: white;\n  display: inline-block;\n  font-family: monospace;\n  outline: none;\n}\n"],sourceRoot:""}]),t.a=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.singleExecution=void 0,t.singleExecution=function(e){let t=null;return()=>t||(t=e().then(e=>(t=null,e)),t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PatternPromise=void 0;const r=n(7),o=n(28);t.PatternPromise=class extends Promise{constructor(e){let t;super((n,r)=>{t=r,e(n,r)}),this.forceReject=t}timeout(e){return r.wait(e).then(()=>this.forceReject(new o.PatternPromiseTimeoutError)),this}wait(e){return Promise.race([this,r.wait(e)])}unsubscribe(){this.forceReject("aborted")}once(){return this}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promptPlugin=t.PROMPT_DETECTOR=void 0;const r=n(3),o=["&W<","&R%h/%Hhp ","&C%m/%Mm ","&G%v/%Vmv ","&P%Xxp ","&Y%gg","&W> ","&W%A ","\n"].join(""),s=o.replace("&W>"," &R%E&W>");t.PROMPT_DETECTOR=new RegExp(["<","(?<hpCurr>\\d+)/(?<hpTotal>\\d+)hp ","(?<mCurr>\\d+)/(?<mTotal>\\d+)m ","(?<mvCurr>\\d+)/(?<mvTotal>\\d+)mv ","(?<exp>(\\d|,)+)xp ","(?<gold>(\\d|,)+)g","( \\((?<enemy>\\d+)%\\))?","> (?<invis>I)?"].join(""));class i{constructor(){this.total=0,this.current=0}get percent(){const e=this.total?1/this.total*this.current:0;return Math.round(100*e)/100}}function a(e){return parseInt(e.replace(/,/g,""),10)}t.promptPlugin=async function({when:e,write:n}){let c=!1;const l={hp:new i,mana:new i,mv:new i,exp:0,gold:0,enemy:null,get isFighting(){return null!==l.enemy}},u=r.emitter();return e(t.PROMPT_DETECTOR).timeout(1).catch((function(){n("prompt "+o),n("fprompt "+s)})).finally(()=>{e(t.PROMPT_DETECTOR,({groups:e})=>{l.hp.current=a(e.hpCurr),l.hp.total=a(e.hpTotal),l.mana.current=a(e.mCurr),l.mana.total=a(e.mTotal),l.mv.current=a(e.mvCurr),l.mv.total=a(e.mvTotal),l.exp=a(e.exp),l.gold=a(e.gold),l.enemy=e.enemy?a(e.enemy):null,c=Boolean(e.invis),u(l)})}),{waitForPrompt:function(){return e(t.PROMPT_DETECTOR)},getPercent:function(e){return l[e].percent},until:d,whenFresh:function(){return d(e=>1===e.hp.percent&&1===e.mana.percent&&1===e.mv.percent)},onUpdate:u.subscribe,get isFighting(){return l.isFighting},get isInvisible(){return c}};function d(e){return!!e(l)||new Promise(t=>{const n=u.subscribe(r=>{e(r)&&(n(),t(r))})})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PluginContext=void 0;const r=n(17),o=n(18),s=n(7);class i{constructor(e,t,n,r){this.name=e,this.username=t,this.triggers=n,this.send=r,this.subscriptions=[],this.isPrintingLogs=!1,this.isAborted=!1,o.bindAll(this,i)}get printLogs(){return this.isPrintingLogs=!0,null}write(e,t){this.checkNotAborted(),this.log("[WRITE]",e),this.send(e,t)}when(e,t,n){return this.checkNotAborted(),this.log("[WATCH]",e),"function"==typeof t?this.triggers.add(e,t,n):this.triggers.add(e,t)}sleep(e){return this.checkNotAborted(),this.log("[SLEEP]",e),s.wait(e)}abort(){this.isAborted=!0}dispose(){this.log("DISPOSE"),this.subscriptions.forEach(e=>e.unsubscribe())}log(...e){this.checkNotAborted(),this.isPrintingLogs&&console.log(`[${this.name}]`,...e)}checkNotAborted(){if(this.isAborted)throw new r.ExecutionAbortedError}}t.PluginContext=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExecutionAbortedError=void 0;class r extends Error{}t.ExecutionAbortedError=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bindAll=void 0,t.bindAll=function(e,t){const n=t.prototype;Object.getOwnPropertyNames(n).filter(e=>"function"==typeof Object.getOwnPropertyDescriptor(n,e).value).forEach(t=>{e[t]=e[t].bind(e)})}},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(3),o=n(22),s=n(40),i=n(41),a=n(56),c=n(78),l=n(79),u=n(80);const d="https://amatiasq.github.io"===location.origin?"wss://mudOS.amatiasq.com":"ws://localhost:"+u.DEFAULT_PORT,{host:p,port:h,user:f,pass:m}=function(){const{user:e,server:t}=l.getQueryParams(),[n,r]=t.split(":"),o=c.getPassword(e);return{host:n,port:parseInt(r,10),user:e,pass:o}}(),{terminal:g,controls:A}=a.renderUserInterface(document.body);!function(){const e=new WebSocket(d);e.addEventListener("open",()=>{const t=new s.RemoteTelnet(e);t.connect(p,h),g.write(`Connecting to ${p}:${h} as ${f}\n`),async function(e){const t=new o.Mud(e);async function n(){const e=r.emitter();A.addMeter("red",e.subscribe);const n=r.emitter();A.addMeter("blue",n.subscribe);const o=r.emitter();A.addMeter("green",o.subscribe),t.getPlugin("prompt").onUpdate(t=>{e(t.hp.percent),n(t.mana.percent),o(t.mv.percent)})}function s(){A.addButton("Entrenar",()=>t.run("train"))}function a(e,n){const r=`"${e}" with "${n.join(" ")}"`;g.write(`-> Running ${r}\n`),t.run(e,n).then(e=>g.write(`\n<- Done ${r}\n`),e=>g.write(`\n\n<! FAILED ${r}: ${e.message}\n\n`))}t.onCommand(e=>g.write(e+"\n")),e.onData(e=>g.write(e)),window.onbeforeunload=()=>{e.isConnected&&e.send("abandonar"),e.close()},g.onSubmit(n=>{if(g.write(n+"\n"),n.startsWith("!")){const[e,...t]=n.substr(1).split(/\s+/);a(e,t)}else e.send(n),t.userInput(n)}),await t.login(f,m),i.registerWorkflows(t),await n(),s(),Object.assign(window,{mud:t})}(t)})}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Mud=void 0;const r=n(3),o=n(23),s=n(31),i=n(16),a=n(32),c=n(36),l=n(38),u=n(39);t.Mud=class{constructor(e){this.telnet=e,this.triggers=new a.TriggerCollection,this.workflows={},this.emitCommand=r.emitter(),this.onCommand=this.emitCommand.subscribe,this.whenLoggedIn=new Promise(e=>this.emitLoggedIn=e),this.workflow=this.workflow.bind(this),this.send=this.send.bind(this),this.run=this.run.bind(this),this.telnet.onData(e=>this.triggers.process(function(e){return e.replace(/\u001b\[.*?m/g,"")}(e).replace(/\r/g,"")))}async login(e,t){const n=new i.PluginContext("login","N/A",this.triggers,this.send);await s.login(n,e,t,async()=>{this.plugins=await o.initializePlugins(t=>new i.PluginContext(t,e,this.triggers,this.send))}),n.dispose(),this.username=e,this.emitLoggedIn(e)}send(e,t={}){this.emitCommand(t.password?"*".repeat(e.length):e),this.telnet.send(e)}userInput(e){}getPlugin(e){return this.plugins[e]}daemon(e,t,n,r){const o=new l.Workflow(e,async e=>(await t(e),e.runForever()));return this.executeWorkflow(o,n,r)}workflow(e,t){const n=new l.Workflow(e,t);return this.workflows[n.name]=n,n}run(e,t,n){if(!(e in this.workflows))throw new u.WorkflowNotFoundError(`Workflow ${e} is not registered.`);const r=this.workflows[e];return this.executeWorkflow(r,t,n)}executeWorkflow(e,t=[],{logs:n}={}){const r=this.createWorkflowContext(e.name);n&&r.printLogs;const o=e.execute(r,...t).then(e=>(r.dispose(),e));return Object.assign(o,{abort(){r.abort()}})}createWorkflowContext(e){return new c.Context(e,this.username,this.triggers,this.plugins,this.send,this.workflow,this.run)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initializePlugins=void 0;const r=n(24),o=n(26),s=n(27),i=n(15),a=n(29),c={chat:r.chatPlugin,inventory:o.inventoryPlugin,navigation:s.navigationPlugin,prompt:i.promptPlugin,skills:a.skillsPlugin};t.initializePlugins=async function(e){const t=Object.entries(c).map(async([t,n])=>[t,await n(e(t))]),n=await Promise.all(t);return Object.fromEntries(n)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.chatPlugin=void 0;const r=n(4),o=n(25);function s(e){return({groups:{name:t,message:n}})=>{console.log(`[MESSAGE(${t})]:`,n),c(e,{from:t,message:n}),a(t,n)}}function i(e){return({groups:{name:t,message:n}})=>c(e,{to:t,message:n})}async function a(e,t){return await o.requestNotificationPermission(),new Notification(`${name} te cuenta '${t}'`)}function c(e,t){const n={time:Date.now(),from:"me",to:"me",...t},r=e.get()||{},o=t.from||t.to,s=r[o]||[];return s.push(n),e.set({...r,[o]:s}),n}t.chatPlugin=function({when:e}){const t=new r.ClientStorage("chat:tell"),n=new r.ClientStorage("chat:whisper");window.chat=()=>t.get(),e(/(?<name>.+) te susurra '(?<message>[^']+)'/,s(n)),e(/Susurras a (?<name>.+) '(?<message>[^']+)'/,i(n)),e([/(?<name>.+) te cuenta '(?<message>[^']+)'/,/(?<name>.+) te responde '(?<message>[^']+)'/],s(t)),e([/Cuentas a (?<name>.+) '(?<message>[^']+)'/,/Respondes a (?<name>.+) '(?<message>[^']+)'/],i(t))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.requestNotificationPermission=void 0,t.requestNotificationPermission=function(){if("Notification"in window){if("granted"===Notification.permission)return Promise.resolve(!0);if("denied"!==Notification.permission)return Notification.requestPermission().then(e=>"granted"===e)}else console.warn("This browser does not support desktop notification")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.inventoryPlugin=void 0;const r=n(13),o=/Estas llevando:(\n.*)+?\n\n/;t.inventoryPlugin=function({when:e,write:t}){let n=!1,s={};const i=r.singleExecution(async()=>{t("inventario"),await e(o)});return e("No tienes ese objeto.",i),e(o,({captured:e})=>{const[t,...r]=e[0].split("\n").map(e=>e.trim()).filter(Boolean);n=!0,s={};for(const e of r){if("Nada."===e)return;const t=e.match(/(.*) \((\d+)\)$/);t?s[t[1]]=parseInt(t[2],10):s[e]=1}},{captureLength:1e3}),{refresh:i,has:async function(e){n||await i();if("string"==typeof e)return a(e)?e:null;if(Array.isArray(e))return e.find(a)||null;const t=Object.keys(e).find(a);return t?e[t]:null}};function a(e){return s[e]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.navigationPlugin=void 0;const r=n(3),o=n(14),s=n(15),i="(cerrada)",a={s:"sur",n:"norte",e:"este",w:"oeste",o:"oeste",u:"arriba",d:"abajo",l:"sureste",k:"suroeste",j:"noreste",h:"noroeste"};t.navigationPlugin=function({log:e,when:t,write:n}){let c=!1,l=!1,u=!1,d=[];const p=()=>t(s.PROMPT_DETECTOR),h=r.emitter();return t(/Plaza de Darkhaven\s+/,()=>l=!0),t("Puerta esta cerrada.",()=>{const e=d.find(e=>e.includes(i));if(e){const t=e.replace(i,"");n("abrir "+t),n(t)}}),t(/\nSalidas: ([^\.]+)/,async({captured:e})=>{d=e[1].split(" "),c=!1,u=l,l=!1,await p(),h(d)}),{canGo:m,go:g,execute:async function(e,t=(()=>{})){"r"===e[0]&&(await f(),e=e.substr(1));let n=!1;for(const o of(r=e,r.replace(/(\d+)(\w)/g,(e,t,n)=>n.repeat(t))))if("X"!==o.toUpperCase()){if(!n){if(await g(o)){await t();continue}return!1}for(;m(o);){if(!await g(o))return!1;await t()}n=!1}else n=!0;var r;return!0},recall:f,waitForRecall:function(){if(u)return new o.PatternPromise(e=>e());return t("Plaza de Darkhaven")},onRoomChange:h.subscribe,get isNavigating(){return c},get isAtRecall(){return u}};async function f(){if(u)return Promise.resolve();n("recall"),await t("Plaza de Darkhaven"),await p()}function m(e){return Boolean(A(e))}async function g(r){if(c)throw new Error("WTF DUDE");const o=A(r);if(!o)throw new Error(`Unknown direction '${r}'`);if(function(e){const t=A(e);return t&&t.includes(i)}(r)){n("abrir "+r);if(!await Promise.any([t("Abres la puerta.").then(()=>!0),t("Esta cerrada con llave.").then(()=>!1)]))return e("Can\t open door"),!1}return n(o.replace(i,"").trim()),c=!0,await t("\nSalidas:"),await p(),c=!1,!0}function A(e){return e in a&&(e=a[e]),d.find(t=>t.startsWith(e))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PatternPromiseTimeoutError=void 0;class r extends Error{}t.PatternPromiseTimeoutError=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.skillsPlugin=void 0;const r=n(30),o=n(13),s=n(5),i=void 0,a=Object.fromEntries(s.getSpells().map(e=>[e.name,e.success])),c=/((?:\w+ )+)\s+(\d+)%/g,l=r.concatRegexes(/-+\[(\w+)\]-+\n/,/(.|\n)+/,/Te quedan \d+ practicas.\n/,/Tienes \d+ entrenamientos.\n/);t.skillsPlugin=function({when:e,write:t}){let n=!1,r=!1,u={};const d=o.singleExecution(()=>(t("practicar"),e(l)));return e(l,({captured:[e]})=>{n=!0;for(const t of e.matchAll(c))u[t[1].trim()]=parseInt(t[2],10);n=!0,console.log(u)},{captureLength:3e3}),{has:p,canLearn:async function(e){return await f(),e in u},castSpell:async function(n,o=""){const c=await p(n);if(!c)return i;if(!(c in a))throw new Error(`Unknown response for spell "${n}".`);if(r)return null;r=!0,t(`conjurar "${c}" ${o}`);const l=a[c],u=await Promise.any([e(l).then(()=>true),e(s.SPELL_NOT_POSSIBLE).then(()=>i),e(s.SPELL_ALREADY_APPLIED).then(()=>1),e(s.SPELL_FAILED).wait(4).then(()=>false)]);return r=!1,u},NOT_AVAILABLE:i,BUSY:null,FAILED:false,CASTED:true,ALREADY_APPLIED:1};async function p(e){return await f(),"string"==typeof e?h(e)?e:null:e.find(h)||null}function h(e){return u[e]}function f(){if(!n)return d()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.concatRegexes=void 0,t.concatRegexes=function(...e){const t=e.map(e=>e.toString().replace(/^\/|\/[gi]*$/g,"")).join(""),n=e.map(e=>e instanceof RegExp&&e.flags).filter(Boolean).join(""),r=[...new Set(n)].join("");return new RegExp(t,r)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.login=void 0,t.login=async function({when:e,write:t,log:n},r,o,s){await e("Entra el nombre de tu personaje o escribe Nuevo:"),t(r),n("Username sent, waiting for password request"),await e("Password:"),t(o,{password:!0}),n("Logged in as "+r),await Promise.any([(async()=>{await e("Reconectando."),await s()})(),(async()=>{await e("Pulsa [ENTER]"),t(""),await e("Pulsa [ENTER]"),t(""),await e("Bienvenido a Balzhur...",s,{await:!0}).once()})()])}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TriggerCollection=void 0;const r=n(33),o=n(14);t.TriggerCollection=class{constructor(){this.patterns=new Set,this.queue=[],this.isProcessing=!1}add(e,t,n){return 1===arguments.length?this.once(e):3===arguments.length?this.watch(e,t,n):"function"==typeof t?this.watch(e,t):this.once(e,t)}watch(e,t,n){const s=new r.PatternMatcher(e,e=>t(e),n);this.patterns.add(s);const i=()=>this.patterns.delete(s);return{unsubscribe:i,once:()=>new o.PatternPromise(e=>{const r=t;t=async t=>{i(),r&&(n&&n.await?await r(t):r(t)),e(t)}})}}once(e,t){return new o.PatternPromise(n=>{const r=this.add(e,(function(e){r.unsubscribe(),n(e)}),t)})}async process(e){if(this.isProcessing)return void this.queue.push(e);this.isProcessing=!0;const t=e.split("\n"),n=t.pop(),r=[...t.map(e=>e+"\n"),n];for(const e of r)for(const t of this.patterns)await t.process(e);return this.isProcessing=!1,this.queue.length?this.process(this.queue.pop()):void 0}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PatternMatcher=void 0;const r=n(34),o=n(35);t.PatternMatcher=class{constructor(e,t,n={}){this.handler=t,this.options=n,this.patterns=Array.isArray(e)?e:[e],this.length=n.captureLength||10*Math.max(...this.patterns.map(e=>String(e).length)),this.buffer=function(e){let t="";const n=()=>t="",o=n=>t=r.trimEnd(`${t}${n}`,e);return Object.assign(o,{clear:n})}(this.length)}process(e){const t=this.buffer(e),n=this.patterns.filter(e=>this.testPattern(t,e));if(!n.length)return;this.buffer.clear();const r=new o.PatternResult(n,t),s=this.handler(r);return this.options.await?s:null}testPattern(e,t){return"string"==typeof t?e.indexOf(t)>-1:t.test(e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.trimEnd=void 0,t.trimEnd=function(e,t){return e.length>t?e.substr(e.length-t):e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PatternResult=void 0;function r(e){return e instanceof RegExp}function o(e,t){return{...e,...t}}t.PatternResult=class{constructor(e,t){this.patterns=e,this.haystack=t}get regexes(){return this.patterns.filter(r)}get stringPatterns(){return this.patterns.filter(e=>!r(e))}get captured(){return this.regexes.map(e=>this.haystack.match(e)).filter(Boolean).map(e=>Array.from(e))[0]}get groups(){return this.regexes.map(e=>this.haystack.match(e)).filter(Boolean).map(e=>e.groups).filter(Boolean).reduce(o,{})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Context=void 0;const r=n(17),o=n(16),s=n(18),i=n(37);class a extends o.PluginContext{constructor(e,t,n,r,o,c,l){var u,d;super(`W(${e})`,t,n,o),this.register=c,this.runWorkflow=l,this.finish=null,this.plugins=(u=r,d=this.log.bind(this),new Proxy(u,{get(e,t){if(!(t in e))throw d("Failed to get plugin "+t),new i.MissingPluginError(`Plugin ${t} is not registered.`);return d("Requires plugin "+t),e[t]}})),s.bindAll(this,a)}run(e,t=[]){return this.checkNotAborted(),this.log(`Invoke workflow ${e} with`,...t),this.runWorkflow(e,t,{logs:this.isPrintingLogs})}runForever(){return new Promise(e=>this.finish=e)}abort(){super.abort(),this.finish&&this.finish(new r.ExecutionAbortedError)}}t.Context=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MissingPluginError=void 0;class r extends Error{}t.MissingPluginError=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Workflow=void 0;t.Workflow=class{constructor(e,t){this.name=e,this.run=t,this.executionCount=0,this.currentExecutions=0}get isRunning(){return this.currentExecutions>0}get timesExecuted(){return this.executionCount}async execute(e,...t){this.currentExecutions++;const n=this.executionCount++;e.log(`[Exe(${n})]`,...t);try{const r=await this.run(e,...t);return e.log(`[Res(${n}]`,r),r}catch(t){throw e.log(`[ERR(${n})]`,t),t}finally{this.currentExecutions--}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkflowNotFoundError=void 0;class r extends Error{}t.WorkflowNotFoundError=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteTelnet=void 0;const r=n(3);t.RemoteTelnet=class{constructor(e){this.socket=e,this._isConnected=!1,this.emitClose=r.emitter(),this.onClose=this.emitClose.subscribe,this.emitData=r.emitter(),this.onData=this.emitData.subscribe,e.addEventListener("close",this.emitClose),e.addEventListener("message",this.onMessage.bind(this)),this.onData(()=>this._isConnected=!0),this.onClose(()=>this._isConnected=!1)}get isConnected(){return this._isConnected}connect(e,t){this.proxy("OPEN",{host:e,port:t})}send(e){this.proxy("INPUT",e)}close(){this.socket.close()}proxy(e,t){this.socket.send(JSON.stringify({type:e,payload:t}))}async onMessage(e){const t=(await e.data.text()).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");this.emitData(t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.registerWorkflows=void 0;const r=n(42),o=n(43),s=n(45),i=n(46),a=n(47),c=n(48),l=n(49),u=n(50),d=n(51),p=n(52),h=n(53),f=n(54),m=n(55);t.registerWorkflows=function(e){e.workflow("afk",l.afk),e.workflow("bank",u.bank),e.workflow("cast",d.cast),e.workflow("donations",p.donations),e.workflow("kill",f.kill),e.workflow("go",h.go),e.workflow("train",m.train),e.daemon("defend",r.defend),e.daemon("dope",o.dope),e.daemon("drink",s.drink),e.daemon("eat",i.eat),e.daemon("idle",a.idle),e.daemon("rest",c.rest)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defend=void 0;const r=n(5),o=["serpiente","caracol","lobo","conejo","ogro","orco","buitre","ciervo","dragon"];t.defend=async function({log:e,when:t,write:n,plugins:{prompt:s,skills:i,navigation:a}}){t("Estas demasiado exhausto para huir del combate!",()=>a.recall()),t(/El \w+ de (?:el|la|un|una) ((?: |\w)+) te /,async({captured:t})=>{const c=s.getPercent("hp");if(c<.1)await a.recall();else if(s.getPercent("mv")<.1||c<.3)n("huir");else if(s.getPercent("mana")>.1){const e=t[1],n=o.find(t=>e.includes(t));n||console.warn(`Unknown sustantive for "${e}"`),await i.castSpell(r.SPELLS_BY_TYPE.attack,n||e)}else e("Nothing")})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dope=void 0;const r=n(5),o=n(4),s=n(5),i=n(44),a=new o.ClientStorage("dope:casting");t.dope=async function({when:e,write:t,register:n,run:o,plugins:{prompt:c,skills:l}}){const u=m(.2),d=m(.1,.8),p=e=>o("cast",[e]).catch(()=>null),h=new Set(a.get()),f=s.getSpells();function m(e,t=1){const n=1/(t-e);return(r,o)=>{if(0===r||o>t)return!1;if(o<e)return!0;const s=(o-e)*n;return Math.hypot(r,1-s)>1}}f.filter(e=>e.endEffect).forEach((async function(n){const r=Array.isArray(n.dope)?n.dope:n.name;e(n.endEffect,async()=>{h.add(r),a.set([...h]);if(await p(r)){h.delete(r),a.set([...h]);const e=n.afterDope;Array.isArray(e)?e.forEach(e=>t(e)):e&&t(e)}})})),c.onUpdate(async({isFighting:e,mana:{percent:t},hp:{percent:n},mv:{percent:o}})=>{if(!e&&0!==t)return u(t,n)?l.castSpell(r.SPELLS_BY_TYPE.heal):d(t,o)?l.castSpell("refrescar"):void 0}),n("dope",async e=>{const t=f.filter(e=>e.dope).map(e=>Array.isArray(e.dope)?e.dope.join("|"):e.name);for(const e of i.uniq(t))await p(e.split("|"))})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uniq=void 0,t.uniq=function(e){return[...new Set(e)]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.drink=void 0,t.drink=async function({when:e,write:t,plugins:{inventory:n,navigation:r,skills:o}}){let s=!1,i=!1;async function a(){return n.has({"un odre de cuero":"odre","una cantimplora":"cantimplora"})}r.onRoomChange(()=>s=!1),e(["Un manantial magico esta aqui.","Una hermosa fuente de marmol blanco esta aqui.","Trazas un circulo delante tuyo del cual emerge un manantial de agua cristalina."],async()=>{if(s=!0,!i){const e=await a();e&&(t("llenar "+e),i=!0)}}),e(["Te apetece dar un sorbo a algo refrescante.","Tienes sed.","Estas realmente sediento.","Estas MUERTO de SED!","Estas en peligro de deshidratacion."],async()=>{if(s||await o.castSpell("crear manantial"))return void t("beber");const e=await a();e?(t("beber "+e),await o.castSpell("crear agua",e)):console.log("No hay fuente de agua")})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.eat=void 0,t.eat=async function({when:e,write:t,plugins:{inventory:n,navigation:r,skills:o}}){async function s(){const r=await async function(){return await i(),await n.has({"un chorizo":"chorizo","pavo cocinado":"pavo","una chuleta de cordero":"chuleta","loncha de salami":"salami","pierna de cordero":"pierna","ricas longanizas":"longanizas"})}();return r?(t("comer "+r),n.refresh(),!0):await async function(){if(!await o.castSpell("crear comida"))return!1;t("coger seta");try{return await e("Coges una seta magica.").timeout(3),t("comer seta"),!0}catch(e){return!1}}()}async function i(){if(await n.has("una bolsa")){t("coger todo bolsa"),t("examinar bolsa");const{captured:n}=await e(/Una bolsa contiene:\n\s+(Nada)?/);n[1]&&t("tirar bolsa")}}e(["Tienes hambre.","Estas realmente hambriento."],s),e(["Estas terriblemente hambriento.","Estas HAMBRIENTO!"],async()=>{await s()||(await async function(){await r.recall(),await r.execute("2sen"),t("comprar 1 chuleta"),await Promise.any([e("Compras una chuleta de cordero."),e("El carnicero pone todo en una bolsa y te la da.").then(i)]),await r.execute("sw2n")}(),await s())})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.idle=void 0,t.idle=async function({when:e,write:t,run:n,plugins:{navigation:r,skills:o}}){e("Desapareces en la nada.",async()=>{console.log("IDLE"),r.isAtRecall?(await n("train"),o.has("invisibilidad")&&await n("cast",["invisibilidad"])):t("estado")})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.rest=void 0,t.rest=async function({when:e,write:t}){e(["Nah... Estas demasiado relajado...","En tus suenyos o que?","Estas demasiado relajado para lanzar ese conjuro."],()=>t("despertar"))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.afk=void 0,t.afk=async function({run:e,plugins:{prompt:t}}){await async function n(){await t.whenFresh(),console.log("Stats 100%. Start train...");try{await e("train"),console.log("workflow completed")}catch(e){console.log("workflow failed")}return await e("bank"),n()}()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bank=void 0,t.bank=async function({write:e,plugins:{navigation:t}},n=2e3){await t.execute("r4s2en"),e("banco ingresar todo"),e("banco retirar "+n),await t.execute("s2w4n")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cast=void 0;const r=n(7);t.cast=async function({plugins:{prompt:e,skills:t}},n){const o=await async function n(o,s=""){e.isFighting&&await e.until(e=>!e.isFighting);switch(await t.castSpell(o,s)){case t.CASTED:case t.ALREADY_APPLIED:return!0;case t.NOT_AVAILABLE:return!1;case t.BUSY:await r.wait(3);case t.FAILED:return n(o,s)}throw new Error("WTF DUDE")}(n);if(!1===o)throw new Error(`Unable to cast "${n}"`);return o}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.donations=void 0;const r={weapon:["baculo","baston","vara","varita","daga","pica","lanza","espada","hacha","martillo","maza"],body:["ropaje"],hands:["coderas","guanteletes","guantes","mangas","manoplas","pulsera"],feet:["botas","grebas","mocasines","perneras","polainas","tobillera"],head:["anteojos","casco","somprero","visera"],complements:["anillo","colgante","collar","pendiente"],shield:["escudo"]};t.donations=async function({when:e,write:t,plugins:{navigation:n}}){t("estado");const{captured:o}=await e(/\|\| Nivel\s+: (\d+)\s+/),s=parseInt(o[1],10),i=[{from:31,to:40,path:"4wn"},{from:21,to:30,path:"3wn"},{from:11,to:20,path:"2wn"},{from:1,to:10,path:"wn"},{from:41,to:50,path:"en"},{from:51,to:60,path:"2en"},{from:61,to:70,path:"3en"},{from:71,to:80,path:"4en"}].find(e=>e.from<=s&&e.to<=s);if(!i)throw new Error(`No room for level "${s}"`);await n.execute("rh2w4n");const a=e(/Salidas: sur\.\n\n((?:.|\n)*)\n\n/,{captureLength:Number.MAX_VALUE});await n.execute(i.path);const{captured:c}=await a,l=c[1].split("\n").map(e=>e.trim());for(const e of Object.values(r))for(const t of e){if(l.some(e=>e.includes(t)&&!e.includes("mallas"))&&await u(t))break}async function u(n){t("coger "+n),await e(/Coges /),t("vestir "+n);const r=await Promise.any([e(/Debes ser nivel \d+ para usar este objeto/).then(()=>false),e(["No hay ningun","no puedes llevar tantos objetos"]).then(()=>null),e(["Blandes ","Sostienes ","Te pones ","Te colocas ","Usas "]).then(()=>true)]);return false===r&&(t("tirar "+n),await e("Tiras ")),Boolean(r)}await n.recall()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.go=void 0,t.go=function({plugins:{navigation:e}},t){return e.execute(t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.kill=void 0;const r=n(5);t.kill=async function({when:e,write:t,plugins:{navigation:n,skills:o}},s){const i=[...r.SPELLS_BY_TYPE.dedope,...r.SPELLS_BY_TYPE.attack];await async function(e,t){for(let n=0;n<e;n++)if(await t())return!0;return!1}(3,()=>o.castSpell(i,s))||t("matar "+s);const a=await Promise.any([n.waitForRecall().then(()=>"flee"),e(s+" ha MUERTO!!").then(()=>"win"),e("Huyes como un cobarde del combate.").then(()=>"flee"),e("No esta aqui.").timeout(3).then(()=>"missing")]);return"win"===a&&(t("sacrificar cuerpo"),await e("te da una moneda de oro por tu sacrificio.")),a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.train=void 0,t.train=async function({when:e,run:t,plugins:{navigation:n,prompt:r}}){const o=[];await n.recall(),await n.go("abajo");const s=e=>()=>o.push(e),i=e=>()=>{const t=o.indexOf(e);t>-1&&o.splice(t,1)};return e(["Un pequenyo caracol esta aqui haciendo trompos.","El pequenyo caracol llega desde el"],s("pequenyo caracol")),e(["Un buitre carronyero esta aqui.","El buitre carronyero llega desde el"],s("buitre carronyero")),e(["Un lobo hambriento te esta mirando.","El lobo hambriento llega desde el"],s("lobo hambriento")),e(["Una serpiente que parece venenosa te mira fijamente.","La serpiente llega desde el"],s("serpiente")),e("El pequenyo caracol se va hacia el",i("pequenyo caracol")),e("El buitre carronyero se va hacia el",i("buitre carronyero")),e("El lobo hambriento se va hacia el",i("lobo hambriento")),e("La serpiente se va hacia el",i("serpiente")),await n.execute("xsexnexsexnexs",(async function(){await r.until(({mv:{current:e}})=>e>50);for(;o.length;){if("flee"===await t("kill",[o.pop()]))return console.log("Had to run. Train over."),n.recall()}})),n.execute("4w5nu")}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.renderUserInterface=void 0;const o=n(4);n(57);const s=n(58),i=n(61),a=r(n(64)),c=n(6),l=n(65),u=n(68);t.renderUserInterface=function(e){const t=function(){const e=new o.ClientStorage("ui:state");e.get()||e.set({showControls:!1});return e}(),n=t.get(),r=c.render(a.default),d=r.$(".container"),p=new l.Sidebar;p.render(d);const h=new s.Controls;h.render(d);const f=new u.Terminal;f.render(d),e.appendChild(r);const m=new i.Hamburger(n.showControls);return m.render(e),m.onChange(e=>{e?(d.classList.add("show-controls"),n.showControls=!0):(d.classList.remove("show-controls"),n.showControls=!1),t.set(n)}),{controls:h,sidebar:p,terminal:f}}},function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),s=n(8),i={insert:"head",singleton:!1};o()(s.a,i);t.default=s.a.locals||{}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Controls=void 0,n(59);const o=n(6),s=r(n(60));t.Controls=class{constructor(){this.dom=o.render(s.default),this.meterTpl=this.dom.$(".meter-template"),this.buttonTpl=this.dom.$(".button-template")}render(e){e.appendChild(this.dom)}addMeter(e,t){const n=o.render(this.meterTpl,{".meter":n=>{n.style.setProperty("--color",e),n.style.setProperty("--value","100%"),t(e=>{const t=Math.round(100*e);n.style.setProperty("--value",t+"%")})}});this.dom.appendChild(n)}addButton(e,t){const n=o.render(this.buttonTpl,{button:n=>{n.textContent=e,n.addEventListener("click",t)}});this.dom.appendChild(n)}}},function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),s=n(9),i={insert:"head",singleton:!1};o()(s.a,i);t.default=s.a.locals||{}},function(e,t){e.exports='<header class="controls"></header> <template class="meter-template"> <div class="meter" data-color="white" data-value="100%"> <div class="bar"></div> </div> </template> <template class="button-template"> <button class="ui-button"></button> </template> '},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Hamburger=void 0,n(62);const o=n(3),s=n(6),i=r(n(63));t.Hamburger=class{constructor(e=!1){this.dom=s.render(i.default),this.checkbox=this.dom.$("input"),this.emitChange=o.emitter(),this.onChange=this.emitChange.subscribe,this.toggle=this.toggle.bind(this),this.checkbox.checked=e}render(e){this.checkbox.addEventListener("change",this.toggle),e.appendChild(this.dom),this.checkbox.checked&&this.toggle()}toggle(){this.emitChange(this.checkbox.checked)}}},function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),s=n(10),i={insert:"head",singleton:!1};o()(s.a,i);t.default=s.a.locals||{}},function(e,t){e.exports='<div class="hamburger"> <input type="checkbox"/> <span></span> <span></span> <span></span> </div> '},function(e,t){e.exports='<div class="container"></div> '},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Sidebar=void 0,n(66);const o=n(6),s=r(n(67));t.Sidebar=class{constructor(){this.dom=o.render(s.default)}render(e){e.appendChild(this.dom)}}},function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),s=n(11),i={insert:"head",singleton:!1};o()(s.a,i);t.default=s.a.locals||{}},function(e,t){e.exports='<aside class="sidebar"></aside> '},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Terminal=void 0;const o=n(4);n(69);const s=r(n(70)),i=n(3),a=n(6),c=r(n(77)),l=new s.default,u=new o.ClientStorage("mud:command-history");function d(e){const t=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/  +/g,e=>"&nbsp;".repeat(e.length));return l.toHtml(t).replace(/\n/g,"<br>")}function p(){const e=getSelection();return e&&"Range"===e.type}t.Terminal=class{constructor(){this.dom=a.render(c.default),this.$log=this.dom.$(".log"),this.$input=this.dom.$("input"),this.log=[],this.history=u.get()||[],this.histPos=0,this.emitSubmit=i.emitter(),this.onSubmit=this.emitSubmit.subscribe,this.onKey=this.onKey.bind(this)}focus(){this.$input.focus()}render(e){this.dom.$(".terminal").addEventListener("click",()=>{p()||this.$input.focus()}),this.$input.addEventListener("keydown",this.onKey),e.appendChild(this.dom)}write(e){const t=this.$log.parentElement,n=`${this.log.length?this.log.pop():""}${r=e,r.replace(/\r/g,"")}`.split(/\n\n+/);var r;const o=n.pop();for(const e of n){this.log.push(e);const n=document.createElement("p");n.innerHTML=d(e),t.insertBefore(n,this.$log)}this.log.push(o),this.$log.innerHTML=d(o),p()||(t.scrollTop=t.scrollHeight)}onKey(e){"Enter"===e.code&&this.submit(),"ArrowUp"===e.code&&this.loadHistory(1),"ArrowDown"===e.code&&this.loadHistory(-1),this.$input.size=this.$input.value.length+1}submit(){const{value:e}=this.$input;this.$input.value="",e&&(this.history.shift(),this.history.unshift(e),this.history.unshift(""),u.set(this.history)),this.histPos=0,this.emitSubmit(e)}loadHistory(e){var t,n,r;this.history.length&&(this.history[this.histPos]=this.$input.value,this.histPos=(t=this.histPos+e,n=0,r=this.history.length-1,t<n?n:t>r?r:t),this.$input.value=this.history[this.histPos])}}},function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),s=n(12),i={insert:"head",singleton:!1};o()(s.a,i);t.default=s.a.locals||{}},,,,,,,,function(e,t){e.exports='<main class="terminal"> <span class="log"></span> <input type="text" size="1" autofocus> </main>'},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPassword=void 0;const r=n(4);t.getPassword=function(e){const t=new r.ClientStorage("pass:"+e),n=t.get();if(n)return n;const o=prompt("Password for "+e);if(!o)throw new Error("Password required");return t.set(o),o}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getQueryParams=void 0,t.getQueryParams=function(){const e={};return window.location.search.substr(1).split("&").map(e=>e.split("=").map(decodeURIComponent)).forEach(([t,n])=>e[t]=n),e}},function(e){e.exports=JSON.parse('{"DEFAULT_PORT":53472}')}]);
//# sourceMappingURL=main.js.map
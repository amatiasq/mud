!function(e){function t(t){for(var r,s,a=t[0],c=t[1],u=t[2],d=0,h=[];d<a.length;d++)s=a[d],Object.prototype.hasOwnProperty.call(o,s)&&o[s]&&h.push(o[s][0]),o[s]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);for(l&&l(t);h.length;)h.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,a=1;a<n.length;a++){var c=n[a];0!==o[c]&&(r=!1)}r&&(i.splice(t--,1),e=s(s.s=n[0]))}return e}var r={},o={0:0},i=[];function s(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=r,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var a=window.webpackJsonp=window.webpackJsonp||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var u=0;u<a.length;u++)t(a[u]);var l=c;i.push([20,1]),n()}([,,,,function(e,t,n){"use strict";function r(e){return e.cloneNode(!0)}Object.defineProperty(t,"__esModule",{value:!0}),t.render=void 0,t.render=function(e,t){"string"==typeof e&&(e=function(e){const t=document.createElement("template");return t.innerHTML=e,t}(e));const n=e instanceof HTMLTemplateElement?r(e.content):r(e);if(t)for(const[e,r]of Object.entries(t)){const t=n.querySelector(e);t?r(t):console.error(`Selector ${e} returned no results`)}return Object.assign(n,{$:e=>n.querySelector(e)})}},,function(e,t,n){"use strict";var r=n(2),o=n.n(r),i=n(3),s=n.n(i)()(o.a);s.push([e.i,"body {\n  --background-color: #1c1c1c;\n  --border-color: #484848;\n}\n\n.container {\n  height: 100%;\n  display: grid;\n  grid-template-rows: 1fr;\n  grid-template-columns: 1fr;\n  grid-template-areas: 'terminal';\n}\n\n.container.show-controls {\n  grid-template-rows: 50px auto;\n  grid-template-columns: 9fr 3fr;\n  grid-template-areas:\n    'controls sidebar'\n    'terminal sidebar';\n}\n\n.terminal {\n  grid-area: terminal;\n}\n\n.sidebar {\n  grid-area: sidebar;\n  background-color: var(--background-color);\n  border-left: 1px solid var(--border-color);\n}\n\n.controls {\n  grid-area: controls;\n  background-color: var(--background-color);\n  border-bottom: 1px solid var(--border-color);\n}\n\n.container:not(.show-controls) .sidebar,\n.container:not(.show-controls) .controls {\n  display: none;\n}\n","",{version:3,sources:["webpack://src/ui/index.css"],names:[],mappings:"AAAA;EACE,2BAA2B;EAC3B,uBAAuB;AACzB;;AAEA;EACE,YAAY;EACZ,aAAa;EACb,uBAAuB;EACvB,0BAA0B;EAC1B,+BAA+B;AACjC;;AAEA;EACE,6BAA6B;EAC7B,8BAA8B;EAC9B;;sBAEoB;AACtB;;AAEA;EACE,mBAAmB;AACrB;;AAEA;EACE,kBAAkB;EAClB,yCAAyC;EACzC,0CAA0C;AAC5C;;AAEA;EACE,mBAAmB;EACnB,yCAAyC;EACzC,4CAA4C;AAC9C;;AAEA;;EAEE,aAAa;AACf",sourcesContent:["body {\n  --background-color: #1c1c1c;\n  --border-color: #484848;\n}\n\n.container {\n  height: 100%;\n  display: grid;\n  grid-template-rows: 1fr;\n  grid-template-columns: 1fr;\n  grid-template-areas: 'terminal';\n}\n\n.container.show-controls {\n  grid-template-rows: 50px auto;\n  grid-template-columns: 9fr 3fr;\n  grid-template-areas:\n    'controls sidebar'\n    'terminal sidebar';\n}\n\n.terminal {\n  grid-area: terminal;\n}\n\n.sidebar {\n  grid-area: sidebar;\n  background-color: var(--background-color);\n  border-left: 1px solid var(--border-color);\n}\n\n.controls {\n  grid-area: controls;\n  background-color: var(--background-color);\n  border-bottom: 1px solid var(--border-color);\n}\n\n.container:not(.show-controls) .sidebar,\n.container:not(.show-controls) .controls {\n  display: none;\n}\n"],sourceRoot:""}]),t.a=s},function(e,t,n){"use strict";var r=n(2),o=n.n(r),i=n(3),s=n.n(i)()(o.a);s.push([e.i,".controls {\n  display: flex;\n  align-items: stretch;\n}\n\n.controls .meter {\n  width: 100px;\n  margin: 8px;\n  margin-right: 0;\n  border: 1px solid var(--border-color);\n  --color: white;\n  --value: 100%;\n}\n\n.controls .meter .bar {\n  height: 100%;\n  width: var(--value);\n  background-color: var(--color);\n}\n","",{version:3,sources:["webpack://src/ui/Controls/Controls.css"],names:[],mappings:"AAAA;EACE,aAAa;EACb,oBAAoB;AACtB;;AAEA;EACE,YAAY;EACZ,WAAW;EACX,eAAe;EACf,qCAAqC;EACrC,cAAc;EACd,aAAa;AACf;;AAEA;EACE,YAAY;EACZ,mBAAmB;EACnB,8BAA8B;AAChC",sourcesContent:[".controls {\n  display: flex;\n  align-items: stretch;\n}\n\n.controls .meter {\n  width: 100px;\n  margin: 8px;\n  margin-right: 0;\n  border: 1px solid var(--border-color);\n  --color: white;\n  --value: 100%;\n}\n\n.controls .meter .bar {\n  height: 100%;\n  width: var(--value);\n  background-color: var(--color);\n}\n"],sourceRoot:""}]),t.a=s},function(e,t,n){"use strict";var r=n(2),o=n.n(r),i=n(3),s=n.n(i)()(o.a);s.push([e.i,".hamburger {\n  display: inline-block;\n  position: absolute;\n  top: 24px;\n  right: 40px;\n  z-index: 1;\n  -webkit-user-select: none;\n  user-select: none;\n}\n\n.hamburger input {\n  display: block;\n  width: 40px;\n  height: 32px;\n  position: absolute;\n  top: -7px;\n  left: -5px;\n  cursor: pointer;\n  opacity: 0; /* hide this */\n  z-index: 2; /* and place it over the hamburger */\n  -webkit-touch-callout: none;\n}\n\n.hamburger span {\n  display: block;\n  width: 33px;\n  height: 4px;\n  margin-bottom: 5px;\n  position: relative;\n  background: #cdcdcd;\n  border-radius: 3px;\n  z-index: 1;\n  transform-origin: center right;\n  transition: transform 0.5s cubic-bezier(0.77, 0.2, 0.05, 1),\n    background 0.5s cubic-bezier(0.77, 0.2, 0.05, 1), opacity 0.55s ease;\n}\n\n/*\n * Transform all the slices of hamburger\n * into a crossmark.\n */\n.hamburger input:checked ~ span:nth-of-type(2) {\n  opacity: 0;\n  transform: rotate(0deg) scale(0.2, 0.2);\n}\n\n.hamburger input:checked ~ span:first-of-type {\n  transform: rotate(-45deg) translate(0, -4px);\n}\n\n.hamburger input:checked ~ span:last-of-type {\n  transform: rotate(45deg) translate(0, 4px);\n}\n","",{version:3,sources:["webpack://src/ui/Hamburger/Hamburger.css"],names:[],mappings:"AAAA;EACE,qBAAqB;EACrB,kBAAkB;EAClB,SAAS;EACT,WAAW;EACX,UAAU;EACV,yBAAyB;EACzB,iBAAiB;AACnB;;AAEA;EACE,cAAc;EACd,WAAW;EACX,YAAY;EACZ,kBAAkB;EAClB,SAAS;EACT,UAAU;EACV,eAAe;EACf,UAAU,EAAE,cAAc;EAC1B,UAAU,EAAE,oCAAoC;EAChD,2BAA2B;AAC7B;;AAEA;EACE,cAAc;EACd,WAAW;EACX,WAAW;EACX,kBAAkB;EAClB,kBAAkB;EAClB,mBAAmB;EACnB,kBAAkB;EAClB,UAAU;EACV,8BAA8B;EAC9B;wEACsE;AACxE;;AAEA;;;EAGE;AACF;EACE,UAAU;EACV,uCAAuC;AACzC;;AAEA;EACE,4CAA4C;AAC9C;;AAEA;EACE,0CAA0C;AAC5C",sourcesContent:[".hamburger {\n  display: inline-block;\n  position: absolute;\n  top: 24px;\n  right: 40px;\n  z-index: 1;\n  -webkit-user-select: none;\n  user-select: none;\n}\n\n.hamburger input {\n  display: block;\n  width: 40px;\n  height: 32px;\n  position: absolute;\n  top: -7px;\n  left: -5px;\n  cursor: pointer;\n  opacity: 0; /* hide this */\n  z-index: 2; /* and place it over the hamburger */\n  -webkit-touch-callout: none;\n}\n\n.hamburger span {\n  display: block;\n  width: 33px;\n  height: 4px;\n  margin-bottom: 5px;\n  position: relative;\n  background: #cdcdcd;\n  border-radius: 3px;\n  z-index: 1;\n  transform-origin: center right;\n  transition: transform 0.5s cubic-bezier(0.77, 0.2, 0.05, 1),\n    background 0.5s cubic-bezier(0.77, 0.2, 0.05, 1), opacity 0.55s ease;\n}\n\n/*\n * Transform all the slices of hamburger\n * into a crossmark.\n */\n.hamburger input:checked ~ span:nth-of-type(2) {\n  opacity: 0;\n  transform: rotate(0deg) scale(0.2, 0.2);\n}\n\n.hamburger input:checked ~ span:first-of-type {\n  transform: rotate(-45deg) translate(0, -4px);\n}\n\n.hamburger input:checked ~ span:last-of-type {\n  transform: rotate(45deg) translate(0, 4px);\n}\n"],sourceRoot:""}]),t.a=s},function(e,t,n){"use strict";var r=n(2),o=n.n(r),i=n(3),s=n.n(i)()(o.a);s.push([e.i,".sidebar {\n}\n","",{version:3,sources:["webpack://src/ui/Sidebar/Sidebar.css"],names:[],mappings:"AAAA;AACA",sourcesContent:[".sidebar {\n}\n"],sourceRoot:""}]),t.a=s},function(e,t,n){"use strict";var r=n(2),o=n.n(r),i=n(3),s=n.n(i)()(o.a);s.push([e.i,".terminal {\n  grid-area: terminal;\n  overflow-x: hidden;\n  overflow-y: auto;\n  -ms-overflow-style: none; /* IE and Edge */\n  scrollbar-width: none; /* Firefox */\n}\n\n.terminal::-webkit-scrollbar {\n  display: none;\n}\n\n.terminal p {\n  margin: 1em 0;\n}\n\n.terminal input {\n  background-color: transparent;\n  border: none;\n  color: white;\n  display: inline-block;\n  font-family: monospace;\n  outline: none;\n}\n","",{version:3,sources:["webpack://src/ui/Terminal/Terminal.css"],names:[],mappings:"AAAA;EACE,mBAAmB;EACnB,kBAAkB;EAClB,gBAAgB;EAChB,wBAAwB,EAAE,gBAAgB;EAC1C,qBAAqB,EAAE,YAAY;AACrC;;AAEA;EACE,aAAa;AACf;;AAEA;EACE,aAAa;AACf;;AAEA;EACE,6BAA6B;EAC7B,YAAY;EACZ,YAAY;EACZ,qBAAqB;EACrB,sBAAsB;EACtB,aAAa;AACf",sourcesContent:[".terminal {\n  grid-area: terminal;\n  overflow-x: hidden;\n  overflow-y: auto;\n  -ms-overflow-style: none; /* IE and Edge */\n  scrollbar-width: none; /* Firefox */\n}\n\n.terminal::-webkit-scrollbar {\n  display: none;\n}\n\n.terminal p {\n  margin: 1em 0;\n}\n\n.terminal input {\n  background-color: transparent;\n  border: none;\n  color: white;\n  display: inline-block;\n  font-family: monospace;\n  outline: none;\n}\n"],sourceRoot:""}]),t.a=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PatternPromise=void 0;const r=n(12),o=n(27);t.PatternPromise=class extends Promise{constructor(e){let t;super((n,r)=>{t=r,e(n,r)}),this.forceReject=t}timeout(e){return r.wait(e).then(()=>this.forceReject(new o.PatternPromiseTimeoutError)),this}wait(e){return Promise.race([this,r.wait(e)])}unsubscribe(){this.forceReject("aborted")}once(){return this}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wait=void 0,t.wait=function(e){return new Promise(t=>setTimeout(t,1e3*e))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promptPlugin=t.PROMPT_DETECTOR=void 0;const r=n(0),o=["&W<","&R%h/%Hhp ","&C%m/%Mm ","&G%v/%Vmv ","&P%Xxp ","&Y%gg","&W> ","&W%A ","\n"].join(""),i=o.replace("&W>"," &R%E&W>");t.PROMPT_DETECTOR=new RegExp(["<","(?<hpCurr>\\d+)/(?<hpTotal>\\d+)hp ","(?<mCurr>\\d+)/(?<mTotal>\\d+)m ","(?<mvCurr>\\d+)/(?<mvTotal>\\d+)mv ","(?<exp>(\\d|,)+)xp ","(?<gold>(\\d|,)+)g","( \\((?<enemy>\\d+)%\\))?","> (?<invis>I)?"].join(""));class s{constructor(){this.total=0,this.current=0}get percent(){return this.total?1/this.total*this.current:0}}function a(e){return parseInt(e.replace(/,/g,""),10)}t.promptPlugin=async function({when:e,write:n}){let c=!1;const u={hp:new s,mana:new s,mv:new s,exp:0,gold:0,enemy:null,get isFighting(){return null!==u.enemy}},l=r.emitter();return e(t.PROMPT_DETECTOR).timeout(1).catch((function(){n("prompt "+o),n("fprompt "+i)})).finally(()=>{e(t.PROMPT_DETECTOR,({groups:e})=>{u.hp.current=a(e.hpCurr),u.hp.total=a(e.hpTotal),u.mana.current=a(e.mCurr),u.mana.total=a(e.mTotal),u.mv.current=a(e.mvCurr),u.mv.total=a(e.mvTotal),u.exp=a(e.exp),u.gold=a(e.gold),u.enemy=e.enemy?a(e.enemy):null,c=Boolean(e.invis),l(u)})}),{waitForPrompt:function(){return e(t.PROMPT_DETECTOR)},getPercent:function(e){return u[e].percent},onUpdate:l.subscribe,get isExhausted(){return u.mv.current<=15},get isInjured(){return 1!==u.hp.percent},get needsHospital(){return u.hp.percent<.3},get isInDanger(){return u.hp.percent<.1},get isInvisible(){return c}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PluginContext=void 0;const r=n(15),o=n(16),i=n(12);class s{constructor(e,t,n,r){this.name=e,this.username=t,this.triggers=n,this.send=r,this.subscriptions=[],this.isPrintingLogs=!1,this.isAborted=!1,o.bindAll(this,s)}get printLogs(){return this.isPrintingLogs=!0,null}write(e){this.checkNotAborted(),this.log("[WRITE]",e),this.send(e)}when(e,t,n){return this.checkNotAborted(),this.log("[WATCH]",e),"function"==typeof t?this.triggers.add(e,t,n):this.triggers.add(e,t)}sleep(e){return this.checkNotAborted(),this.log("[SLEEP]",e),i.wait(e)}abort(){this.isAborted=!0}dispose(){this.log("DISPOSE"),this.subscriptions.forEach(e=>e.unsubscribe())}log(...e){this.checkNotAborted(),this.isPrintingLogs&&console.log(`[${this.name}]`,...e)}checkNotAborted(){if(this.isAborted)throw new r.ExecutionAbortedError}}t.PluginContext=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExecutionAbortedError=void 0;class r extends Error{}t.ExecutionAbortedError=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bindAll=void 0,t.bindAll=function(e,t){const n=t.prototype;Object.getOwnPropertyNames(n).filter(e=>"function"==typeof Object.getOwnPropertyDescriptor(n,e).value).forEach(t=>{e[t]=e[t].bind(e)})}},,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),o=n(21),i=n(39),s=n(40),a=n(48),c=n(50),u=n(72),l=n(73),{user:d,server:h}=l.getQueryParams(),[p,f]=h.split(":"),g=u.getPassword(d),{terminal:m,controls:A}=c.renderUserInterface(document.body),b=new i.RemoteTelnet(a.socket);m.write(`Connecting to ${p}:${f} as ${d}\n`),b.onConnected((async function(){const e=new o.Mud(b);e.onCommand(e=>m.write(e+"\n")),m.onSubmit(t=>e.userInput(t)),await e.login(d,g),s.registerWorkflows(e),await async function(){const t=r.emitter();A.addMeter("red",t.subscribe);const n=r.emitter();A.addMeter("blue",n.subscribe);const o=r.emitter();A.addMeter("green",o.subscribe),e.getPlugin("prompt").onUpdate(e=>{t(e.hp.percent),n(e.mana.percent),o(e.mv.percent)})}(),A.addButton("Entrenar",()=>e.invokeWorkflow("train")),Object.assign(window,{mud:e})})),b.onData(e=>m.write(e)),a.socket.onConnected(()=>{b.connect({host:p,port:parseInt(f)}),m.onSubmit(e=>{m.write(e+"\n"),b.send(e)}),window.onbeforeunload=()=>{b.isConnected&&b.send("abandonar"),b.close()}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Mud=void 0;const r=n(0),o=n(22),i=n(30),s=n(14),a=n(31),c=n(35),u=n(37),l=n(38);t.Mud=class{constructor(e){this.telnet=e,this.triggers=new a.TriggerCollection,this.workflows={},this.emitCommand=r.emitter(),this.onCommand=this.emitCommand.subscribe,this.whenLoggedIn=new Promise(e=>this.emitLoggedIn=e),this.send=this.send.bind(this),this.invokeWorkflow=this.invokeWorkflow.bind(this),this.telnet.onData(e=>this.triggers.process(function(e){return e.replace(/\u001b\[.*?m/g,"")}(e).replace(/\r/g,"")))}async login(e,t){const n=new s.PluginContext("login","N/A",this.triggers,this.send);await i.login(n,e,t,async()=>{this.plugins=await o.initializePlugins(t=>new s.PluginContext(t,e,this.triggers,this.send))}),n.dispose(),this.username=e,this.emitLoggedIn(e)}send(e){this.emitCommand(e),this.telnet.send(e)}userInput(e){}getPlugin(e){return this.plugins[e]}runWorkflow(e,t,n){const r=new u.Workflow(e);return this.executeWorkflow(r,t,n)}registerWorkflow(e){const t=new u.Workflow(e);return this.workflows[t.name]=t,t}invokeWorkflow(e,t,n){if(!(e in this.workflows))throw new l.WorkflowNotFoundError(`Workflow ${e} is not registered.`);const r=this.workflows[e];return this.executeWorkflow(r,t,n)}executeWorkflow(e,t=[],{logs:n}={}){const r=this.createWorkflowContext(e.name);n&&r.printLogs;const o=e.execute(r,...t).then(e=>(r.dispose(),e));return Object.assign(o,{abort(){r.abort()}})}createWorkflowContext(e){return new c.Context(e,this.username,this.triggers,this.plugins,this.send,this.invokeWorkflow)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initializePlugins=void 0;const r=n(23),o=n(25),i=n(26),s=n(13),a=n(28),c={chat:r.chatPlugin,inventory:o.inventoryPlugin,navigation:i.navigationPlugin,prompt:s.promptPlugin,skills:a.skillsPlugin};t.initializePlugins=async function(e){const t=Object.entries(c).map(async([t,n])=>[t,await n(e(t))]),n=await Promise.all(t);return Object.fromEntries(n)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.chatPlugin=void 0;const r=n(5),o=n(24);function i(e){return({groups:{name:t,message:n}})=>{c(e,{from:t,message:n}),a(t,n)}}function s(e){return({groups:{name:t,message:n}})=>c(e,{to:t,message:n})}async function a(e,t){return await o.requestNotificationPermission(),new Notification(`${name} te cuenta '${t}'`)}function c(e,t){const n={time:Date.now(),from:"me",to:"me",...t},r=e.get()||{},o=t.from||t.to,i=r[o]||[];return i.push(n),e.set({...r,[o]:i}),n}t.chatPlugin=function({when:e}){const t=new r.ClientStorage("chat:tell"),n=new r.ClientStorage("chat:whisper");e(/(?<name>.+) te susurra '(?<message>[^']+)'/,i(n)),e(/Susurras a (?<name>.+) '(?<message>[^']+)'/,s(n)),e([/(?<name>.+) te cuenta '(?<message>[^']+)'/,/(?<name>.+) te responde '(?<message>[^']+)'/],i(t)),e([/Cuentas a (?<name>.+) '(?<message>[^']+)'/,/Respondes a (?<name>.+) '(?<message>[^']+)'/],s(t))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.requestNotificationPermission=void 0,t.requestNotificationPermission=function(){if("Notification"in window){if("granted"===Notification.permission)return Promise.resolve(!0);if("denied"!==Notification.permission)return Notification.requestPermission().then(e=>"granted"===e)}else console.warn("This browser does not support desktop notification")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.inventoryPlugin=void 0;const r=/Estas llevando:(\n.*)+?\n\n/;t.inventoryPlugin=function({when:e,write:t}){let n=!1,o=[];return e("No tienes ese objeto.",i),e(r,({captured:e})=>{const[t,...r]=e[0].split("\n").map(e=>e.trim()).filter(Boolean);n=!0,o=r},{captureLength:1e3}),{refresh:i,has:async function(e){n||await i();if("string"==typeof e)return o.find(t=>t===e);if(Array.isArray(e))return o.find(t=>e.includes(t));const t=o.find(t=>t in e);return t&&e[t]}};async function i(){t("inventario"),await e(r)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.navigationPlugin=void 0;const r=n(0),o=n(11),i=n(13),s={s:"sur",n:"norte",e:"este",w:"oeste",o:"oeste",u:"arriba",d:"abajo",l:"sureste",k:"suroeste",j:"noreste",h:"noroeste"};t.navigationPlugin=function({when:e,write:t}){let n=!1,a=!1,c=!1,u=[];const l=()=>e(i.PROMPT_DETECTOR),d=r.emitter();return e("Plaza de Darkhaven",()=>a=!0),e(/\nSalidas: ([^\.]+)/,async({captured:e})=>{u=e[1].split(" "),n=!1,c=a,a=!1,await l(),d(u)}),{canGo:function(e){return Boolean(f(e))},go:p,execute:async function(e){"r"===e[0]&&(await h(),e=e.substr(1));for(const n of(t=e,t.replace(/(\d+)(\w)/g,(e,t,n)=>n.repeat(t))))await p(n);var t},recall:h,waitForRecall:function(){if(c)return new o.PatternPromise(e=>e());return e("Plaza de Darkhaven")},onRoomChange:d.subscribe,get isNavigating(){return n},get isAtRecall(){return c}};async function h(){if(c)return Promise.resolve();t("recall"),await e("Plaza de Darkhaven"),await l()}async function p(r){if(n)throw new Error("WTF DUDE");r in s&&(r=s[r]);if(!f(r))throw new Error(`Unknown direction '${r}'`);(function(e){const t=f(e);return t&&t.includes("(cerrada)")})(r)&&(t("abrir "+r),await e("Abres la puerta.")),t(r),n=!0,await e("\nSalidas:"),await l()}function f(e){return u.find(t=>t.startsWith(e))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PatternPromiseTimeoutError=void 0;class r extends Error{}t.PatternPromiseTimeoutError=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.skillsPlugin=void 0;const r=n(29),o=/((?:\w+ )+)\s+(\d+)%/g,i=r.concatRegexes(/-+\[(\w+)\]-+\n/,/(.|\n)+/,/Te quedan \d+ practicas.\n/,/Tienes \d+ entrenamientos.\n/);t.skillsPlugin=function({when:e,write:t}){let n=!1,r={};return e(i,({captured:[e]})=>{n=!0;for(const t of e.matchAll(o))r[t[1].trim()]=parseInt(t[2],10);n=!0},{captureLength:3e3}),{has:async function(e){return await s(),Boolean(r[e])},canLearn:async function(e){return await s(),e in r}};function s(){if(!n)return t("practicar"),e(i)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.concatRegexes=void 0,t.concatRegexes=function(...e){const t=e.map(e=>e.toString().replace(/^\/|\/[gi]*$/g,"")).join(""),n=e.map(e=>e instanceof RegExp&&e.flags).filter(Boolean).join(""),r=[...new Set(n)].join("");return new RegExp(t,r)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.login=void 0,t.login=async function({when:e,write:t,log:n},r,o,i){t(r),n("Username sent, waiting for password request"),await e("Password:"),t(o),n("Logged in as "+r),await e("Pulsa [ENTER]"),t(""),await e("Pulsa [ENTER]"),t(""),await e("Bienvenido a Balzhur...",i,{await:!0}).once()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TriggerCollection=void 0;const r=n(32),o=n(11);t.TriggerCollection=class{constructor(){this.patterns=new Set,this.queue=[],this.isProcessing=!1}add(e,t,n){return 1===arguments.length?this.once(e):3===arguments.length?this.watch(e,t,n):"function"==typeof t?this.watch(e,t):this.once(e,t)}watch(e,t,n){const i=new r.PatternMatcher(e,e=>t(e),n);this.patterns.add(i);const s=()=>this.patterns.delete(i);return{unsubscribe:s,once:()=>new o.PatternPromise(e=>{const r=t;t=async t=>{s(),r&&(n&&n.await?await r(t):r(t)),e(t)}})}}once(e,t){return new o.PatternPromise(n=>{const r=this.add(e,(function(e){r.unsubscribe(),n(e)}),t)})}async process(e){if(this.isProcessing)return void this.queue.push(e);this.isProcessing=!0;const t=e.split("\n"),n=t.pop(),r=[...t.map(e=>e+"\n"),n];for(const e of r)for(const t of this.patterns)await t.process(e);return this.isProcessing=!1,this.queue.length?this.process(this.queue.pop()):void 0}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PatternMatcher=void 0;const r=n(33),o=n(34);t.PatternMatcher=class{constructor(e,t,n={}){this.handler=t,this.options=n,this.patterns=Array.isArray(e)?e:[e],this.length=n.captureLength||10*Math.max(...this.patterns.map(e=>String(e).length)),this.buffer=function(e){let t="";const n=()=>t="",o=n=>t=r.trimEnd(`${t}${n}`,e);return Object.assign(o,{clear:n})}(this.length)}process(e){const t=this.buffer(e),n=this.patterns.filter(e=>this.testPattern(t,e));if(!n.length)return;this.buffer.clear();const r=new o.PatternResult(n,t),i=this.handler(r);return this.options.await?i:null}testPattern(e,t){return"string"==typeof t?e.indexOf(t)>-1:t.test(e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.trimEnd=void 0,t.trimEnd=function(e,t){return e.length>t?e.substr(e.length-t):e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PatternResult=void 0;function r(e){return e instanceof RegExp}function o(e,t){return{...e,...t}}t.PatternResult=class{constructor(e,t){this.patterns=e,this.haystack=t}get regexes(){return this.patterns.filter(r)}get stringPatterns(){return this.patterns.filter(e=>!r(e))}get captured(){return this.regexes.map(e=>this.haystack.match(e)).filter(Boolean).map(e=>Array.from(e))[0]}get groups(){return this.regexes.map(e=>this.haystack.match(e)).filter(Boolean).map(e=>e.groups).filter(Boolean).reduce(o,{})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Context=void 0;const r=n(15),o=n(14),i=n(16),s=n(36);class a extends o.PluginContext{constructor(e,t,n,r,o,c){var u,l;super(`W(${e})`,t,n,o),this.runWorkflow=c,this.finish=null,this.plugins=(u=r,l=this.log.bind(this),new Proxy(u,{get(e,t){if(!(t in e))throw l("Failed to get plugin "+t),new s.MissingPluginError(`Plugin ${t} is not registered.`);return l("Requires plugin "+t),e[t]}})),i.bindAll(this,a)}invokeWorkflow(e,t=[]){return this.checkNotAborted(),this.log(`Invoke workflow ${e} with`,...t),this.runWorkflow(e,t,{logs:this.isPrintingLogs})}runForever(){return new Promise(e=>this.finish=e)}abort(){super.abort(),this.finish&&this.finish(new r.ExecutionAbortedError)}}t.Context=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MissingPluginError=void 0;class r extends Error{}t.MissingPluginError=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Workflow=void 0;t.Workflow=class{constructor(e){this.run=e,this.executionCount=0,this.currentExecutions=0}get isRunning(){return this.currentExecutions>0}get timesExecuted(){return this.executionCount}get name(){return this.run.name}async execute(e,...t){this.currentExecutions++;const n=this.executionCount++;e.log(`[Exe(${n})]`,...t);try{const r=await this.run(e,...t);return e.log(`[Res(${n}]`,r),r}catch(t){throw e.log(`[ERR(${n})]`,t),t}finally{this.currentExecutions--}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkflowNotFoundError=void 0;class r extends Error{}t.WorkflowNotFoundError=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteTelnet=void 0;const r=n(0);t.RemoteTelnet=class{constructor(e){this.socket=e,this._isConnected=!1,this.emitConnected=r.emitter(),this.onConnected=this.emitConnected.subscribe,this.emitClose=r.emitter(),this.onClose=this.emitClose.subscribe,this.emitData=r.emitter(),this.onData=this.emitData.subscribe,e.onMessageType("CONNECTED",this.emitConnected),e.onMessageType("DISCONNECTED",this.emitClose),e.onMessageType("OUTPUT",this.emitData),this.onConnected(()=>this._isConnected=!0),this.onClose(()=>this._isConnected=!1)}get isConnected(){return this._isConnected}connect(e){this.socket.send("OPEN",e)}send(e){this.socket.send("INPUT",e)}close(){this.socket.close()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.registerWorkflows=void 0;const r=n(41),o=n(42),i=n(43),s=n(44),a=n(45),c=n(46),u=n(47);t.registerWorkflows=function(e){e.registerWorkflow(s.fight),e.registerWorkflow(u.train),e.runWorkflow(r.dope),e.runWorkflow(o.drink),e.runWorkflow(i.eat),e.runWorkflow(a.idle),e.runWorkflow(c.rest)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dope=void 0,t.dope=async function({write:e,runForever:t,plugins:{prompt:n,skills:r}}){const o=(e=>{const t=1+1/((1-e)/e);return(e,n)=>{const r=(1-e)*t;return Math.hypot(r,n)>1}})(.2);n.onUpdate(async({isFighting:t,hp:{percent:n},mana:{percent:i}})=>{t||0===i||n<1&&o(n,i)&&await r.has("curar leves")&&e('c "curar leves"')}),await t()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.drink=void 0,t.drink=async function({when:e,write:t,runForever:n,plugins:{inventory:r,navigation:o,skills:i}}){let s=!1,a=!1;async function c(){return r.has({"un odre de cuero":"odre","una cantimplora":"cantimplora"})}o.onRoomChange(()=>s=!1),e(["Un manantial magico esta aqui.","Una hermosa fuente de marmol blanco esta aqui."],async()=>{if(s=!0,!a){const e=await c();e&&(t("llenar "+e),a=!0)}}),e(["Te apetece dar un sorbo a algo refrescante.","Tienes sed.","Estas realmente sediento.","Estas MUERTO de SED!","Estas en peligro de deshidratacion."],async()=>{if(s)return void t("beber");const e=await c();e?(t("beber "+e),await i.has("crear agua")&&t('c "crear agua" '+e)):console.log("No hay fuente de agua")}),await n()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.eat=void 0,t.eat=async function({when:e,write:t,runForever:n,plugins:{inventory:r,navigation:o}}){async function i(){console.log("eatSomething");const e=await async function(){return await s(),await r.has({"un chorizo":"chorizo","pavo cocinado":"pavo","una chuleta de cordero":"chuleta","loncha de salami":"salami","pierna de cordero":"pierna","ricas longanizas":"longanizas"})}();return!!e&&(t("comer "+e),r.refresh(),!0)}async function s(){if(await r.has("una bolsa")){t("coger todo bolsa"),t("examinar bolsa");const{captured:n}=await e(/Una bolsa contiene:\n\s+(Nada)?/);n[1]&&t("tirar bolsa")}}e(["Tienes hambre.","Estas realmente hambriento."],i),e(["Estas terriblemente hambriento.","Estas HAMBRIENTO!"],async()=>{console.log("hungry"),await i()||(await async function(){await o.recall(),await o.execute("2sen"),t("comprar 1 chuleta"),await e("El carnicero pone todo en una bolsa y te la da."),await s(),await o.execute("sw2n")}(),await i())}),await n()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fight=void 0,t.fight=async function({when:e,write:t,plugins:{prompt:n,navigation:r}},o){return e("Estas demasiado exhausto para huir del combate!",()=>r.recall()),e([new RegExp(`Tu (?<attack>\\w+) (?<effect>\\w+) a( |\\w)+ ${o}.`),new RegExp(`El ataque de( |\\w)+ ${o} te (?<effect>w+).`)],(async function(){n.isInDanger?await r.recall():(n.isExhausted||n.needsHospital)&&t("huir")})),t("kill "+o),Promise.any([r.waitForRecall().then(()=>"flee"),e(o+" ha MUERTO!!").then(()=>"win"),e("Huyes como un cobarde del combate.").then(()=>"flee"),e("No esta aqui.").timeout(3).then(()=>"missing")])}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.idle=void 0,t.idle=async function({when:e,write:t,invokeWorkflow:n,runForever:r,plugins:{navigation:o}}){e("Desapareces en la nada.",()=>{console.log("IDLE"),o.isAtRecall?n("train"):t("estado")}),await r()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.rest=void 0,t.rest=async function({when:e,write:t,runForever:n}){e(["Nah... Estas demasiado relajado...","En tus suenyos o que?","Estas demasiado relajado para lanzar ese conjuro."],()=>t("despertar")),await n()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.train=void 0,t.train=async function({when:e,invokeWorkflow:t,plugins:{navigation:n}}){const r=[];let o="sur";await n.recall(),await n.go("abajo");const i=e=>()=>r.push(e),s=e=>()=>{const t=r.indexOf(e);t>-1&&r.splice(t,1)};return e(["Un pequenyo caracol esta aqui haciendo trompos.","El pequenyo caracol llega desde el"],i("pequenyo caracol")),e(["Un buitre carronyero esta aqui.","El buitre carronyero llega desde el"],i("buitre carronyero")),e(["Un lobo hambriento te esta mirando.","El lobo hambriento llega desde el"],i("lobo hambriento")),e(["Una serpiente que parece venenosa te mira fijamente.","La serpiente llega desde el"],i("serpiente")),e("El pequenyo caracol se va hacia el",s("pequenyo caracol")),e("El buitre carronyero se va hacia el",s("buitre carronyero")),e("El lobo hambriento se va hacia el",s("lobo hambriento")),e("La serpiente se va hacia el",s("serpiente")),async function e(){for(;r.length;){if("flee"===await t("fight",[r.pop()]))return console.log("Had to run. Train over."),n.recall()}if(n.canGo(o))await n.go(o);else{if(!n.canGo("este"))return n.execute("4w5nu");await n.go("este"),o="sur"===o?"norte":"sur"}return e()}()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.socket=void 0;const r=n(74),o=n(49);const i="https://amatiasq.github.io"===location.origin?"wss://ts-socket.amatiasq.com":"ws://localhost:"+o.DEFAULT_PORT;t.socket=new r.ClientSocket(i),t.socket.onMessage(e=>console.debug("MESSAGE",e))},function(e){e.exports=JSON.parse('{"DEFAULT_PORT":53472}')},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.renderUserInterface=void 0;const o=n(5);n(51);const i=n(52),s=n(55),a=r(n(58)),c=n(4),u=n(59),l=n(62);t.renderUserInterface=function(e){const t=function(){const e=new o.ClientStorage("ui:state");e.get()||e.set({showControls:!1});return e}(),n=t.get(),r=c.render(a.default),d=r.$(".container"),h=new u.Sidebar;h.render(d);const p=new i.Controls;p.render(d);const f=new l.Terminal;f.render(d),e.appendChild(r);const g=new s.Hamburger(n.showControls);return g.render(e),g.onChange(e=>{e?(d.classList.add("show-controls"),n.showControls=!0):(d.classList.remove("show-controls"),n.showControls=!1),t.set(n)}),{controls:p,sidebar:h,terminal:f}}},function(e,t,n){"use strict";n.r(t);var r=n(1),o=n.n(r),i=n(6),s={insert:"head",singleton:!1};o()(i.a,s);t.default=i.a.locals||{}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Controls=void 0,n(53);const o=n(4),i=r(n(54));t.Controls=class{constructor(){this.dom=o.render(i.default),this.meterTpl=this.dom.$(".meter-template"),this.buttonTpl=this.dom.$(".button-template")}render(e){e.appendChild(this.dom)}addMeter(e,t){const n=o.render(this.meterTpl,{".meter":n=>{n.style.setProperty("--color",e),n.style.setProperty("--value","100%"),t(e=>{const t=Math.round(100*e);n.style.setProperty("--value",t+"%")})}});this.dom.appendChild(n)}addButton(e,t){const n=o.render(this.buttonTpl,{button:n=>{n.textContent=e,n.addEventListener("click",t)}});this.dom.appendChild(n)}}},function(e,t,n){"use strict";n.r(t);var r=n(1),o=n.n(r),i=n(7),s={insert:"head",singleton:!1};o()(i.a,s);t.default=i.a.locals||{}},function(e,t){e.exports='<header class="controls"></header> <template class="meter-template"> <div class="meter" data-color="white" data-value="100%"> <div class="bar"></div> </div> </template> <template class="button-template"> <button class="ui-button"></button> </template> '},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Hamburger=void 0,n(56);const o=n(0),i=n(4),s=r(n(57));t.Hamburger=class{constructor(e=!1){this.dom=i.render(s.default),this.checkbox=this.dom.$("input"),this.emitChange=o.emitter(),this.onChange=this.emitChange.subscribe,this.toggle=this.toggle.bind(this),this.checkbox.checked=e}render(e){this.checkbox.addEventListener("change",this.toggle),e.appendChild(this.dom),this.checkbox.checked&&this.toggle()}toggle(){this.emitChange(this.checkbox.checked)}}},function(e,t,n){"use strict";n.r(t);var r=n(1),o=n.n(r),i=n(8),s={insert:"head",singleton:!1};o()(i.a,s);t.default=i.a.locals||{}},function(e,t){e.exports='<div class="hamburger"> <input type="checkbox"/> <span></span> <span></span> <span></span> </div> '},function(e,t){e.exports='<div class="container"></div> '},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Sidebar=void 0,n(60);const o=n(4),i=r(n(61));t.Sidebar=class{constructor(){this.dom=o.render(i.default)}render(e){e.appendChild(this.dom)}}},function(e,t,n){"use strict";n.r(t);var r=n(1),o=n.n(r),i=n(9),s={insert:"head",singleton:!1};o()(i.a,s);t.default=i.a.locals||{}},function(e,t){e.exports='<aside class="sidebar"></aside> '},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Terminal=void 0;const o=n(5);n(63);const i=r(n(64)),s=n(0),a=n(4),c=r(n(71)),u=new i.default,l=new o.ClientStorage("mud:command-history");function d(e){const t=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/  +/g,e=>"&nbsp;".repeat(e.length));return u.toHtml(t).replace(/\n/g,"<br>")}function h(){const e=getSelection();return e&&"Range"===e.type}t.Terminal=class{constructor(){this.dom=a.render(c.default),this.$log=this.dom.$(".log"),this.$input=this.dom.$("input"),this.log=[],this.history=l.get()||[],this.histPos=0,this.emitSubmit=s.emitter(),this.onSubmit=this.emitSubmit.subscribe,this.onKey=this.onKey.bind(this)}focus(){this.$input.focus()}render(e){this.dom.$(".terminal").addEventListener("click",()=>{h()||this.$input.focus()}),this.$input.addEventListener("keydown",this.onKey),e.appendChild(this.dom)}write(e){const t=this.$log.parentElement,n=`${this.log.length?this.log.pop():""}${r=e,r.replace(/\r/g,"")}`.split(/\n\n+/);var r;const o=n.pop();for(const e of n){this.log.push(e);const n=document.createElement("p");n.innerHTML=d(e),t.insertBefore(n,this.$log)}this.log.push(o),this.$log.innerHTML=d(o),h()||(t.scrollTop=t.scrollHeight)}onKey(e){"Enter"===e.code&&this.submit(),"ArrowUp"===e.code&&this.loadHistory(1),"ArrowDown"===e.code&&this.loadHistory(-1),this.$input.size=this.$input.value.length+1}submit(){const{value:e}=this.$input;this.$input.value="",this.history.shift(),this.history.unshift(e),this.history.unshift(""),l.set(this.history),this.histPos=0,this.emitSubmit(e)}loadHistory(e){var t,n,r;this.history.length&&(this.history[this.histPos]=this.$input.value,this.histPos=(t=this.histPos+e,n=0,r=this.history.length-1,t<n?n:t>r?r:t),this.$input.value=this.history[this.histPos])}}},function(e,t,n){"use strict";n.r(t);var r=n(1),o=n.n(r),i=n(10),s={insert:"head",singleton:!1};o()(i.a,s);t.default=i.a.locals||{}},,,,,,,,function(e,t){e.exports='<main class="terminal"> <span class="log"></span> <input type="text" size="1" autofocus> </main>'},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPassword=void 0;const r=n(5);t.getPassword=function(e){const t=new r.ClientStorage("pass:"+e),n=t.get();if(n)return n;const o=prompt("Password for "+e);if(!o)throw new Error("Password required");return t.set(o),o}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getQueryParams=void 0,t.getQueryParams=function(){const e={};return window.location.search.substr(1).split("&").map(e=>e.split("=").map(decodeURIComponent)).forEach(([t,n])=>e[t]=n),e}}]);
//# sourceMappingURL=main.js.map
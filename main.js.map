{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/lib/util/concatRegexes.ts","webpack:///./src/lib/createPlugin.ts","webpack:///./src/lib/util/int.ts","webpack:///./src/lib/util/CancellablePromise.ts","webpack:///./src/data/spells.ts","webpack:///./src/data/mobs.ts","webpack:///./src/data/items.ts","webpack:///./src/ui/render.ts","webpack:///./src/ui/index.css","webpack:///./src/lib/util/singleExecution.ts","webpack:///./src/plugins/promptPlugin.ts","webpack:///./src/util/conversation.ts","webpack:///./src/util/getPassword.ts","webpack:///./src/lib/context/BasicContextCreator.ts","webpack:///./src/lib/util/wait.ts","webpack:///./src/data/areas.ts","webpack:///./src/state.ts","webpack:///./src/index.ts","webpack:///./src/lib/Mud.ts","webpack:///./src/plugins/index.ts","webpack:///./src/plugins/chatPlugin.ts","webpack:///./src/lib/util/dateTime.ts","webpack:///./src/lib/util/requestNotificationPermission.ts","webpack:///./src/plugins/inventoryPlugin.ts","webpack:///./src/plugins/navigationPlugin.ts","webpack:///./src/plugins/skillsPlugin.ts","webpack:///./src/data/skills.json.ts","webpack:///./src/plugins/statsPlugin.ts","webpack:///./src/plugins/login.ts","webpack:///./src/util/getEmail.ts","webpack:///./src/lib/context/WorkflowContextCreator.ts","webpack:///./src/lib/triggers/RootTriggerCollection.ts","webpack:///./src/lib/triggers/ChildTriggerCollection.ts","webpack:///./src/lib/triggers/PatternMatcher.ts","webpack:///./src/lib/util/trimEnd.ts","webpack:///./src/lib/triggers/PatternResult.ts","webpack:///./src/lib/triggers/PatternSubscription.ts","webpack:///./src/lib/workflow/Workflow.ts","webpack:///./src/lib/RemoteTelnet.ts","webpack:///./src/lib/audio.ts","webpack:///./src/registerWorkflows.ts","webpack:///./src/daemons/code.ts","webpack:///./src/daemons/defend.ts","webpack:///./src/daemons/dope.ts","webpack:///./src/util/uniq.ts","webpack:///./src/daemons/drink.ts","webpack:///./src/daemons/eat.ts","webpack:///./src/daemons/idle.ts","webpack:///./src/daemons/quest.ts","webpack:///./src/daemons/repair.ts","webpack:///./src/daemons/rest.ts","webpack:///./src/daemons/shop.ts","webpack:///./src/workflows/afk.ts","webpack:///./src/workflows/bank.ts","webpack:///./src/workflows/cast.ts","webpack:///./src/workflows/donations.ts","webpack:///./src/workflows/go.ts","webpack:///./src/data/areas.json.ts","webpack:///./src/workflows/kill.ts","webpack:///./src/workflows/learn.ts","webpack:///./src/data/skills_order.ts","webpack:///./src/workflows/recover.ts","webpack:///./src/workflows/train.ts","webpack:///./src/workflows/tutorial.ts","webpack:///./src/workflows/wear.ts","webpack:///./src/ui/index.ts","webpack:///./src/ui/index.css?3ef0","webpack:///./src/ui/Controls.ts","webpack:///./src/ui/Hamburger.ts","webpack:///./src/ui/Sidebar.ts","webpack:///./src/ui/Terminal.ts","webpack:///./src/util/getQueryParams.ts"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","0","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","createConcatenator","escape","regexes","join","map","x","RegExp","toString","replace","flags","filter","Boolean","uniq","Set","escapeRegExp","concatRegexes","concatRegexesUnescaped","String","initiator","instanceCreator","context","NUMBER","parseInt","CancellablePromise","Promise","executor","emitCancel","emitter","onCancel","subscribe","super","resolve","reject","this","isPending","isCancelled","state","reason","promises","forEach","promise","then","cancel","onfulfilled","onrejected","languageList","type","skillList","spellList","weaponList","effectDuration","int","effectProp","prop","metadata","armadura","success","target","end","effect","bendecir","ceguera","flotar","identificar","invisibilidad","polimorfar","refrescar","santuario","terremoto","veneno","viajar","volar","spells","SPELL_FAILED","SPELL_ALREADY_APPLIED","SPELL_NOT_POSSIBLE","SPELLS_BY_TYPE","food","water","movement","heal","invisibility","massAttack","attack","attackAlternative","dedope","pet","SPELL_LEARN_ORDER","lower","toLowerCase","base","find","startsWith","Error","meta","MOB_ARTICLE","MOB_NAME","ALLIES","MOBS","entries","clegg","edmund","devrel","kivon","mariah","nejane","silus","adorador","aguila","anciano","atontada","atontado","bicho","buitre","calamar","caracol","ciervo","ciudadano","cliente","conejo","criatura","cubo","cultista","dragon","empleado","engendro","espiritu","esqueleto","fanatico","gusano","hobgoblin","hombre","gnoll","goblin","guardia","guerrero","jefe","ladron","lobo","mago","merodeador","murcielago","ogro","orco","oso","pantera","picara","piranya","rana","rata","sapo","sacerdotisa","serpiente","troll","viejo","zombie","presence","ATTACK_RECEIVED","MOB_ARRIVES","MOB_LEAVES","MOB_DIES","flat","patterns","Array","isArray","some","includes","text","console","warn","ITEM_ARTICLE","WEAR","UNWEAR","ITEM_SUSTANTIVES","item","found","render","html","h","___CSS_LOADER_EXPORT___","fn","running","PROMPT","FPROMPT","captureProgress","PROMPT_DETECTOR","Stat","total","current","Math","round","stats","hp","mana","mv","exp","gold","enemy","promptPlugin","createPlugin","when","write","isInvisible","update","timeout","catch","finally","groups","g","toInt","hpCurr","hpTotal","mCurr","mTotal","mvCurr","mvTotal","invis","getIsInvisible","onUpdate","getPercent","stat","percent","getValue","until","whenFresh","log","isFighting","predicate","unsubscribe","async","questions","question","answer","user","storage","ClientStorage","stored","input","prompt","set","triggers","send","dispositions","Map","emitInstanceAborted","onInstanceAborted","emitInstanceDisposed","onInstanceDisposed","list","listener","onChange","checkNotAborted","dispose","subscriptions","isPrintingLogs","isAborted","onDispose","assign","pattern","handler","options","arguments","undefined","logger","rest","subscription","add","any","watchers","sleep","seconds","wait","abort","command","args","delete","timer","setTimeout","clearTimeout","ARENAS","getWithMetadata","area","arena","realm","level","from","to","sort","a","b","areaName","first","candidates","toLocaleLowerCase","listening","WeakMap","emitStateChange","onStateChange","mud","onWorkflowsChange","workflows","workflow","has","getPlugin","buttons","meters","color","serverUri","location","origin","DEFAULT_PORT","host","port","pass","server","getQueryParams","split","getPassword","getParams","terminal","renderUserInterface","document","body","socket","WebSocket","addEventListener","telnet","RemoteTelnet","connect","Mud","onUserInput","userInput","runWorkflow","cmd","getWorkflow","execute","message","onCommand","onData","onSubmit","onbeforeunload","isConnected","close","registerHandler","stopAll","trigger","action","permanent","trim","run","daemon","printLogs","runOnce","login","bindViewTo","registerWorkflows","initializeMud","openSocket","event","error","preventDefault","RootTriggerCollection","contextCreator","BasicContextCreator","handlers","emitCommand","emitWorkflowsChange","whenLoggedIn","emitLoggedIn","process","match","substr","removeAsciiCodes","createInstance","plugins","initializePlugins","password","repeat","id","identifier","creator","runForever","Workflow","createContextCreator","values","stop","workflowOrName","WorkflowContextCreator","createChild","chat","chatPlugin","inventory","inventoryPlugin","navigation","navigationPlugin","skills","skillsPlugin","statsPlugin","plugin","all","fromEntries","beepAudio","Audio","version","date","Date","toISOString","receive","addMessage","notify","sent","content","play","requestNotificationPermission","Notification","partial","datetime","faction","order","novice","tell","whisper","count","global","channel","receiveTell","received","sentPattern","tokens","re","response","token","test","handleAutoResponses","pad","val","getFullYear","getMonth","getDate","getHours","getMinutes","permission","requestPermission","CONTENT","INVENTORY_DETECTOR","ITEM_AMOUNT","ITEM_MATCHER","isInitialized","items","refresh","singleExecution","parseItems","captureLength","ensureInitialized","getItems","captured","effects","amount","search","searchInList","hasIn","hasInBackpack","getByEffect","container","keys","CLOSED","aliases","e","w","u","k","recalls","landingAtRecall","directions","isNavigating","isAtRecall","roomChanged","closed","dir","getDirections","getIsAtRecall","getIsNavigating","onRoomChange","setIsNavigating","canGo","go","callback","recall","untilEnd","done","step","path","_","times","toUpperCase","move","getRealm","waitForRecall","direction","isClosed","NOT_AVAILABLE","BUSY","FAILED","CASTED","SKILL","SKILLS_DETECTOR","practices","trainings","skill","matchAll","getPractices","getTrainings","getSkills","ensureInitiated","isSpellRunning","isMeditating","can","canLearn","castSpell","meditate","waitResponse","reverse","minLevel","ALREADY_APPLIED","hasSync","getSpell","learnt","spell","minPos","SIZE","STATE_DETECTOR","low","DASH","SPACE","PIPE","row","isInitiated","principal","fue","fueBase","des","desBase","vida","vidaBase","vidaRegen","intBase","sab","sabBase","manaBase","manaRegen","con","conBase","car","carBase","mov","movBase","movRegen","sue","sueBase","username","initialize","qa","conversation","bestRoll","roll","rollTableSuscription","blockProcessingUntil","register","children","finish","pluginsGetter","isRunning","params","execution","fromExecution","source","Proxy","queue","isProcessing","emitChange","child","ChildTriggerCollection","PatternSubscription","matcher","PatternMatcher","isAlive","clean","onMatch","splitted","last","pop","lines","line","_isEnabled","emitMatch","max","buffer","clear","trimEnd","matching","testPattern","PatternResult","indexOf","maxLength","isRegex","merge","haystack","stringPatterns","reduce","_resolve","race","executions","executionCount","size","triggerList","onTriggersChange","iteration","_isConnected","emitClose","onClose","emitData","onMessage","proxy","encoder","TextEncoder","invariant","normalize","encode","payload","JSON","stringify","reader","FileReader","onloadend","processor","readAsText","chunk","SOUND","sound","playAudio","invalid","audio","debug","volume","onerror","code","defend","dope","drink","eat","idle","quest","repair","shop","afk","bank","cast","donations","kill","learn","recover","train","tutorial","wear","things","dict","fullName","mob","getMobIn","RECUPERED","bodies","sus","memory","spellGroups","shouldHeal","defineShould","shouldRefresh","castingQueue","getSpells","currentlyCasting","min","multiplier","clapped","hypot","getSpellGroup","group","invoke","previousCast","canMeditate","isFontAvailable","isBottleFull","isThirsty","getWaterBottle","bottle","createFont","nav","eatSomething","getFoodFromBag","getFoodFromInventory","err","createFood","buyFood","REPAIR_SHOP","Calimhar","Earand","Valmorag","Niruk","REPAIR_MAN","repairEquipment","broken","repairAll","getBrokenEquipment","getItemSustantive","locations","config","areas","initialExp","died","floor","random","take","INGRESS","EXTRACT","carring","final","ceil","wasSleeping","repeatUntilCasted","rooms","getLevel","room","Number","MAX_VALUE","itemsMatch","PATH","TRAVEL","REALM_RECALLS","getAreaMetadata","canTravel","clan","focused","handleBody","parts","practicesLeft","arg","goPractice","practice","next","following","SKILL_LEARN_ORDER","single","isLearnable","getNextSkills","invisible","canHeal","canRefresh","canInvisible","isInjured","needsMana","needsRest","hasEnoughMana","acted","ready","AVOID","getBestArea","getArena","theif","enemies","avoidRoom","getMobsPresence","fullMatch","enemySpotted","getMobFromPresence","enemyGone","route","checkEnemies","index","getAreasForLevel","others","killAll","wearItem","isMetallic","identified","tirar","other","parent","showControls","initState","Terminal","hamburger","Hamburger","onControlsToggle","main","dom","renderComponents","Controls","getControlsProps","Sidebar","getSidebarProps","appendChild","classList","remove","locals","props","onClick","initialState","$checkbox","$el","toggle","checked","WorkflowComponent","isEnabled","instancesRunning","instances","classes","WorkflowActions","WorkflowTriggers","actions","Action","disable","Icon","enable","rows","blink","blinking","className","convert","history","asciiToHtml","escaped","toHtml","$log","$input","lastChunk","histPos","emitSubmit","onKeyDown","onKeyUp","focus","selection","getSelection","userHasSelectedText","block","before","__html__","innerHTML","clearLog","parentElement","removeCount","removeChild","firstChild","submit","loadHistory","unshift","modifier","entry","decodeURIComponent"],"mappings":"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","file":"main.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t0: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([26,1]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","const createConcatenator = (escape: (x: string) => string) => (\n  ...regexes: (RegExp | string)[]\n) => {\n  const join = regexes\n    .map(x => (x instanceof RegExp ? regexToString(x) : escape(x)))\n    .join('');\n\n  const flags = regexes\n    .map(x => x instanceof RegExp && x.flags)\n    .filter(Boolean)\n    .join('');\n\n  const uniq = [...new Set(flags)].join('');\n  return new RegExp(join, uniq);\n};\n\nexport const concatRegexes = createConcatenator(escapeRegExp);\nexport const concatRegexesUnescaped = createConcatenator(String);\n\nfunction regexToString(value: RegExp) {\n  return value.toString().replace(/^\\/|\\/[gi]*$/g, '');\n}\n\nfunction stringToRegex(value: string, flags: string) {\n  return new RegExp(escapeRegExp(value));\n}\n\nfunction escapeRegExp(value: string) {\n  // $& means the whole matched string\n  return value.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&').replace(/\\n/g, '\\\\n');\n}\n","import { BasicContext } from '../lib/context/BasicContextCreator';\n\nexport function createPlugin<T, U>(\n  initiator: (context: BasicContext) => T,\n  instanceCreator: (utils: T) => (context: BasicContext) => U,\n) {\n  return (context: BasicContext) => instanceCreator(initiator(context));\n}\n","import { concatRegexesUnescaped } from './concatRegexes';\n\nconst NUMBER = /-?\\d+(?:,\\d{3})*/;\n\nexport function toInt(value: string) {\n  return parseInt(value.replace(/,/g, ''), 10);\n}\n\nexport function int(name?: string) {\n  return name ? concatRegexesUnescaped(`(?<${name}>`, NUMBER, ')') : NUMBER;\n}\n","import { emitter } from '@amatiasq/emitter';\n\ntype PromiseResolver<T> = (value?: T | PromiseLike<T>) => void;\ntype PromiseRejector<T> = (reason?: T) => void;\n\nexport type PromiseExecutor<T> = (\n  resolve: PromiseResolver<T>,\n  reject: PromiseRejector<any>,\n) => void;\n\nexport type PromiseOnFulfilled<Input, Result> =\n  | ((value: Input) => Result | PromiseLike<Result>)\n  | undefined\n  | null;\nexport type PromiseOnRejected<Reason, Result> =\n  | ((reason: Reason) => Result | PromiseLike<Result>)\n  | undefined\n  | null;\n\nexport type CancellableExecutor<T> = (\n  resolve: PromiseResolver<T>,\n  reject: PromiseRejector<any>,\n  onCancel: (listener: () => void) => void,\n) => void;\n\n// Tell typescript how this works now\nexport interface CancellablePromise<T> {\n  // then<Result1 = T, Result2 = never>(\n  //   onfulfilled?: PromiseOnFulfilled<T, Result1>,\n  //   onrejected?: PromiseOnRejected<any, Result2>,\n  // ): CancellablePromise<Result1 | Result2>;\n  catch<Result = T>(\n    onrejected?: PromiseOnRejected<any, Result>,\n  ): CancellablePromise<Result>;\n  finally(onfinally?: (() => void) | undefined | null): CancellablePromise<T>;\n}\n\nexport class CancellablePromise<T> extends Promise<T> {\n  static race<T>(promises: CancellablePromise<T>[]) {\n    return new CancellablePromise<T>((resolve, reject, onCancel) => {\n      promises.forEach(promise => promise.then(resolve, reject));\n      onCancel(() => promises.forEach(promise => promise.cancel()));\n    });\n  }\n\n  private readonly emitCancel;\n  readonly onCancel;\n\n  private state!: 'resolved' | 'rejected' | 'pending' | 'cancelled';\n\n  get isCancelled() {\n    return this.state === 'cancelled';\n  }\n\n  get isPending() {\n    return this.state === 'pending';\n  }\n\n  get isResolved() {\n    return this.state === 'resolved';\n  }\n\n  get isRejected() {\n    return this.state === 'rejected';\n  }\n\n  constructor(executor: CancellableExecutor<T>) {\n    const emitCancel = emitter<void>();\n    const onCancel = emitCancel.subscribe;\n\n    super((resolve, reject) => {\n      executor(\n        value => {\n          if (this.isPending || this.isCancelled) {\n            this.state = 'resolved';\n            resolve(value!);\n          }\n        },\n        reason => {\n          if (this.isPending || this.isCancelled) {\n            this.state = 'rejected';\n            reject(reason);\n          }\n        },\n        onCancel,\n      );\n    });\n\n    this.state = 'pending';\n    this.emitCancel = emitCancel;\n    this.onCancel = onCancel;\n  }\n\n  then<Result1 = T, Result2 = never>(\n    onfulfilled?: PromiseOnFulfilled<T, Result1>,\n    onrejected?: PromiseOnRejected<any, Result2>,\n  ) {\n    const result = super.then(onfulfilled, onrejected) as CancellablePromise<\n      Result1 | Result2\n    >;\n    result.onCancel(() => this.cancel());\n    this.onCancel(() => result.cancel());\n    return result;\n  }\n\n  // finally(onfinally?: (() => void) | undefined | null) {\n  //   if (onfinally) {\n  //     this.onCancel(onfinally);\n  //   }\n\n  //   super.finally(onfinally);\n  //   return this;\n  // }\n\n  cancel() {\n    if (this.isPending) {\n      this.state = 'cancelled';\n      this.emitCancel();\n    }\n  }\n}\n","import { Pattern } from '../lib/triggers/Pattern';\nimport { concatRegexes } from '../lib/util/concatRegexes';\nimport { int } from '../lib/util/int';\nimport ALL_SKILLS from './skills.json';\n\ntype Item = typeof ALL_SKILLS[number];\n\n// prettier-ignore-start\nexport const languageList = ALL_SKILLS.filter(\n  x => x.type === 'Idioma',\n) as LanguageBase[];\nexport const skillList = ALL_SKILLS.filter(\n  x => x.type === 'Habilidad',\n) as SkillBase[];\nexport const spellList = ALL_SKILLS.filter(\n  x => x.type === 'Hechizo',\n) as SpellBase[];\nexport const weaponList = ALL_SKILLS.filter(\n  x => x.type === 'Arma',\n) as WeaponBase[];\n// prettier-ignore-end\n\nexport type LanguageBase = Extract<Item, { type: 'Idioma' }>;\nexport type SkillBase = Extract<Item, { type: 'Habilidad' }>;\nexport type SpellBase = Extract<Item, { type: 'Hechizo' }>;\nexport type WeaponBase = Extract<Item, { type: 'Arma' }>;\n\nexport type SkillName = Item['name'];\n\nexport type LanguageName = LanguageBase['name'];\nexport type SpellName = SpellBase['name'];\nexport type WeaponName = WeaponBase['name'];\n\nconst effectDuration = (name: SpellName) =>\n  concatRegexes(\n    /Hechizo  : '/,\n    name,\n    /'  durante /,\n    int('asaltos'),\n    / asaltos./,\n  );\n\nconst effectProp = (prop: string | RegExp) => (name: SpellName) =>\n  concatRegexes(\n    /Hechizo  : '/,\n    name,\n    /' Afecta /,\n    prop,\n    / en /,\n    int('cantidad'),\n    / durante /,\n    int('asaltos'),\n    / asaltos./,\n  );\n\nconst metadata: Partial<Record<SpellName, SpellMetadata>> = {\n  armadura: {\n    success: 'Tu armadura brilla suavemente al ser mejorada por un conjuro.',\n    target:\n      /La armadura de (?<target>(?:\\w+ )+)brilla suavemente al ser mejorada por un conjuro\\./,\n    end: 'Tu armadura vuelve a su valor normal.',\n    effect: effectProp('armor class'),\n  },\n\n  'atravesar puerta': {\n    success: 'Te vuelves translucido.',\n    end: 'Vuelves a tener un cuerpo solido.',\n    effect: effectDuration,\n  },\n\n  bendecir: {\n    success: 'Tu dios te otorga una poderosa bendicion.',\n    end: 'La bendicion desaparece.',\n    effect: effectProp('hit roll'),\n  },\n\n  'causar critica': { target: /Tu conjuro [^\\n]+ a(?<target>(?: \\w+)+)!/ },\n  'causar grave': { target: /Tu conjuro [^\\n]+ a(?<target>(?: \\w+)+)!/ },\n  'causar leve': { target: /Tu conjuro [^\\n]+ a(?<target>(?: \\w+)+)!/ },\n  ceguera: { target: /Lanzas un conjuro de ceguera contra (?<target>[^.]+)./ },\n  'crear agua': { target: ' esta lleno.\\n' },\n\n  'crear baya': {\n    success: 'Una baya brillante y dorada aparece en tus manos!',\n  },\n\n  'crear comida': { success: 'Una seta magica aparece de repente.' },\n\n  'crear fuego': {\n    success: 'Una gran hoguera se enciende en el suelo delante tuyo.',\n  },\n\n  'crear manantial': {\n    success:\n      'Trazas un circulo delante tuyo del cual emerge un manantial de agua cristalina.',\n    end: 'Un manantial magico se seca.',\n  },\n\n  'curar criticas': {\n    success: 'Tus heridas mas graves se cierran y el dolor desaparece.',\n    target: /Curas las heridas mas graves de (?<target>[^\\.]+)\\./,\n  },\n\n  'curar graves': {\n    success: 'Tus heridas graves se cierran y el dolor desaparece.',\n    target: /Curas las heridas graves de (?<target>[^\\.]+)\\./,\n  },\n\n  'curar leves': {\n    success: 'Tus heridas leves se cierran y el dolor desaparece.',\n    target: /Curas las heridas leves de (?<target>[^\\.]+)\\./,\n  },\n\n  'curar veneno': {\n    success: 'Un agradable sensacion recorre tu cuerpo.',\n  },\n\n  'detectar escondido': {\n    success: 'Tus sentidos cobran la viveza de los del mejor predador.',\n    end: 'Te sientes menos consciente de lo que te rodea.',\n    effect: effectDuration,\n  },\n\n  'detectar invisible': {\n    success: 'Tus ojos brillan, siendo capaces ahora de ver lo invisible.',\n    end: 'Ya no ves objetos invisibles.',\n    effect: effectDuration,\n  },\n\n  'detectar magia': {\n    success:\n      'Delgadas lineas azules reseguiran las siluetas de los objetos magicos que te encuentres.',\n    end: 'Las lineas azules desaparecen de tu vision',\n    effect: effectDuration,\n  },\n\n  'detectar maldad': {\n    success:\n      'Delgadas lineas rojas reseguiran las siluetas de los seres malvados que te encuentres.',\n    effect: effectDuration,\n    end: 'Las lineas rojas desaparecen de tu vision.',\n  },\n\n  'detectar trampas': {\n    success: 'De repente te sientes mas alerta de los peligros que te rodean.',\n    end: 'Te sientes menos alerta de los peligros que te rodean.',\n    effect: effectDuration,\n  },\n\n  'encantar arma': {\n    success: ' resplandece con destellos de energia azul.',\n  },\n\n  'escudo hielo': {\n    success: 'Un torbellino de granizo te envuelve protectivamente.',\n    effect: effectDuration,\n  },\n\n  flotar: {\n    success: 'Empiezas a flotar a unos centimetros del suelo...',\n    target:\n      /\\n(?<target>[^\\n]+) empieza a flotar a unos centimetros del suelo\\.\\.\\./,\n    end: 'Tus pies aterrizan suavemente en el suelo.',\n  },\n\n  'fuerza vampirica': {\n    success: 'La fuerza de los vampiros fluye por tus venas...',\n    end: 'Tu musculos vuelven lentamente a su estado normal...',\n    effect: effectProp('fuerza'),\n  },\n\n  'furia naturaleza': {\n    success: 'Sientes como la furia de la naturaleza te embarga...',\n  },\n\n  identificar: {\n    target:\n      /El objeto '(?<name>[^']+)' es un\\(a\\) (?<type>\\w+), propiedades especiales: (?<properties>[^\\n]+)\\n/,\n  },\n\n  invisibilidad: {\n    success: 'Te desvaneces en el aire.',\n    target: /\\n(?<target>[^\\n]+) se desvanece en el aire./,\n    end: 'Ya no eres invisible.',\n    effect: effectDuration,\n  },\n\n  'invisibilidad grupo': {\n    success:\n      'Tu cuerpo se vuelve traslucido por un momento y luego se desvanece.',\n  },\n\n  'invocar armadillo': {\n    success:\n      'Agitas tus brazos a la vez que te concentras para invocar un pequenyo armadillo.',\n  },\n\n  'luz eterna': {\n    success:\n      'Rayos de luz iridiscente colisionan para formar una bola de luz eterna...',\n  },\n\n  'piel petrea': {\n    success: 'Tu piel se vuelve dura como la piedra, aunque flexible.',\n    effect: effectProp('armor class'),\n  },\n\n  'piel robliza': {\n    success: 'Tu piel se oscurece a la vez que adquiere la dureza del roble.',\n    end: 'Tu piel vuelve a su estado normal...',\n    effect: effectProp('armor class'),\n  },\n\n  polimorfar: {\n    success:\n      /Tu cuerpo empieza a cambiar... hasta transformarte en (?<result>[^!]+)!/,\n    end: 'Recuperas tu forma natural.',\n  },\n\n  refrescar: { success: 'Nueva vitalidad fluye hacia ti.' },\n\n  'respiracion acuatica': {\n    success: 'Tus pulmones ahora son capaces de respirar bajo agua...',\n    target:\n      /Los pulmones de (?<target>[^\\n]+) ahora son capaces de respirar bajo agua\\.\\.\\./,\n    end: 'Tus pulmones vuelven a su estado original.',\n    effect: effectDuration,\n  },\n\n  'retirar maldicion': {\n    success: 'Te sientes liberado de la maldicion.',\n  },\n\n  santuario: {\n    success: 'Una aura luminosa se forma lentamente a tu alrededor.',\n    end: 'El aura luminosa alrededor tuyo se desvanece.',\n    effect: effectDuration,\n  },\n\n  terremoto: {\n    success: 'La tierra tiembla bajo tus pies!',\n    target: 'La tierra tiembla bajo tus pies!',\n  },\n\n  veneno: {\n    target:\n      /\\n(?<target>[^\\n]+)cobra un aspecto enfermizo cuando tu veneno se esparce por su cuerpo./,\n  },\n\n  viajar: {\n    target: 'Salidas: ',\n  },\n\n  'vista distancia': {\n    success: 'Tienes una vision reveladora...',\n    target:\n      /Los ojos de (?<target>[^\\n]+) parecen estar mirando un lugar lejano\\.\\.\\./,\n    end: 'Tu clarividencia te abandona...',\n    effect: effectDuration,\n  },\n\n  volar: {\n    success: 'Te elevas entre las corrientes de aire...',\n    target: /\\n(?<target>[^\\n]+) se eleva entre las corrientes de aire.../,\n    end: 'Aterrizas suavemente en el suelo.',\n    effect: effectDuration,\n  },\n};\n\nconst spells = spellList.map(x => ({\n  ...x,\n  ...(metadata[x.name] || {}),\n})) as Spell[];\n\ninterface SpellMetadata {\n  readonly success?: Pattern;\n  readonly target?: Pattern;\n  readonly end?: Pattern;\n  readonly effect?: (string: SpellName) => Pattern;\n}\n\nexport type Casteable = SpellName | SpellName[];\nexport type Spell = SpellBase & SpellMetadata;\n\nexport const SPELL_FAILED = [\n  'Algo te distrae y pierdes la concentracion.',\n  'Has perdido la concentracion.',\n  'Has tenido una laguna mental mientras invocabas el hechizo.',\n  'Pierdes la concentracion.',\n  'Un picor en la nariz te impide mantener la concentracion.',\n  'Un pinchazo en tu pierna te impide lanzar el conjuro adecuadamente.',\n  'Una mota de polvo en el ojo rompe tu concentracion por un momento.',\n];\n\nexport const SPELL_ALREADY_APPLIED = [\n  'Has fallado.',\n  'Eso no parece tener ningun efecto.',\n];\n\nexport const SPELL_NOT_POSSIBLE = [\n  'No esta aqui.',\n  'Falta algo...',\n  'No tienes suficiente mana.',\n  'Sobre que quieres lanzar este conjuro?',\n  'No puedes encontrar ningun ',\n  'Este estilo de lucha pide demasiado atencion para hacer eso!',\n  'Este asalto del combate es demasiado febril para concentrarte adecuadamente.',\n  'No has tenido suficiente tiempo en este asalto para completar el conjuro.',\n  'Estas demasiado malherido para hacer eso.',\n  'Estas demasiado aturdido para hacer eso.',\n  'Tu armadura metalica no te permite concentrarte para hacer magia.',\n];\n\nexport const SPELLS_BY_TYPE = {\n  food: ['saciar hambre', 'crear comida'] as Casteable,\n  water: ['crear manantial', 'crear agua'] as Casteable,\n  movement: ['volar', 'flotar'] as Casteable,\n  heal: ['curar criticas', 'curar graves', 'curar leves'] as Casteable,\n  invisibility: ['invisibilidad grupo', 'invisibilidad'] as Casteable,\n  massAttack: ['terremoto'] as Casteable,\n  attack: ['causar critica', 'causar grave', 'causar leve'] as Casteable,\n\n  attackAlternative: [\n    'agarron impactante',\n    'relampago',\n    'bola fuego',\n    'misil magico',\n  ] as Casteable,\n\n  dedope: [\n    'ceguera',\n    'veneno',\n    'disipar magia',\n    'disipar maldad',\n    'maldecir',\n    'proteccion',\n    'fuego espectral',\n    'debilitar',\n  ] as Casteable,\n\n  pet: [\n    'invocar oso',\n    'invocar jaguar',\n    'invocar lobo',\n    'invocar aguila',\n    'invocar lince',\n    'invocar armadillo',\n  ] as Casteable,\n};\n\nexport const SPELL_LEARN_ORDER: Casteable[] = [\n  // Survival\n  SPELLS_BY_TYPE.food,\n  SPELLS_BY_TYPE.water,\n  SPELLS_BY_TYPE.dedope,\n  'luz eterna',\n\n  // Love\n  'invisibilidad',\n  'invocar armadillo',\n\n  // Dope\n  'armadura',\n  'bendecir',\n  'detectar escondido',\n  'detectar invisible',\n  'detectar magia',\n  SPELLS_BY_TYPE.movement,\n\n  // Medic\n  'curar ceguera',\n  SPELLS_BY_TYPE.heal,\n  'refrescar',\n\n  // Other\n  SPELLS_BY_TYPE.attack,\n  'crear fuego',\n];\n\nexport function getSpells() {\n  return spells;\n}\n\nexport function getSpell(name: string) {\n  const lower = name.toLowerCase();\n  const base = spellList.find(x => x.name.startsWith(lower));\n\n  if (!base) {\n    throw new Error(`Unknown spell ${name}`);\n  }\n\n  const meta = base && metadata[base.name];\n  if (!meta) return base;\n\n  return {\n    ...base,\n    ...meta,\n    effect:\n      typeof meta.effect === 'function' ? meta.effect(base.name) : meta.effect,\n  };\n}\n","import { Pattern, SinglePattern } from '../lib/triggers/Pattern';\nimport { concatRegexes } from '../lib/util/concatRegexes';\n\nconst MOB_GENERIC = {\n  adorador: [\n    'Un adorador mira con cólera a su alrededor.',\n    'Un devoto adorador mira con cólera a su alrededor.',\n  ],\n  aguila: [\n    'Una enorme aguila esta aqui profundamente dormido.',\n    'Una gigantesca aguila vuela a tu alrededor.',\n  ],\n  anciano: 'Un marchito anciano deambula por los pasillos vigilando.',\n  atontada: 'Una granjera atontada mira hacia ningun lugar.',\n  atontado: 'Un granjero atontado tropieza por aqui.',\n  bicho: 'Un asqueroso bicho se fija en ti nada mas verte.',\n  buitre: 'Un buitre carronyero esta aqui.',\n  calamar: 'Un calamar gigante esta aqui nadando.',\n  caracol: 'Un pequenyo caracol esta aqui haciendo trompos.',\n  ciervo: null,\n  ciudadano:\n    'El pobre ciudadano esta tan absorto en su pena que no te advierte.',\n  cliente:\n    'Un cliente muy serio se sienta silenciosamente en una de las grandes mesas.',\n  conejo: null,\n  criatura: [\n    'Una poderosa criatura del pantano esta aqui profundamente dormido.',\n  ],\n  cubo: 'Un enorme cubo transparente de materia gelatinosa rezuma ante ti.',\n  cultista: [\n    'Una joven cultista parece bastante serena, mientras no vea a nadie m',\n  ],\n  dragon: null,\n  empleado: null,\n  engendro:\n    'Un deforme humano, un engendro de la magia, quiere descargar su agresividad.',\n  espiritu: 'Un espíritu se desliza por el aire.',\n  esqueleto: [\n    'El esqueleto hace castanyetear sus dientes amenazadoramente y se acerca!',\n    'Un esqueleto con armadura avanza torpemente a traves de los arboles.',\n    'Un esqueleto huesudo esta aqui profundamente dormido.',\n    'Un esqueleto polvoriento esta aqui.',\n  ],\n  fanatico: [\n    \"Un humano poseído por el fanatismo busca 'herejes'.\",\n    'Una figura humanoide resplandece detras de un brillante campo de fuerza.',\n  ],\n  gusano: [\n    'Un gusano de roca esta aqui profundamente dormido.',\n    /Un monstruoso gusano de hielo excava a traves del hielo y la nieve aqui\\. Se yergue y\\s+ataca!/,\n  ],\n  hobgoblin: [\n    'un guardia hobgoblin de elite esta aqui profundamente dormido.',\n    'Un hobgoblin armado esta aqui, interrogando a un prisionero.',\n    'Un macizo hobgoblin esta de guardia cerca del hueco de la escalera.',\n    'Un guardian de la montaña esta aquí, echando espuma por la boca.',\n  ],\n  hombre: 'Un salvaje hombre, medio desnudo, te mira con ansiedad.',\n  gnoll: 'un gnoll feo esta aqui profundamente dormido.',\n  goblin: [\n    'Un alegre goblin cacarea maniaticamente.',\n    'un goblin negrero esta aqui profundamente dormido.',\n    'Un habitante del bosque merodea por aqui, protegiendo su montanya.',\n    'Un macizo chaman goblin esta aqui rugiendo a sus lacayos.',\n    'Un pequenyo, pero fuerte goblin se arrastra por las cabanyas.',\n  ],\n  guardia: [\n    'Un Guardia Real está aquí velando por la seguridad del estadio',\n    'Un guardia del pueblo vaga a ciegas.',\n  ],\n  guerrero: 'Un guerrero asqueroso grunye al verte.',\n  jefe: [\n    'Un jefe esta aqui descansando.',\n    'Un jefe orco esta aqui mirandote desconfiado.',\n    'Un macizo chaman goblin esta aqui rugiendo a sus lacayos.',\n  ],\n  ladron: [\n    'Un cauteloso ladron busca algo valioso por la ciudad.',\n    'Un ladron esta aqui profundamente dormido.',\n    'Un ladron te mira desconfiado.',\n    'Una extraña figura se mueve furtivamente.',\n    /Tu ataque causa .* a un ladron!/,\n  ],\n  lobo: [\n    'Un gran lobo negro, te muestra los colmillos hambriento.',\n    'Un lobo blanco como la nieve del tamanyo de una vaca grunye amenzadoramente.',\n    'Un lobo feroz esta aqui y grunye muy enojado.',\n    'Un lobo hambriento te esta mirando',\n  ],\n  mago: [\n    'Un mago viejo esta aqui profundamente dormido.',\n    'Un anciano con ropajes de mago, pregona sus mercancias.',\n  ],\n  merodeador: null,\n  murcielago: null,\n  ogro: [\n    'el capitan ogro esta aqui profundamente dormido.',\n    'Un gigantesco ogro juega con una enorme roca lanzandola al aire.',\n  ],\n  orco: [\n    'El arquero orco esta aqui profundamente dormido.',\n    'El capitan orco te observa con sus ojos llenos de furia.',\n    'El chaman esta sentado detras de un escritorio, escribiendo una misiva.',\n    'El desagradable y malioliente espadachin orco esta aqui.',\n    'el jefe orco minero esta aqui profundamente dormido.',\n    'El orco espadachin llega desde el este.',\n    'Un asqueroso arquero orco esta aqui.',\n    'Un corpulento orco esta aqui de guardia.',\n    'un guardia orco esta aqui profundamente dormido.',\n    'Un jefe orco esta aqui profundamente dormido.',\n    'Un ogro centinela esta de guardia delante de la puerta norte.',\n    'un orco centinela esta aqui profundamente dormido.',\n    'Un orco esta de pie al lado de la ballesta.',\n    'Un orco fuera de servicio esta sentado aqui jugando a ',\n    'un orco minero esta aqui profundamente dormido.',\n    'Un orco que se ve fiero, grune y oscila su arma hacia tu cabeza',\n    'Un orco salvaje gruñe y prepara sus armas.',\n    'Un pequenyo orco se sienta en una de las sillas roncando.',\n    'Un sargento orco mantiene vigilada la chusma a la que comanda.',\n    'Un voluminoso cocinero orco sopesa un cuchillo de carnicero manchado de sangre.',\n    /El orco espadachin esta aqui profundamente dormido\\./i,\n  ],\n  oso:\n    'Un oso pardo se mueve pesadamente detras de la mesa, hay sangre en su piel.',\n  pantera: null,\n  picara: 'Una picara sale de las sombras y te ataca!',\n  piranya: [\n    'Una piranya te mira con su enorme boca.',\n    /Una piranya esta aqui profundamente dormido\\./i,\n  ],\n  rana: 'Una rana enorme croa furiosamente.',\n  rata: 'Una rata gigante esta aqui profundamente dormido.',\n  sapo: 'un sapo gigante esta aqui profundamente dormido.',\n  sacerdotisa:\n    'Una voluptuosa mujer desnuda se postra ante su dios lujuriosamente.',\n  serpiente: 'Una serpiente que parece venenosa te mira fijamente.',\n  'uruk-hai': [\n    'Un asqueroso arquero uruk-hai tensa su arco al verte.',\n    'Un superior uruk-hai esta aqui vigilando.',\n  ],\n  troll: 'Un troll de mas de 3 metros de alto esta destrozando el mobiliario.',\n  viejo: 'Un harapiento y despeinado viejo llora sentado en el suelo.',\n  zombie: 'Un zombie se acerca hacia ti con los brazos extendidos.',\n};\n\nconst MOB_CHARACTERS = {\n  clegg:\n    'El carnicero demente saca espuma por la boca mientras parte la carne.',\n  edmund: 'Un hombre pequenyo y rechoncho yace aturdido en el suelo.',\n  devrel: 'Un hombre desnudo yace sobre sus propios excrementos.',\n  kivon: 'Kivon, el líder del culto, no está nada contento con intromisiones.',\n  mariah: 'Una joven esta aqui sentada y canta suavemente para si.',\n  nejane: 'Nejane, la líder, parece estar en trance.',\n  silus:\n    'Un delgado elfo, el propietario del establecimiento, te mira fijamente.',\n} as const;\n\nconst MOB_ARTICLE = /(?:(?:un|una|el|la|los|las|unos|unas) )?/;\nconst MOB_NAME = /(?<mob>(?: |\\w|-)+)/;\nconst ALLIES = ['armadillo', 'lince'];\n\nconst MOBS: Mob[] = Object.entries({\n  ...MOB_CHARACTERS,\n  ...MOB_GENERIC,\n}).map(([name, presence]) => ({\n  name: name as MobName,\n  presence,\n}));\n\ntype GenericMobName = keyof typeof MOB_GENERIC;\ntype CharacterMobName = keyof typeof MOB_CHARACTERS;\n\n// PUBLIC\n\nexport type MobName = GenericMobName | CharacterMobName;\n\nexport interface Mob {\n  name: MobName;\n  presence?: Pattern | null;\n}\n\nexport const ATTACK_RECEIVED = [\n  /Tu ataque \\w+ a un (?<mob>ladron)./,\n  concatRegexes(/El \\w+ de /, MOB_ARTICLE, MOB_NAME, / te /),\n];\n\nexport const MOB_ARRIVES = concatRegexes(\n  MOB_ARTICLE,\n  MOB_NAME,\n  / llega desde el (?<direction>\\w+)/,\n);\n\nexport const MOB_LEAVES = concatRegexes(\n  MOB_ARTICLE,\n  MOB_NAME,\n  / (?:se va)|(?:vuela) hacia (?:el )?(?<direction>\\w+)/,\n);\n\nexport const MOB_DIES = concatRegexes(MOB_ARTICLE, MOB_NAME, / ha MUERTO!!/);\n\nexport function getMobsPresence() {\n  return MOBS.map(x => x.presence)\n    .flat()\n    .filter(Boolean) as Pattern;\n}\n\nexport function getMobFromPresence(patterns: SinglePattern[]) {\n  return MOBS.filter(x => x.presence).find(({ presence }) =>\n    Array.isArray(presence)\n      ? patterns.some(x => presence.includes(x))\n      : patterns.includes(presence!),\n  );\n}\n\nexport function getMobIn(text: string) {\n  const lower = text.toLowerCase();\n\n  if (ALLIES.some(x => lower.includes(x))) {\n    return null;\n  }\n\n  const result = MOBS.find(x => lower.includes(x.name));\n\n  if (!result) {\n    console.warn(`Unknown sustantive for \"${text}\"`);\n  }\n\n  return result;\n}\n","import { concatRegexes } from '../lib/util/concatRegexes';\n\nexport type ItemName = typeof ITEM_SUSTANTIVES[number];\n\nexport const ITEM_ARTICLE = /(?: (?:un|una|el|la|los|las|unos|unas))?/;\n\nexport const WEAR = [\n  'Te colocas ',\n  'Te pones ',\n  'Metes las piernas ',\n  'Vistes ',\n  'Usas ',\n];\nexport const UNWEAR = concatRegexes(\n  /Dejas de usar/,\n  ITEM_ARTICLE,\n  / (?<item>[^.]+?)\\./,\n);\n\nexport const ITEM_SUSTANTIVES = [\n  'amuleto',\n  'anillo',\n  'anteojos',\n  'armadura',\n  'baculo',\n  'baston',\n  'bola',\n  'botas',\n  'brazal',\n  'brazalete',\n  'brazaletes',\n  'brigandina',\n  'capa',\n  'capote',\n  'casco',\n  'cetro',\n  'cinto',\n  'cinturon',\n  'cinturón',\n  'coderas',\n  'colgante',\n  'collar',\n  'coraza',\n  'cota',\n  'cubrepiernas',\n  'daga',\n  'escudo',\n  'espada',\n  'faja',\n  'faldones',\n  'grebas',\n  'guanteletes',\n  'guantes',\n  'hacha',\n  // 'joya',\n  'lanza',\n  'luz',\n  'máscara',\n  'mangas',\n  'manoplas',\n  'martillo',\n  'maza',\n  'mocasines',\n  'pendiente',\n  'perneras',\n  'peto',\n  'pica',\n  'placa',\n  'polainas',\n  'pulsera',\n  'ropaje',\n  'sentido',\n  'sombrero',\n  'tobillera',\n  'vara',\n  'varita',\n  'visera',\n  'yelmo',\n] as const;\n\nexport function getItemSustantive(item: string): ItemName | null {\n  const lower = item.toLowerCase();\n  const found = ITEM_SUSTANTIVES.find(x => lower.includes(x));\n\n  if (!found) {\n    console.warn('Unknown item sustantive:', item);\n    return null;\n  }\n\n  return found;\n}\n","import { h, render } from 'preact';\nimport htm from 'htm';\n\nexport const html = htm.bind(h);\nexport { render };\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/cssWithMappingToString.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nimport ___CSS_LOADER_AT_RULE_IMPORT_0___ from \"-!../../node_modules/css-loader/dist/cjs.js!../../node_modules/normalize.css/normalize.css\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n___CSS_LOADER_EXPORT___.i(___CSS_LOADER_AT_RULE_IMPORT_0___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"body {\\n  --background-color: #1c1c1c;\\n  --border-color: #484848;\\n  --control-color: white;\\n  --color: white;\\n  background-color: black;\\n  color: white;\\n}\\n\\n.container {\\n  height: 100%;\\n  display: grid;\\n  grid-template-rows: 1fr;\\n  grid-template-columns: 1fr;\\n  grid-template-areas: 'terminal';\\n}\\n\\n.container.show-controls {\\n  grid-template-columns: 1fr 1fr;\\n}\\n\\n.container.show-controls:not(.top) {\\n  grid-template-areas:\\n    'terminal sidebar'\\n    'controls sidebar';\\n}\\n\\n.container.show-controls.top {\\n  grid-template-areas:\\n    'controls sidebar'\\n    'terminal sidebar';\\n}\\n\\n.container:not(.show-controls) .sidebar,\\n.container:not(.show-controls) .controls {\\n  display: none;\\n}\\n\\n.container.show-controls:not(.top) .controls:empty {\\n  border-top: 1px solid var(--border-color);\\n}\\n\\n.container.show-controls.top .controls:empty {\\n  border-bottom: 1px solid var(--border-color);\\n}\\n\\n/* TERMINAL */\\n\\n.terminal {\\n  min-width: 700px;\\n  grid-area: terminal;\\n  overflow-x: hidden;\\n  overflow-y: auto;\\n  -ms-overflow-style: none; /* IE and Edge */\\n  scrollbar-width: none; /* Firefox */\\n  display: flex;\\n  flex-direction: column-reverse;\\n  padding: 0 0.5em;\\n}\\n\\n.terminal::-webkit-scrollbar {\\n  display: none;\\n}\\n\\n.terminal p {\\n  margin: 1em 0;\\n}\\n\\n.terminal input {\\n  background-color: transparent;\\n  border: none;\\n  color: white;\\n  display: inline-block;\\n  font-family: monospace;\\n  outline: none;\\n}\\n\\n/* CONTROLS */\\n\\n.controls {\\n  grid-area: controls;\\n  background-color: var(--background-color);\\n  display: flex;\\n  align-items: stretch;\\n  height: 30px;\\n}\\n\\n.controls .meters {\\n  display: flex;\\n  flex-direction: column;\\n  align-items: stretch;\\n  flex: 1;\\n}\\n\\n.controls .meters .meter {\\n  flex: 1;\\n}\\n\\n.controls .meter .bar {\\n  height: 100%;\\n}\\n\\n/* SIDEBAR */\\n\\n.sidebar {\\n  grid-area: sidebar;\\n  background-color: var(--background-color);\\n  border-left: 1px solid var(--border-color);\\n  display: flex;\\n  flex-direction: column-reverse;\\n  align-items: stretch;\\n  overflow-y: auto;\\n}\\n\\n.sidebar .title {\\n  text-align: center;\\n  text-transform: uppercase;\\n}\\n\\n.sidebar .workflow-list {\\n  list-style: none;\\n  margin-bottom: 0;\\n  padding: 0;\\n}\\n\\n.sidebar .workflow {\\n  border-top: 1px solid var(--border-color);\\n}\\n.sidebar .workflow.running {\\n  color: gray;\\n}\\n.sidebar .workflow.disabled .workflow-content {\\n  opacity: 0.5;\\n}\\n\\n.sidebar .workflow header {\\n  display: flex;\\n  align-items: center;\\n  padding: 1rem;\\n}\\n\\n.sidebar .workflow .name {\\n  flex: 1;\\n  margin: 0 0.5rem;\\n  font-size: 1.4rem;\\n  font-family: monospace;\\n  text-transform: uppercase;\\n  font-weight: normal;\\n}\\n\\n.sidebar .action {\\n  appearance: none;\\n  background: none;\\n  border: none;\\n  outline: none;\\n  margin: 0;\\n  padding: 3px;\\n  color: var(--control-color);\\n  font-size: 0.9rem;\\n  transition: opacity 0.1s ease-in-out;\\n  text-align: center;\\n  opacity: 0.8;\\n}\\n.sidebar .action:hover {\\n  opacity: 1;\\n}\\n.sidebar .action:active {\\n  opacity: 0.5;\\n}\\n\\n.sidebar .workflow .triggers:not(:empty) {\\n  max-height: 25vh;\\n  overflow-y: auto;\\n  list-style: square;\\n  border-top: 1px solid var(--border-color);\\n}\\n\\n.sidebar .workflow .trigger {\\n  display: flex;\\n  flex-direction: column;\\n}\\n\\n.sidebar .workflow .pattern {\\n  white-space: nowrap;\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n}\\n\\n.sidebar .workflow .pattern.blink {\\n  animation: highlight 0.3s linear;\\n}\\n\\n.sidebar .action.enable-control:hover i:first-child,\\n.sidebar .action.enable-control:not(:hover) i:last-child,\\n.sidebar .workflow.running .run,\\n.sidebar .workflow:not(.running) .stop,\\n.sidebar .workflow:not(.expanded) .triggers {\\n  display: none;\\n}\\n\\n@keyframes highlight {\\n  0% {\\n    background-color: transparent;\\n    color: inherit;\\n  }\\n  10% {\\n    background-color: #aa0000;\\n    color: #ffffff;\\n  }\\n  100% {\\n    background-color: transparent;\\n    color: inherit;\\n  }\\n}\\n\\n/* HAMBURGER */\\n\\n.hamburger {\\n  display: inline-block;\\n  position: absolute;\\n  top: 24px;\\n  right: 40px;\\n  z-index: 1;\\n  -webkit-user-select: none;\\n  user-select: none;\\n}\\n\\n.hamburger input {\\n  display: block;\\n  width: 40px;\\n  height: 32px;\\n  position: absolute;\\n  top: -7px;\\n  left: -5px;\\n  cursor: pointer;\\n  opacity: 0; /* hide this */\\n  z-index: 2; /* and place it over the hamburger */\\n  -webkit-touch-callout: none;\\n}\\n\\n.hamburger span {\\n  display: block;\\n  width: 33px;\\n  height: 4px;\\n  margin-bottom: 5px;\\n  position: relative;\\n  background: #cdcdcd;\\n  border-radius: 3px;\\n  z-index: 1;\\n  transform-origin: center right;\\n  transition: transform 0.5s cubic-bezier(0.77, 0.2, 0.05, 1),\\n    background 0.5s cubic-bezier(0.77, 0.2, 0.05, 1), opacity 0.55s ease;\\n}\\n\\n/*\\n * Transform all the slices of hamburger\\n * into a crossmark.\\n */\\n.hamburger input:checked ~ span:nth-of-type(2) {\\n  opacity: 0;\\n  transform: rotate(0deg) scale(0.2, 0.2);\\n}\\n\\n.hamburger input:checked ~ span:first-of-type {\\n  transform: rotate(-45deg) translate(0, -4px);\\n}\\n\\n.hamburger input:checked ~ span:last-of-type {\\n  transform: rotate(45deg) translate(0, 4px);\\n}\\n\", \"\",{\"version\":3,\"sources\":[\"webpack://src/ui/index.css\"],\"names\":[],\"mappings\":\"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\",\"sourcesContent\":[\"@import '../../node_modules/normalize.css/normalize.css';\\n\\nbody {\\n  --background-color: #1c1c1c;\\n  --border-color: #484848;\\n  --control-color: white;\\n  --color: white;\\n  background-color: black;\\n  color: white;\\n}\\n\\n.container {\\n  height: 100%;\\n  display: grid;\\n  grid-template-rows: 1fr;\\n  grid-template-columns: 1fr;\\n  grid-template-areas: 'terminal';\\n}\\n\\n.container.show-controls {\\n  grid-template-columns: 1fr 1fr;\\n}\\n\\n.container.show-controls:not(.top) {\\n  grid-template-areas:\\n    'terminal sidebar'\\n    'controls sidebar';\\n}\\n\\n.container.show-controls.top {\\n  grid-template-areas:\\n    'controls sidebar'\\n    'terminal sidebar';\\n}\\n\\n.container:not(.show-controls) .sidebar,\\n.container:not(.show-controls) .controls {\\n  display: none;\\n}\\n\\n.container.show-controls:not(.top) .controls:empty {\\n  border-top: 1px solid var(--border-color);\\n}\\n\\n.container.show-controls.top .controls:empty {\\n  border-bottom: 1px solid var(--border-color);\\n}\\n\\n/* TERMINAL */\\n\\n.terminal {\\n  min-width: 700px;\\n  grid-area: terminal;\\n  overflow-x: hidden;\\n  overflow-y: auto;\\n  -ms-overflow-style: none; /* IE and Edge */\\n  scrollbar-width: none; /* Firefox */\\n  display: flex;\\n  flex-direction: column-reverse;\\n  padding: 0 0.5em;\\n}\\n\\n.terminal::-webkit-scrollbar {\\n  display: none;\\n}\\n\\n.terminal p {\\n  margin: 1em 0;\\n}\\n\\n.terminal input {\\n  background-color: transparent;\\n  border: none;\\n  color: white;\\n  display: inline-block;\\n  font-family: monospace;\\n  outline: none;\\n}\\n\\n/* CONTROLS */\\n\\n.controls {\\n  grid-area: controls;\\n  background-color: var(--background-color);\\n  display: flex;\\n  align-items: stretch;\\n  height: 30px;\\n}\\n\\n.controls .meters {\\n  display: flex;\\n  flex-direction: column;\\n  align-items: stretch;\\n  flex: 1;\\n}\\n\\n.controls .meters .meter {\\n  flex: 1;\\n}\\n\\n.controls .meter .bar {\\n  height: 100%;\\n}\\n\\n/* SIDEBAR */\\n\\n.sidebar {\\n  grid-area: sidebar;\\n  background-color: var(--background-color);\\n  border-left: 1px solid var(--border-color);\\n  display: flex;\\n  flex-direction: column-reverse;\\n  align-items: stretch;\\n  overflow-y: auto;\\n}\\n\\n.sidebar .title {\\n  text-align: center;\\n  text-transform: uppercase;\\n}\\n\\n.sidebar .workflow-list {\\n  list-style: none;\\n  margin-bottom: 0;\\n  padding: 0;\\n}\\n\\n.sidebar .workflow {\\n  border-top: 1px solid var(--border-color);\\n}\\n.sidebar .workflow.running {\\n  color: gray;\\n}\\n.sidebar .workflow.disabled .workflow-content {\\n  opacity: 0.5;\\n}\\n\\n.sidebar .workflow header {\\n  display: flex;\\n  align-items: center;\\n  padding: 1rem;\\n}\\n\\n.sidebar .workflow .name {\\n  flex: 1;\\n  margin: 0 0.5rem;\\n  font-size: 1.4rem;\\n  font-family: monospace;\\n  text-transform: uppercase;\\n  font-weight: normal;\\n}\\n\\n.sidebar .action {\\n  appearance: none;\\n  background: none;\\n  border: none;\\n  outline: none;\\n  margin: 0;\\n  padding: 3px;\\n  color: var(--control-color);\\n  font-size: 0.9rem;\\n  transition: opacity 0.1s ease-in-out;\\n  text-align: center;\\n  opacity: 0.8;\\n}\\n.sidebar .action:hover {\\n  opacity: 1;\\n}\\n.sidebar .action:active {\\n  opacity: 0.5;\\n}\\n\\n.sidebar .workflow .triggers:not(:empty) {\\n  max-height: 25vh;\\n  overflow-y: auto;\\n  list-style: square;\\n  border-top: 1px solid var(--border-color);\\n}\\n\\n.sidebar .workflow .trigger {\\n  display: flex;\\n  flex-direction: column;\\n}\\n\\n.sidebar .workflow .pattern {\\n  white-space: nowrap;\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n}\\n\\n.sidebar .workflow .pattern.blink {\\n  animation: highlight 0.3s linear;\\n}\\n\\n.sidebar .action.enable-control:hover i:first-child,\\n.sidebar .action.enable-control:not(:hover) i:last-child,\\n.sidebar .workflow.running .run,\\n.sidebar .workflow:not(.running) .stop,\\n.sidebar .workflow:not(.expanded) .triggers {\\n  display: none;\\n}\\n\\n@keyframes highlight {\\n  0% {\\n    background-color: transparent;\\n    color: inherit;\\n  }\\n  10% {\\n    background-color: #aa0000;\\n    color: #ffffff;\\n  }\\n  100% {\\n    background-color: transparent;\\n    color: inherit;\\n  }\\n}\\n\\n/* HAMBURGER */\\n\\n.hamburger {\\n  display: inline-block;\\n  position: absolute;\\n  top: 24px;\\n  right: 40px;\\n  z-index: 1;\\n  -webkit-user-select: none;\\n  user-select: none;\\n}\\n\\n.hamburger input {\\n  display: block;\\n  width: 40px;\\n  height: 32px;\\n  position: absolute;\\n  top: -7px;\\n  left: -5px;\\n  cursor: pointer;\\n  opacity: 0; /* hide this */\\n  z-index: 2; /* and place it over the hamburger */\\n  -webkit-touch-callout: none;\\n}\\n\\n.hamburger span {\\n  display: block;\\n  width: 33px;\\n  height: 4px;\\n  margin-bottom: 5px;\\n  position: relative;\\n  background: #cdcdcd;\\n  border-radius: 3px;\\n  z-index: 1;\\n  transform-origin: center right;\\n  transition: transform 0.5s cubic-bezier(0.77, 0.2, 0.05, 1),\\n    background 0.5s cubic-bezier(0.77, 0.2, 0.05, 1), opacity 0.55s ease;\\n}\\n\\n/*\\n * Transform all the slices of hamburger\\n * into a crossmark.\\n */\\n.hamburger input:checked ~ span:nth-of-type(2) {\\n  opacity: 0;\\n  transform: rotate(0deg) scale(0.2, 0.2);\\n}\\n\\n.hamburger input:checked ~ span:first-of-type {\\n  transform: rotate(-45deg) translate(0, -4px);\\n}\\n\\n.hamburger input:checked ~ span:last-of-type {\\n  transform: rotate(45deg) translate(0, 4px);\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","export function singleExecution<Return>(fn: () => PromiseLike<Return>) {\n  let running: PromiseLike<Return> | null = null;\n\n  return () => {\n    if (running) {\n      return running;\n    }\n\n    running = fn().then(x => {\n      running = null;\n      return x;\n    });\n\n    return running;\n  };\n}\n","import { emitter } from '@amatiasq/emitter';\n\nimport { createPlugin } from '../lib/createPlugin';\nimport { concatRegexes } from '../lib/util/concatRegexes';\nimport { int, toInt } from '../lib/util/int';\n\nconst PROMPT = [\n  '&W<',\n  '&R%h/%Hhp ',\n  '&C%m/%Mm ',\n  '&G%v/%Vmv ',\n  '&P%Xxp ',\n  '&Y%gg ',\n  '&W&0%d',\n  '&W> ',\n  '&W%A ',\n  '\\n',\n].join('');\n\nconst FPROMPT = PROMPT.replace('&W>', ' &R%E&W>');\n\nconst captureProgress = (name: string) =>\n  concatRegexes(int(`${name}Curr`), '/', int(`${name}Total`), `${name} `);\n\n// prettier-ignore\nexport const PROMPT_DETECTOR = concatRegexes(\n  /</,\n  captureProgress('hp'),\n  captureProgress('m'),\n  captureProgress('mv'),\n  int('exp'), /xp /,\n  int('gold'), /g /,\n  int('favor'),\n  /( \\((?<enemy>\\d+)%\\))?/,\n  /> (?<invis>I)?/,\n);\n\nclass Stat {\n  total = 0;\n  current = 0;\n\n  get percent() {\n    const result = this.total ? (1 / this.total) * this.current : 0;\n    return Math.round(result * 100) / 100;\n  }\n}\n\nconst stats = {\n  hp: new Stat(),\n  mana: new Stat(),\n  mv: new Stat(),\n  exp: 0,\n  gold: 0,\n  enemy: null as number | null,\n\n  get isFighting() {\n    return stats.enemy !== null;\n  },\n};\n\ntype Stats = typeof stats;\n\nexport const promptPlugin = createPlugin(\n  ({ when, write }) => {\n    let isInvisible = false;\n    const update = emitter<typeof stats>();\n\n    when(PROMPT_DETECTOR)\n      .timeout(1)\n      .catch(setPrompt)\n      .finally(() => {\n        when(PROMPT_DETECTOR, ({ groups: g }) => {\n          stats.hp.current = toInt(g.hpCurr);\n          stats.hp.total = toInt(g.hpTotal);\n          stats.mana.current = toInt(g.mCurr);\n          stats.mana.total = toInt(g.mTotal);\n          stats.mv.current = toInt(g.mvCurr);\n          stats.mv.total = toInt(g.mvTotal);\n          stats.exp = toInt(g.exp);\n          stats.gold = toInt(g.gold);\n          stats.enemy = g.enemy ? toInt(g.enemy) : null;\n          isInvisible = Boolean(g.invis);\n          update(stats);\n        });\n      });\n\n    return {\n      getIsInvisible: () => isInvisible,\n      onUpdate: update.subscribe,\n    };\n\n    function setPrompt() {\n      write(`prompt ${PROMPT}`);\n      write(`fprompt ${FPROMPT}`);\n    }\n  },\n  ({ getIsInvisible, onUpdate }) =>\n    ({ when }) => {\n      return {\n        getPercent,\n        getValue,\n        until,\n        whenFresh,\n        onUpdate,\n\n        get isFighting() {\n          return stats.isFighting;\n        },\n\n        get isInvisible() {\n          return getIsInvisible();\n        },\n      };\n\n      function whenFresh() {\n        return until(stats => {\n          console.log(\n            stats.hp.percent,\n            stats.mana.percent,\n            stats.mv.percent,\n            stats.hp.percent === 1 &&\n              stats.mana.percent === 1 &&\n              stats.mv.percent === 1,\n          );\n          return (\n            stats.hp.percent === 1 &&\n            stats.mana.percent === 1 &&\n            stats.mv.percent === 1\n          );\n        });\n      }\n\n      function getPercent(stat: 'hp' | 'mana' | 'mv') {\n        return stats[stat].percent;\n      }\n\n      function getValue(stat: 'gold' | 'exp'): number;\n      function getValue(stat: 'enemy'): number | null;\n      function getValue(stat: 'gold' | 'exp' | 'enemy') {\n        return stats[stat];\n      }\n\n      function until(predicate?: (stats: Stats) => boolean) {\n        if (!predicate) {\n          return when(PROMPT_DETECTOR);\n        }\n\n        if (predicate(stats)) {\n          return Promise.resolve(true);\n        }\n\n        return new Promise(resolve => {\n          const unsubscribe = onUpdate((stats: Stats) => {\n            if (predicate(stats)) {\n              unsubscribe();\n              resolve(stats);\n            }\n          });\n        });\n      }\n    },\n);\n","import { BasicContext } from '../lib/context/BasicContextCreator';\n\nexport function conversation(\n  when: BasicContext['when'],\n  write: BasicContext['write'],\n) {\n  return async (questions: Record<string, string>) => {\n    for (const [question, answer] of Object.entries(questions)) {\n      await when(question);\n      write(answer);\n    }\n  };\n}\n","import { ClientStorage } from '@amatiasq/client-storage';\n\nexport function getPassword(user: string) {\n  const storage = new ClientStorage<string>(`pass:${user}`);\n  const stored = storage.get();\n\n  if (stored) {\n    return stored;\n  }\n\n  const input = prompt(`Password for ${user}`);\n\n  if (!input) {\n    throw new Error(`Password required`);\n  }\n\n  storage.set(input);\n  return input;\n}\n","import { emitter } from '@amatiasq/emitter';\n\nimport { Mud } from '../Mud';\nimport { Pattern } from '../triggers/Pattern';\nimport { PatternMatcher } from '../triggers/PatternMatcher';\nimport { PatternOptions } from '../triggers/PatternOptions';\nimport { PatternResult } from '../triggers/PatternResult';\nimport { PatternSubscription } from '../triggers/PatternSubscription';\nimport { TriggerCollection } from '../triggers/TriggerCollection';\nimport { CancellablePromise } from '../util/CancellablePromise';\nimport { wait } from '../util/wait';\nimport { WriteOptions } from '../WriteOptions';\n\nexport type BasicContext = ReturnType<BasicContextCreator['createInstance']>;\n\nexport class BasicContextCreator {\n  private readonly dispositions = new Map<\n    BasicContext,\n    (data: void) => boolean\n  >();\n\n  private readonly emitInstanceAborted = emitter<BasicContext>();\n  readonly onInstanceAborted = this.emitInstanceAborted.subscribe;\n\n  private readonly emitInstanceDisposed = emitter<BasicContext>();\n  readonly onInstanceDisposed = this.emitInstanceDisposed.subscribe;\n\n  get triggerList() {\n    return this.triggers.list;\n  }\n\n  constructor(\n    private readonly triggers: TriggerCollection,\n    private readonly send: Mud['send'],\n  ) {}\n\n  onTriggersChange(listener: (list: PatternMatcher[]) => void) {\n    return this.triggers.onChange(listener);\n  }\n\n  createInstance(name: string) {\n    const { checkNotAborted, send, triggers } = this;\n    const dispose = emitter<void>();\n    const subscriptions: PatternSubscription[] = [];\n    let isPrintingLogs = false;\n    let isAborted = false;\n\n    const context = {\n      get name() {\n        return name;\n      },\n      get isAborted() {\n        return isAborted;\n      },\n      get isPrintingLogs() {\n        return isPrintingLogs;\n      },\n      get printLogs() {\n        return (isPrintingLogs = true);\n      },\n\n      onDispose: dispose.subscribe,\n      send,\n      log,\n      when: Object.assign(when, { any: whenAny }),\n\n      sleep: (seconds: number) => {\n        checkNotAborted(context);\n        log('[SLEEP]', seconds);\n        return wait(seconds);\n      },\n\n      abort: () => {\n        if (isAborted) return;\n        isAborted = true;\n        this.emitInstanceAborted(context);\n      },\n\n      write: (command: string, options?: WriteOptions) => {\n        checkNotAborted(context);\n        log(`[WRITE]`, command);\n        send(command, options);\n      },\n    };\n\n    dispose.subscribe(() => subscriptions.forEach(x => x.unsubscribe()));\n    this.dispositions.set(context, dispose);\n    return context;\n\n    function log(...args: Parameters<Console['log']>) {\n      checkNotAborted(context);\n\n      if (isPrintingLogs) {\n        console.log(`[${name}]`, ...args);\n      }\n    }\n\n    async function whenAny(\n      ...watchers: (PatternSubscription | CancellablePromise<any>)[]\n    ) {\n      const result = await Promise.any(watchers);\n      watchers.forEach(x =>\n        x instanceof CancellablePromise ? x.cancel() : x.unsubscribe(),\n      );\n      return result;\n    }\n\n    function when(\n      pattern: Pattern,\n      options?: PatternOptions,\n    ): PatternSubscription;\n    function when(\n      pattern: Pattern,\n      handler: (result: PatternResult) => void,\n      options?: PatternOptions,\n    ): PatternSubscription;\n    function when(\n      pattern: Pattern,\n      handler?: ((result: PatternResult) => void) | PatternOptions,\n      options?: PatternOptions,\n    ) {\n      checkNotAborted(context);\n      log('[WATCH]', pattern, options);\n\n      if (typeof handler !== 'function' && arguments.length > 1) {\n        options = handler;\n        handler = undefined;\n      }\n\n      if (isPrintingLogs) {\n        if (options && (options as any).logger) {\n          throw new Error('run after not supported');\n        }\n\n        options = Object.assign(\n          {\n            logger: [\n              ({ patterns, ...rest }: PatternResult) =>\n                log('[TRIG GERED]', ...patterns, rest),\n            ],\n          },\n          options,\n        );\n      }\n\n      const subscription =\n        typeof handler === 'function'\n          ? triggers.add(pattern, handler, options)\n          : triggers.add(pattern, options);\n\n      subscriptions.push(subscription);\n      return subscription;\n    }\n  }\n\n  dispose(context: BasicContext) {\n    const dispose = this.dispositions.get(context);\n\n    if (!dispose) {\n      throw new Error(`Can't dispose context: ${context.name}`);\n    }\n\n    this.dispositions.delete(context);\n    dispose();\n    this.emitInstanceDisposed(context);\n  }\n\n  protected checkNotAborted(context: BasicContext) {\n    if (context.isAborted) {\n      throw new Error(`[${context.name}] Workflow aborted.`);\n    }\n  }\n}\n","import { CancellablePromise } from './CancellablePromise';\n\nexport function wait(seconds: number) {\n  let timer: number;\n\n  const promise = new CancellablePromise<void>(resolve => {\n    timer = setTimeout(resolve, seconds * 1000);\n  });\n\n  promise.onCancel(() => clearTimeout(timer));\n\n  return promise;\n}\n","import ALL_AREAS from './areas.json';\n\ntype AreaBase = typeof ALL_AREAS[number];\ntype Arena = string | string[];\n\nexport type Realm = AreaBase['realm'];\nexport type AreaName = AreaBase['name'];\nexport type Area = AreaBase & { path?: string; arena?: Arena };\n\nconst sides = 'e2we';\n\nconst ARENAS: Partial<Record<AreaName, Arena>> = {\n  // cadaver: { path: 'ru2sw'},\n  'Academia de Darkhaven': ['Xse', 'Xne', 'Xse', 'Xne', 'Xs'],\n  'El Gran Estadio': 'j',\n  'El Imperio Orco': [\n    `4n${sides}n`, // planta principal\n    `ds${sides}s${sides}s${sides}s${sides}Xnu`, // sotano\n    'uXs', // primer piso\n    `un${sides}n${sides}Xs`, // segundo piso\n    `un${sides}n${sides}nXsejk2whlen`, // tercer piso\n    `u3n${sides}2nXs`, // cuarto piso\n    `Xnu2s${sides}2ndXs`, // `Xnu2s${x}s3ndXs`, // cuarto piso parte 2 - we skip El Jefe\n    `un${sides}n${sides}n${sides}n${sides}Xs`, // quinto piso\n    `un${sides}n${sides}Xs`, // sexto piso\n    'uns', // uXnXs', // septimo piso // cerrado con llave\n    `un${sides}n${sides}2n`, // octavo piso\n    'u', // techo\n  ],\n  'El Pantano Orco': [\n    'wn2w',\n    'n3esje4n4sw',\n    '4nw3sw3nw3sw3nd',\n    '3es3w3es3w',\n    // 'Xs' // cerrado\n  ],\n  'La Mansion de Marmol': [\n    'e2n', // entrada\n    'n2d', // sotano\n    [\n      '3n3s',\n      '3e3w', // prisionera\n      '3w3e', // engendro\n      '3s3n',\n      '2us', // salir sotano\n    ].join(''),\n    '2e2w',\n    '4w4e',\n    '2unu', // Kivon & Nejane\n  ],\n  'Los Usurpadores de Hochenyana': [\n    'n3w', // esquina noroeste\n    'ensen2sne', // calle mayor\n    'en2snense', // esquina noreste\n    `ws${sides}e2sn`, // esquina surestes\n    'wn2sn2wn2sn2w', // esquina suroeste\n    `en${sides}e2sn2e`, // centro sur\n    '2sws2wu', // oficinal del alcalde\n    '2en2es2e4snwe3n2wnw', //uudd',\n    '4s', // `4senenswn${sides}n3sw`, // Biblioteca de Hochenyana\n    `2s${'' && sides}s2e4w2es`, // s\n  ],\n  'La tumba de Damara': [\n    'nnwes', // despensa\n    'esn', // la prision\n    '2ln',\n  ],\n};\n\nexport function getAreasForLevel(realm: Realm, level: number) {\n  return (\n    ALL_AREAS.filter(x => x.realm === realm && x.from <= level && x.to >= level)\n      .sort((a, b) => a.to - b.to)\n      // .sort((a, b) => avg(a, level) - avg(b, level))\n      .map(getWithMetadata)\n  );\n\n  // function avg(area: AreaBase, level: number) {\n  //   return Math.abs(level - area.from + (level - area.to));\n  // }\n}\n\nexport function getAreaMetadata(areaName: string) {\n  const lower = areaName.toLowerCase();\n  const [first, ...candidates] = ALL_AREAS.filter(x =>\n    x.name.toLocaleLowerCase().includes(lower),\n  );\n\n  if (candidates.length) {\n    console.warn(\n      `Many areas detected for ${areaName}:\\n- ${[first, ...candidates]\n        .map(x => x.name)\n        .join('\\n- ')}`,\n    );\n  }\n\n  return first && getWithMetadata(first);\n}\n\nfunction getWithMetadata(area: AreaBase): Area {\n  if (area.name in ARENAS) {\n    return { ...area, arena: ARENAS[area.name] };\n  }\n\n  return area;\n}\n","import { emitter } from '@amatiasq/emitter';\n\nimport { Mud } from './lib/Mud';\nimport { Workflow } from './lib/workflow/Workflow';\nimport { ControlProps } from './ui/Controls';\nimport { SidebarProps } from './ui/Sidebar';\n\nconst listening = new WeakMap<Workflow, true>();\n\nconst emitStateChange = emitter<void>();\nexport const onStateChange = emitStateChange.subscribe;\n\nexport function bindViewTo(mud: Mud) {\n  mud.onWorkflowsChange(x => {\n    workflows = x.sort((a, b) => (a.name < b.name ? -1 : 1));\n    workflows.forEach(workflow => {\n      if (listening.has(workflow)) return;\n      listening.set(workflow, true);\n      workflow.onChange(() => emitStateChange());\n    });\n\n    emitStateChange();\n  });\n\n  mud.getPlugin('prompt').onUpdate(x => {\n    hp = x.hp.percent;\n    mana = x.mana.percent;\n    mv = x.mv.percent;\n    emitStateChange();\n  });\n}\n\nlet hp = 1;\nlet mana = 1;\nlet mv = 1;\n\nexport function getControlsProps(): ControlProps {\n  return {\n    buttons: [],\n    meters: [\n      { color: '550000', value: hp },\n      { color: '000055', value: mana },\n      { color: '005500', value: mv },\n    ],\n  };\n}\n\nlet workflows: Workflow[] = [];\n\nexport function getSidebarProps(): SidebarProps {\n  return { workflows };\n}\n","import { DEFAULT_PORT } from '../../config.json';\nimport { Mud } from './lib/Mud';\nimport { RemoteTelnet } from './lib/RemoteTelnet';\nimport { registerWorkflows } from './registerWorkflows';\nimport { bindViewTo } from './state';\nimport { renderUserInterface } from './ui';\nimport { getPassword } from './util/getPassword';\nimport { getQueryParams } from './util/getQueryParams';\n\nlet FORCE_PROD_SERVER = false;\n// FORCE_PROD_SERVER = true;\n\nconst serverUri = getSocketUri();\nconst { host, port, user, pass } = getParams();\nconst terminal = renderUserInterface(document.body);\n\nopenSocket();\n\nwindow.addEventListener('unhandledrejection', event => {\n  const error = event.reason as Error;\n\n  if ((error as any) === 'aborted') {\n    event.preventDefault();\n  }\n\n  if (error && error.message && error.message.startsWith('Timeout: ')) {\n    event.preventDefault();\n    console.warn(error.message);\n  }\n});\n\nfunction openSocket() {\n  const socket = new WebSocket(serverUri);\n\n  // socket.addEventListener('close', openSocket);\n  socket.addEventListener('open', () => {\n    const telnet = new RemoteTelnet(socket);\n\n    telnet.connect(host, port);\n    terminal.write(`Connecting to ${host}:${port} as ${user}\\n`);\n\n    initializeMud(telnet);\n  });\n}\n\nasync function initializeMud(telnet: RemoteTelnet) {\n  const mud = new Mud(telnet);\n\n  mud.onCommand(x => terminal.write(`${x}\\n`));\n  telnet.onData(data => terminal.write(data));\n  terminal.onSubmit(onUserInput);\n\n  window.onbeforeunload = () => {\n    if (telnet.isConnected) {\n      telnet.send('abandonar');\n    }\n\n    telnet.close();\n  };\n\n  mud.registerHandler('!', command => {\n    const [workflow, ...args] = command.split(/\\s+/);\n\n    if (workflow === 'stop') {\n      mud.stopAll();\n    } else {\n      runWorkflow(workflow, args);\n    }\n  });\n\n  mud.registerHandler('#', command => {\n    const [trigger, action, permanent] = command.split(/#/).map(x => x.trim());\n    const name = `#${trigger}${permanent}`;\n    const run = () => onUserInput(action);\n\n    if (permanent != null) {\n      mud.daemon(name, ({ when, printLogs }) => when(trigger, run));\n    } else {\n      mud.runOnce(name, ({ when, printLogs }) => when(trigger).then(run));\n    }\n\n    terminal.write(`WHEN: ${trigger}\\nRUN: ${action}\\n`);\n  });\n\n  await mud.login(user, pass);\n\n  bindViewTo(mud);\n\n  // if (user === 'may') {\n  registerWorkflows(mud);\n  // }\n\n  Object.assign(window, { mud });\n\n  function onUserInput(command: string) {\n    terminal.write(`${command}\\n`);\n\n    if (mud.userInput(command)) {\n      telnet.send(command);\n    }\n  }\n\n  function runWorkflow(name: string, args: string[]) {\n    const cmd = `\"${name}\" with \"${args.join(' ')}\"`;\n    terminal.write(`-> Running ${cmd}\\n`);\n\n    mud\n      .getWorkflow(name)\n      .execute(...args)\n      .then(\n        x => terminal.write(`\\n<- Done ${cmd}: ${x}\\n`),\n        x => terminal.write(`\\n\\n<! FAILED ${cmd}: ${x.message}\\n\\n`),\n      );\n  }\n}\n\nfunction getSocketUri() {\n  const prodClients = [\n    'https://amatiasq.github.io',\n    'https://mudos.amatiasq.com',\n  ];\n\n  return prodClients.includes(location.origin) || FORCE_PROD_SERVER\n    ? 'wss://mudos.amatiasq.com/connect'\n    : `ws://localhost:${DEFAULT_PORT}`;\n}\n\nfunction getParams() {\n  const { user, server } = getQueryParams();\n  const [host, port] = (server || 'mud.balzhur.org:5400').split(':');\n  const pass = getPassword(user);\n  return { host, port: parseInt(port, 10), user, pass };\n}\n","import { emitter } from '@amatiasq/emitter';\n\nimport {\n  BindedPluginMap,\n  initializePlugins,\n  PluginMap,\n} from '../plugins/index';\nimport { login } from '../plugins/login';\nimport { BasicContextCreator } from './context/BasicContextCreator';\nimport {\n  WorkflowContext,\n  WorkflowContextCreator,\n} from './context/WorkflowContextCreator';\nimport { RemoteTelnet } from './RemoteTelnet';\nimport { RootTriggerCollection } from './triggers/RootTriggerCollection';\nimport { Workflow } from './workflow/Workflow';\nimport { WorkflowFn } from './workflow/WorkflowFn';\nimport { WriteOptions } from './WriteOptions';\n\nexport class Mud {\n  private readonly triggers = new RootTriggerCollection();\n  private readonly workflows = new Map<string, Workflow>();\n  private readonly contextCreator = new BasicContextCreator(\n    this.triggers,\n    this.send.bind(this),\n  );\n\n  private readonly handlers: {\n    id: string;\n    handler: (command: string) => void | true;\n  }[] = [];\n\n  private plugins!: PluginMap;\n  // private username!: string;\n\n  private readonly emitCommand = emitter<string>();\n  readonly onCommand = this.emitCommand.subscribe;\n\n  private readonly emitWorkflowsChange = emitter<Workflow[]>();\n  readonly onWorkflowsChange = this.emitWorkflowsChange.subscribe;\n\n  private emitLoggedIn!: (usernamne: string) => void;\n  readonly whenLoggedIn = new Promise(resolve => (this.emitLoggedIn = resolve));\n\n  constructor(private readonly telnet: RemoteTelnet) {\n    this.telnet.onData(x => this.triggers.process(removeNoise(x)));\n  }\n\n  async login(user: string, pass: string) {\n    const context = this.contextCreator.createInstance('login');\n\n    await login(context, user, pass, async () => {\n      this.plugins = await initializePlugins(\n        this.contextCreator.createInstance.bind(this.contextCreator),\n      );\n    });\n\n    this.contextCreator.dispose(context);\n    // this.username = user;\n    this.emitLoggedIn(user);\n  }\n\n  send(text: string, options: WriteOptions = {}) {\n    this.emitCommand(options.password ? '*'.repeat(text.length) : text);\n    this.telnet.send(text);\n  }\n\n  // User input\n\n  userInput(command: string): boolean {\n    const x = this.handlers.find(x => command.startsWith(x.id));\n    return Boolean(!x || x.handler(command.substr(x.id.length)));\n  }\n\n  registerHandler(\n    identifier: string,\n    handler: (command: string) => void | true,\n  ) {\n    this.handlers.push({ id: identifier, handler });\n  }\n\n  // Plugins\n\n  getPlugin<Name extends keyof BindedPluginMap>(name: Name) {\n    const creator = this.plugins[name];\n    const context = this.contextCreator.createInstance(name);\n    return creator(context) as BindedPluginMap[Name];\n  }\n\n  // Daemons\n\n  daemon(name: string, run: WorkflowFn<[]>) {\n    this.runOnce(name, async (context: WorkflowContext) => {\n      await run(context);\n      return context.runForever();\n    });\n  }\n\n  // Workflows\n\n  workflow(name: string, run: WorkflowFn<any[]>) {\n    const workflow = new Workflow(name, run, this.createContextCreator());\n    this.workflows.set(workflow.name, workflow);\n    this.emitWorkflowsChange([...this.workflows.values()]);\n    return workflow;\n  }\n\n  runOnce(name: string, run: WorkflowFn<[]>) {\n    return new Workflow(name, run, this.createContextCreator()).execute();\n  }\n\n  stopAll() {\n    for (const [, workflow] of this.workflows) {\n      workflow.stop();\n    }\n  }\n\n  getWorkflow(workflowOrName: Workflow | string) {\n    if (workflowOrName instanceof Workflow) {\n      return workflowOrName;\n    }\n\n    if (!this.workflows.has(workflowOrName)) {\n      throw new Error(`Workflow \"${workflowOrName}\" is not registered.`);\n    }\n\n    return this.workflows.get(workflowOrName)!;\n  }\n\n  private createContextCreator() {\n    return new WorkflowContextCreator(\n      this,\n      this.triggers.createChild(),\n      this.plugins,\n    );\n  }\n}\n\nfunction removeNoise(text: string) {\n  return removeAsciiCodes(text).replace(/\\r/g, '');\n}\n\nlet stored = '';\n\nfunction removeAsciiCodes(text: string) {\n  if (stored) {\n    text = `${stored}${text}`;\n    stored = '';\n  }\n\n  const match = text.match(/\\u001b[^m]*?$/);\n\n  if (match) {\n    stored = match[0];\n    text = text.substr(0, text.length - stored.length);\n  }\n\n  return text.replace(/\\u001b\\[[^m]*?m/g, '');\n}\n","import { BasicContext } from '../lib/context/BasicContextCreator';\nimport { chatPlugin } from './chatPlugin';\nimport { inventoryPlugin } from './inventoryPlugin';\nimport { navigationPlugin } from './navigationPlugin';\nimport { promptPlugin } from './promptPlugin';\nimport { skillsPlugin } from './skillsPlugin';\nimport { statsPlugin } from './statsPlugin';\n\nconst plugins = {\n  chat: chatPlugin,\n  inventory: inventoryPlugin,\n  navigation: navigationPlugin,\n  prompt: promptPlugin,\n  skills: skillsPlugin,\n  stats: statsPlugin,\n} as const;\n\n// -- Dirty implementation\n\ntype plugins = typeof plugins;\ntype UnPromisify<T> = T extends PromiseLike<infer U> ? U : T;\n\nexport type PluginMap = {\n  [name in keyof plugins]: UnPromisify<ReturnType<plugins[name]>>;\n};\n\nexport type BindedPluginMap = {\n  [name in keyof PluginMap]: UnPromisify<ReturnType<PluginMap[name]>>;\n};\n\nexport async function initializePlugins(\n  context: (name: string) => BasicContext,\n) {\n  const promises = Object.entries(plugins).map(async ([name, plugin]) => [\n    name,\n    await plugin(context(name)),\n  ]);\n\n  const entries = await Promise.all(promises);\n  return Object.fromEntries(entries) as PluginMap;\n}\n","import { ClientStorage } from '@amatiasq/client-storage';\n\nimport { createPlugin } from '../lib/createPlugin';\nimport { PatternResult } from '../lib/triggers/PatternResult';\nimport { datetime, DateTime } from '../lib/util/dateTime';\nimport { requestNotificationPermission } from '../lib/util/requestNotificationPermission';\n\ntype Message = [DateTime, string, string, string];\ntype History = ClientStorage<Message[]>;\n\nconst beepAudio = new Audio(\n  'data:audio/wav;base64,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qJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=',\n);\n\nconst version = { version: 2 };\nconst date = () =>\n  new Date()\n    .toISOString()\n    .replace('T', ' ')\n    .replace(/\\.\\d\\d\\dZ/, '');\n\nconst receive =\n  (log: History, type: string) =>\n  ({ groups: { name, message } }: PatternResult) => {\n    console.log(`MESSAGE [${type}] ${date()} => ${name} =>`, message);\n    addMessage(log, { from: name, message });\n\n    if (!name.startsWith('[Orden')) {\n      notify(`${name}: ${message}`);\n    }\n  };\n\nconst sent =\n  (log: History, type: string) =>\n  ({ groups: { name, message } }: PatternResult) => {\n    console.log(`SENT [${type}] ${date()} => ${name} =>`, message);\n    addMessage(log, { to: name, message });\n  };\n\nexport const chatPlugin = createPlugin(\n  ({ when, write }) => {\n    // const say = new ClientStorage<Record<string, Message[]>>('chat:say');\n    const chat = new ClientStorage<Message[]>('chat:global', version);\n    const faction = new ClientStorage<Message[]>('chat:faction', version);\n    const order = new ClientStorage<Message[]>('chat:order', version);\n    const novice = new ClientStorage<Message[]>('chat:novice', version);\n    const tell = new ClientStorage<Message[]>('chat:tell', version);\n    const whisper = new ClientStorage<Message[]>('chat:whisper', version);\n\n    (window as any).chat = (count = 0) => ({\n      global: chat.get() ? chat.get()!.slice(count) : [],\n      faction: faction.get() ? faction.get()!.slice(count) : [],\n      order: order.get() ? order.get()!.slice(count) : [],\n      novice: novice.get() ? novice.get()!.slice(count) : [],\n      tell: tell.get() ? tell.get()!.slice(count) : [],\n      whisper: whisper.get() ? whisper.get()!.slice(count) : [],\n    });\n\n    channel(\n      'General',\n      chat,\n      /(?<name>\\w+) charla '(?<message>[^']+)'/,\n      /Charlas '(?<message>[^']+)'/,\n    );\n\n    channel(\n      'Novatos',\n      novice,\n      /(?<name>\\[Novatos: [^\\]]+\\]): '(?<message>[^']+)'/,\n      /(?<name>\\[Novatos\\]): '(?<message>[^']+)'/,\n    );\n\n    channel(\n      'Order',\n      order,\n      /(?<name>\\[Orden: [^\\]]+\\]): '(?<message>[^']+)'/,\n      /(?<name>\\[Orden\\]): '(?<message>[^']+)'/,\n    );\n\n    channel(\n      'Faccion',\n      faction,\n      /(?<name>\\[Faccion: [^\\]]+\\]): '(?<message>[^']+)'/,\n      /(?<name>\\[Faccion\\]): '(?<message>[^']+)'/,\n    );\n\n    channel(\n      'Whisper',\n      whisper,\n      /(?<name>.+) te susurra '(?<message>[^']+)'/,\n      /Susurras a (?<name>.+) '(?<message>[^']+)'/,\n    );\n\n    const receiveTell = receive(tell, 'Tell');\n\n    when(\n      [\n        /(?<name>.+) te cuenta '(?<message>[^']+)'/,\n        /(?<name>.+) te responde '(?<message>[^']+)'/,\n      ],\n      result => {\n        receiveTell(result);\n        handleAutoResponses(result.groups);\n      },\n    );\n\n    when(\n      [\n        /Cuentas a (?<name>.+) '(?<message>[^']+)'/,\n        /Respondes a (?<name>.+) '(?<message>[^']+)'/,\n      ],\n      sent(tell, 'Tell'),\n    );\n\n    when(\n      /(?<name>\\w+) te ha desafiado a un combate en la arena!/,\n      ({ groups }) => notify(`[ARENA] w/ ${groups.name}`),\n    );\n\n    function channel(\n      name: string,\n      storage: History,\n      received: RegExp,\n      sentPattern: RegExp,\n    ) {\n      when(received, receive(storage, name));\n      when(sentPattern, sent(storage, name));\n    }\n\n    function handleAutoResponses({ name, message }: Record<string, string>) {\n      const tokens = {\n        re: /^porfa re(sponde(me)?)? /,\n        [`tell ${name}`]: /^porfa di(me)? /,\n        [`susurrar ${name}`]: /^porfa susurra(me)? /,\n      };\n\n      for (const [response, token] of Object.entries(tokens)) {\n        if (token.test(message)) {\n          write(`${response} ${message.replace(token, '')}`);\n        }\n      }\n    }\n  },\n  () => () => ({}),\n);\n\ntype msg = { message: string };\n\nasync function notify(content: string) {\n  beepAudio.play();\n  await requestNotificationPermission();\n  return new Notification(content);\n}\n\nfunction addMessage(log: History, partial: { from: string } & msg): Message;\nfunction addMessage(log: History, partial: { to: string } & msg): Message;\nfunction addMessage(\n  log: History,\n  partial: { from?: string; to?: string } & msg,\n): Message {\n  const message: Message = [\n    datetime(new Date()),\n    partial.from || 'me',\n    partial.to || 'me',\n    partial.message,\n  ];\n\n  log.set([...(log.get() || []), message]);\n  return message;\n}\n","const pad = (val: number) => (val < 10 ? `0${val}` : val);\n\nexport type DateTime = '[string DateTime]';\n\nexport function datetime(date: Date) {\n  const yyyy = date.getFullYear();\n  const MM = pad(date.getMonth() + 1);\n  const dd = pad(date.getDate());\n  const hh = pad(date.getHours());\n  const mm = pad(date.getMinutes());\n\n  return `${yyyy}-${MM}-${dd} ${hh}:${mm}` as DateTime;\n}\n","export function requestNotificationPermission() {\n  if (!('Notification' in window)) {\n    console.warn('This browser does not support desktop notification');\n    return;\n  }\n\n  if (Notification.permission === 'granted') {\n    return Promise.resolve(true);\n  }\n\n  if (Notification.permission === 'denied') {\n    return;\n  }\n\n  return Notification.requestPermission().then(x => x === 'granted');\n}\n","import { createPlugin } from '../lib/createPlugin';\nimport {\n  concatRegexes,\n  concatRegexesUnescaped,\n} from '../lib/util/concatRegexes';\nimport { int, toInt } from '../lib/util/int';\nimport { singleExecution } from '../lib/util/singleExecution';\n\ninterface ItemData {\n  name: string;\n  amount: number;\n  effects: string[];\n}\n\ntype ItemList = Record<string, ItemData>;\ntype ItemSearch = string | string[] | Record<string, string>;\n\nconst CONTENT = /\\n(?<content>(?:.|\\n)*)\\n[^ ]/;\nconst INVENTORY_DETECTOR = concatRegexes(/Estas llevando:/, CONTENT);\nconst ITEM_EFECTS = /(?<effects>(?:\\(\\w[^\\)]+\\w\\) )*)/;\nconst ITEM_AMOUNT = concatRegexesUnescaped('(?: \\\\(', int('amount'), '\\\\))?');\nconst ITEM_MATCHER = concatRegexes(\n  /^/,\n  ITEM_EFECTS,\n  /(?<name>\\w[^\\(\\)]*\\w)/,\n  ITEM_AMOUNT,\n  /$/,\n);\n\nexport const inventoryPlugin = createPlugin(\n  ({ when, write }) => {\n    let isInitialized = false;\n    let items: ItemList = {};\n\n    const refresh = singleExecution(async () => {\n      write('inventario');\n      await when(INVENTORY_DETECTOR);\n    });\n\n    when('No tienes ese objeto.', refresh);\n\n    when(\n      INVENTORY_DETECTOR,\n      ({ groups }) => {\n        isInitialized = true;\n        items = parseItems(groups.content);\n      },\n      { captureLength: 1000 },\n    );\n\n    return {\n      refresh,\n      parseItems,\n      ensureInitialized: () => isInitialized || refresh(),\n      getItems: () => items,\n    };\n\n    function parseItems(captured: string) {\n      const list = captured\n        .split('\\n')\n        .map(x => x.trim())\n        .filter(Boolean);\n\n      const result: ItemList = {};\n\n      for (const item of list) {\n        if (item === 'Nada.') {\n          return {};\n        }\n\n        const match = item.match(ITEM_MATCHER);\n\n        if (!match) {\n          console.error(`Can't match item \"${item}\"`);\n          continue;\n        }\n\n        const { effects, name, amount } = match.groups!;\n\n        result[name] = {\n          name,\n          amount: amount ? toInt(amount) : 1,\n          effects: effects\n            .replace(/^\\s*\\(|\\)\\s*$/g, '')\n            .split(') (')\n            .filter(Boolean),\n        };\n      }\n\n      return result;\n    }\n  },\n  ({ refresh, parseItems, ensureInitialized, getItems }) =>\n    ({ when, write }) => {\n      return {\n        refresh,\n        has,\n        hasIn,\n        hasInBackpack: hasIn.bind(null, 'mochila'),\n        getByEffect,\n      };\n\n      async function has(search: ItemSearch) {\n        await ensureInitialized();\n        return searchInList(getItems(), search);\n      }\n\n      async function getByEffect(effect: string) {\n        await ensureInitialized();\n        return Object.values(getItems()).filter(x =>\n          x.effects.includes(effect),\n        );\n      }\n\n      async function hasIn(container: string, search: ItemSearch) {\n        write(`examinar ${container}`);\n\n        const match = await when.any(\n          when('No ves eso aqui.').then(() => null),\n          when(\n            concatRegexes(/Cuando miras dentro ves:\\n.+ contiene:/, CONTENT),\n            {\n              captureLength: 1000,\n            },\n          ),\n        );\n\n        if (!match) {\n          return false;\n        }\n\n        const items = parseItems(match.groups.content);\n        console.log('IN', container, items);\n        return searchInList(items, search);\n      }\n\n      function searchInList(items: ItemList, search: ItemSearch) {\n        if (typeof search === 'string') {\n          return items[search] ? search : null;\n        }\n\n        if (Array.isArray(search)) {\n          return search.find(x => items[x]) || null;\n        }\n\n        const key = Object.keys(search).find(x => items[x]);\n        return key ? search[key] : null;\n      }\n    },\n);\n","import { emitter } from '@amatiasq/emitter';\n\nimport { Realm } from '../data/areas';\nimport { createPlugin } from '../lib/createPlugin';\nimport { CancellablePromise } from '../lib/util/CancellablePromise';\nimport { PROMPT_DETECTOR } from './promptPlugin';\n\nconst CLOSED = '(cerrada)';\nconst aliases = {\n  s: 'sur',\n  n: 'norte',\n  e: 'este',\n  w: 'oeste',\n  o: 'oeste',\n  u: 'arriba',\n  d: 'abajo',\n  l: 'sureste',\n  k: 'suroeste',\n  j: 'noreste',\n  h: 'noroeste',\n};\n\nconst recalls = [\n  /Plaza de Darkhaven\\s+/,\n  /Templo de la Justicia\\s+/,\n  /Templo de las Tinieblas\\s+/,\n];\n\nexport const navigationPlugin = createPlugin(\n  ({ when, write }) => {\n    let landingAtRecall = false;\n    let directions: string[] = [];\n    let isNavigating = false;\n    let isAtRecall = false;\n\n    const prompt = () => when(PROMPT_DETECTOR);\n    const roomChanged = emitter<string[]>();\n\n    when(recalls, () => (landingAtRecall = true));\n\n    when([/Puerta \\w+ esta cerrada./, /Puertas? esta cerrada\\./], async () => {\n      const closed = directions.find(x => x.includes(CLOSED));\n\n      if (closed) {\n        const dir = closed.replace(CLOSED, '');\n        write(`abrir ${dir}`);\n\n        const result = await when.any(\n          when('Esta cerrada con llave.').then(() => false),\n          when('Abres ').then(() => true),\n        );\n\n        if (result) {\n          write(dir);\n        }\n      }\n    });\n\n    when(/\\nSalidas: ([^\\.]+)/, async ({ captured }) => {\n      directions = captured[1].split(' ');\n      isNavigating = false;\n      isAtRecall = landingAtRecall;\n      landingAtRecall = false;\n      await prompt();\n      roomChanged(directions);\n    });\n\n    return {\n      getDirections: () => directions,\n      getIsAtRecall: () => isAtRecall,\n      getIsNavigating: () => isNavigating,\n      onRoomChange: roomChanged.subscribe,\n      prompt,\n      setIsNavigating: (value: boolean) => (isNavigating = value),\n    };\n  },\n  ({\n      getDirections,\n      getIsAtRecall,\n      getIsNavigating,\n      onRoomChange,\n      prompt,\n      setIsNavigating,\n    }) =>\n    ({ log, when, write }) => {\n      return {\n        canGo,\n        go,\n        execute,\n        getRealm,\n        recall,\n        waitForRecall,\n        onRoomChange,\n\n        get isNavigating() {\n          return getIsNavigating();\n        },\n\n        get isAtRecall() {\n          return getIsAtRecall();\n        },\n      };\n\n      async function recall() {\n        if (getIsAtRecall()) {\n          return true;\n        }\n\n        write('recall');\n        await when(recalls);\n        await prompt();\n      }\n\n      function waitForRecall() {\n        return getIsAtRecall()\n          ? new CancellablePromise(resolve => resolve())\n          : when(recalls).then();\n      }\n\n      function canGo(direction: string) {\n        return Boolean(get(direction));\n      }\n\n      function isClosed(direction: string) {\n        const dir = get(direction);\n        return dir && dir.includes(CLOSED);\n      }\n\n      async function execute(pattern: string, callback?: () => Promise<any>) {\n        if (pattern[0] === 'r') {\n          await recall();\n          pattern = pattern.substr(1);\n        }\n\n        let untilEnd = false;\n        let done = '';\n\n        for (const step of parsePath(pattern)) {\n          if (step.toUpperCase() === 'X') {\n            untilEnd = true;\n            done += '(X)';\n            continue;\n          }\n\n          if (untilEnd) {\n            while (canGo(step)) {\n              if (await move(step)) {\n                return false;\n              }\n            }\n\n            untilEnd = false;\n          } else {\n            if (await move(step)) {\n              return false;\n            }\n          }\n        }\n\n        return true;\n\n        async function move(step: string) {\n          try {\n            if (!(await go(step))) {\n              return true;\n            }\n            done += step;\n          } catch (error) {\n            throw new Error(`${error.message} - on ${pattern} - ${done}`);\n          }\n\n          if (typeof callback === 'function') {\n            const result = await callback();\n            return result === false;\n          }\n        }\n      }\n\n      async function go(direction: string) {\n        if (getIsNavigating()) {\n          throw new Error('WTF DUDE');\n        }\n\n        const dir = get(direction);\n\n        if (!dir) {\n          throw new Error(`Unknown direction '${direction}'`);\n        }\n\n        if (isClosed(direction)) {\n          write(`abrir ${direction}`);\n\n          const success = await when.any(\n            when([/Abres la puertas?\\./, /Abres la puerta \\w+\\./]).then(\n              () => true,\n            ),\n            when('Esta cerrada con llave.').then(() => false),\n          );\n\n          if (!success) {\n            log('Can\\t open door');\n            return false;\n          }\n        }\n\n        write(dir.replace(CLOSED, '').trim());\n        setIsNavigating(true);\n\n        await when('\\nSalidas:');\n        await prompt();\n\n        setIsNavigating(false);\n        return true;\n      }\n\n      async function getRealm() {\n        write('donde');\n        const result = await when(\n          /Jugadores cerca de ti en [^,]+, Reino de (?<realm>\\w+):/,\n        );\n        return result.groups.realm as Realm;\n      }\n\n      function get(direction: string) {\n        if (direction in aliases) {\n          direction = aliases[direction as keyof typeof aliases];\n        }\n\n        return getDirections().find(x => x.startsWith(direction));\n      }\n    },\n);\n\nfunction parsePath(path: string) {\n  return path.replace(/(\\d+)(\\w)/g, (_, times, dir) => dir.repeat(times));\n}\n","import {\n  Casteable,\n  getSpell,\n  SkillName,\n  Spell,\n  SPELL_ALREADY_APPLIED,\n  SPELL_FAILED,\n  SPELL_NOT_POSSIBLE,\n} from '../data/spells';\nimport { createPlugin } from '../lib/createPlugin';\nimport { CancellablePromise } from '../lib/util/CancellablePromise';\nimport { concatRegexes } from '../lib/util/concatRegexes';\nimport { int, toInt } from '../lib/util/int';\nimport { singleExecution } from '../lib/util/singleExecution';\n\n// Skill cast results\n// const TIMEOUT = 0;\nconst NOT_AVAILABLE = undefined;\nconst BUSY = null;\nconst FAILED = false;\nconst CASTED = true;\nconst ALREADY_APPLIED = 1;\n\nexport type CastSpellResult =\n  | typeof NOT_AVAILABLE\n  | typeof BUSY\n  | typeof FAILED\n  | typeof CASTED\n  | typeof ALREADY_APPLIED;\n\nexport type MeditationResult =\n  | typeof NOT_AVAILABLE\n  | typeof BUSY\n  | typeof FAILED\n  | typeof CASTED;\n\nconst SKILL = /((?:\\w+ )+)\\s+(\\d+)%/g;\nconst SKILLS_DETECTOR = concatRegexes(\n  /-+\\[(\\w+)\\]-+\\n/,\n  /(.|\\n)+/,\n  /Te quedan /,\n  int('practices'),\n  / practicas?.\\n/,\n  /Tienes /,\n  int('trainings'),\n  / entrenamientos?.\\n/,\n);\n\nexport const skillsPlugin = createPlugin(\n  ({ when, write }) => {\n    let isInitialized = false;\n    let practices = 0;\n    let trainings = 0;\n    let skills: Record<string, number> = {};\n\n    const refresh = singleExecution(() => {\n      write('practicar');\n      return when(SKILLS_DETECTOR);\n    });\n\n    when(\n      SKILLS_DETECTOR,\n      ({ captured: [content], groups }) => {\n        practices = toInt(groups.practices);\n        trainings = toInt(groups.trainings);\n\n        for (const skill of content.matchAll(SKILL)!) {\n          skills[skill[1].trim()] = parseInt(skill[2], 10);\n        }\n\n        isInitialized = true;\n      },\n      { captureLength: 5000 },\n    );\n\n    return {\n      getPractices: () => practices,\n      getTrainings: () => trainings,\n      getSkills: () => skills,\n\n      refresh,\n\n      async ensureInitiated() {\n        if (!isInitialized) {\n          await refresh();\n        }\n      },\n    };\n  },\n  ({ getPractices, getTrainings, getSkills, refresh, ensureInitiated }) =>\n    ({ when, write }) => {\n      let isSpellRunning = false;\n      let isMeditating = false;\n\n      return {\n        get practices() {\n          return ensureInitiated().then(getPractices);\n        },\n        get trainings() {\n          return ensureInitiated().then(getTrainings);\n        },\n\n        can,\n        canLearn,\n        castSpell,\n        getPractices,\n        getTrainings,\n        refresh,\n        meditate,\n        polimorfar,\n        NOT_AVAILABLE,\n        BUSY,\n        FAILED,\n        CASTED,\n        ALREADY_APPLIED,\n      };\n\n      async function can(search: SkillName | SkillName[]) {\n        await ensureInitiated();\n\n        if (typeof search === 'string') {\n          return hasSync(search) ? search : null;\n        } else {\n          return search.find(hasSync) || null;\n        }\n      }\n\n      function hasSync(name: string) {\n        return getSkills()[name];\n      }\n\n      async function canLearn(name: string) {\n        await ensureInitiated();\n        return name in getSkills();\n      }\n\n      async function meditate() {\n        if (!(await can('meditar'))) return NOT_AVAILABLE;\n        if (isSpellRunning) return BUSY;\n        if (isMeditating) return waitResponse();\n\n        isMeditating = true;\n        write('meditar');\n        return waitResponse().finally(() => (isMeditating = false));\n\n        function waitResponse() {\n          return when.any(\n            when(\n              'Meditas con total paz interior, recolectando mana del cosmos.',\n            ).then(() => CASTED),\n            when(\n              'Te pasas varios minutos en profunda concentracion, pero fallas en el intento de recolectar mana.',\n            ).then(() => FAILED),\n          );\n        }\n      }\n\n      async function castSpell(name: Casteable, args = '') {\n        const aliases = Array.isArray(name) ? name : [name];\n        const candidates = aliases.map(getSpell).filter(Boolean) as Spell[];\n\n        const learnt = await can(candidates.map(x => x.name));\n        if (!learnt) return NOT_AVAILABLE;\n\n        const spell = candidates.find(x => x.name === learnt)!;\n        const success = args ? spell.target : spell.success;\n\n        if (!success) {\n          throw new Error(\n            `Unknown response for spell \"${name}\" (${spell.name}).` +\n              (args ? ` With target \"${args}\"` : ''),\n          );\n        }\n\n        if (isSpellRunning || isMeditating) {\n          return BUSY;\n        }\n\n        const canCreateBerry = await can('crear baya');\n        isSpellRunning = true;\n        write(`conjurar \"${spell.name}\" ${args}`);\n\n        const promises: CancellablePromise<CastSpellResult>[] = [\n          when(success).then(() => CASTED),\n          // when('Falta algo...').then(() => )\n          when(SPELL_NOT_POSSIBLE).then(() => NOT_AVAILABLE),\n          when(SPELL_ALREADY_APPLIED).then(() => ALREADY_APPLIED),\n          when(SPELL_FAILED)\n            .wait(4)\n            .then(() => FAILED),\n        ];\n\n        if (spell.target) {\n          promises.push(when(spell.target).then(() => CASTED));\n        }\n\n        const result = await when.any(...promises);\n        isSpellRunning = false;\n        return result;\n      }\n\n      async function polimorfar(level: number) {\n        const options: [number, string][] = [\n          [20, 'Gato'],\n          [23, 'Aguila'],\n          [25, 'Serpiente'],\n          [30, 'Lobo'],\n          [35, 'Tortuga'],\n          [40, 'Cocodrilo'],\n          [45, 'Oso'],\n          [50, 'Pegaso'],\n          [55, 'Elem aire'],\n          [60, 'Elem tierra'],\n          [65, 'Ent'],\n        ];\n\n        const target = options\n          .reverse()\n          .find(([minLevel]) => level >= minLevel);\n        return target && castSpell('polimorfar', target[1]);\n      }\n    },\n);\n","export default [\n  {\n    level: 1,\n    type: 'Hechizo',\n    name: 'armadura',\n    minPos: 'luchando (evasivo)',\n  },\n  {\n    level: 1,\n    type: 'Hechizo',\n    name: 'causar leve',\n    minPos: 'luchando (defensivo)',\n  },\n  {\n    level: 1,\n    type: 'Habilidad',\n    name: 'carpinteria',\n    minPos: 'de pie',\n  },\n  {\n    level: 1,\n    type: 'Habilidad',\n    name: 'cocinar',\n    minPos: 'luchando (defensivo)',\n  },\n  {\n    level: 1,\n    type: 'Habilidad',\n    name: 'despellejar',\n    minPos: 'luchando (defensivo)',\n  },\n  {\n    level: 1,\n    type: 'Habilidad',\n    name: 'estilo estandar',\n  },\n  {\n    level: 1,\n    type: 'Habilidad',\n    name: 'estilo evasivo',\n  },\n  {\n    level: 1,\n    type: 'Habilidad',\n    name: 'forjar',\n    minPos: 'de pie',\n  },\n  {\n    level: 1,\n    type: 'Habilidad',\n    name: 'minar',\n    minPos: 'de pie',\n  },\n  {\n    level: 1,\n    type: 'Habilidad',\n    name: 'pescar',\n    minPos: 'de pie',\n  },\n  {\n    level: 1,\n    type: 'Habilidad',\n    name: 'talar',\n    minPos: 'de pie',\n  },\n  {\n    level: 1,\n    type: 'Habilidad',\n    name: 'tallar',\n    minPos: 'de pie',\n  },\n  {\n    level: 1,\n    type: 'Habilidad',\n    name: 'tejer',\n    minPos: 'de pie',\n  },\n  {\n    level: 1,\n    type: 'Arma',\n    name: 'armas cortas',\n  },\n  {\n    level: 1,\n    type: 'Arma',\n    name: 'armas flexibles',\n  },\n  {\n    level: 1,\n    type: 'Arma',\n    name: 'armas impacto',\n  },\n  {\n    level: 1,\n    type: 'Arma',\n    name: 'armas largas',\n  },\n  {\n    level: 1,\n    type: 'Arma',\n    name: 'garras',\n  },\n  {\n    level: 1,\n    type: 'Arma',\n    name: 'pugilismo',\n  },\n  { level: 1, type: 'Idioma', name: 'comun' },\n  { level: 1, type: 'Idioma', name: 'elfico' },\n  {\n    level: 1,\n    type: 'Idioma',\n    name: 'enano',\n  },\n  {\n    level: 1,\n    type: 'Idioma',\n    name: 'goblin',\n  },\n  {\n    level: 1,\n    type: 'Idioma',\n    name: 'ogro',\n  },\n  {\n    level: 1,\n    type: 'Idioma',\n    name: 'orco',\n  },\n  {\n    level: 1,\n    type: 'Idioma',\n    name: 'troll',\n  },\n  {\n    level: 2,\n    type: 'Hechizo',\n    name: 'crear agua',\n    minPos: 'luchando (evasivo)',\n  },\n  {\n    level: 2,\n    type: 'Hechizo',\n    name: 'curar leves',\n    minPos: 'luchando (defensivo)',\n  },\n  {\n    level: 2,\n    type: 'Hechizo',\n    name: 'luz eterna',\n    minPos: 'luchando (evasivo)',\n  },\n  {\n    level: 2,\n    type: 'Habilidad',\n    name: 'cartografia',\n    minPos: 'luchando (agresivo)',\n  },\n  {\n    level: 2,\n    type: 'Habilidad',\n    name: 'cavar',\n    minPos: 'de pie',\n  },\n  {\n    level: 3,\n    type: 'Hechizo',\n    name: 'crear comida',\n    minPos: 'luchando (evasivo)',\n  },\n  {\n    level: 3,\n    type: 'Hechizo',\n    name: 'detectar magia',\n    minPos: 'luchando (evasivo)',\n  },\n  {\n    level: 4,\n    type: 'Hechizo',\n    name: 'detectar invisible',\n    minPos: 'luchando (berserk)',\n  },\n  {\n    level: 4,\n    type: 'Hechizo',\n    name: 'fuego espectral',\n    minPos: 'luchando',\n  },\n  {\n    level: 4,\n    type: 'Habilidad',\n    name: 'montar',\n    minPos: 'de pie',\n  },\n  {\n    level: 5,\n    type: 'Hechizo',\n    name: 'bendecir',\n    minPos: 'luchando',\n  },\n  {\n    level: 5,\n    type: 'Hechizo',\n    name: 'causar grave',\n    minPos: 'luchando (agresivo)',\n  },\n  {\n    level: 5,\n    type: 'Hechizo',\n    name: 'ceguera',\n    minPos: 'luchando (berserk)',\n  },\n  {\n    level: 5,\n    type: 'Hechizo',\n    name: 'curar ceguera',\n    minPos: 'luchando',\n  },\n  {\n    level: 5,\n    type: 'Hechizo',\n    name: 'detectar maldad',\n    minPos: 'luchando (defensivo)',\n  },\n  {\n    level: 6,\n    type: 'Hechizo',\n    name: 'crear fuego',\n    minPos: 'luchando (evasivo)',\n  },\n  {\n    level: 6,\n    type: 'Hechizo',\n    name: 'flotar',\n    minPos: 'luchando',\n  },\n  {\n    level: 6,\n    type: 'Habilidad',\n    name: 'buscar',\n    minPos: 'de pie',\n  },\n  {\n    level: 6,\n    type: 'Habilidad',\n    name: 'escalar',\n    minPos: 'de pie',\n  },\n  {\n    level: 6,\n    type: 'Habilidad',\n    name: 'patada',\n    minPos: 'luchando (berserk)',\n  },\n  {\n    level: 6,\n    type: 'Habilidad',\n    name: 'primeros auxilios',\n    minPos: 'luchando (agresivo)',\n  },\n  {\n    level: 7,\n    type: 'Hechizo',\n    name: 'refrescar',\n    minPos: 'luchando',\n  },\n  {\n    level: 7,\n    type: 'Habilidad',\n    name: 'danyo incrementado',\n    minPos: 'luchando (berserk)',\n  },\n  {\n    level: 7,\n    type: 'Habilidad',\n    name: 'estilo agresivo',\n  },\n  {\n    level: 8,\n    type: 'Hechizo',\n    name: 'curar veneno',\n    minPos: 'luchando (defensivo)',\n  },\n  {\n    level: 8,\n    type: 'Hechizo',\n    name: 'detectar escondido',\n    minPos: 'de pie',\n  },\n  {\n    level: 8,\n    type: 'Hechizo',\n    name: 'detectar trampas',\n    minPos: 'de pie',\n  },\n  {\n    level: 8,\n    type: 'Hechizo',\n    name: 'terremoto',\n    minPos: 'luchando',\n  },\n  {\n    level: 9,\n    type: 'Hechizo',\n    name: 'causar critica',\n    minPos: 'luchando',\n  },\n  {\n    level: 9,\n    type: 'Hechizo',\n    name: 'conocer alineamiento',\n    minPos: 'luchando (defensivo)',\n  },\n  {\n    level: 9,\n    type: 'Hechizo',\n    name: 'misil magico',\n    minPos: 'luchando',\n  },\n  {\n    level: 9,\n    type: 'Hechizo',\n    name: 'volar',\n    minPos: 'luchando',\n  },\n  {\n    level: 10,\n    type: 'Hechizo',\n    name: 'crear baya',\n    minPos: 'ninguna',\n  },\n  {\n    level: 10,\n    type: 'Hechizo',\n    name: 'crear manantial',\n    minPos: 'luchando',\n  },\n  {\n    level: 10,\n    type: 'Hechizo',\n    name: 'curar graves',\n    minPos: 'luchando (defensivo)',\n  },\n  {\n    level: 10,\n    type: 'Hechizo',\n    name: 'invisibilidad',\n    minPos: 'de pie',\n  },\n  {\n    level: 10,\n    type: 'Hechizo',\n    name: 'invocar armadillo',\n    minPos: 'de pie',\n  },\n  {\n    level: 10,\n    type: 'Hechizo',\n    name: 'veneno',\n    minPos: 'luchando (evasivo)',\n  },\n  {\n    level: 11,\n    type: 'Hechizo',\n    name: 'niebla espectral',\n    minPos: 'de pie',\n  },\n  {\n    level: 11,\n    type: 'Hechizo',\n    name: 'proteccion',\n    minPos: 'luchando (evasivo)',\n  },\n  {\n    level: 12,\n    type: 'Hechizo',\n    name: 'curar criticas',\n    minPos: 'luchando',\n  },\n  {\n    level: 12,\n    type: 'Hechizo',\n    name: 'disipar maldad',\n    minPos: 'luchando (agresivo)',\n  },\n  {\n    level: 12,\n    type: 'Hechizo',\n    name: 'llamar rayo',\n    minPos: 'luchando',\n  },\n  {\n    level: 12,\n    type: 'Hechizo',\n    name: 'maldecir',\n    minPos: 'luchando (agresivo)',\n  },\n  {\n    level: 13,\n    type: 'Hechizo',\n    name: 'bola fuego',\n    minPos: 'luchando',\n  },\n  {\n    level: 13,\n    type: 'Hechizo',\n    name: 'control climatico',\n    minPos: 'de pie',\n  },\n  {\n    level: 13,\n    type: 'Hechizo',\n    name: 'detectar veneno',\n    minPos: 'de pie',\n  },\n  {\n    level: 13,\n    type: 'Hechizo',\n    name: 'identificar',\n    minPos: 'luchando (evasivo)',\n  },\n  {\n    level: 13,\n    type: 'Hechizo',\n    name: 'localizar objeto',\n    minPos: 'luchando (evasivo)',\n  },\n  {\n    level: 14,\n    type: 'Hechizo',\n    name: 'disipar magia',\n    minPos: 'luchando',\n  },\n  {\n    level: 14,\n    type: 'Hechizo',\n    name: 'piel robliza',\n    minPos: 'de pie',\n  },\n  {\n    level: 14,\n    type: 'Hechizo',\n    name: 'retirar invisibilidad',\n    minPos: 'de pie',\n  },\n  {\n    level: 14,\n    type: 'Hechizo',\n    name: 'saciar hambre',\n    minPos: 'luchando (evasivo)',\n  },\n  {\n    level: 15,\n    type: 'Hechizo',\n    name: 'debilitar',\n    minPos: 'luchando (agresivo)',\n  },\n  {\n    level: 15,\n    type: 'Hechizo',\n    name: 'relampago',\n    minPos: 'luchando (defensivo)',\n  },\n  {\n    level: 15,\n    type: 'Habilidad',\n    name: 'manotazo',\n    minPos: 'luchando',\n  },\n  {\n    level: 15,\n    type: 'Habilidad',\n    name: 'otear',\n    minPos: 'de pie',\n  },\n  {\n    level: 15,\n    type: 'Habilidad',\n    name: 'pisoton',\n    minPos: 'luchando (berserk)',\n  },\n  {\n    level: 15,\n    type: 'Habilidad',\n    name: 'segundo ataque',\n    minPos: 'luchando (berserk)',\n  },\n  {\n    level: 16,\n    type: 'Hechizo',\n    name: 'golpe flamigero',\n    minPos: 'luchando (defensivo)',\n  },\n  {\n    level: 16,\n    type: 'Habilidad',\n    name: 'meditar',\n    minPos: 'descansando',\n  },\n  {\n    level: 17,\n    type: 'Hechizo',\n    name: 'causar fatales',\n    minPos: 'luchando (agresivo)',\n  },\n  {\n    level: 17,\n    type: 'Hechizo',\n    name: 'retirar maldicion',\n    minPos: 'luchando (evasivo)',\n  },\n  {\n    level: 17,\n    type: 'Hechizo',\n    name: 'sonyar',\n    minPos: 'de pie',\n  },\n  {\n    level: 17,\n    type: 'Hechizo',\n    name: 'vista distancia',\n    minPos: 'luchando',\n  },\n  {\n    level: 17,\n    type: 'Habilidad',\n    name: 'estilo defensivo',\n  },\n  {\n    level: 17,\n    type: 'Habilidad',\n    name: 'sigilo',\n    minPos: 'de pie',\n  },\n  {\n    level: 18,\n    type: 'Hechizo',\n    name: 'agarron impactante',\n    minPos: 'luchando (berserk)',\n  },\n  {\n    level: 18,\n    type: 'Hechizo',\n    name: 'respiracion acuatica',\n    minPos: 'de pie',\n  },\n  {\n    level: 18,\n    type: 'Hechizo',\n    name: 'retirar trampa',\n    minPos: 'de pie',\n  },\n  {\n    level: 19,\n    type: 'Hechizo',\n    name: 'sanar',\n    minPos: 'luchando (agresivo)',\n  },\n  {\n    level: 20,\n    type: 'Hechizo',\n    name: 'fuerza vampirica',\n    minPos: 'luchando',\n  },\n  {\n    level: 20,\n    type: 'Hechizo',\n    name: 'invisibilidad grupo',\n    minPos: 'de pie',\n  },\n  {\n    level: 20,\n    type: 'Hechizo',\n    name: 'invocar lince',\n    minPos: 'de pie',\n  },\n  {\n    level: 20,\n    type: 'Hechizo',\n    name: 'invocar regreso',\n    minPos: 'descansando',\n  },\n  {\n    level: 20,\n    type: 'Hechizo',\n    name: 'polimorfar',\n    minPos: 'luchando (evasivo)',\n  },\n  {\n    level: 20,\n    type: 'Habilidad',\n    name: 'rescatar',\n    minPos: 'luchando (berserk)',\n  },\n  {\n    level: 21,\n    type: 'Habilidad',\n    name: 'desarmar',\n    minPos: 'luchando (agresivo)',\n  },\n  {\n    level: 22,\n    type: 'Hechizo',\n    name: 'rayo solar',\n    minPos: 'luchando (berserk)',\n  },\n  {\n    level: 24,\n    type: 'Hechizo',\n    name: 'atravesar puerta',\n    minPos: 'luchando (evasivo)',\n  },\n  {\n    level: 24,\n    type: 'Hechizo',\n    name: 'furia naturaleza',\n    minPos: 'ninguna',\n  },\n  {\n    level: 25,\n    type: 'Hechizo',\n    name: 'escudo hielo',\n    minPos: 'de pie',\n  },\n  {\n    level: 26,\n    type: 'Habilidad',\n    name: 'esquivar',\n    minPos: 'luchando (agresivo)',\n  },\n  {\n    level: 28,\n    type: 'Habilidad',\n    name: 'estilo berserk',\n    minPos: 'luchando (defensivo)',\n  },\n  {\n    level: 30,\n    type: 'Hechizo',\n    name: 'encantar arma',\n    minPos: 'de pie',\n  },\n  {\n    level: 30,\n    type: 'Hechizo',\n    name: 'invocar aguila',\n    minPos: 'de pie',\n  },\n  {\n    level: 30,\n    type: 'Hechizo',\n    name: 'santuario',\n    minPos: 'de pie',\n  },\n  {\n    level: 30,\n    type: 'Habilidad',\n    name: 'tercer ataque',\n    minPos: 'luchando (berserk)',\n  },\n  {\n    level: 31,\n    type: 'Hechizo',\n    name: 'viajar',\n    minPos: 'de pie',\n  },\n  {\n    level: 32,\n    type: 'Hechizo',\n    name: 'relentizar',\n    minPos: 'luchando',\n  },\n  {\n    level: 34,\n    type: 'Hechizo',\n    name: 'dormir',\n    minPos: 'de pie',\n  },\n  {\n    level: 35,\n    type: 'Hechizo',\n    name: 'atravesar vegetacion',\n    minPos: 'de pie',\n  },\n  {\n    level: 35,\n    type: 'Hechizo',\n    name: 'drenar energia',\n    minPos: 'luchando',\n  },\n  {\n    level: 35,\n    type: 'Hechizo',\n    name: 'escudo flamigero',\n    minPos: 'luchando (evasivo)',\n  },\n  {\n    level: 35,\n    type: 'Hechizo',\n    name: 'metal ardiente',\n    minPos: 'luchando',\n  },\n  {\n    level: 35,\n    type: 'Hechizo',\n    name: 'piel petrea',\n    minPos: 'luchando',\n  },\n  {\n    level: 35,\n    type: 'Habilidad',\n    name: 'rastrear',\n    minPos: 'de pie',\n  },\n  {\n    level: 40,\n    type: 'Hechizo',\n    name: 'escudo',\n    minPos: 'luchando',\n  },\n  {\n    level: 40,\n    type: 'Hechizo',\n    name: 'invocar lobo',\n    minPos: 'de pie',\n  },\n  {\n    level: 40,\n    type: 'Habilidad',\n    name: 'parada',\n    minPos: 'luchando (agresivo)',\n  },\n  {\n    level: 42,\n    type: 'Hechizo',\n    name: 'enredo vegetal',\n    minPos: 'ninguna',\n  },\n  {\n    level: 43,\n    type: 'Hechizo',\n    name: 'transporte arboreo',\n    minPos: 'ninguna',\n  },\n  {\n    level: 45,\n    type: 'Hechizo',\n    name: 'escudo electrico',\n    minPos: 'luchando (evasivo)',\n  },\n  {\n    level: 45,\n    type: 'Hechizo',\n    name: 'nube aturdidora',\n    minPos: 'de pie',\n  },\n  {\n    level: 45,\n    type: 'Habilidad',\n    name: 'cuarto ataque',\n    minPos: 'luchando (berserk)',\n  },\n  {\n    level: 45,\n    type: 'Habilidad',\n    name: 'esconderse',\n    minPos: 'de pie',\n  },\n  {\n    level: 48,\n    type: 'Hechizo',\n    name: 'vision verdadera',\n    minPos: 'de pie',\n  },\n  {\n    level: 50,\n    type: 'Hechizo',\n    name: 'invocar jaguar',\n    minPos: 'de pie',\n  },\n  {\n    level: 50,\n    type: 'Hechizo',\n    name: 'teleportar',\n    minPos: 'luchando (defensivo)',\n  },\n  {\n    level: 51,\n    type: 'Hechizo',\n    name: 'cantico',\n    minPos: 'luchando (evasivo)',\n  },\n  {\n    level: 51,\n    type: 'Habilidad',\n    name: 'punyo_helado',\n    minPos: 'luchando (agresivo)',\n  },\n  {\n    level: 52,\n    type: 'Hechizo',\n    name: 'crear arbol',\n    minPos: 'ninguna',\n  },\n  {\n    level: 52,\n    type: 'Hechizo',\n    name: 'destruir maldad',\n    minPos: 'luchando (defensivo)',\n  },\n  {\n    level: 52,\n    type: 'Habilidad',\n    name: 'punyo_electrico',\n    minPos: 'luchando (agresivo)',\n  },\n  {\n    level: 54,\n    type: 'Hechizo',\n    name: 'maremoto',\n    minPos: 'luchando',\n  },\n  {\n    level: 57,\n    type: 'Hechizo',\n    name: 'vara robliza',\n    minPos: 'ninguna',\n  },\n  {\n    level: 60,\n    type: 'Hechizo',\n    name: 'delirio caotico',\n    minPos: 'luchando',\n  },\n  {\n    level: 60,\n    type: 'Hechizo',\n    name: 'invocar oso',\n    minPos: 'de pie',\n  },\n  {\n    level: 60,\n    type: 'Hechizo',\n    name: 'rafaga viento',\n    minPos: 'luchando',\n  },\n  {\n    level: 62,\n    type: 'Hechizo',\n    name: 'relampago helado',\n    minPos: 'luchando (defensivo)',\n  },\n  {\n    level: 63,\n    type: 'Hechizo',\n    name: 'clonacion',\n    minPos: 'luchando (defensivo)',\n  },\n  {\n    level: 67,\n    type: 'Hechizo',\n    name: 'tormenta hielo',\n    minPos: 'luchando (berserk)',\n  },\n] as const;\n","import { BasicContext } from '../lib/context/BasicContextCreator';\nimport { createPlugin } from '../lib/createPlugin';\nimport { concatRegexes } from '../lib/util/concatRegexes';\nimport { int, toInt } from '../lib/util/int';\n\nconst SIZE = 3000;\n\nconst STATE_DETECTOR = (() => {\n  type Args = Parameters<typeof concatRegexes>;\n  const r = concatRegexes;\n  const low = (x: string) => x.toLowerCase();\n\n  const ANY = /(?:.|\\n)+?/;\n  const DASH = /\\-{78}/;\n  const SPACE = /\\s+/;\n  const PIPE = /\\s+\\|\\s+/;\n  const SPACER = /\\|\\|-{36}\\+-{41}\\|\\|\\n/;\n\n  const row = (...content: Args) => r(/\\|\\|\\s*/, ...content, /\\s*\\|\\|\\n/);\n  const stat = (key: string) =>\n    r(key, /\\s+: /, int(low(key)), /\\(/, int(`${low(key)}Base`), /\\)/);\n\n  const percent = (key: string) =>\n    r(\n      key,\n      /\\s+: /,\n      int(low(key)),\n      /\\s+\\//,\n      int(`${low(key)}Base`),\n      /\\s+\\(\\s*/,\n      int(`${low(key)}Regen`),\n      /%\\) (?:Regen)?/,\n    );\n\n  return r(\n    DASH,\n    /\\n ?\\/\\s{78}\\\\\\n/,\n    row(/Ficha de (?<name>\\w+)(?<principal> \\(Personaje Principal\\))\\./),\n    row(DASH),\n    row(stat('FUE'), SPACE, stat('DES'), PIPE, percent('Vida')),\n    row(stat('INT'), SPACE, stat('SAB'), PIPE, percent('Mana')),\n    row(stat('CON'), SPACE, stat('CAR'), PIPE, percent('Mov')),\n    row(stat('SUE'), SPACE, PIPE, SPACE),\n    SPACER,\n    r(/\\|\\|\\s*Nivel\\s+: /, int('level'), ANY),\n    // ANY,\n    // / \\|\\|\\n\\\\\\s{78}\\/\\n  /,\n    // DASH,\n  );\n\n  /*\n    ------------------------------------------------------------------------------\n  /                                                                              \\\n  ||  Ficha de May (Personaje Principal).                                         ||\n  ||------------------------------------------------------------------------------||\n  || FUE      : 17(16)   DES   : 17(15) | Vida      : 362  /362   ( 0%) Regen     ||\n  || INT      : 20(18)   SAB   : 17(16) | Mana      : 359  /359   ( 0%)           ||\n  || CON      : 15(15)   CAR   : 15(15) | Mov       : 250  /250   ( 0%)           ||\n  || SUE      : 14(14)                  |                                         ||\n  ||------------------------------------+-----------------------------------------||\n  || Nivel    : 15      Edad   : 68     | Profesion : Druida   Raza: Medio-Elfo   ||\n  || Hitroll  : 19      Damroll: 18     | Objetos   : 1    /8                     ||\n  || Armadura : -13     Alin   : 40     | Peso      : 36   /220                   ||\n  || Impacto  : 22 %    Da�o   : 11     | Posicion  : de pie                      ||\n  || Esquivar : 12 %    Parada : 12 %   | Estilo    : estandar                    ||\n  || Huida    : 0       Horas  : 102    | Mision    : 0 /15   Quest: 0    (0 /50) ||\n  ||------------------------------------+-----------------------------------------||\n  || FISIC Da�o/Res/Crit:   0%/  0%/ 3% |            Salvaciones                  ||\n  || MAGIA Da�o/Res/Crit:   0%/  0%/ 3% | Veneno       : 5        Fuego    : -3   ||\n  || CURAS Dar / Recibir:   0%/  0%     | Acido/Paral  : 0        Frio     : 0    ||\n  || EXP : 4,202,269     Pract : 12     | Energia/Elec : 0                        ||\n  || ORO : 63,593        Entr  : 26     |                                         ||\n  || Deidad   : Mittarna                | Favor        : amado        (2500 )     ||\n  ||------------------------------------------------------------------------------||\n  || Te sientes muy bien.                                                         ||\n  ||------------------------------------------------------------------------------||\n  ||                        -= Datos de Guerras =-                                ||\n  || Rango           : Plebeya                     Gloria         : 0    /0       ||\n  || Asesinatos      : 0                           Muertes        : 0             ||\n  ||------------------------------------------------------------------------------||\n  || Conclave:                                                                    ||\n  ||  Avatar Matados : 336                         Otros Matados  : 136           ||\n  ||  Avatar Muertos : 557                         Otros Muertos  : 366           ||\n  \\                                                                              /\n    ------------------------------------------------------------------------------\n  */\n})();\n\nexport const statsPlugin = createPlugin(\n  ({ when, write }) => {\n    let isInitiated = false;\n    let name = '';\n    let principal = false;\n\n    const stats = {\n      fue: 0,\n      fueBase: 0,\n      des: 0,\n      desBase: 0,\n      vida: 0,\n      vidaBase: 0,\n      vidaRegen: 0,\n      int: 0,\n      intBase: 0,\n      sab: 0,\n      sabBase: 0,\n      mana: 0,\n      manaBase: 0,\n      manaRegen: 0,\n      con: 0,\n      conBase: 0,\n      car: 0,\n      carBase: 0,\n      mov: 0,\n      movBase: 0,\n      movRegen: 0,\n      sue: 0,\n      sueBase: 0,\n      level: 0,\n    };\n\n    when(\n      STATE_DETECTOR,\n      ({ groups }) => {\n        for (const key of Object.keys(stats) as (keyof typeof stats)[]) {\n          stats[key] = toInt(groups[key]) as any;\n        }\n\n        name = groups.name;\n        principal = Boolean(groups.principal);\n        isInitiated = true;\n      },\n      { captureLength: SIZE },\n    );\n\n    return {\n      async getLevel() {\n        await ensureInitiated();\n        return stats.level;\n      },\n    };\n\n    async function ensureInitiated() {\n      if (!isInitiated) {\n        write('estado');\n        await when(STATE_DETECTOR, { captureLength: SIZE });\n      }\n    }\n  },\n  plugin => () => plugin,\n);\n","import { BasicContext } from '../lib/context/BasicContextCreator';\nimport { conversation } from '../util/conversation';\nimport { getEmail } from '../util/getEmail';\nimport { getPassword } from '../util/getPassword';\n\nconst principal = 'may';\n\nexport async function login(\n  { when, write, log }: BasicContext,\n  username: string,\n  password: string,\n  initialize: () => Promise<any>,\n) {\n  await when('Entra el nombre de tu personaje o escribe Nuevo:');\n  write(username);\n  log('Username sent, waiting for password request');\n\n  await Promise.any([\n    when('Password:').then(authenticate),\n    when('Ese jugador no existe').then(create),\n  ]);\n\n  when('Pulsa [ENTER]', () => write(''));\n\n  await when.any(\n    when('Reconectando.', {\n      blockProcessingUntil: initialize,\n    }),\n    when('Bienvenido a Balzhur...', {\n      blockProcessingUntil: initialize,\n    }),\n  );\n\n  function authenticate() {\n    write(password, { password: true });\n    log(`Logged in as ${username}`);\n  }\n\n  async function create() {\n    write('Nuevo');\n\n    const qa = conversation(when, write);\n\n    await qa({\n      'Cual es tu sexo (H)ombre, (M)ujer o (N)eutral?': 'N',\n      // Mago Clerigo Ladron Guerrero Vampiro Druida Montaraz Bardo Paladin\n      'Selecciona una profesion': 'Druida',\n      // Humano Elfo Enano Hada Medio-Elfo Gnomo\n      'Escoge una raza o escribe ayuda [raza] para saber mas sobre ellas:':\n        'elfo',\n      'Por favor escoge el nombre': username,\n      'Estas seguro de querer escoger': 's',\n      'Escoge un buen password': password,\n      'Vuelve a escribir el password para confirmarlo': password,\n      'Tienes alguna otra ficha creada?': principal ? 's' : 'n',\n    });\n\n    if (principal) {\n      qa({\n        '¿Cual es tu personaje principal?': 'may',\n        'Escribe el password de tu personaje principal': await getPassword(\n          'may',\n        ),\n      });\n    }\n\n    qa({\n      'Quieres calcular tus caracteristicas al azar o repartir manualmente':\n        'a',\n    });\n\n    let bestRoll = { roll: 0, total: 0 };\n\n    const rollTableSuscription = when(\n      /^\\|\\s+(?<roll>\\d+).+?(?<total>\\d+) \\|$/m,\n      ({ groups }) => {\n        if (parseInt(groups.total, 10) > bestRoll.total) {\n          bestRoll = groups as any;\n        }\n      },\n    );\n\n    await when('Con qué numero de tirada quieres quedarte?');\n    write(`${bestRoll.roll}`);\n    rollTableSuscription.unsubscribe();\n\n    if (!principal) {\n      await qa({\n        '¿Qué cuenta de correo quieres asociar a tu personaje?':\n          getEmail(username),\n        '¿Es correcto? (S/N)': 's',\n      });\n    }\n  }\n}\n","import { ClientStorage } from '@amatiasq/client-storage';\n\nexport function getEmail(user: string) {\n  const storage = new ClientStorage<string>(`email:${user}`);\n  const stored = storage.get();\n\n  if (stored) {\n    return stored;\n  }\n\n  const input = prompt(`Email for ${user}?`);\n\n  if (!input) {\n    throw new Error(`Email is required to create a user`);\n  }\n\n  storage.set(input);\n  return input;\n}\n","import { BindedPluginMap, PluginMap } from '../../plugins';\nimport { Mud } from '../Mud';\nimport { TriggerCollection } from '../triggers/TriggerCollection';\nimport { CancellablePromise } from '../util/CancellablePromise';\nimport { BasicContext, BasicContextCreator } from './BasicContextCreator';\n\nexport type WorkflowContext = ReturnType<\n  WorkflowContextCreator['createInstance']\n>;\n\nexport class WorkflowContextCreator extends BasicContextCreator {\n  private readonly register: Mud['workflow'];\n  private readonly getWorkflow: Mud['getWorkflow'];\n\n  constructor(\n    mud: Mud,\n    triggers: TriggerCollection,\n    private readonly plugins: PluginMap,\n  ) {\n    super(triggers, mud.send.bind(mud));\n    this.register = mud.workflow.bind(mud);\n    this.getWorkflow = mud.getWorkflow.bind(mud);\n  }\n\n  createInstance(name: string) {\n    const context = super.createInstance(name);\n    const { log, abort } = context;\n    const { checkNotAborted, register, getWorkflow } = this;\n\n    const children: CancellablePromise<any>[] = [];\n    let finish: (value: string) => void;\n\n    return Object.assign(context, {\n      plugins: pluginsGetter(this.plugins, context),\n\n      register,\n\n      isRunning: (name: string) => getWorkflow(name).isRunning,\n\n      run(name: string, ...params: any[]) {\n        checkNotAborted(context);\n        log(`Invoke workflow \"${name}\" with`, ...params);\n\n        const workflow = getWorkflow(name);\n        const execution = workflow.execute(...params);\n\n        children.push(execution);\n\n        execution.then(\n          result => log(`Invocation \"${name}\" returned `, result),\n          error => log(`Invocation \"${name}\" failed `, error),\n        );\n\n        return execution;\n      },\n\n      runForever() {\n        checkNotAborted(context);\n        return new Promise(resolve => (finish = resolve));\n      },\n\n      abort(fromExecution?: boolean) {\n        if (context.isAborted) return;\n\n        children.forEach(x => x.cancel());\n\n        abort();\n\n        if (finish) {\n          finish(\n            `Workflow aborted from ${fromExecution ? 'execution' : 'context'}`,\n          );\n        }\n      },\n    });\n\n    // const createChild = (childName?: string) => {\n    //   const child = this.createInstance(\n    //     `${name}->${childName || children.length}`,\n    //   );\n\n    //   if (context.isPrintingLogs) {\n    //     child.printLogs;\n    //   }\n\n    //   return child;\n    // };\n  }\n}\n\nfunction pluginsGetter(\n  source: PluginMap,\n  context: BasicContext,\n): BindedPluginMap {\n  return new Proxy(source as any, {\n    get(target: PluginMap, key: string) {\n      if (!(key in target)) {\n        context.log(`Failed to get plugin ${key}`);\n        throw new Error(`Plugin ${key} is not registered.`);\n      }\n\n      context.log(`Requires plugin ${key}`);\n      // TODO: bind plugin to context\n      return target[key as keyof typeof target](context);\n    },\n  });\n}\n","import { emitter } from '@amatiasq/emitter';\nimport { ChildTriggerCollection } from './ChildTriggerCollection';\nimport { Pattern } from './Pattern';\nimport { PatternMatcher } from './PatternMatcher';\nimport { PatternOptions } from './PatternOptions';\nimport { PatternResult } from './PatternResult';\nimport { PatternSubscription } from './PatternSubscription';\nimport { TriggerCollection } from './TriggerCollection';\n\ntype Handler = (result: PatternResult) => void;\n\nexport class RootTriggerCollection implements TriggerCollection {\n  private readonly children: ChildTriggerCollection[] = [];\n  private readonly patterns = new Set<PatternMatcher>();\n  private readonly queue: string[] = [];\n  private isProcessing = false;\n\n  private readonly emitChange = emitter<PatternMatcher[]>();\n  readonly onChange = this.emitChange.subscribe;\n\n  get list() {\n    return Array.from(this.patterns);\n  }\n\n  createChild() {\n    const child = new ChildTriggerCollection(this.add);\n    this.children.push(child);\n    return child;\n  }\n\n  add(\n    pattern: Pattern,\n    handler?: Handler | PatternOptions,\n    options?: PatternOptions,\n  ) {\n    if (typeof handler !== 'function' && arguments.length === 2) {\n      options = handler;\n      handler = undefined;\n    }\n\n    return new PatternSubscription(resolve => {\n      const matcher = new PatternMatcher(pattern, options);\n      let isAlive = true;\n\n      const unsubscribe = () => {\n        if (!isAlive) return false;\n        isAlive = false;\n        clean();\n        matcher.dispose();\n        this.patterns.delete(matcher);\n        this.emitChange(this.list);\n        return true;\n      };\n\n      const action = typeof handler === 'function' ? handler : unsubscribe;\n\n      const clean = matcher.onMatch(result => {\n        resolve(result);\n        action(result);\n      });\n\n      this.patterns.add(matcher);\n      this.emitChange(this.list);\n\n      return unsubscribe;\n    });\n  }\n\n  async process(text: string): Promise<void> {\n    if (this.isProcessing) {\n      this.queue.push(text);\n      return;\n    }\n\n    this.isProcessing = true;\n\n    const splitted = text.split('\\n');\n    const last = splitted.pop() as string;\n    const lines = [...splitted.map(x => `${x}\\n`), last];\n\n    for (const line of lines) {\n      // console.log('PROCESS', line);\n\n      try {\n        for (const pattern of this.patterns) {\n          await pattern.process(line);\n        }\n\n        for (const child of this.children) {\n          await child.process(line);\n        }\n      } catch (error) {\n        console.error(\n          `Line \"${line}\" produced error: ${\n            error && error.message ? error.message : error\n          }`,\n        );\n        throw error;\n      }\n    }\n\n    this.isProcessing = false;\n\n    if (this.queue.length) {\n      return this.process(this.queue.pop()!);\n    }\n  }\n}\n","import { emitter } from '@amatiasq/emitter';\nimport { PatternMatcher } from './PatternMatcher';\nimport { TriggerCollection } from './TriggerCollection';\n\nexport class ChildTriggerCollection implements TriggerCollection {\n  private readonly patterns = new Set<PatternMatcher>();\n\n  private readonly emitChange = emitter<PatternMatcher[]>();\n  readonly onChange = this.emitChange.subscribe;\n\n  get list() {\n    return Array.from(this.patterns);\n  }\n\n  constructor(readonly add: TriggerCollection['add']) {}\n\n  async process(line: string) {\n    for (const pattern of this.patterns) {\n      await pattern.process(line);\n    }\n  }\n}\n","import { emitter } from '@amatiasq/emitter';\nimport { trimEnd } from '../util/trimEnd';\nimport { Pattern, SinglePattern } from './Pattern';\nimport { PatternOptions } from './PatternOptions';\nimport { PatternResult } from './PatternResult';\n\nexport class PatternMatcher {\n  private readonly buffer;\n  readonly patterns: SinglePattern[];\n  readonly length;\n  private _isEnabled = true;\n\n  get isEnabled() {\n    return this._isEnabled;\n  }\n\n  private readonly emitMatch = emitter<PatternResult>();\n  readonly onMatch = this.emitMatch.subscribe;\n\n  constructor(pattern: Pattern, private readonly options: PatternOptions = {}) {\n    this.patterns = Array.isArray(pattern) ? pattern : [pattern];\n    this.length =\n      options.captureLength ||\n      Math.max(...this.patterns.map(x => String(x).length)) * 10;\n\n    this.buffer = buffer(this.length);\n  }\n\n  enable() {\n    this._isEnabled = true;\n  }\n\n  disable() {\n    this._isEnabled = false;\n    this.buffer.clear();\n  }\n\n  process(text: string) {\n    if (!this._isEnabled) return;\n\n    const value = this.buffer(text);\n    const matching = this.patterns.filter(pattern =>\n      this.testPattern(value, pattern),\n    );\n\n    if (!matching.length) return;\n\n    this.buffer.clear();\n    const result = new PatternResult(matching, value);\n\n    const { logger } = this.options as any;\n    const { blockProcessingUntil } = this.options;\n\n    if (logger) {\n      logger();\n    }\n\n    this.emitMatch(result);\n\n    if (blockProcessingUntil) {\n      return blockProcessingUntil();\n    }\n  }\n\n  dispose() {\n    this.buffer.clear();\n    Object.assign(this, {\n      buffer: null,\n      emitMatch: null,\n      onMatch: null,\n      options: null,\n    });\n  }\n\n  private testPattern(text: string, pattern: SinglePattern) {\n    if (typeof pattern === 'string') {\n      return text.indexOf(pattern) > -1;\n    }\n\n    return pattern.test(text);\n  }\n}\n\nfunction buffer(length: number) {\n  let value = '';\n  const clear = () => (value = '');\n  const add = (text: string) => (value = trimEnd(`${value}${text}`, length));\n  return Object.assign(add, { clear });\n}\n","export function trimEnd(value: string, maxLength: number) {\n  return value.length > maxLength\n    ? value.substr(value.length - maxLength)\n    : value;\n}\n","import { SinglePattern } from './Pattern';\n\nexport class PatternResult {\n  private get regexes() {\n    return this.patterns.filter(isRegex);\n  }\n\n  private get stringPatterns() {\n    return this.patterns.filter(x => !isRegex(x)) as string[];\n  }\n\n  get fullMatch() {\n    return this.stringPatterns[0];\n  }\n\n  get captured() {\n    const regexMatches = this.regexes\n      .map(x => this.haystack.match(x)!)\n      .filter(Boolean)\n      .map(x => Array.from(x));\n\n    // TODO: maybe return the one with more captures?\n    return regexMatches[0];\n  }\n\n  get groups(): Record<string, string> {\n    return this.regexes\n      .map(x => this.haystack.match(x)!)\n      .filter(Boolean)\n      .map(x => x.groups!)\n      .filter(Boolean)\n      .reduce(merge, {});\n  }\n\n  constructor(\n    readonly patterns: SinglePattern[],\n    private readonly haystack: string,\n  ) {}\n}\n\nfunction isRegex(value: SinglePattern) {\n  return value instanceof RegExp;\n}\n\nfunction merge(a: object, b: object) {\n  return { ...a, ...b };\n}\n","import { CancellablePromise } from '../util/CancellablePromise';\nimport { wait } from '../util/wait';\nimport { PatternResult } from './PatternResult';\n\nexport class PatternSubscription {\n  private readonly stop: () => void;\n  readonly then: CancellablePromise<PatternResult>['then'];\n\n  constructor(\n    executor: (match: (result: PatternResult) => void) => () => void,\n  ) {\n    let resolve!: (value: PatternResult) => void;\n    const promise = new CancellablePromise<PatternResult>(\n      _resolve => (resolve = _resolve),\n    );\n\n    promise.onCancel(() => this.stop());\n\n    this.stop = executor(resolve);\n    this.then = promise.then.bind(promise);\n  }\n\n  timeout(seconds: number) {\n    return CancellablePromise.race([\n      this.then(),\n      wait(seconds).then(() => {\n        this.stop();\n        throw new Error(`Timeout: ${seconds}`);\n      }),\n    ]);\n  }\n\n  wait(seconds: number) {\n    return CancellablePromise.race<PatternResult | void>([\n      this.then(),\n      wait(seconds).then(() => this.stop()),\n    ]);\n  }\n\n  unsubscribe(): void {\n    return this.stop();\n  }\n}\n","import { emitter } from '@amatiasq/emitter';\nimport { WorkflowContextCreator } from '../context/WorkflowContextCreator';\nimport { PatternMatcher } from '../triggers/PatternMatcher';\nimport { CancellablePromise } from '../util/CancellablePromise';\nimport { WorkflowFn } from './WorkflowFn';\n\nexport class Workflow<Result = any, Args extends any[] = any[]> {\n  private executions = new Set<CancellablePromise<Result>>();\n  private executionCount = 0;\n  private _isEnabled = true;\n\n  private readonly emitChange = emitter<this>();\n  readonly onChange = this.emitChange.subscribe;\n\n  get isRunning() {\n    return Boolean(this.executions.size);\n  }\n\n  get instancesRunning() {\n    return this.executions.size;\n  }\n\n  get timesExecuted() {\n    return this.executionCount;\n  }\n\n  get isEnabled() {\n    return this._isEnabled;\n  }\n\n  get triggers() {\n    return this.contextCreator.triggerList;\n  }\n\n  constructor(\n    readonly name: string,\n    private readonly run: WorkflowFn<Args>,\n    private readonly contextCreator: WorkflowContextCreator,\n  ) {}\n\n  onTriggersChange(listener: (list: PatternMatcher[]) => void) {\n    return this.contextCreator.onTriggersChange(listener);\n  }\n\n  owns(execution: CancellablePromise<any>) {\n    return this.executions.has(execution);\n  }\n\n  execute(...args: Args) {\n    if (!this._isEnabled) {\n      throw new Error(`Workflow \"${this.name}\" is disabled`);\n    }\n\n    const iteration = this.executionCount++;\n    const context = this.contextCreator.createInstance(this.name);\n\n    context.log(`[Exe(${iteration})]`, ...args);\n\n    const promise = new CancellablePromise<Result>(\n      (resolve, reject, onCancel) => {\n        onCancel(() => {\n          context.abort();\n          reject();\n        });\n\n        Promise.resolve(this.run(context, ...args)).then(resolve, reject);\n      },\n    );\n\n    this.executions.add(promise);\n\n    const result = promise\n      .then(\n        result => {\n          context.log(`[Res(${iteration})]`, result);\n          return result;\n        },\n        error => {\n          context.log(`[ERR(${iteration})]`, error);\n          throw error;\n        },\n      )\n      .finally(() => {\n        this.executions.delete(promise);\n        this.contextCreator.dispose(context);\n        this.emitChange(this);\n      });\n\n    this.emitChange(this);\n    return result;\n  }\n\n  stop() {\n    this.executions.forEach(x => x.cancel());\n    this.emitChange(this);\n  }\n\n  enable() {\n    this._isEnabled = true;\n    this.emitChange(this);\n  }\n\n  disable() {\n    this._isEnabled = false;\n    this.emitChange(this);\n  }\n}\n","import { emitter } from '@amatiasq/emitter';\nimport { playAudio } from './audio';\n\nexport class RemoteTelnet {\n  private _isConnected = false;\n\n  get isConnected() {\n    return this._isConnected;\n  }\n\n  private readonly emitClose = emitter();\n  readonly onClose = this.emitClose.subscribe;\n\n  private readonly emitData = emitter<string>();\n  readonly onData = this.emitData.subscribe;\n\n  constructor(private readonly socket: WebSocket) {\n    socket.addEventListener('close', this.emitClose);\n    socket.addEventListener('message', this.onMessage.bind(this));\n\n    this.onData(() => (this._isConnected = true));\n    this.onClose(() => (this._isConnected = false));\n  }\n\n  connect(host: string, port: number) {\n    this.proxy('OPEN', { host, port });\n  }\n\n  send(value: string) {\n    this.socket.send(encode(value));\n  }\n\n  close() {\n    this.socket.close();\n  }\n\n  private proxy(type: string, payload: any) {\n    this.socket.send(JSON.stringify({ type, payload }));\n  }\n\n  private async onMessage(event: MessageEvent<Blob>) {\n    const reader = new FileReader();\n    reader.onloadend = () => this.processor(reader.result as string);\n    reader.readAsText(event.data, 'ISO-8859-1');\n\n    // .replace(/z<Ex>/g, '')\n    // .replace(/\\[1z<\\/Ex>/g, '')\n    // .replace(/&lt;/g, '<')\n    // .replace(/&gt;/g, '>')\n    // .replace(/&amp;/g, '&');\n  }\n\n  private processor(chunk: string) {\n    const SOUND = /!!SOUND\\((?<path>[\\w\\/\\.]+) U=http:\\/\\/(?<host>[\\w\\/\\.]+)\\)/g;\n\n    if (chunk.match(SOUND)) {\n      for (const sound of chunk.matchAll(SOUND)) {\n        playAudio('/assets/' + sound.groups!.path);\n      }\n\n      chunk = chunk.replace(SOUND, '');\n    }\n\n    this.emitData(chunk);\n  }\n}\n\nfunction encode(text: string) {\n  const encoder = new TextEncoder();\n  const invariant = text.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n  return encoder.encode(invariant);\n}\n","import { ClientStorage } from '@amatiasq/client-storage';\n\nconst storage = new ClientStorage<string[]>('invalid-audio');\nconst invalid = new Set<string>(storage.get() || []);\n\nexport function playAudio(path: string) {\n  if (invalid.has(path)) {\n    return;\n  }\n\n  const audio = new Audio(path);\n  console.debug('AUDIO', path);\n  audio.volume = 0.05;\n  audio.play();\n\n  audio.onerror = () => {\n    invalid.add(path);\n    storage.set([...invalid]);\n  };\n}\n","import { code } from './daemons/code';\nimport { defend } from './daemons/defend';\nimport { dope } from './daemons/dope';\nimport { drink } from './daemons/drink';\nimport { eat } from './daemons/eat';\nimport { idle } from './daemons/idle';\nimport { quest } from './daemons/quest';\nimport { repair } from './daemons/repair';\nimport { rest } from './daemons/rest';\nimport { shop } from './daemons/shop';\nimport { Mud } from './lib/Mud';\nimport { afk } from './workflows/afk';\nimport { bank } from './workflows/bank';\nimport { cast } from './workflows/cast';\nimport { donations } from './workflows/donations';\nimport { go } from './workflows/go';\nimport { kill } from './workflows/kill';\nimport { learn } from './workflows/learn';\nimport { recover } from './workflows/recover';\nimport { train } from './workflows/train';\nimport { tutorial } from './workflows/tutorial';\nimport { wear } from './workflows/wear';\n\nexport function registerWorkflows(mud: Mud) {\n  mud.daemon('code', code);\n  mud.daemon('defend', defend);\n  mud.daemon('dope', dope);\n  mud.daemon('drink', drink);\n  mud.daemon('eat', eat);\n  mud.daemon('idle', idle);\n  mud.daemon('quest', quest);\n  mud.daemon('repair', repair);\n  mud.daemon('rest', rest);\n  mud.daemon('shop', shop);\n\n  mud.workflow('afk', afk);\n  mud.workflow('bank', bank);\n  mud.workflow('cast', cast);\n  mud.workflow('donations', donations);\n  mud.workflow('kill', kill);\n  mud.workflow('go', go);\n  mud.workflow('learn', learn);\n  mud.workflow('recover', recover);\n  mud.workflow('train', train);\n  mud.workflow('tutorial', tutorial);\n  mud.workflow('wear', wear);\n}\n","import { ClientStorage } from '@amatiasq/client-storage';\n\nimport { Context } from '../lib';\n\nconst storage = new ClientStorage<Record<string, number>>('things-in-rooms');\n\nexport function code({ when }: Context) {\n  when(\n    /Salidas: [^\\.]+\\.\\n\\n([^<]+)\\n<\\d+/,\n    ({ captured }) => {\n      if (captured[1].includes('Solo puedes leer mails de ese buzon.')) {\n        return;\n      }\n\n      const things = captured[1].split(/\\n/).map(x => x.trim());\n      const dict = storage.get() || {};\n      things.forEach(x => (dict[x] = (dict[x] || 0) + 1));\n      storage.set(dict);\n    },\n    { captureLength: 5000 },\n  );\n}\n","import { ATTACK_RECEIVED, getMobIn } from '../data/mobs';\nimport { Casteable, SPELLS_BY_TYPE } from '../data/spells';\nimport { Context } from '../lib';\n\nexport async function defend({\n  isRunning,\n  run,\n  when,\n  write,\n  plugins: { prompt, skills, navigation },\n}: Context) {\n  when('Estas demasiado exhausto para huir del combate!', () =>\n    navigation.recall(),\n  );\n\n  when(\n    [\n      'Sientes escalofrios a la vez que tiemblas.',\n      'No te encuentras nada bien.',\n    ],\n    () => run('cast', 'curar veneno'),\n  );\n\n  when(' te DESARMA!', () => write('vestir todo'));\n\n  when(ATTACK_RECEIVED, async ({ groups }) => {\n    if (isRunning('kill')) {\n      return;\n    }\n\n    const mana = prompt.getPercent('mana');\n    const fullName = groups.mob;\n\n    if (!fullName || mana <= 0.1) {\n      return;\n    }\n\n    const mob = getMobIn(fullName);\n    const hp = prompt.getPercent('hp');\n    const attack =\n      hp < 0.5\n        ? <Casteable>[...SPELLS_BY_TYPE.massAttack, ...SPELLS_BY_TYPE.attack]\n        : SPELLS_BY_TYPE.attack;\n\n    await skills.castSpell(attack, mob ? mob.name : fullName);\n  });\n\n  when('.. Todo empieza a volverse negro.\\n', async () => {\n    const RECUPERED =\n      'Tu cuerpo aparece de repente, rodeado por una divina presencia...';\n\n    let bodies = 0;\n\n    const sus = when(RECUPERED, () => bodies++);\n\n    await prompt.until();\n    await write('despertar');\n    await write('suplicar cuerpo');\n    await when(RECUPERED).timeout(5);\n\n    sus.unsubscribe();\n\n    when('El cadaver de May pasa a convertirse en polvo', () => bodies--);\n\n    while (bodies) {\n      write('coger todo may');\n      await prompt.until();\n      write('vestir todo');\n      await prompt.until();\n      await prompt.until();\n    }\n  });\n\n  when('Esta completamente oscuro ...', async () => {\n    if (await skills.can('luz eterna')) {\n      await run('cast', 'luz eterna');\n      write('vestir luz');\n      write('mirar');\n    }\n  });\n\n  when('Estas maldito y no puedes usar el regresar!', async () => {\n    if (await skills.can('retirar maldicion')) {\n      await run('cast', 'retirar maldicion');\n      await navigation.recall();\n    }\n  });\n\n  when(/El cadaver de.* contiene:(?<items>(?:.|\\n)+)\\n[^ ]/, ({ groups }) => {\n    const items = groups.items\n      .toLowerCase()\n      .split(/\\n/)\n      .map(x => x.trim())\n      .filter(x => x && x !== 'nada.');\n\n    // Use if looking for a specific item\n    // if (items.some(x => x.includes('yelmo de orco'))) {\n    //   write('coger yelmo cuerpo');\n    // }\n\n    if (items.some(x => x.includes('llave'))) {\n      write('coger llave cuerpo');\n    }\n  });\n\n  when('Tragas agua al intentar respirar!', async () => {\n    if (await skills.can('respiracion acuatica')) {\n      skills.castSpell('respiracion acuatica');\n    }\n  });\n}\n","import { ClientStorage } from '@amatiasq/client-storage';\n\nimport {\n  Casteable,\n  getSpells,\n  Spell,\n  SpellName,\n  SPELLS_BY_TYPE,\n} from '../data/spells';\nimport { Context } from '../lib';\nimport { uniq } from '../util/uniq';\n\nconst memory = new ClientStorage<(string | string[])[]>('dope:casting');\nconst spellGroups = Object.values(SPELLS_BY_TYPE) as SpellName[][];\n\nexport async function dope({\n  when,\n  register,\n  run,\n  plugins: { prompt, skills },\n}: Context) {\n  const shouldHeal = defineShould(0.2);\n  const shouldRefresh = defineShould(0.1, 0.8);\n\n  const castingQueue = new Set(memory.get());\n  const spells = getSpells();\n  let currentlyCasting: Promise<any> | null = null;\n\n  spells.filter(x => x.end).forEach(watchDope);\n\n  prompt.onUpdate(\n    async ({\n      isFighting,\n      mana: { percent: mana },\n      hp: { percent: hp },\n      mv: { percent: mv },\n    }) => {\n      if (isFighting) {\n        return;\n      }\n\n      const canMeditate = await skills.can('meditar');\n\n      if (mana < 0.1 && !canMeditate) {\n        return;\n      }\n\n      if (mana < 0.7 && canMeditate) {\n        return skills.meditate();\n      }\n\n      if (hp > 0 && shouldHeal(mana, hp)) {\n        return skills.castSpell(SPELLS_BY_TYPE.heal);\n      }\n\n      if (hp > 0 && shouldRefresh(mana, mv)) {\n        return skills.castSpell('refrescar');\n      }\n    },\n  );\n\n  when('No puedes mantener un pensamiento fijo.', async () => {\n    if (await skills.can('curar veneno')) {\n      // cast curar veneno\n    }\n  });\n\n  register('dope', async ({ run }: Context, target?: string) => {\n    const list = spells\n      .filter(spell => spell.effect && (target ? spell.target : true))\n      .map(spell => getSpellGroup(spell.name));\n\n    const clean = uniq(list.map(x => x.join('|'))).map(\n      x => x.split('|') as Casteable,\n    );\n\n    for (const spell of clean) {\n      if (await skills.can(spell)) {\n        await run('cast', spell, target);\n      }\n    }\n  });\n\n  async function watchDope(spell: Spell) {\n    const invoke = getSpellGroup(spell.name);\n    const cast = () => run('cast', invoke).catch(() => null);\n\n    when(spell.end!, async () => {\n      castingQueue.add(invoke);\n      memory.set([...castingQueue]);\n\n      // Add new cast to the queue\n      const previousCast = currentlyCasting || Promise.resolve();\n      currentlyCasting = previousCast.then(cast);\n      const success = await currentlyCasting;\n\n      if (success) {\n        castingQueue.delete(invoke);\n        memory.set([...castingQueue]);\n      }\n    });\n  }\n\n  function defineShould(min: number, max = 1) {\n    const multiplier = 1 / (max - min);\n\n    return (mana: number, stat: number) => {\n      if (mana === 0 || stat > max) return false;\n      if (stat < min) return true;\n\n      const clapped = (stat - min) * multiplier;\n      return Math.hypot(mana, 1 - clapped) > 1;\n    };\n  }\n\n  function getSpellGroup(name: SpellName) {\n    const group = spellGroups.find(x => x.includes(name));\n    return group ? group : [name];\n  }\n}\n","export function uniq<T>(list: T[]) {\n  return [...new Set(list)];\n}\n","import { Context } from '../lib';\n\nexport async function drink({\n  run,\n  when,\n  write,\n  plugins: { inventory, navigation, skills },\n}: Context) {\n  let isFontAvailable = false;\n  let isBottleFull = false;\n  let isThirsty = true;\n\n  navigation.onRoomChange(() => (isFontAvailable = false));\n\n  when(\n    [\n      'Un manantial magico esta aqui.',\n      'Una hermosa fuente de marmol blanco esta aqui.',\n      'Trazas un circulo delante tuyo del cual emerge un manantial de agua cristalina.',\n    ],\n    async () => {\n      setTimeout(() => (isFontAvailable = true), 100);\n\n      if (!isBottleFull) {\n        const bottle = await getWaterBottle();\n\n        if (bottle) {\n          write(`llenar ${bottle}`);\n          isBottleFull = true;\n        }\n      }\n\n      if (isThirsty) {\n        write('beber');\n        isThirsty = false;\n      }\n    },\n  );\n\n  when(\n    [\n      'Te apetece dar un sorbo a algo refrescante.',\n      'Tienes sed.',\n      // 'Estas sediento.',\n      'Estas realmente sediento.',\n      'Estas MUERTO de SED!',\n      'Estas en peligro de deshidratacion.',\n    ],\n    async () => {\n      if (isFontAvailable || (await createFont())) {\n        write('beber');\n        return;\n      }\n\n      const bottle = await getWaterBottle();\n\n      if (!bottle) {\n        console.log('No hay fuente de agua');\n        isThirsty = true;\n        return;\n      }\n\n      write(`beber ${bottle}`);\n      isBottleFull = false;\n\n      if (await skills.can('crear agua')) {\n        if ((await skills.castSpell('crear agua', bottle)) === skills.CASTED) {\n          isBottleFull = true;\n        }\n      }\n    },\n  );\n\n  async function createFont() {\n    if (await skills.can('crear manantial')) {\n      return run('cast', 'crear manantial');\n    }\n  }\n\n  async function getWaterBottle() {\n    return inventory.has({\n      'un odre de cuero': 'odre',\n      'una cantimplora': 'cantimplora',\n    });\n  }\n}\n","import { Context } from '../lib';\n\nexport async function eat({\n  run,\n  when,\n  write,\n  plugins: { inventory, navigation: nav, skills },\n}: Context) {\n  const EXPECTED_FOOD = 1;\n  const DEFAULT_FOOD_NAME = 'chuleta';\n\n  when(['Tienes hambre.', 'Estas realmente hambriento.'], eatSomething);\n\n  when(['Estas terriblemente hambriento.', 'Estas HAMBRIENTO!'], async () => {\n    if (await eatSomething()) {\n      return;\n    }\n\n    if (nav.isAtRecall) {\n      await buyFood();\n      await eatSomething();\n    }\n  });\n\n  async function eatSomething() {\n    const food = await getFoodFromInventory();\n\n    if (food) {\n      write(`comer ${food}`);\n      inventory.refresh();\n      return true;\n    }\n\n    return await createFood();\n  }\n\n  async function createFood() {\n    if (\n      !(await skills.can('crear comida')) ||\n      !(await run('cast', 'crear comida'))\n    ) {\n      return false;\n    }\n\n    write('coger seta');\n\n    try {\n      await when('Coges una seta magica.').timeout(3);\n      write('comer seta');\n      return true;\n    } catch (err) {\n      return false;\n    }\n  }\n\n  async function buyFood() {\n    await nav.execute('2sen');\n\n    write(`comprar ${EXPECTED_FOOD} ${DEFAULT_FOOD_NAME}`);\n\n    await when.any(\n      when('Compras una chuleta de cordero.'),\n      when('El carnicero pone todo en una bolsa y te la da.').then(\n        getFoodFromBag,\n      ),\n    );\n\n    await nav.execute('sw2n');\n  }\n\n  async function getFoodFromInventory() {\n    await getFoodFromBag();\n\n    return await inventory.has({\n      'una seta magica': 'seta',\n      'un chorizo': 'chorizo',\n      'pavo cocinado': 'pavo',\n      'una chuleta de cordero': 'chuleta',\n      'loncha de salami': 'salami',\n      'pierna de cordero': 'pierna',\n      'ricas longanizas': 'longanizas',\n      'un extranyo hongo': 'hongo',\n    });\n  }\n\n  async function getFoodFromBag() {\n    if (await inventory.has('una bolsa')) {\n      write('coger todo bolsa');\n      write('examinar bolsa');\n\n      const { captured } = await when(/Una bolsa contiene:\\n\\s+(Nada)?/);\n      if (captured[1]) {\n        write('tirar bolsa');\n      }\n    }\n  }\n}\n","import { Context } from '../lib';\n\nexport async function idle({\n  when,\n  write,\n  run,\n  plugins: { navigation, skills },\n}: Context) {\n  when('Escribe MIRAR CARTEL para empezar el aprendizaje', () =>\n    run('tutorial'),\n  );\n\n  when('Desapareces en la nada.', async () => {\n    console.log('IDLE');\n\n    if (!navigation.isAtRecall) {\n      write('estado');\n      return;\n    }\n\n    await run('train');\n\n    if (await skills.can('invisibilidad')) {\n      await run('cast', 'invisibilidad');\n    }\n  });\n}\n","import { Context } from '../lib';\n\nexport async function quest({ when, write, plugins: { navigation } }: Context) {\n  when(\n    /El tesoro parece estar(?: al) (?<dir>\\w+) de aqui.../,\n    async ({ groups }) => {\n      await navigation.go(groups.dir);\n      write('carto mapa');\n    },\n  );\n\n  when('No has desenterrado nada a pesar de haber cavado bien hondo.', () =>\n    write('cavar'),\n  );\n}\n","import { Realm } from '../data/areas';\nimport { getItemSustantive, ItemName, UNWEAR } from '../data/items';\nimport { Context } from '../lib';\n\nconst REPAIR_SHOP: Record<Realm, string | null> = {\n  Calimhar: 'r2ses',\n  Earand: null,\n  Valmorag: 'r4swd2n',\n  Niruk: null,\n};\n\nconst REPAIR_MAN = ['El herrero', 'Grimloz'];\n\nexport async function repair({\n  isRunning,\n  sleep,\n  when,\n  write,\n  register,\n  plugins: { inventory, navigation, prompt },\n}: Context) {\n  register('repair', async () => {\n    const broken = await getBrokenEquipment();\n\n    if (broken) {\n      const realm = await navigation.getRealm();\n      const shop = REPAIR_SHOP[realm];\n\n      if (!shop) {\n        throw new Error(`No repair shop known in ${realm}`);\n      }\n\n      await navigation.execute(shop);\n      return repairEquipment(broken);\n    }\n  });\n\n  when('No puedes vestir eso, necesita repararse.', async () => {\n    if (isRunning('donations')) {\n      return;\n    }\n\n    await navigation.execute('r2ses');\n    await repairAll();\n\n    const broken = await getBrokenEquipment();\n\n    if (broken) {\n      return repairEquipment(broken);\n    }\n  });\n\n  async function repairEquipment(broken: ItemName[]) {\n    for (const item of broken) {\n      write(`guardar ${item}`);\n      await when(UNWEAR);\n    }\n\n    await repairAll();\n    return navigation.execute('nw2n');\n  }\n\n  async function getBrokenEquipment() {\n    const inInventory = await inventory.getByEffect('ROTO');\n\n    const broken: ItemName[] = [\n      ...inInventory.map(x => getItemSustantive(x.name)!).filter(Boolean),\n    ];\n    write('equipo');\n\n    const sus = when(/>\\s+\\[\\+*[^+]+\\] (?<item>.*)/, ({ groups }) => {\n      const item = getItemSustantive(groups.item);\n      if (item) broken.push(item);\n    });\n\n    await when('Estas usando:');\n    await prompt.until();\n    sus.unsubscribe();\n\n    return broken.length ? broken : null;\n  }\n\n  async function repairAll() {\n    write('reparar todo');\n\n    await when.any(\n      when(REPAIR_MAN.map(x => `${x} te cobra`)).then(() => true),\n      when(REPAIR_MAN.map(x => `${x} te cuenta`)).then(() => false),\n      sleep(5).then(() => null),\n    );\n\n    write('vestir todo');\n  }\n}\n","import { Context } from '../lib';\n\nexport async function rest({ when, write }: Context) {\n  when(\n    [\n      'Nah... Estas demasiado relajado...',\n      'En tus suenyos o que?',\n      'Estas demasiado relajado para lanzar ese conjuro.',\n    ],\n    () => write('despertar'),\n  );\n}\n","import { Realm } from '../data/areas';\nimport { Context } from '../lib';\n\ninterface Location {\n  path: Partial<Record<Realm, string>>;\n  name?: string;\n  amount?: number;\n}\n\nconst locations: Record<string, Location> = {\n  viajar: {\n    path: { Calimhar: 'r2s3wn' },\n    amount: 5,\n  },\n};\n\nexport async function shop({ when, write, register }: Context) {\n  when(/pone todo en una bolsa y te la da\\./, async () => {\n    write('coger todo bolsa');\n    write('examinar bolsa');\n\n    await when(/Una bolsa contiene:\\n\\s+Nada\\./);\n    write('tirar bolsa');\n  });\n\n  register(\n    'buy',\n    async (\n      { when, write, plugins: { navigation } }: Context,\n      item: string,\n      amount: number,\n    ) => {\n      if (!(item in locations)) {\n        throw new Error(`Unknown item type \"${item}\"`);\n      }\n\n      const realm = await navigation.getRealm();\n      const config = locations[item as keyof typeof locations];\n      const path = config.path[realm];\n      const name = config.name || item;\n\n      if (!amount) {\n        amount = config.amount || 1;\n      }\n\n      if (!path) {\n        throw new Error(`Can't find shop for ${item} on realm ${realm}`);\n      }\n\n      await navigation.execute(path);\n      write(`comprar ${amount} ${name}`);\n\n      return when.any(\n        when('Lo siento, esta cerrado, vuelve mas tarde.').then(() => false),\n        when(['Compras ', 'pone todo en una bolsa y te la da']).then(\n          () => true,\n        ),\n      );\n    },\n  );\n}\n","import { Context } from '../lib';\n\nexport async function afk(\n  { abort, log, run, when, write, plugins: { navigation, prompt } }: Context,\n  ...areas: string[]\n) {\n  const initialExp = prompt.getValue('exp');\n  let died = false;\n\n  console.log({ initialExp });\n\n  when('.. Todo empieza a volverse negro.\\n', async () => {\n    died = true;\n\n    await prompt.until();\n\n    const exp = prompt.getValue('exp');\n\n    if (exp > initialExp) {\n      abort();\n    }\n  });\n\n  while (true) {\n    if (died) {\n      await when('El cadaver de May pasa a convertirse en polvo');\n      died = false;\n    }\n\n    await action();\n    log('AFK Completed. Restarting...');\n  }\n\n  async function action(): Promise<void> {\n    try {\n      await run('recover');\n      await run('repair');\n      await run('learn');\n      await run('dope');\n      await run('recover');\n    } catch (error) {\n      console.log('Preparation error', error);\n    }\n\n    try {\n      await run('train', rand(areas || []));\n    } catch (error) {\n      console.log('Train error', error);\n    }\n\n    try {\n      const realm = await navigation.getRealm();\n\n      if (realm === 'Calimhar' && navigation.isAtRecall) {\n        await run('bank');\n      }\n    } catch (error) {\n      console.log('Bank error', error);\n    }\n  }\n}\n\nfunction rand<T>(list: T[]) {\n  return list[Math.floor(Math.random() * list.length)];\n}\n","import { Context } from '../lib';\nimport { concatRegexes } from '../lib/util/concatRegexes';\nimport { int, toInt } from '../lib/util/int';\n\nexport async function bank(\n  { when, write, plugins: { navigation } }: Context,\n  take?: number,\n) {\n  const INGRESS = concatRegexes(\n    /Ingresas /,\n    int(),\n    / monedas? de oro en tu cuenta bancaria./,\n  );\n  const EXTRACT = concatRegexes(\n    /Retiras /,\n    int(),\n    / monedas? de oro de tu cuenta bancaria./,\n  );\n\n  await navigation.execute('r4s2en');\n\n  write('banco saldo');\n\n  const { groups } = await when(\n    concatRegexes(\n      /Estas llevando /,\n      int('carring'),\n      / monedas de oro.\\n/,\n      /Tienes /,\n      int('balance'),\n      / monedas de oro en el banco.\\n/,\n      /Lo que hace un total de /,\n      int('total'),\n      / monedas de oro.\\n/,\n    ),\n  );\n\n  const carring = toInt(groups.carring);\n  // const balance = toInt(groups.balance);\n  const total = toInt(groups.total);\n  const final = take == null ? Math.max(Math.ceil(total * 0.01), 2000) : take;\n\n  if (carring < final) {\n    write(`banco retirar ${final - carring}`);\n    await when(EXTRACT);\n  } else if (carring > final) {\n    write(`banco ingresar ${carring - final}`);\n    await when(INGRESS);\n  }\n\n  await navigation.execute('s2w4n');\n}\n","import { Casteable } from '../data/spells';\nimport { Context } from '../lib';\n\nexport async function cast(\n  { sleep, when, write, plugins: { prompt, skills } }: Context,\n  spell: Casteable,\n  ...args: string[]\n) {\n  let wasSleeping = false;\n\n  when('Tienes un bonito sueño donde eres el mejor mago del mundo.', () => {\n    wasSleeping = true;\n    write('despertar');\n  });\n\n  const result = await repeatUntilCasted();\n\n  if (result === false) {\n    console.warn(`Unable to cast \"${spell}\"`);\n  }\n\n  if (wasSleeping) {\n    write('dormir');\n    await when([\n      'Cierras los ojos y caes en un profundo suenyo.',\n      'Ya estas durmiendo.',\n    ]);\n  }\n\n  return result;\n\n  async function repeatUntilCasted(): Promise<boolean> {\n    if (prompt.isFighting) {\n      await prompt.until(x => !x.isFighting);\n    }\n\n    switch (await skills.castSpell(spell, args.join(' '))) {\n      case skills.CASTED:\n      case skills.ALREADY_APPLIED:\n        return true;\n      case skills.NOT_AVAILABLE:\n        return false;\n      case skills.BUSY:\n        await sleep(3);\n      case skills.FAILED:\n        return repeatUntilCasted();\n    }\n\n    throw new Error('WTF DUDE');\n  }\n}\n","import { ITEM_SUSTANTIVES } from '../data/items';\nimport { Context } from '../lib';\n\nconst rooms = [\n  { from: 31, to: 40, path: '4wn' },\n  { from: 21, to: 30, path: '3wn' },\n  { from: 11, to: 20, path: '2wn' },\n  { from: 1, to: 10, path: 'wn' },\n  { from: 41, to: 50, path: 'en' },\n  { from: 51, to: 60, path: '2en' },\n  { from: 61, to: 70, path: '3en' },\n  { from: 71, to: 80, path: '4en' },\n];\n\nexport async function donations({\n  when,\n  write,\n  run,\n  plugins: { navigation: nav, stats },\n}: Context) {\n  write('estado');\n  const level = await stats.getLevel();\n  const room = rooms.find(x => x.from <= level && x.to >= level);\n\n  if (!room) {\n    throw new Error(`No room for level \"${level}\"`);\n  }\n\n  await nav.execute('rh2w4n');\n\n  const promise = when(/Salidas: sur\\.\\n\\n((?:.|\\n)*)\\n\\n/, {\n    // donations rooms can get HUGE\n    captureLength: Number.MAX_VALUE,\n  });\n\n  await nav.execute(room.path);\n\n  const { captured: itemsMatch } = await promise;\n  const list = itemsMatch[1].split('\\n').map(x => x.trim());\n\n  for (const item of Object.values(ITEM_SUSTANTIVES)) {\n    const found = list.some(x => x.includes(item) && !x.includes('mallas'));\n\n    if (found) {\n      await run('wear', item);\n    }\n  }\n\n  await nav.recall();\n}\n","import { getAreaMetadata, Realm } from '../data/areas';\nimport { Context } from '../lib';\n\nconst PATH = /^r?((?:x|\\d+)?[nsewudohjkl])+$/i;\nconst TRAVEL = 'un pergamino de viajar';\n\nconst REALM_RECALLS: Record<Realm, string | null> = {\n  Calimhar: 'DarkHaven',\n  Earand: 'Justicia',\n  Valmorag: 'Tinieblas',\n  Niruk: null,\n};\n\nexport async function go(\n  { run, when, write, plugins: { navigation, inventory, skills } }: Context,\n  path: string,\n) {\n  if (PATH.test(path)) {\n    return navigation.execute(path);\n  }\n\n  const area = getAreaMetadata(path);\n\n  if (!area) {\n    throw new Error(`Can't resolve path or area \"${path}\"`);\n  }\n\n  if (!area.path) {\n    throw new Error(`Area ${area.name} doesn't have a path`);\n  }\n\n  const realm = await navigation.getRealm();\n\n  if (area.realm === realm) {\n    return navigation.execute(area.path);\n  }\n\n  const recall = REALM_RECALLS[area.realm];\n\n  if (!recall) {\n    throw new Error(`Realm ${area.realm} doesn't have recall.`);\n  }\n\n  if (await skills.can('viajar')) {\n    if (await run('cast', 'viajar', recall)) {\n      return navigation.execute(area.path);\n    }\n  }\n\n  let canTravel = false;\n\n  if (await inventory.has(TRAVEL)) {\n    canTravel = true;\n  } else if (await inventory.hasInBackpack(TRAVEL)) {\n    write('coger viajar mochila');\n\n    canTravel = await when.any(\n      when('Coges un pergamino de viajar de').then(() => true),\n      when('No hay nada parecido a eso en').then(() => false),\n    );\n  }\n\n  if (canTravel) {\n    write(`recitar viajar ${recall}`);\n    await when('Recitas un pergamino de viajar.').timeout(3);\n    return navigation.execute(area.path);\n  }\n\n  throw new Error(`No way to travel to ${area.name} in ${area.realm}`);\n}\n","export default [\n  {\n    realm: 'Calimhar',\n    name: 'Academia de Darkhaven',\n    path: 'rd',\n    from: 1,\n    to: 5,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Calimhar',\n    name: 'Bosque de las Hadas',\n    path: 'r6w2nwk2wh',\n    from: 1,\n    to: 5,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Calimhar',\n    name: 'Catacumbas de la Capilla',\n    path: 'r6w8se7s',\n    from: 15,\n    to: 25,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Calimhar',\n    name: 'Cementerio Oscuro',\n    path: 'r4s4ws',\n    clan: 'Legends',\n    from: 5,\n    to: 15,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Calimhar',\n    name: 'Ciudad Imperial',\n    path: 'r8e2n4el3e2sj',\n    from: 0,\n    to: 95,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Calimhar',\n    name: 'DarkHaven',\n    path: 'rd',\n    from: 0,\n    to: 95,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Calimhar',\n    name: 'El Campamento Goblin',\n    path: 'r10s4en3e2n',\n    from: 1,\n    to: 10,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Calimhar',\n    name: 'El Cementerio',\n    path: 'r6w8ses',\n    from: 5,\n    to: 10,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Calimhar',\n    name: 'El Centinela',\n    path: 'r7ws',\n    from: 5,\n    to: 10,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Calimhar',\n    name: 'El Gran Estadio',\n    path: 'r8e2n4el3e2s2jn',\n    from: 10,\n    to: 20,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Calimhar',\n    name: 'El Imperio Orco',\n    path: 'r13s2wn',\n    clan: 'Legends',\n    from: 10,\n    to: 20,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Calimhar',\n    name: 'El Jardin de los Heroes',\n    path: 'r8e2n4el3e2s2j8l8e5j4els',\n    from: 75,\n    to: 80,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Calimhar',\n    name: 'El Pantano Orco',\n    path: 'r13s2en',\n    clan: 'DarkAngels',\n    from: 5,\n    to: 30,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Calimhar',\n    name: 'El Refugio Destruido',\n    path: 'r8e2ne',\n    from: 5,\n    to: 20,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Calimhar',\n    name: 'Exportaciones de Dragones',\n    path: 'r4sen',\n    clan: 'Legends',\n    from: 5,\n    to: 25,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Calimhar',\n    name: 'Foire de Reves',\n    path: 'r8n3ene',\n    from: 0,\n    to: 50,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Calimhar',\n    name: 'Galeria de arte',\n    path: 'r4swn',\n    from: 10,\n    to: 50,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Calimhar',\n    name: 'Guarderia Enana',\n    path: 'r8ejs',\n    from: 1,\n    to: 5,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Calimhar',\n    name: 'Haon Dor',\n    path: 'r7w',\n    from: 5,\n    to: 10,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Calimhar',\n    name: 'Holy Grove',\n    path: 'r9e',\n    from: 5,\n    to: 20,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Calimhar',\n    name: 'Kharadest, Baluarte de Platino',\n    from: 78,\n    to: 80,\n    min: 77,\n    max: 95,\n  },\n  {\n    realm: 'Calimhar',\n    name: 'La Fortaleza de Valor',\n    path: 'r11n2en',\n    clan: 'DragonSlayers',\n    from: 5,\n    to: 30,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Calimhar',\n    name: 'La Mansion de Marmol',\n    path: 'r9w3s',\n    from: 5,\n    to: 15,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Calimhar',\n    name: 'La Mansion de Tullfuhrzky',\n    path: 'r6w2nwk2wh4nj',\n    from: 1,\n    to: 10,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Calimhar',\n    name: 'La Torre del Brujo',\n    path: 'r9w2sese2s',\n    clan: 'Legends',\n    from: 10,\n    to: 20,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Calimhar',\n    name: 'Las Alcantarillas',\n    path: 'r4sd',\n    from: 5,\n    to: 20,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Calimhar',\n    name: 'Las Llanuras del Norte',\n    path: 'r7n',\n    from: 1,\n    to: 20,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Calimhar',\n    name: \"Miden'nir\",\n    path: 'r7s',\n    from: 5,\n    to: 15,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Calimhar',\n    name: 'Residencias de Mortales',\n    from: 0,\n    to: 95,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Calimhar',\n    name: 'Sindaliore',\n    clan: 'Legends',\n    from: 75,\n    to: 80,\n    min: 77,\n    max: 95,\n  },\n  {\n    realm: 'Earand',\n    name: 'Armageddon',\n    path: 'r3s7w6n2wsl2sejls',\n    clan: 'Conclave',\n    from: 50,\n    to: 80,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Earand',\n    name: 'Asgard',\n    path: 'r3s7w11ne2n2enhjn;entrar;.s',\n    clan: 'El Santuario',\n    from: 40,\n    to: 60,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Earand',\n    name: 'Asoinwan, ciudad de las hadas',\n    path: 'r3s7w11ne2n',\n    clan: 'DragonSlayers',\n    from: 5,\n    to: 30,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Earand',\n    name: 'Camelot',\n    path: 'r3s7w11ne2n2ej',\n    from: 65,\n    to: 80,\n    min: 50,\n    max: 95,\n  },\n  {\n    realm: 'Earand',\n    name: 'Dregoria',\n    path: 'r3s5e10n3wn',\n    clan: 'Cantico',\n    from: 40,\n    to: 65,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Earand',\n    name: 'El Calabozo de la Muerte',\n    path: 'ruse7n',\n    from: 10,\n    to: 35,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Earand',\n    name: 'El Campo de Batalla Desolado',\n    path: 'r3s7w6n2wsl2se',\n    from: 15,\n    to: 25,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Earand',\n    name: 'El Plano Astral',\n    path: 'r2su',\n    clan: 'DarkAngels',\n    from: 15,\n    to: 35,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Earand',\n    name: 'El Pueblo Fantasma',\n    path: 'r3s5e2j',\n    clan: 'DragonSlayers',\n    from: 35,\n    to: 50,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Earand',\n    name: 'El Reino de Yggdrasil',\n    path: 'r3s7w11ne2n2enhjn;entrar',\n    from: 15,\n    to: 50,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Earand',\n    name: 'El Yunque del Sol',\n    path: 'r3s7w6n2wsl2sejl2s5e4n3w2n4w',\n    clan: 'Legends',\n    from: 60,\n    to: 80,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Earand',\n    name: 'Estroglia, coraz�n del Yunque',\n    clan: 'DarkAngels',\n    from: 75,\n    to: 80,\n    min: 75,\n    max: 95,\n  },\n  {\n    realm: 'Earand',\n    name: 'Ghotiamir',\n    path: 'r',\n    from: 0,\n    to: 95,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Earand',\n    name: 'La Ciudad de Velas',\n    path: 'r3s7wn',\n    from: 45,\n    to: 55,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Earand',\n    name: 'La Fortaleza de Lord Krothgar',\n    path: 'r3s5e3n',\n    from: 35,\n    to: 60,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Earand',\n    name: 'La Fortaleza Enana',\n    path: 'r3s5el2nj',\n    clan: 'El Santuario',\n    from: 35,\n    to: 65,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Earand',\n    name: 'La Guarida de Kotegaesi',\n    path: 'r3s7w6n2wslsk',\n    from: 30,\n    to: 45,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Earand',\n    name: 'La tumba de Damara',\n    path: 'r3s5w3n',\n    clan: 'Shinsent',\n    from: 15,\n    to: 25,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Earand',\n    name: 'Las Ruinas de los Antiguos',\n    from: 78,\n    to: 80,\n    min: 77,\n    max: 95,\n  },\n  {\n    realm: 'Earand',\n    name: 'Observatorio del Ojo Celeste',\n    path: 'r3s3e2s',\n    clan: 'Cantico',\n    from: 25,\n    to: 65,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Earand',\n    name: 'Valle de Rivendel',\n    path: 'r3s7w11ne2n2e2n',\n    from: 60,\n    to: 80,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Earand',\n    name: 'Villa Enana',\n    path: 'r3s5el',\n    from: 10,\n    to: 35,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Niruk',\n    name: 'La casa de Anarion',\n    from: 75,\n    to: 80,\n    min: 75,\n    max: 95,\n  },\n  {\n    realm: 'Niruk',\n    name: 'Las Tierras Desoladas',\n    clan: 'DarkAngels',\n    from: 10,\n    to: 80,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Niruk',\n    name: 'Residencia de Inmortales',\n    from: 81,\n    to: 95,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Niruk',\n    name: \"Tiempo de L'Hopital\",\n    from: 75,\n    to: 80,\n    min: 75,\n    max: 95,\n  },\n  {\n    realm: 'Valmorag',\n    name: 'Bosque de los Muertos',\n    path: 'r3s5e2n2e2ses2en',\n    from: 20,\n    to: 40,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Valmorag',\n    name: 'Dhusebark',\n    path: 'r',\n    from: 0,\n    to: 95,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Valmorag',\n    name: 'El Devorador de Mundos',\n    path: 'r3s5e2n2e2ses2e3n2wkwnwhne6nunj',\n    from: 30,\n    to: 50,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Valmorag',\n    name: 'El Legado de Xchantharus',\n    path: 'r3s5e2n2e3swse3sd9sh',\n    clan: 'El Santuario',\n    from: 30,\n    to: 50,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Valmorag',\n    name: 'El Mausoleo del Minotauro',\n    path: 'r3s5e2n2en',\n    from: 40,\n    to: 65,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Valmorag',\n    name: 'Guarida de Gigantes de Fuego',\n    path: 'r3s5wh2w',\n    from: 40,\n    to: 50,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Valmorag',\n    name: 'Infierno',\n    path: 'r4sd',\n    from: 30,\n    to: 80,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Valmorag',\n    name: 'La Ciudad Maldita',\n    path: 'r9sk3esek',\n    clan: 'Sindicato',\n    from: 40,\n    to: 80,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Valmorag',\n    name: 'La Fortaleza de Lilith',\n    path: 'r9sk2w3usw',\n    clan: 'Torre Arcana',\n    from: 65,\n    to: 80,\n    min: 55,\n    max: 95,\n  },\n  {\n    realm: 'Valmorag',\n    name: 'La Fortaleza de Mahn-Tor',\n    path: 'r3s5e2n2e',\n    from: 5,\n    to: 35,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Valmorag',\n    name: 'La Gran Torre de la Hechiceria',\n    path: 'r3s5e2nj',\n    from: 10,\n    to: 30,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Valmorag',\n    name: 'La Maldicion del Nigromante',\n    path: 'r3s5e2n2e2s2e',\n    clan: 'Cantico',\n    from: 30,\n    to: 55,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Valmorag',\n    name: 'La Residencia de Redferne',\n    path: 'r9sk2w',\n    from: 20,\n    to: 30,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Valmorag',\n    name: 'Los Pozos de la Reina Aranya',\n    from: 40,\n    to: 55,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Valmorag',\n    name: 'Los Usurpadores de Hochenyana',\n    path: 'r3s6ele',\n    clan: 'Shinsent',\n    from: 20,\n    to: 35,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Valmorag',\n    name: 'Profundidades Umbrias',\n    path: 'r3s5e2n2e3swse3sd9sd',\n    from: 20,\n    to: 50,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Valmorag',\n    name: 'Puerto Libre',\n    path: 'r9ske',\n    from: 10,\n    to: 55,\n    min: 0,\n    max: 95,\n  },\n  {\n    realm: 'Valmorag',\n    name: 'Valle de Morgul',\n    path: 'r9sk2w3us',\n    clan: 'Shinsent',\n    from: 30,\n    to: 55,\n    min: 0,\n    max: 95,\n  },\n] as const;\n","import { ATTACK_RECEIVED, getMobIn } from '../data/mobs';\nimport { Casteable, SPELLS_BY_TYPE } from '../data/spells';\nimport { Context } from '../lib';\nimport { concatRegexes } from '../lib/util/concatRegexes';\n\nexport type KillResult = 'win' | 'flee' | 'missing';\n\nexport async function kill(\n  { sleep, when, write, plugins: { prompt, navigation, skills } }: Context,\n  target: string,\n): Promise<KillResult> {\n  const { dedope } = SPELLS_BY_TYPE;\n  const focused = target.startsWith('!');\n\n  if (focused) {\n    target = target.substr(1);\n  }\n\n  if (!(await repeatUntilCasted(dedope, target))) {\n    write(`matar ${target}`);\n  }\n\n  const unsubscribe = prompt.onUpdate(x => {\n    if (x.hp.percent <= 0.4) {\n      navigation.recall();\n    }\n  });\n\n  if (await skills.can('segundo ataque')) {\n    when(ATTACK_RECEIVED, async ({ groups }) => {\n      if (prompt.getPercent('mana') < 0.2) {\n        return;\n      }\n\n      const fullName = groups.mob;\n      const mob = getMobIn(fullName);\n      const name = mob ? mob.name : fullName || target;\n      const attack = focused\n        ? SPELLS_BY_TYPE.attack\n        : ([\n            ...SPELLS_BY_TYPE.massAttack,\n            ...SPELLS_BY_TYPE.attack,\n          ] as Casteable);\n\n      await skills.castSpell(attack, name);\n    });\n  }\n\n  let bodyContent: string[] = [];\n\n  const result = await when.any(\n    navigation.waitForRecall().then(() => 'flee' as KillResult),\n\n    when([\n      concatRegexes(target, /(?:\\w|�| )* (ha)|(cae al suelo) MUERTO!!/i),\n      'monedas de oro de el cadaver de un ladron',\n    ]).then(() => 'win' as KillResult),\n\n    when('No esta aqui.')\n      .timeout(3)\n      .then(() => 'missing' as KillResult),\n\n    when([\n      'Huyes como un cobarde del combate.',\n      'Estas demasiado malherido para hacer eso.',\n      'Estas demasiado aturdido para hacer eso.',\n    ]).then(() => 'flee' as KillResult),\n  );\n\n  if (result === 'win') {\n    // no need to await for this\n    setTimeout(() => handleBody(bodyContent));\n  }\n\n  unsubscribe();\n  return result;\n\n  async function handleBody(items: string[]) {\n    write('sacrificar cuerpo');\n    // await when('te da una moneda de oro por tu sacrificio.');\n  }\n\n  async function repeatUntilCasted(\n    spell: Casteable,\n    target: string,\n  ): Promise<boolean> {\n    if (prompt.getPercent('mana') < 0.1) {\n      return false;\n    }\n\n    switch (await skills.castSpell(spell, target)) {\n      case skills.CASTED:\n      case skills.ALREADY_APPLIED:\n        return true;\n      case skills.NOT_AVAILABLE:\n        return false;\n      case skills.BUSY:\n        await sleep(3);\n      case skills.FAILED:\n        return repeatUntilCasted(spell, target);\n    }\n\n    throw new Error('WTF DUDE');\n  }\n}\n","import { SKILL_LEARN_ORDER } from '../data/skills_order';\nimport { SkillName } from '../data/spells';\nimport { Context } from '../lib';\n\nexport async function learn(\n  { when, write, plugins: { navigation, skills } }: Context,\n  ...parts: string[]\n) {\n  let practicesLeft = await skills.practices;\n\n  if (!practicesLeft) {\n    console.warn('No practices left');\n    return;\n  }\n\n  const arg = parts.join(' ') as SkillName;\n\n  if (arg) {\n    if (await skills.can(arg)) {\n      console.warn(`${arg} already known!`);\n      return;\n    }\n\n    return goPractice(() => practice(arg));\n  }\n\n  const next = await getNextSkills();\n\n  if (!next.length) {\n    console.warn('Nothing to learn');\n    return;\n  }\n\n  return goPractice(async () => {\n    for (const skill of next) {\n      await practice(skill);\n      practicesLeft--;\n\n      if (!practicesLeft) {\n        break;\n      }\n    }\n\n    return skills.refresh();\n  });\n\n  async function goPractice(action: () => Promise<any>) {\n    await navigation.execute('rdnne');\n    await action();\n    await navigation.execute('wssu');\n  }\n\n  async function practice(skill: SkillName) {\n    write(`practicar ${skill}`);\n    await when.any(\n      when('Ahora deberas practicarlo por tu cuenta...').then(() => true),\n      when([\n        'Tienes que conseguir mas sesiones de practicas.',\n        'Ya te he enseñado cuanto podia sobre',\n      ]).then(() => false),\n    );\n  }\n\n  async function getNextSkills() {\n    const following: SkillName[] = [];\n\n    for (const skill of SKILL_LEARN_ORDER) {\n      if (!Array.isArray(skill)) {\n        if (await isLearnable(skill)) {\n          following.push(skill);\n        }\n        continue;\n      }\n\n      for (const single of skill) {\n        if (await skills.can(single)) {\n          break;\n        }\n\n        if (await skills.canLearn(single)) {\n          following.push(single);\n          break;\n        }\n      }\n    }\n\n    return following;\n  }\n\n  async function isLearnable(skill: SkillName) {\n    if (await skills.can(skill)) {\n      return false;\n    }\n\n    return skills.canLearn(skill);\n  }\n}\n","import { SkillName } from './spells';\n\nexport const SKILL_LEARN_ORDER: (SkillName | SkillName[])[] = [\n  'estilo evasivo',\n  'armas impacto',\n\n  // Basicos\n  ['crear manantial', 'crear agua'],\n  ['crear baya', 'crear comida', 'saciar hambre'],\n  'luz eterna',\n  'refrescar',\n  [\n    'invocar oso',\n    'invocar jaguar',\n    'invocar lobo',\n    'invocar aguila',\n    'invocar lince',\n    'invocar armadillo',\n  ],\n  'identificar',\n  'meditar',\n  'proteccion', // dope pero en el lugar\n  'polimorfar',\n  'viajar',\n  'dormir',\n\n  // Cura\n  ['sanar', 'curar criticas', 'curar graves', 'curar leves'],\n  'curar ceguera',\n  'curar veneno',\n\n  // Ofensivas\n  'danyo incrementado',\n  ['cuarto ataque', 'tercer ataque', 'segundo ataque'],\n  ['parada', 'esquivar'],\n  ['manotazo', 'patada', 'pisoton', 'agarron impactante'],\n  ['causar fatales', 'causar critica', 'causar grave', 'causar leve'],\n  ['ceguera', 'veneno', 'maldecir', 'debilitar', 'desarmar', 'relentizar'],\n  ['terremoto', 'maremoto'],\n  [\n    'tormenta hielo',\n    'rafaga viento',\n    'relampago helado',\n    'relampago',\n    'llamar rayo',\n    'bola fuego',\n    'misil magico',\n    'golpe flamigero',\n    'rayo solar',\n    'drenar energia',\n    'metal ardiente',\n    'enredo vegetal',\n  ],\n  ['punyo_helado', 'punyo_electrico'],\n\n  // Dope,\n  ['esconderse', 'invisibilidad'],\n  'armadura',\n  'bendecir',\n  ['piel petrea', 'piel robliza'],\n  ['volar', 'flotar'],\n  'vision verdadera', // vale por infravision, detectar invisible y detectar oculto\n  'detectar invisible',\n  'detectar escondido',\n  'detectar magia',\n  'detectar maldad',\n  'detectar trampas',\n  'sigilo',\n  'respiracion acuatica',\n  'fuerza vampirica',\n  'atravesar puerta',\n  'furia naturaleza',\n  ['escudo electrico', 'escudo hielo', 'escudo flamigero'], // requiere baya en inventario,\n  'encantar arma', // requiere <arma>\n  'santuario', // requiere <personaje>\n  'atravesar vegetacion',\n  'escudo',\n  'delirio caotico',\n\n  // Meh,\n  'cavar',\n  'cartografia',\n  'despellejar',\n  'carpinteria',\n  'fuego espectral',\n  'montar',\n  'crear fuego',\n  'buscar',\n  'escalar',\n  'primeros auxilios',\n  'conocer alineamiento',\n  'niebla espectral',\n  'disipar maldad',\n  'control climatico',\n  'detectar veneno',\n  'localizar objeto',\n  'disipar magia',\n  'retirar invisibilidad',\n  'otear',\n  'retirar maldicion',\n  'sonyar',\n  'vista distancia',\n  'estilo defensivo',\n  'retirar trampa',\n  'invisibilidad grupo',\n  'invocar regreso',\n  'rastrear',\n  'vara robliza',\n  'clonacion',\n\n  // // No,\n  // 'cocinar',\n  // 'estilo estandar',\n  // 'forjar',\n  // 'minar',\n  // 'pescar',\n  // 'talar',\n  // 'tallar',\n  // 'tejer',\n  // 'armas cortas',\n  // 'armas flexibles',\n  // 'armas largas',\n  // 'garras',\n  // 'pugilismo',\n  // 'enano',\n  // 'goblin',\n  // 'ogro',\n  // 'orco',\n  // 'troll',\n  // 'estilo agresivo',\n  // 'rescatar',\n  // 'estilo berserk',\n  // 'transporte arboreo',\n  // 'crear arbol',\n  // 'teleportar',\n  // 'cantico',\n  // 'destruir maldad',\n];\n","import { SPELLS_BY_TYPE } from '../data/spells';\nimport { Context } from '../lib';\n\nexport async function recover({\n  run,\n  sleep,\n  plugins: { skills, prompt },\n}: Context) {\n  const heal = SPELLS_BY_TYPE.heal;\n  const refresh = 'refrescar';\n  const invisible = 'invisibilidad';\n\n  const canHeal = await skills.can(heal);\n  const canRefresh = await skills.can(refresh);\n  const canMeditate = await skills.can('meditar');\n  const canInvisible = await skills.can(invisible);\n\n  const hp = () => prompt.getPercent('hp');\n  const mana = () => prompt.getPercent('mana');\n  const mv = () => prompt.getPercent('mv');\n\n  const wantedHp = () => (canMeditate ? 1 : Math.max(mana(), 0.5));\n\n  const isInjured = () => hp() < wantedHp();\n  const needsMana = () => mana() < 0.8;\n  const needsRest = () => mv() < 1;\n\n  const hasEnoughMana = () => (canMeditate ? mana() > 0.3 : mana() > 0.1);\n  const isRefreshed = () => !isInjured() && !needsMana() && !needsRest();\n  const isDoneCasting = () =>\n    (canHeal ? !isInjured() : true) &&\n    (canMeditate ? !needsMana() : true) &&\n    (canRefresh ? !needsRest() : true);\n\n  while (!isDoneCasting()) {\n    let acted = false;\n\n    if (canInvisible && !prompt.isInvisible) {\n      acted = true;\n      await run('cast', invisible);\n    }\n\n    if (canHeal && isInjured() && hasEnoughMana()) {\n      acted = true;\n      await run('cast', heal);\n    }\n\n    if (canRefresh && needsRest() && hasEnoughMana()) {\n      acted = true;\n      await run('cast', refresh);\n    }\n\n    if (canMeditate && needsMana()) {\n      acted = true;\n      const result = await skills.meditate();\n\n      if (result === skills.BUSY) {\n        await sleep(2);\n      }\n    }\n\n    if (!acted) {\n      break;\n    }\n  }\n\n  await prompt.until(() => {\n    const ready = isRefreshed();\n\n    if (!ready) {\n      console.log('Resting...');\n    }\n\n    return ready;\n  });\n}\n","import { getAreaMetadata, getAreasForLevel } from '../data/areas';\nimport {\n  getMobFromPresence,\n  getMobIn,\n  getMobsPresence,\n  Mob,\n  MOB_ARRIVES,\n  MOB_DIES,\n  MOB_LEAVES,\n} from '../data/mobs';\nimport { Context } from '../lib';\nimport { SinglePattern } from './../lib/triggers/Pattern';\nimport { KillResult } from './kill';\n\nconst AVOID: SinglePattern[] = [\n  'Un hombre desnudo yace sobre sus propios excrementos.',\n  'Una figura humanoide resplandece detras de un brillante campo de fuerza.',\n];\n\nexport async function train(\n  {\n    log,\n    run,\n    when,\n    write,\n    plugins: { navigation: nav, prompt, stats },\n  }: Context,\n  area?: string,\n) {\n  if (area === 'test') {\n    const area = await getBestArea();\n    console.log(area.name, area);\n    return;\n  }\n\n  const arena = await getArena(area);\n  const theif = getMobIn('ladron');\n  const enemies: Mob[] = [];\n  let avoidRoom = false;\n\n  when(getMobsPresence(), ({ patterns, fullMatch, captured }) => {\n    if (patterns.some(x => AVOID.includes(x))) {\n      avoidRoom = true;\n      return;\n    }\n\n    return enemySpotted(\n      getMobFromPresence(patterns) || getMobIn(fullMatch || captured[0]),\n    );\n  });\n\n  when(MOB_ARRIVES, ({ groups }) => enemySpotted(getMobIn(groups.mob)));\n  when(\n    MOB_LEAVES,\n    ({ groups }) => groups.mob && enemyGone(getMobIn(groups.mob)),\n  );\n  when(MOB_DIES, ({ groups }) => groups.mob && enemyGone(getMobIn(groups.mob)));\n\n  const route = `${arena.path}${arena.arena}`;\n\n  write('visible');\n  write('huida');\n\n  console.log({ route });\n\n  await nav.execute(route, enterRoom);\n  return nav.recall();\n\n  async function enterRoom() {\n    if (avoidRoom) {\n      avoidRoom = false;\n      return true;\n    }\n\n    log('ENTER_ROOM');\n    await prompt.until(({ mv: { current: mv } }) => mv > 50);\n\n    while (enemies.length) {\n      if (await checkEnemies()) {\n        return false;\n      }\n\n      const recover = run('recover');\n      await when.any(\n        recover,\n        when(MOB_ARRIVES).then(() => recover.cancel()),\n      );\n\n      log('READY_TO_FIGHT!!!');\n    }\n  }\n\n  function enemySpotted(mob: Mob | null = null) {\n    if (mob && (mob !== theif || !enemies.includes(theif))) {\n      enemies.push(mob);\n    }\n  }\n\n  function enemyGone(mob: Mob | null = null) {\n    if (mob) {\n      const index = enemies.indexOf(mob);\n      if (index > -1) {\n        enemies.splice(index, 1);\n      }\n    }\n  }\n\n  async function checkEnemies() {\n    log('CHECK_ENEMIES', enemies.length);\n\n    while (enemies.length) {\n      const enemy = enemies[0];\n      const result = (await run('kill', enemy.name)) as KillResult;\n\n      if (result === 'flee') {\n        console.log('Had to run. Train over.');\n        await nav.recall();\n        return true;\n      }\n\n      if (result === 'missing') {\n        enemies.shift();\n      }\n    }\n  }\n\n  async function getArena(areaName?: string) {\n    const area = areaName ? getAreaMetadata(areaName) : await getBestArea();\n    console.log('Train at', area);\n\n    if (!area) {\n      throw new Error(`NO AREA \"${areaName}\"`);\n    }\n\n    if (!area.arena) {\n      throw new Error(`\"${area.name}\" training path is unknown`);\n    }\n\n    const path = area.path!.split('');\n    const last = path.pop();\n    const arena = Array.isArray(area.arena) ? area.arena.join('') : area.arena;\n\n    return { path: path.join(''), arena: `${last}${arena}` };\n  }\n\n  async function getBestArea() {\n    const [realm, level] = await Promise.all([\n      nav.getRealm(),\n      stats.getLevel(),\n    ]);\n\n    const areas = getAreasForLevel(realm, level);\n    const [first, ...others] = areas.filter(x => x.arena);\n\n    console.log(\n      'Selected arena',\n      first.name,\n      others.map(x => x.name),\n    );\n    return first;\n  }\n}\n","import { Context } from '../lib';\nimport { conversation } from '../util/conversation';\n\nexport async function tutorial({\n  when,\n  write,\n  run,\n  plugins: { prompt },\n}: Context) {\n  const qa = conversation(when, write);\n\n  await qa({\n    'Escribe MIRAR CARTEL para empezar el aprendizaje': 'mirar cartel',\n    'Para continuar el aprendizaje escribe NORTE': 'norte',\n    'mirame con el comando MIRAR POLARD': 'mirar polard',\n    'Escribe esto: DECIR HOLA': 'decir hola',\n    'Ahora puedes ir hacia el NORTE': 'norte',\n    'escribe COGER HOJA para cogerlo del suelo': 'coger hoja',\n    'Escribe: DAR HOJA VERNER': 'dar hoja verner',\n    'Para usarla escribe: VESTIR ARMADURA': 'vestir armadura',\n    'Ahora continua hacia el ESTE': 'este',\n    'cuando termines escribe: DECIR LISTO': 'decir listo',\n    'Ahora escribe: TIRAR MASCARA': 'tirar mascara',\n    'Ahora escribe: COGER MASCARA': 'coger mascara',\n    'Ahora escribe: VESTIR MASCARA': 'vestir mascara',\n    'Escribe ESTE para pasar al siguiente nivel de aprendizaje': 'este',\n    'para ello ves al NORTE y escribe MATAR ORCO': 'norte',\n    'Un asqueroso orco aparece para enfrentarse a ti': 'matar orco',\n    'El cadaver de el orco contiene': 'sur',\n    'Ves al ESTE para continuar tu aprendizaje': 'este',\n    'Escribiendo PRACTICAR veras la lista': 'practicar',\n\n    // pause\n\n    'PRACTICA lo que creas necesario': 'practicar luz',\n    'Practicas luz eterna': 'practicar estilo evasivo',\n    'Practicas estilo evasivo': 'decir listo',\n    'Para continuar, escribe DECIR LISTO': 'decir listo',\n\n    'Para ello escribe ENTRENAR CON': 'entrenar con',\n    'Sientes como tu con': 'entrenar sab',\n    'Sientes como tu sab': 'decir listo',\n\n    'Te llevare cuando digas DECIR LLEVAME': 'decir llevame',\n    'Ves al NORTE a matarlos': 'norte',\n  });\n\n  write('estilo evasivo');\n\n  await killAll('monstruito', 'Un monstruito que te mira mientras babea');\n  write('sur');\n\n  await when('que te encargues de los bichos del ESTE');\n  write('este');\n\n  await killAll('kobold', 'Un kobold con las manos atadas te mira fijamente');\n  write('oeste');\n\n  await when('Ahora a por los del OESTE');\n  write('oeste');\n\n  await killAll('minotauro', 'Un minotauro grunye mientras te mira fijamente');\n  write('este');\n\n  await when('Ya solo te quedan los del SUR');\n  write('sur');\n\n  await killAll('gnoll', 'Un joven gnoll esta aqui preparado para atacarte');\n  write('tirar todo');\n  write('norte');\n\n  await qa({\n    'Continua hacia ABAJO': 'abajo',\n    'escribe COMPRAR': 'lista',\n    'Un odre de cuero': 'comprar odre',\n    'Escribe BEBER ODRE': 'beber odre',\n    'Bebes agua de un odre de cuero': 'norte',\n    'Quieres escucharlos?': 'decir no',\n    'Si quieres irte simplemente escribe RECALL': 'recall',\n  });\n\n  async function killAll(mob: string, presence: string) {\n    await when('Combates para ');\n\n    let enemies = 0;\n    const sus = when(presence, () => enemies++);\n    await prompt.until();\n    sus.unsubscribe();\n\n    for (let i = 0; i < enemies; i++) {\n      await run('kill', [mob]);\n      await prompt.until();\n      write('coger todo cuerpo');\n      await prompt.until();\n      write('vestir todo');\n      await prompt.until();\n    }\n  }\n}\n","import {\n  getItemSustantive,\n  ITEM_ARTICLE,\n  ITEM_SUSTANTIVES,\n  UNWEAR,\n  WEAR,\n} from '../data/items';\nimport { Context } from '../lib';\nimport { concatRegexes } from '../lib/util/concatRegexes';\n\nexport async function wear(\n  { run, sleep, when, write, plugins: { skills } }: Context,\n  ...args: string[]\n) {\n  const items = args.length ? args : ITEM_SUSTANTIVES;\n\n  for (const item of items) {\n    for (let i = 0; i < 5; i++) {\n      if (await wearItem(item)) {\n        break;\n      }\n    }\n  }\n\n  async function wearItem(item: string) {\n    write(`coger \"${item}\"`);\n\n    const pickedUp = await when.any(\n      when(`No hay ningun ${item} aqui.`)\n        .wait(8)\n        .then(() => false),\n      when(\n        concatRegexes(/Coges/, ITEM_ARTICLE, /(?: (?:\\\\w|�)+)* /i, item),\n      ).then(() => true),\n    );\n\n    if (!pickedUp) {\n      console.warn(`Couldn't pick up \"${item}\"`);\n      return true;\n    }\n\n    if (await skills.can('identificar')) {\n      let isMetallic = false;\n      const sus = when(\n        ' es un(a) armadura_metalica,',\n        () => (isMetallic = true),\n      );\n      const identified = await run('cast', 'identificar', item);\n\n      await sleep(1);\n      sus.unsubscribe();\n\n      if (!identified) {\n        console.warn(`Couldn't identifiy \"${item}\"`);\n        await tirar(item);\n        return false;\n      }\n\n      if (isMetallic) {\n        await tirar(item);\n        return false;\n      }\n    }\n\n    write(`vestir \"${item}\"`);\n\n    const result = await when.any(\n      when(WEAR).then(() => true),\n      when(UNWEAR).then(({ groups }) => groups.item),\n      when([\n        'No tienes ese objeto.',\n        /Debes ser nivel \\w+ para usar este objeto./,\n        'No puedes vestir eso, necesita repararse.',\n        'Te esta prohibido usar ese objeto.',\n        'No puedes vestir un objeto que no te pertenece.',\n      ]).then(() => false),\n    );\n\n    if (result === false) {\n      await tirar(item);\n      return false;\n    }\n\n    if (typeof result === 'string') {\n      const other = getItemSustantive(result);\n\n      if (other) {\n        await run('cast', 'identificar', other);\n        write(`poner ${other} mochila`);\n        await when(' en una mochila ');\n      }\n    }\n\n    return true;\n  }\n\n  function tirar(item: string) {\n    write(`tirar \"${item}\"`);\n    return when('Tiras ');\n  }\n}\n","import './index.css';\n\nimport { ClientStorage } from '@amatiasq/client-storage';\nimport { dom } from '@amatiasq/dom';\n\nimport { getControlsProps, getSidebarProps, onStateChange } from '../state';\nimport { Controls } from './Controls';\nimport { Hamburger } from './Hamburger';\nimport { html, render } from './render';\nimport { Sidebar } from './Sidebar';\nimport { Terminal } from './Terminal';\n\nexport function renderUserInterface(parent: HTMLElement) {\n  const state = initState();\n  const data = state.get()!;\n\n  const terminal = new Terminal();\n\n  const hamburger = new Hamburger(data.showControls);\n  hamburger.onChange(onControlsToggle);\n\n  const main = dom`\n    <div class=\"container\">\n      ${terminal.render()}\n    </div>\n  `;\n\n  onStateChange(renderComponents);\n  renderComponents();\n\n  function renderComponents() {\n    render(\n      html`\n        <${Controls} ...${getControlsProps()} />\n        <${Sidebar} ...${getSidebarProps()} />\n      `,\n      main,\n    );\n  }\n\n  parent.appendChild(main);\n  parent.appendChild(hamburger.render());\n\n  onControlsToggle(data.showControls);\n\n  return terminal;\n\n  function onControlsToggle(value: boolean) {\n    if (value) {\n      main.classList.add('show-controls');\n      data.showControls = true;\n    } else {\n      main.classList.remove('show-controls');\n      data.showControls = false;\n    }\n\n    state.set(data);\n  }\n}\n\nfunction initState() {\n  const state = new ClientStorage<{ showControls: boolean }>('ui:state');\n  const data = state.get();\n\n  if (!data) {\n    state.set({ showControls: false });\n  }\n\n  return state;\n}\n","import api from \"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n            import content from \"!!../../node_modules/css-loader/dist/cjs.js!./index.css\";\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nexport default content.locals || {};","import { html } from './render';\n\ntype Meter = { color: string; value: number };\ntype Button = { name: string; onClick: () => void };\n\nexport type ControlProps = { meters: Meter[]; buttons: Button[] };\n\nexport function Controls(props: ControlProps) {\n  const meters = props.meters.map(\n    x => html`\n      <div class=\"meter\">\n        <div\n          class=\"bar\"\n          style=\"\n          width: ${Math.round(x.value * 100)}%;\n          background-color: ${x.color}\n        \"\n        ></div>\n      </div>\n    `,\n  );\n\n  const buttons = props.buttons.map(\n    x => html`\n      <button class=\"ui-button\" onclick=\"${x.onClick}\">${x.name}</button>\n    `,\n  );\n\n  return html`\n    <header class=\"controls\">\n      <div class=\"meters\">\n        ${meters}\n      </div>\n\n      ${buttons}\n    </div>\n  `;\n}\n","import { dom } from '@amatiasq/dom';\nimport { emitter } from '@amatiasq/emitter';\n\nexport class Hamburger {\n  private readonly $checkbox = dom<HTMLInputElement>`<input type=\"checkbox\" />`;\n  private readonly $el = dom`\n    <div class=\"hamburger\">\n      ${this.$checkbox}\n      <span></span>\n      <span></span>\n      <span></span>\n    </div>\n  `;\n\n  private readonly emitChange = emitter<boolean>();\n  readonly onChange = this.emitChange.subscribe;\n\n  constructor(initialState = false) {\n    this.toggle = this.toggle.bind(this);\n    this.$checkbox.checked = initialState;\n  }\n\n  render() {\n    this.$checkbox.addEventListener('change', this.toggle);\n\n    if (this.$checkbox.checked) {\n      this.toggle();\n    }\n\n    return this.$el;\n  }\n\n  toggle() {\n    this.emitChange(this.$checkbox.checked);\n  }\n}\n","import { ComponentChildren } from 'preact';\n\nimport { SinglePattern } from '../lib/triggers/Pattern';\nimport { PatternMatcher } from '../lib/triggers/PatternMatcher';\nimport { Workflow } from '../lib/workflow/Workflow';\nimport { html } from './render';\n\nexport type SidebarProps = {\n  workflows: Workflow[];\n};\n\nexport function Sidebar(props: SidebarProps) {\n  return html`\n    <aside class=\"sidebar\">\n      <div class=\"workflows\">\n        <h1 class=\"title\">Workflows</h1>\n        <ul class=\"workflow-list\">\n          ${props.workflows.map(\n            x => html`<${WorkflowComponent} workflow=${x} />`,\n          )}\n        </ul>\n      </div>\n    </aside>\n  `;\n}\n\ntype WorkflowProp = { workflow: Workflow };\n\nfunction WorkflowComponent({ workflow }: WorkflowProp) {\n  const { isEnabled, isRunning, instancesRunning } = workflow;\n  const instances = instancesRunning > 1 ? ` (${instancesRunning})` : '';\n  const name = `${workflow.name}${instances}`;\n\n  const classes = [\n    'workflow',\n    isRunning ? 'running' : 'idle',\n    isEnabled ? 'enabled' : 'disabled',\n    'expanded',\n    // this.expanded.has(workflow) ? 'expanded' : null,\n  ];\n\n  return html`\n    <li class=\"${classes.join(' ')}\">\n      <div class=\"workflow-content\">\n        <header>\n          <h3 class=\"name\">${name}</h3>\n          <${WorkflowActions} workflow=${workflow} />\n        </header>\n\n        <${WorkflowTriggers} workflow=${workflow} />\n      </div>\n    </li>\n  `;\n}\n\nfunction WorkflowActions({ workflow }: WorkflowProp) {\n  const { isEnabled, isRunning } = workflow;\n\n  const actions = [\n    isEnabled\n      ? html`\n        <${Action} className=\"enable-control\" onClick=${() =>\n          workflow.disable()}>\n          <${Icon} name=\"check\" />\n          <${Icon} name=\"times\" />\n        </Button>\n      `\n      : html`\n        <${Action} className=\"enable-control\" onClick=${() =>\n          workflow.enable()}>\n          <${Icon} name=\"times\" />\n          <${Icon} name=\"check\" />\n        </Button>\n      `,\n  ];\n\n  if (isEnabled) {\n    actions.push(\n      isRunning\n        ? html`\n          <${Action} onClick=${() => workflow.stop()}>\n            <${Icon} name=\"stop\" />\n          </Button>\n        `\n        : html`\n          <${Action} onClick=${() => workflow.execute()}>\n            <${Icon} name=\"play\" />\n          </Button>\n        `,\n    );\n  }\n\n  return actions;\n}\n\nconst listening = new WeakMap<PatternMatcher, true>();\n\nfunction WorkflowTriggers({ workflow: { triggers } }: WorkflowProp) {\n  const items = triggers.map(matcher => {\n    const rows = matcher.patterns.map(x => {\n      const blink = blinking.has(x) ? 'blink' : '';\n      return html`<span class=\"pattern ${blink}\">${x}</span>`;\n    });\n\n    if (!listening.has(matcher)) {\n      matcher.onMatch(({ patterns }) => patterns.forEach(blink));\n      listening.set(matcher, true);\n    }\n\n    return html`<li class=\"trigger\">${rows}</li>`;\n  });\n\n  return html`<ul class=\"triggers\">\n    ${items}\n  </ul>`;\n}\n\ntype ButtonProps = {\n  className?: string;\n  children: ComponentChildren;\n  onClick: (event: MouseEvent) => void;\n};\n\nfunction Action({ children, className, onClick }: ButtonProps) {\n  return html`\n    <button class=\"action ${className}\" onClick=\"${onClick}\">\n      ${children}\n    </button>\n  `;\n}\n\nfunction Icon({ name }: { name: string }) {\n  return html`<i class=\"fas fa-${name}\"></i>`;\n}\n\nconst blinking = new Map<SinglePattern, any>();\n\nfunction blink(pattern: SinglePattern) {\n  if (blinking.has(pattern)) {\n    clearTimeout(blinking.get(pattern));\n  }\n\n  blinking.set(\n    pattern,\n    setTimeout(() => blinking.delete(pattern)),\n  );\n}\n","import Convert from 'ansi-to-html';\n\nimport { ClientStorage } from '@amatiasq/client-storage';\nimport { dom } from '@amatiasq/dom';\nimport { emitter } from '@amatiasq/emitter';\n\nconst convert = new Convert();\nconst history = new ClientStorage<string[]>('mud:command-history');\nconst MIN_INPUT_SIZE = 3;\n\nexport class Terminal {\n  private readonly $log = dom`<span class=\"log\" aria-live></span>`;\n  private readonly $input = dom<HTMLInputElement>`<input type=\"text\" size=\"${MIN_INPUT_SIZE}\" autofocus>`;\n  private readonly $el = dom`\n    <main class=\"terminal\">\n      <div class=\"scroll-bottom\">\n        ${this.$log}\n        ${this.$input}\n      </div>\n    </main>\n  `;\n\n  private readonly history: string[] = history.get() || [];\n  private lastChunk: string = '';\n  private histPos = 0;\n\n  private readonly emitSubmit = emitter<string>();\n  readonly onSubmit = this.emitSubmit.subscribe;\n\n  constructor() {\n    this.onKeyDown = this.onKeyDown.bind(this);\n    this.onKeyUp = this.onKeyUp.bind(this);\n  }\n\n  focus() {\n    this.$input.focus();\n  }\n\n  render() {\n    this.$el.addEventListener('click', () =>\n      setTimeout(() => !userHasSelectedText() && this.$input.focus(), 80),\n    );\n\n    this.$input.addEventListener('keydown', this.onKeyDown);\n    this.$input.addEventListener('keyup', this.onKeyUp);\n\n    return this.$el;\n  }\n\n  write(data: string) {\n    const content = `${this.lastChunk}${fixLineEndings(data)}`.split(/\\n\\n+/);\n    this.lastChunk = content.pop()!;\n\n    for (const block of content) {\n      this.$log.before(dom`<p>${{ __html__: asciiToHtml(block) }}</p>`);\n    }\n\n    this.$log.innerHTML = asciiToHtml(this.lastChunk);\n    this.clearLog();\n  }\n\n  private clearLog() {\n    const area = this.$log.parentElement!;\n    const removeCount = area.children.length - 2000;\n\n    for (let i = 0; i < removeCount; i++) {\n      area.removeChild(area.firstChild!);\n    }\n  }\n\n  private onKeyDown(event: KeyboardEvent) {\n    if (event.code === 'Enter') {\n      this.submit();\n    }\n\n    if (event.code === 'ArrowUp') {\n      this.loadHistory(1);\n    }\n\n    if (event.code === 'ArrowDown') {\n      this.loadHistory(-1);\n    }\n\n    this.onKeyUp(event);\n  }\n\n  private onKeyUp(event: KeyboardEvent) {\n    const value = this.$input.value;\n    this.history[0] = value;\n    this.$input.size = value.length + MIN_INPUT_SIZE;\n  }\n\n  private submit() {\n    const { value } = this.$input;\n    this.$input.value = '';\n    this.histPos = 0;\n\n    if (value && value !== this.history[1]) {\n      this.history.shift();\n      this.history.unshift(value);\n      this.history.unshift('');\n      history.set(this.history);\n    }\n\n    for (const command of value.split(/;\\s+/)) {\n      this.emitSubmit(command);\n    }\n  }\n\n  private loadHistory(modifier: 1 | -1) {\n    if (!this.history.length) {\n      return;\n    }\n\n    this.history[this.histPos] = this.$input.value;\n    this.histPos = clamp(this.histPos + modifier, 0, this.history.length - 1);\n    this.$input.value = this.history[this.histPos];\n  }\n}\n\nfunction asciiToHtml(text: string) {\n  const escaped = escapeHtml(text);\n  const html = convert.toHtml(escaped);\n  return html.replace(/\\n/g, '<br>');\n}\n\nfunction fixLineEndings(text: string) {\n  return text.replace(/\\r/g, '');\n}\n\nfunction escapeHtml(unsafe: string) {\n  return unsafe\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#039;')\n    .replace(/  +/g, x => '&nbsp;'.repeat(x.length));\n}\n\nfunction userHasSelectedText() {\n  const selection = getSelection();\n  return selection && selection.type === 'Range';\n}\n\nfunction clamp(value: number, min: number, max: number) {\n  return value < min ? min : value > max ? max : value;\n}\n","export function getQueryParams() {\n  const result: { [key: string]: string } = {};\n\n  window.location.search\n    .substr(1)\n    .split('&')\n    .map(entry => entry.split('=').map(decodeURIComponent))\n    .forEach(([key, value]) => (result[key] = value));\n\n  return result;\n}\n"],"sourceRoot":""}
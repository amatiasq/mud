{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/ui/render.ts","webpack:///./src/lib/util/wait.ts","webpack:///./src/ui/index.css","webpack:///./src/ui/Controls/Controls.css","webpack:///./src/ui/Hamburger/Hamburger.css","webpack:///./src/ui/Sidebar/Sidebar.css","webpack:///./src/ui/Terminal/Terminal.css","webpack:///./src/lib/util/singleExecution.ts","webpack:///./src/lib/triggers/PatternPromise.ts","webpack:///./src/plugins/promptPlugin.ts","webpack:///./src/lib/PluginContext.ts","webpack:///./src/lib/ExecutionAbortedError.ts","webpack:///./src/lib/util/bindAll.ts","webpack:///./src/index.ts","webpack:///./src/lib/Mud.ts","webpack:///./src/plugins/index.ts","webpack:///./src/plugins/chatPlugin.ts","webpack:///./src/lib/util/requestNotificationPermission.ts","webpack:///./src/plugins/inventoryPlugin.ts","webpack:///./src/plugins/navigationPlugin.ts","webpack:///./src/lib/triggers/PatternPromiseTimeoutError.ts","webpack:///./src/plugins/skillsPlugin.ts","webpack:///./src/lib/util/concatRegexes.ts","webpack:///./src/plugins/login.ts","webpack:///./src/lib/triggers/TriggerCollection.ts","webpack:///./src/lib/triggers/PatternMatcher.ts","webpack:///./src/lib/util/trimEnd.ts","webpack:///./src/lib/triggers/PatternResult.ts","webpack:///./src/lib/workflow/Context.ts","webpack:///./src/lib/workflow/MissingPluginError.ts","webpack:///./src/lib/workflow/Workflow.ts","webpack:///./src/lib/workflow/WorkflowNotFoundError.ts","webpack:///./src/lib/RemoteTelnet.ts","webpack:///./src/registerWorkflows.ts","webpack:///./src/workflows/dope.ts","webpack:///./src/workflows/drink.ts","webpack:///./src/workflows/eat.ts","webpack:///./src/workflows/fight.ts","webpack:///./src/workflows/idle.ts","webpack:///./src/workflows/rest.ts","webpack:///./src/workflows/train.ts","webpack:///./src/socket.ts","webpack:///./src/ui/index.ts","webpack:///./src/ui/index.css?3ef0","webpack:///./src/ui/Controls/Controls.ts","webpack:///./src/ui/Controls/Controls.css?eebb","webpack:///./src/ui/Controls/Controls.html","webpack:///./src/ui/Hamburger/Hamburger.ts","webpack:///./src/ui/Hamburger/Hamburger.css?b2d9","webpack:///./src/ui/Hamburger/Hamburger.html","webpack:///./src/ui/index.html","webpack:///./src/ui/Sidebar/Sidebar.ts","webpack:///./src/ui/Sidebar/Sidebar.css?e0a4","webpack:///./src/ui/Sidebar/Sidebar.html","webpack:///./src/ui/Terminal/Terminal.ts","webpack:///./src/ui/Terminal/Terminal.css?82ae","webpack:///./src/ui/Terminal/Terminal.html","webpack:///./src/util/getPassword.ts","webpack:///./src/util/getQueryParams.ts"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","0","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","clone","el","cloneNode","template","config","html","document","createElement","innerHTML","renderHtml","instance","HTMLTemplateElement","content","selector","operator","entries","querySelector","console","error","assign","$","seconds","Promise","resolve","setTimeout","___CSS_LOADER_EXPORT___","fn","running","then","x","executor","_reject","super","reject","this","forceReject","wait","PatternPromiseTimeoutError","race","PROMPT","join","FPROMPT","replace","PROMPT_DETECTOR","RegExp","Stat","total","current","toInt","parseInt","async","when","write","isInvisible","stats","hp","mana","mv","exp","gold","enemy","update","emitter","timeout","catch","finally","groups","g","hpCurr","hpTotal","mCurr","mTotal","mvCurr","mvTotal","Boolean","invis","waitForPrompt","getPercent","stat","percent","until","predicate","unsubscribe","subscribe","onUpdate","isFighting","PluginContext","username","triggers","send","subscriptions","isPrintingLogs","isAborted","bindAll","command","checkNotAborted","log","pattern","handler","options","add","forEach","args","ExecutionAbortedError","Error","target","source","proto","getOwnPropertyNames","filter","getOwnPropertyDescriptor","method","user","server","getQueryParams","host","port","split","pass","getPassword","terminal","controls","renderUserInterface","body","telnet","RemoteTelnet","socket","onConnected","mud","Mud","onCommand","onSubmit","userInput","login","registerWorkflows","addMeter","getPlugin","connectStats","addButton","invokeWorkflow","onData","connect","onbeforeunload","isConnected","close","TriggerCollection","workflows","emitCommand","whenLoggedIn","emitLoggedIn","process","text","removeAsciiCodes","context","plugins","initializePlugins","dispose","run","params","workflow","Workflow","executeWorkflow","WorkflowNotFoundError","logs","createWorkflowContext","printLogs","promise","execute","abort","Context","chat","chatPlugin","inventory","inventoryPlugin","navigation","navigationPlugin","prompt","promptPlugin","skills","skillsPlugin","promises","map","plugin","all","fromEntries","receive","message","addMessage","from","notify","sent","to","requestNotificationPermission","Notification","partial","time","Date","now","other","history","set","tell","ClientStorage","whisper","permission","requestPermission","warn","INVENTORY_DETECTOR","isInitialized","items","refresh","singleExecution","captured","_","trim","item","match","captureLength","has","search","hasSync","Array","isArray","find","keys","CLOSED","aliases","e","w","u","k","h","isNavigating","landingAtRecall","isAtRecall","directions","roomChanged","closed","includes","dir","canGo","direction","go","recall","substr","step","path","times","repeat","waitForRecall","PatternPromise","onRoomChange","isClosed","startsWith","FAILURE","SUCCESS","NOT_AVAILABLE","undefined","SKILL","SKILLS_DETECTOR","concatRegexes","isSpellRunning","skill","matchAll","canLearn","ensureInitiated","castSpell","validName","success","any","BUSY","FAILED","CASTED","regexes","toString","flags","uniq","Set","password","initialize","await","once","patterns","queue","isProcessing","arguments","watch","entry","PatternMatcher","delete","original","sub","splitted","last","pop","lines","line","Math","max","String","buffer","clear","trimEnd","matching","testPattern","PatternResult","output","indexOf","test","maxLength","isRegex","merge","a","b","haystack","reduce","runWorkflow","finish","Proxy","MissingPluginError","executionCount","currentExecutions","iteration","_isConnected","emitConnected","emitClose","onClose","emitData","onMessageType","registerWorkflow","fight","train","dope","drink","eat","idle","rest","memory","runForever","shouldHeal","defineShould","shouldRefresh","casting","ensureAlways","spell","trigger","repeatUntilCasted","min","multiplier","clapped","hypot","isFontAvailable","isBottleFull","getWaterBottle","bottle","nav","eatSomething","food","getFoodFromBag","getFoodFromInventory","err","createFood","buyFood","isInDanger","isExhausted","needsHospital","attackSpells","action","tryNTimes","enemies","enemySpotted","prey","enemyGone","index","nextRoom","serverUri","location","origin","DEFAULT_PORT","ClientSocket","onMessage","debug","reload","parent","state","showControls","initState","dom","render","main","sidebar","Sidebar","Controls","Terminal","appendChild","hamburger","Hamburger","onChange","classList","remove","locals","meterTpl","buttonTpl","color","observable","fragment","style","setProperty","round","onClick","button","textContent","addEventListener","initialState","checkbox","emitChange","toggle","checked","convert","asciiToHtml","escaped","toHtml","userHasSelectedText","selection","getSelection","type","$log","$input","histPos","emitSubmit","onKey","focus","$parent","parentElement","block","insertBefore","scrollTop","scrollHeight","event","code","submit","loadHistory","size","unshift","modifier","storage","stored","input","decodeURIComponent"],"mappings":"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","file":"main.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t0: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([21,1]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","export function render(\n  template: string | HTMLElement,\n  config?: Record<string, (el: HTMLElement) => void>,\n) {\n  if (typeof template === 'string') {\n    template = renderHtml(template);\n  }\n\n  const instance =\n    template instanceof HTMLTemplateElement\n      ? clone(template.content)\n      : clone(template);\n\n  if (config) {\n    for (const [selector, operator] of Object.entries(config)) {\n      const el = instance.querySelector(selector) as HTMLElement;\n\n      if (el) {\n        operator(el);\n      } else {\n        console.error(`Selector ${selector} returned no results`);\n      }\n    }\n  }\n\n  return Object.assign(instance, {\n    $: <T extends HTMLElement>(selector: string) =>\n      instance.querySelector(selector) as T,\n  });\n}\n\nfunction renderHtml(html: string) {\n  const template = document.createElement('template');\n  template.innerHTML = html;\n  return template;\n}\n\nfunction clone<T extends Node>(el: T) {\n  return el.cloneNode(true) as T;\n}\n","export function wait(seconds: number) {\n  return new Promise<void>(resolve => setTimeout(resolve, seconds * 1000));\n}\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/cssWithMappingToString.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"body {\\n  --background-color: #1c1c1c;\\n  --border-color: #484848;\\n}\\n\\n.container {\\n  height: 100%;\\n  display: grid;\\n  grid-template-rows: 1fr;\\n  grid-template-columns: 1fr;\\n  grid-template-areas: 'terminal';\\n}\\n\\n.container.show-controls {\\n  grid-template-rows: 50px auto;\\n  grid-template-columns: 9fr 3fr;\\n  grid-template-areas:\\n    'controls sidebar'\\n    'terminal sidebar';\\n}\\n\\n.terminal {\\n  grid-area: terminal;\\n}\\n\\n.sidebar {\\n  grid-area: sidebar;\\n  background-color: var(--background-color);\\n  border-left: 1px solid var(--border-color);\\n}\\n\\n.controls {\\n  grid-area: controls;\\n  background-color: var(--background-color);\\n  border-bottom: 1px solid var(--border-color);\\n}\\n\\n.container:not(.show-controls) .sidebar,\\n.container:not(.show-controls) .controls {\\n  display: none;\\n}\\n\", \"\",{\"version\":3,\"sources\":[\"webpack://src/ui/index.css\"],\"names\":[],\"mappings\":\"AAAA;EACE,2BAA2B;EAC3B,uBAAuB;AACzB;;AAEA;EACE,YAAY;EACZ,aAAa;EACb,uBAAuB;EACvB,0BAA0B;EAC1B,+BAA+B;AACjC;;AAEA;EACE,6BAA6B;EAC7B,8BAA8B;EAC9B;;sBAEoB;AACtB;;AAEA;EACE,mBAAmB;AACrB;;AAEA;EACE,kBAAkB;EAClB,yCAAyC;EACzC,0CAA0C;AAC5C;;AAEA;EACE,mBAAmB;EACnB,yCAAyC;EACzC,4CAA4C;AAC9C;;AAEA;;EAEE,aAAa;AACf\",\"sourcesContent\":[\"body {\\n  --background-color: #1c1c1c;\\n  --border-color: #484848;\\n}\\n\\n.container {\\n  height: 100%;\\n  display: grid;\\n  grid-template-rows: 1fr;\\n  grid-template-columns: 1fr;\\n  grid-template-areas: 'terminal';\\n}\\n\\n.container.show-controls {\\n  grid-template-rows: 50px auto;\\n  grid-template-columns: 9fr 3fr;\\n  grid-template-areas:\\n    'controls sidebar'\\n    'terminal sidebar';\\n}\\n\\n.terminal {\\n  grid-area: terminal;\\n}\\n\\n.sidebar {\\n  grid-area: sidebar;\\n  background-color: var(--background-color);\\n  border-left: 1px solid var(--border-color);\\n}\\n\\n.controls {\\n  grid-area: controls;\\n  background-color: var(--background-color);\\n  border-bottom: 1px solid var(--border-color);\\n}\\n\\n.container:not(.show-controls) .sidebar,\\n.container:not(.show-controls) .controls {\\n  display: none;\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/cssWithMappingToString.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".controls {\\n  display: flex;\\n  align-items: stretch;\\n}\\n\\n.controls .meter {\\n  width: 100px;\\n  margin: 8px;\\n  margin-right: 0;\\n  border: 1px solid var(--border-color);\\n  --color: white;\\n  --value: 100%;\\n}\\n\\n.controls .meter .bar {\\n  height: 100%;\\n  width: var(--value);\\n  background-color: var(--color);\\n}\\n\", \"\",{\"version\":3,\"sources\":[\"webpack://src/ui/Controls/Controls.css\"],\"names\":[],\"mappings\":\"AAAA;EACE,aAAa;EACb,oBAAoB;AACtB;;AAEA;EACE,YAAY;EACZ,WAAW;EACX,eAAe;EACf,qCAAqC;EACrC,cAAc;EACd,aAAa;AACf;;AAEA;EACE,YAAY;EACZ,mBAAmB;EACnB,8BAA8B;AAChC\",\"sourcesContent\":[\".controls {\\n  display: flex;\\n  align-items: stretch;\\n}\\n\\n.controls .meter {\\n  width: 100px;\\n  margin: 8px;\\n  margin-right: 0;\\n  border: 1px solid var(--border-color);\\n  --color: white;\\n  --value: 100%;\\n}\\n\\n.controls .meter .bar {\\n  height: 100%;\\n  width: var(--value);\\n  background-color: var(--color);\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/cssWithMappingToString.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".hamburger {\\n  display: inline-block;\\n  position: absolute;\\n  top: 24px;\\n  right: 40px;\\n  z-index: 1;\\n  -webkit-user-select: none;\\n  user-select: none;\\n}\\n\\n.hamburger input {\\n  display: block;\\n  width: 40px;\\n  height: 32px;\\n  position: absolute;\\n  top: -7px;\\n  left: -5px;\\n  cursor: pointer;\\n  opacity: 0; /* hide this */\\n  z-index: 2; /* and place it over the hamburger */\\n  -webkit-touch-callout: none;\\n}\\n\\n.hamburger span {\\n  display: block;\\n  width: 33px;\\n  height: 4px;\\n  margin-bottom: 5px;\\n  position: relative;\\n  background: #cdcdcd;\\n  border-radius: 3px;\\n  z-index: 1;\\n  transform-origin: center right;\\n  transition: transform 0.5s cubic-bezier(0.77, 0.2, 0.05, 1),\\n    background 0.5s cubic-bezier(0.77, 0.2, 0.05, 1), opacity 0.55s ease;\\n}\\n\\n/*\\n * Transform all the slices of hamburger\\n * into a crossmark.\\n */\\n.hamburger input:checked ~ span:nth-of-type(2) {\\n  opacity: 0;\\n  transform: rotate(0deg) scale(0.2, 0.2);\\n}\\n\\n.hamburger input:checked ~ span:first-of-type {\\n  transform: rotate(-45deg) translate(0, -4px);\\n}\\n\\n.hamburger input:checked ~ span:last-of-type {\\n  transform: rotate(45deg) translate(0, 4px);\\n}\\n\", \"\",{\"version\":3,\"sources\":[\"webpack://src/ui/Hamburger/Hamburger.css\"],\"names\":[],\"mappings\":\"AAAA;EACE,qBAAqB;EACrB,kBAAkB;EAClB,SAAS;EACT,WAAW;EACX,UAAU;EACV,yBAAyB;EACzB,iBAAiB;AACnB;;AAEA;EACE,cAAc;EACd,WAAW;EACX,YAAY;EACZ,kBAAkB;EAClB,SAAS;EACT,UAAU;EACV,eAAe;EACf,UAAU,EAAE,cAAc;EAC1B,UAAU,EAAE,oCAAoC;EAChD,2BAA2B;AAC7B;;AAEA;EACE,cAAc;EACd,WAAW;EACX,WAAW;EACX,kBAAkB;EAClB,kBAAkB;EAClB,mBAAmB;EACnB,kBAAkB;EAClB,UAAU;EACV,8BAA8B;EAC9B;wEACsE;AACxE;;AAEA;;;EAGE;AACF;EACE,UAAU;EACV,uCAAuC;AACzC;;AAEA;EACE,4CAA4C;AAC9C;;AAEA;EACE,0CAA0C;AAC5C\",\"sourcesContent\":[\".hamburger {\\n  display: inline-block;\\n  position: absolute;\\n  top: 24px;\\n  right: 40px;\\n  z-index: 1;\\n  -webkit-user-select: none;\\n  user-select: none;\\n}\\n\\n.hamburger input {\\n  display: block;\\n  width: 40px;\\n  height: 32px;\\n  position: absolute;\\n  top: -7px;\\n  left: -5px;\\n  cursor: pointer;\\n  opacity: 0; /* hide this */\\n  z-index: 2; /* and place it over the hamburger */\\n  -webkit-touch-callout: none;\\n}\\n\\n.hamburger span {\\n  display: block;\\n  width: 33px;\\n  height: 4px;\\n  margin-bottom: 5px;\\n  position: relative;\\n  background: #cdcdcd;\\n  border-radius: 3px;\\n  z-index: 1;\\n  transform-origin: center right;\\n  transition: transform 0.5s cubic-bezier(0.77, 0.2, 0.05, 1),\\n    background 0.5s cubic-bezier(0.77, 0.2, 0.05, 1), opacity 0.55s ease;\\n}\\n\\n/*\\n * Transform all the slices of hamburger\\n * into a crossmark.\\n */\\n.hamburger input:checked ~ span:nth-of-type(2) {\\n  opacity: 0;\\n  transform: rotate(0deg) scale(0.2, 0.2);\\n}\\n\\n.hamburger input:checked ~ span:first-of-type {\\n  transform: rotate(-45deg) translate(0, -4px);\\n}\\n\\n.hamburger input:checked ~ span:last-of-type {\\n  transform: rotate(45deg) translate(0, 4px);\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/cssWithMappingToString.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".sidebar {\\n}\\n\", \"\",{\"version\":3,\"sources\":[\"webpack://src/ui/Sidebar/Sidebar.css\"],\"names\":[],\"mappings\":\"AAAA;AACA\",\"sourcesContent\":[\".sidebar {\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/cssWithMappingToString.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".terminal {\\n  grid-area: terminal;\\n  overflow-x: hidden;\\n  overflow-y: auto;\\n  -ms-overflow-style: none; /* IE and Edge */\\n  scrollbar-width: none; /* Firefox */\\n}\\n\\n.terminal::-webkit-scrollbar {\\n  display: none;\\n}\\n\\n.terminal p {\\n  margin: 1em 0;\\n}\\n\\n.terminal input {\\n  background-color: transparent;\\n  border: none;\\n  color: white;\\n  display: inline-block;\\n  font-family: monospace;\\n  outline: none;\\n}\\n\", \"\",{\"version\":3,\"sources\":[\"webpack://src/ui/Terminal/Terminal.css\"],\"names\":[],\"mappings\":\"AAAA;EACE,mBAAmB;EACnB,kBAAkB;EAClB,gBAAgB;EAChB,wBAAwB,EAAE,gBAAgB;EAC1C,qBAAqB,EAAE,YAAY;AACrC;;AAEA;EACE,aAAa;AACf;;AAEA;EACE,aAAa;AACf;;AAEA;EACE,6BAA6B;EAC7B,YAAY;EACZ,YAAY;EACZ,qBAAqB;EACrB,sBAAsB;EACtB,aAAa;AACf\",\"sourcesContent\":[\".terminal {\\n  grid-area: terminal;\\n  overflow-x: hidden;\\n  overflow-y: auto;\\n  -ms-overflow-style: none; /* IE and Edge */\\n  scrollbar-width: none; /* Firefox */\\n}\\n\\n.terminal::-webkit-scrollbar {\\n  display: none;\\n}\\n\\n.terminal p {\\n  margin: 1em 0;\\n}\\n\\n.terminal input {\\n  background-color: transparent;\\n  border: none;\\n  color: white;\\n  display: inline-block;\\n  font-family: monospace;\\n  outline: none;\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","export function singleExecution<Return>(fn: () => Promise<Return>) {\n  let running: Promise<Return> | null = null;\n\n  return () => {\n    if (running) {\n      return running;\n    }\n\n    running = fn().then(x => {\n      running = null;\n      return x;\n    });\n\n    return running;\n  };\n}\n","import { wait } from '../util/wait';\nimport { PatternMatchSubscription } from './PatternMatchSubscription';\nimport { PatternPromiseTimeoutError } from './PatternPromiseTimeoutError';\nimport { PatternResult } from './PatternResult';\n\nexport class PatternPromise\n  extends Promise<PatternResult>\n  implements PatternMatchSubscription {\n  private forceReject!: (reason?: any) => void;\n\n  constructor(\n    executor: (\n      resolve: (value?: PatternResult | PromiseLike<PatternResult>) => void,\n      reject: (reason?: any) => void,\n    ) => void,\n  ) {\n    let _reject!: (reason?: any) => void;\n\n    super((resolve, reject) => {\n      _reject = reject;\n      executor(resolve, reject);\n    });\n\n    this.forceReject = _reject;\n  }\n\n  timeout(seconds: number) {\n    wait(seconds).then(() =>\n      this.forceReject(new PatternPromiseTimeoutError()),\n    );\n\n    return this as Promise<PatternResult>;\n  }\n\n  wait(seconds: number) {\n    return Promise.race([this, wait(seconds)]);\n  }\n\n  unsubscribe(): void {\n    this.forceReject('aborted');\n  }\n\n  once() {\n    return this;\n  }\n}\n","import { emitter } from '@amatiasq/emitter';\n\nimport { PluginContext } from '../lib/PluginContext';\n\nconst PROMPT = [\n  '&W<',\n  '&R%h/%Hhp ',\n  '&C%m/%Mm ',\n  '&G%v/%Vmv ',\n  '&P%Xxp ',\n  '&Y%gg',\n  '&W> ',\n  '&W%A ',\n  '\\n',\n].join('');\n\nconst FPROMPT = PROMPT.replace('&W>', ' &R%E&W>');\n\nexport const PROMPT_DETECTOR = new RegExp(\n  [\n    '<',\n    '(?<hpCurr>\\\\d+)/(?<hpTotal>\\\\d+)hp ',\n    '(?<mCurr>\\\\d+)/(?<mTotal>\\\\d+)m ',\n    '(?<mvCurr>\\\\d+)/(?<mvTotal>\\\\d+)mv ',\n    '(?<exp>(\\\\d|,)+)xp ',\n    '(?<gold>(\\\\d|,)+)g',\n    '( \\\\((?<enemy>\\\\d+)%\\\\))?',\n    '> (?<invis>I)?',\n  ].join(''),\n);\n\nclass Stat {\n  total = 0;\n  current = 0;\n\n  get percent() {\n    return this.total ? (1 / this.total) * this.current : 0;\n  }\n}\n\nexport async function promptPlugin({ when, write }: PluginContext) {\n  let isInvisible = false;\n\n  const stats = {\n    hp: new Stat(),\n    mana: new Stat(),\n    mv: new Stat(),\n    exp: 0,\n    gold: 0,\n    enemy: null as number | null,\n\n    get isFighting() {\n      return stats.enemy !== null;\n    },\n  };\n\n  type Stats = typeof stats;\n\n  const update = emitter<typeof stats>();\n\n  when(PROMPT_DETECTOR)\n    .timeout(1)\n    .catch(setPrompt)\n    .finally(() => {\n      when(PROMPT_DETECTOR, ({ groups: g }) => {\n        stats.hp.current = toInt(g.hpCurr);\n        stats.hp.total = toInt(g.hpTotal);\n        stats.mana.current = toInt(g.mCurr);\n        stats.mana.total = toInt(g.mTotal);\n        stats.mv.current = toInt(g.mvCurr);\n        stats.mv.total = toInt(g.mvTotal);\n        stats.exp = toInt(g.exp);\n        stats.gold = toInt(g.gold);\n        stats.enemy = g.enemy ? toInt(g.enemy) : null;\n        isInvisible = Boolean(g.invis);\n        update(stats);\n      });\n    });\n\n  return {\n    waitForPrompt,\n    getPercent,\n    until,\n    onUpdate: update.subscribe,\n\n    get isExhausted() {\n      return stats.mv.current <= 15;\n    },\n\n    get isInjured() {\n      return stats.hp.percent !== 1;\n    },\n\n    get needsHospital() {\n      return stats.hp.percent < 0.3;\n    },\n\n    get isInDanger() {\n      return stats.hp.percent < 0.1;\n    },\n\n    get isFighting() {\n      return stats.isFighting;\n    },\n\n    get isInvisible() {\n      return isInvisible;\n    },\n  };\n\n  function setPrompt() {\n    write(`prompt ${PROMPT}`);\n    write(`fprompt ${FPROMPT}`);\n  }\n\n  function waitForPrompt() {\n    return when(PROMPT_DETECTOR);\n  }\n\n  function getPercent(stat: 'hp' | 'mana' | 'mv') {\n    return stats[stat].percent;\n  }\n\n  function until(predicate: (stats: Stats) => boolean) {\n    if (predicate(stats)) {\n      return true;\n    }\n\n    return new Promise(resolve => {\n      const unsubscribe = update.subscribe((stats: Stats) => {\n        if (predicate(stats)) {\n          unsubscribe();\n          resolve(stats);\n        }\n      });\n    });\n  }\n}\n\nfunction toInt(value: string) {\n  return parseInt(value.replace(/,/g, ''), 10);\n}\n","import { ExecutionAbortedError } from './ExecutionAbortedError';\nimport { Pattern } from './triggers/Pattern';\nimport { PatternMatchSubscription } from './triggers/PatternMatchSubscription';\nimport { PatternOptions } from './triggers/PatternOptions';\nimport { PatternPromise } from './triggers/PatternPromise';\nimport { PatternResult } from './triggers/PatternResult';\nimport { TriggerCollection } from './triggers/TriggerCollection';\nimport { bindAll } from './util/bindAll';\nimport { wait } from './util/wait';\n\nexport class PluginContext {\n  protected readonly subscriptions: PatternMatchSubscription[] = [];\n  protected isPrintingLogs = false;\n  private isAborted = false;\n\n  get printLogs() {\n    this.isPrintingLogs = true;\n    return null;\n  }\n\n  constructor(\n    readonly name: string,\n    readonly username: string,\n    protected readonly triggers: TriggerCollection,\n    protected readonly send: (command: string) => void,\n  ) {\n    bindAll(this, PluginContext);\n  }\n\n  write(command: string) {\n    this.checkNotAborted();\n    this.log(`[WRITE]`, command);\n    this.send(command);\n  }\n\n  when(pattern: Pattern, options?: PatternOptions): PatternPromise;\n  when(\n    pattern: Pattern,\n    handler: (result: PatternResult) => void,\n    options?: PatternOptions,\n  ): PatternMatchSubscription;\n  when(\n    pattern: Pattern,\n    handler?: ((result: PatternResult) => void) | PatternOptions,\n    options?: PatternOptions,\n  ) {\n    this.checkNotAborted();\n    this.log('[WATCH]', pattern);\n\n    if (typeof handler === 'function') {\n      return this.triggers.add(pattern, handler, options);\n    } else {\n      return this.triggers.add(pattern, handler);\n    }\n  }\n\n  sleep(seconds: number) {\n    this.checkNotAborted();\n    this.log('[SLEEP]', seconds);\n    return wait(seconds);\n  }\n\n  abort() {\n    this.isAborted = true;\n  }\n\n  dispose() {\n    this.log('DISPOSE');\n    this.subscriptions.forEach(x => x.unsubscribe());\n  }\n\n  log(...args: Parameters<Console['log']>) {\n    this.checkNotAborted();\n\n    if (this.isPrintingLogs) {\n      console.log(`[${this.name}]`, ...args);\n    }\n  }\n\n  protected checkNotAborted() {\n    if (this.isAborted) {\n      throw new ExecutionAbortedError();\n    }\n  }\n}\n","export class ExecutionAbortedError extends Error {}\n","export function bindAll<T extends {}>(\n  target: T,\n  source: { new (...args: any[]): T },\n) {\n  const proto = source.prototype;\n  const keys = Object.getOwnPropertyNames(proto) as (keyof T)[];\n\n  keys\n    .filter(key => {\n      const descriptor = Object.getOwnPropertyDescriptor(proto, key)!;\n      return typeof descriptor.value === 'function';\n    })\n    .forEach(method => {\n      target[method] = (target[method] as any).bind(target);\n    });\n}\n","import { emitter } from '@amatiasq/emitter';\n\nimport { Mud } from './lib/Mud';\nimport { RemoteTelnet } from './lib/RemoteTelnet';\nimport { registerWorkflows } from './registerWorkflows';\nimport { socket } from './socket';\nimport { renderUserInterface } from './ui';\nimport { getPassword } from './util/getPassword';\nimport { getQueryParams } from './util/getQueryParams';\n\nconst { user, server } = getQueryParams();\nconst [host, port] = server.split(':');\nconst pass = getPassword(user);\n\nconst { terminal, controls } = renderUserInterface(document.body);\nconst telnet = new RemoteTelnet(socket);\n\nterminal.write(`Connecting to ${host}:${port} as ${user}\\n`);\ntelnet.onConnected(initializeMud);\ntelnet.onData(data => terminal.write(data));\n\nsocket.onConnected(() => {\n  telnet.connect({ host, port: parseInt(port) });\n  terminal.onSubmit(value => {\n    terminal.write(`${value}\\n`);\n    telnet.send(value);\n  });\n\n  window.onbeforeunload = () => {\n    if (telnet.isConnected) {\n      telnet.send('abandonar');\n    }\n\n    telnet.close();\n  };\n});\n\nasync function initializeMud() {\n  const mud = new Mud(telnet);\n  mud.onCommand(x => terminal.write(`${x}\\n`));\n\n  terminal.onSubmit(command => mud.userInput(command));\n\n  await mud.login(user, pass);\n  registerWorkflows(mud);\n  await connectStats();\n  connectButtons();\n\n  Object.assign(window, { mud });\n\n  async function connectStats() {\n    const hp = emitter<number>();\n    controls.addMeter('red', hp.subscribe);\n\n    const mana = emitter<number>();\n    controls.addMeter('blue', mana.subscribe);\n\n    const mv = emitter<number>();\n    controls.addMeter('green', mv.subscribe);\n\n    mud.getPlugin('prompt').onUpdate(x => {\n      hp(x.hp.percent);\n      mana(x.mana.percent);\n      mv(x.mv.percent);\n    });\n  }\n\n  function connectButtons() {\n    controls.addButton('Entrenar', () => mud.invokeWorkflow('train'));\n  }\n}\n","import { emitter } from '@amatiasq/emitter';\n\nimport { initializePlugins, PluginMap } from '../plugins/index';\nimport { login } from '../plugins/login';\nimport { PluginContext } from './PluginContext';\nimport { RemoteTelnet } from './RemoteTelnet';\nimport { TriggerCollection } from './triggers/TriggerCollection';\nimport { Context } from './workflow/Context';\nimport { InvokeOptions } from './workflow/InvokeOptions';\nimport { Workflow } from './workflow/Workflow';\nimport { WorkflowNotFoundError } from './workflow/WorkflowNotFoundError';\n\nexport class Mud {\n  private readonly triggers = new TriggerCollection();\n  private readonly workflows: Record<string, Workflow> = {};\n  private plugins!: PluginMap;\n  private username!: string;\n\n  private readonly emitCommand = emitter<string>();\n  readonly onCommand = this.emitCommand.subscribe;\n\n  private emitLoggedIn!: (usernamne: string) => void;\n  readonly whenLoggedIn = new Promise(resolve => (this.emitLoggedIn = resolve));\n\n  constructor(private readonly telnet: RemoteTelnet) {\n    this.send = this.send.bind(this);\n    this.invokeWorkflow = this.invokeWorkflow.bind(this);\n    this.telnet.onData(x => this.triggers.process(removeNoise(x)));\n  }\n\n  async login(user: string, pass: string) {\n    const context = new PluginContext('login', 'N/A', this.triggers, this.send);\n\n    await login(context, user, pass, async () => {\n      this.plugins = await initializePlugins(\n        name => new PluginContext(name, user, this.triggers, this.send),\n      );\n    });\n\n    context.dispose();\n    this.username = user;\n    this.emitLoggedIn(user);\n  }\n\n  send(text: string) {\n    this.emitCommand(text);\n    this.telnet.send(text);\n  }\n\n  userInput(command: string): void {}\n\n  getPlugin<Name extends keyof PluginMap>(name: Name): PluginMap[Name] {\n    return this.plugins[name];\n  }\n\n  runWorkflow<Args extends any[]>(\n    name: string,\n    run: (context: Context, ...args: Args) => Promise<any> | void,\n    params?: Args,\n    options?: InvokeOptions,\n  ) {\n    const workflow = new Workflow(name, run);\n    return this.executeWorkflow(\n      workflow as Workflow<any, any>,\n      params,\n      options,\n    );\n  }\n\n  registerWorkflow<Args extends any[]>(\n    name: string,\n    run: (context: Context, ...args: Args) => Promise<any> | void,\n  ) {\n    const workflow = new Workflow(name, run);\n    this.workflows[workflow.name] = workflow as Workflow<any, any>;\n    return workflow;\n  }\n\n  invokeWorkflow(name: string, params?: any[], options?: InvokeOptions) {\n    if (!(name in this.workflows)) {\n      throw new WorkflowNotFoundError(`Workflow ${name} is not registered.`);\n    }\n\n    const workflow = this.workflows[name];\n    return this.executeWorkflow(workflow, params, options);\n  }\n\n  private executeWorkflow(\n    workflow: Workflow,\n    params: any[] = [],\n    { logs }: InvokeOptions = {},\n  ) {\n    const context = this.createWorkflowContext(workflow.name);\n\n    if (logs) {\n      context.printLogs;\n    }\n\n    const promise = workflow.execute(context, ...params).then(result => {\n      context.dispose();\n      return result;\n    });\n\n    return Object.assign(promise, {\n      abort() {\n        context.abort();\n      },\n    });\n  }\n\n  private createWorkflowContext(name: string): Context {\n    return new Context(\n      name,\n      this.username,\n      this.triggers,\n      this.plugins,\n      this.send,\n      this.invokeWorkflow,\n    );\n  }\n}\n\nfunction removeNoise(text: string) {\n  return removeAsciiCodes(text).replace(/\\r/g, '');\n}\n\nfunction removeAsciiCodes(text: string) {\n  return text.replace(/\\u001b\\[.*?m/g, '');\n}\n","import { PluginContext } from '../lib/PluginContext';\nimport { chatPlugin } from './chatPlugin';\nimport { inventoryPlugin } from './inventoryPlugin';\nimport { navigationPlugin } from './navigationPlugin';\nimport { promptPlugin } from './promptPlugin';\nimport { skillsPlugin } from './skillsPlugin';\n\nconst plugins = {\n  chat: chatPlugin,\n  inventory: inventoryPlugin,\n  navigation: navigationPlugin,\n  prompt: promptPlugin,\n  skills: skillsPlugin,\n};\n\n// -- Dirty implementation\n\ntype plugins = typeof plugins;\ntype UnPromisify<T> = T extends Promise<infer U> ? U : T;\n\nexport type PluginMap = {\n  [name in keyof plugins]: UnPromisify<ReturnType<plugins[name]>>;\n};\n\nexport async function initializePlugins(\n  context: (name: string) => PluginContext,\n) {\n  const promises = Object.entries(plugins).map(async ([name, plugin]) => [\n    name,\n    await plugin(context(name)),\n  ]);\n\n  const entries = await Promise.all(promises);\n  return Object.fromEntries(entries) as PluginMap;\n}\n","import { ClientStorage } from '@amatiasq/client-storage';\n\nimport { PluginContext } from '../lib/PluginContext';\nimport { PatternResult } from '../lib/triggers/PatternResult';\nimport { requestNotificationPermission } from '../lib/util/requestNotificationPermission';\n\ninterface Message {\n  time: number;\n  from: string;\n  to: string;\n  message: string;\n}\n\ntype History = ClientStorage<Record<string, Message[]>>;\n\nexport function chatPlugin({ when }: PluginContext) {\n  // const say = new ClientStorage<Record<string, Message[]>>('chat:say');\n  const tell = new ClientStorage<Record<string, Message[]>>('chat:tell');\n  const whisper = new ClientStorage<Record<string, Message[]>>('chat:whisper');\n\n  (window as any).chat = () => tell.get();\n\n  when(/(?<name>.+) te susurra '(?<message>[^']+)'/, receive(whisper));\n  when(/Susurras a (?<name>.+) '(?<message>[^']+)'/, sent(whisper));\n\n  when(\n    [\n      /(?<name>.+) te cuenta '(?<message>[^']+)'/,\n      /(?<name>.+) te responde '(?<message>[^']+)'/,\n    ],\n    receive(tell),\n  );\n\n  when(\n    [\n      /Cuentas a (?<name>.+) '(?<message>[^']+)'/,\n      /Respondes a (?<name>.+) '(?<message>[^']+)'/,\n    ],\n    sent(tell),\n  );\n}\n\ntype msg = { message: string };\n\nfunction receive(log: History) {\n  return ({ groups: { name, message } }: PatternResult) => {\n    console.log(`[MESSAGE(${name})]:`, message);\n    addMessage(log, { from: name, message });\n    notify(name, message);\n  };\n}\n\nfunction sent(log: History) {\n  return ({ groups: { name, message } }: PatternResult) =>\n    addMessage(log, { to: name, message });\n}\n\nasync function notify(from: string, message: string) {\n  await requestNotificationPermission();\n  return new Notification(`${name} te cuenta '${message}'`);\n}\n\nfunction addMessage(log: History, partial: { from: string } & msg): Message;\nfunction addMessage(log: History, partial: { to: string } & msg): Message;\nfunction addMessage(\n  log: History,\n  partial: { from?: string; to?: string } & msg,\n): Message {\n  const message: Message = {\n    time: Date.now(),\n    from: 'me',\n    to: 'me',\n    ...partial,\n  };\n\n  const data = log.get() || {};\n  const other = (partial.from || partial.to)!;\n  const history = data[other] || [];\n\n  history.push(message);\n  log.set({ ...data, [other]: history });\n  return message;\n}\n","export function requestNotificationPermission() {\n  if (!('Notification' in window)) {\n    console.warn('This browser does not support desktop notification');\n    return;\n  }\n\n  if (Notification.permission === 'granted') {\n    return Promise.resolve(true);\n  }\n\n  if (Notification.permission === 'denied') {\n    return;\n  }\n\n  return Notification.requestPermission().then(x => x === 'granted');\n}\n","import { PluginContext } from '../lib/PluginContext';\nimport { singleExecution } from '../lib/util/singleExecution';\n\nconst INVENTORY_DETECTOR = /Estas llevando:(\\n.*)+?\\n\\n/;\n\nexport function inventoryPlugin({ when, write }: PluginContext) {\n  let isInitialized = false;\n  let items: Record<string, number> = {};\n\n  const refresh = singleExecution(async () => {\n    write('inventario');\n    await when(INVENTORY_DETECTOR);\n  });\n\n  when('No tienes ese objeto.', refresh);\n\n  when(\n    INVENTORY_DETECTOR,\n    ({ captured }) => {\n      const [_, ...inventory] = captured[0]\n        .split('\\n')\n        .map(x => x.trim())\n        .filter(Boolean);\n\n      isInitialized = true;\n      items = {};\n\n      for (const item of inventory) {\n        const match = item.match(/(.*) \\((\\d+)\\)$/);\n\n        if (match) {\n          items[match[1]] = parseInt(match[2], 10);\n        } else {\n          items[item] = 1;\n        }\n      }\n    },\n    { captureLength: 1000 },\n  );\n\n  return { refresh, has };\n\n  async function has(search: string | string[] | Record<string, string>) {\n    if (!isInitialized) {\n      await refresh();\n    }\n\n    if (typeof search === 'string') {\n      return hasSync(search) ? search : null;\n    }\n\n    if (Array.isArray(search)) {\n      return search.find(hasSync) || null;\n    }\n\n    const key = Object.keys(search).find(hasSync);\n    return key ? search[key] : null;\n  }\n\n  function hasSync(key: string) {\n    return items[key];\n  }\n}\n","import { emitter } from '@amatiasq/emitter';\n\nimport { PluginContext } from '../lib/PluginContext';\nimport { PatternPromise } from '../lib/triggers/PatternPromise';\nimport { PROMPT_DETECTOR } from './promptPlugin';\n\nconst CLOSED = '(cerrada)';\nconst aliases = {\n  s: 'sur',\n  n: 'norte',\n  e: 'este',\n  w: 'oeste',\n  o: 'oeste',\n  u: 'arriba',\n  d: 'abajo',\n  l: 'sureste',\n  k: 'suroeste',\n  j: 'noreste',\n  h: 'noroeste',\n};\n\nexport function navigationPlugin({ when, write }: PluginContext) {\n  let isNavigating = false;\n  let landingAtRecall = false;\n  let isAtRecall = false;\n  let directions: string[] = [];\n\n  const prompt = () => when(PROMPT_DETECTOR);\n  const roomChanged = emitter<string[]>();\n\n  when('Plaza de Darkhaven', () => (landingAtRecall = true));\n\n  when('Puerta esta cerrada.', () => {\n    const closed = directions.find(x => x.includes(CLOSED));\n\n    if (closed) {\n      const dir = closed.replace(CLOSED, '');\n      write(`abrir ${dir}`);\n      write(dir);\n    }\n  });\n\n  when(/\\nSalidas: ([^\\.]+)/, async ({ captured }) => {\n    directions = captured[1].split(' ');\n    isNavigating = false;\n    isAtRecall = landingAtRecall;\n    landingAtRecall = false;\n    await prompt();\n    roomChanged(directions);\n  });\n\n  return {\n    canGo,\n    go,\n    execute,\n    recall,\n    waitForRecall,\n    onRoomChange: roomChanged.subscribe,\n\n    get isNavigating() {\n      return isNavigating;\n    },\n\n    get isAtRecall() {\n      return isAtRecall;\n    },\n  };\n\n  async function recall() {\n    if (isAtRecall) {\n      return Promise.resolve();\n    }\n\n    write('recall');\n    await when('Plaza de Darkhaven');\n    await prompt();\n  }\n\n  function waitForRecall() {\n    if (isAtRecall) {\n      return new PatternPromise(resolve => resolve());\n    }\n\n    return when('Plaza de Darkhaven');\n  }\n\n  function canGo(direction: string) {\n    return Boolean(get(direction));\n  }\n\n  function isClosed(direction: string) {\n    const dir = get(direction);\n    return dir && dir.includes(CLOSED);\n  }\n\n  async function execute(pattern: string) {\n    if (pattern[0] === 'r') {\n      await recall();\n      pattern = pattern.substr(1);\n    }\n\n    for (const step of parsePath(pattern)) {\n      await go(step);\n    }\n  }\n\n  async function go(direction: string) {\n    if (isNavigating) {\n      throw new Error('WTF DUDE');\n    }\n\n    if (direction in aliases) {\n      direction = aliases[direction as keyof typeof aliases];\n    }\n\n    const dir = get(direction);\n\n    if (!dir) {\n      throw new Error(`Unknown direction '${direction}'`);\n    }\n\n    if (isClosed(direction)) {\n      write(`abrir ${direction}`);\n      await when('Abres la puerta.');\n    }\n\n    write(direction);\n    isNavigating = true;\n\n    await when('\\nSalidas:');\n    await prompt();\n\n    isNavigating = false;\n  }\n\n  function get(direction: string) {\n    return directions.find(x => x.startsWith(direction));\n  }\n}\n\nfunction parsePath(path: string) {\n  return path.replace(/(\\d+)(\\w)/g, (_, times, dir) => dir.repeat(times));\n}\n","export class PatternPromiseTimeoutError extends Error {}\n","import { PluginContext } from '../lib/PluginContext';\nimport { concatRegexes } from '../lib/util/concatRegexes';\nimport { singleExecution } from '../lib/util/singleExecution';\n\nconst FAILURE = [\n  'Algo te distrae y pierdes la concentracion.',\n  'Has perdido la concentracion.',\n  'Has tenido una laguna mental mientras invocabas el hechizo.',\n  'Pierdes la concentracion.',\n  'Un picor en la nariz te impide mantener la concentracion.',\n  'Un pinchazo en tu pierna te impide lanzar el conjuro adecuadamente.',\n  'Una mota de polvo en el ojo rompe tu concentracion por un momento.',\n];\n\nconst NOT_POSSIBLE = [\n  'Este estilo de lucha pide demasiado atencion para hacer eso!',\n];\n\n// prettier-ignore\nconst SUCCESS = {\n  'armadura': 'Tu armadura brilla suavemente al ser mejorada por un conjuro.',\n  'bendecir': 'Tu dios te otorga una poderosa bendicion.',\n  'causar grave': /Tu conjuro [^\\n]+ a( w+)+!/,\n  'ceguera': /Lanzas un conjuro de ceguera contra ([^.]+)./,\n  'crear agua': ' esta lleno.\\n',\n  'crear comida': 'Una seta magica aparece de repente.',\n  'detectar invisible': 'Tus ojos brillan, siendo capaces ahora de ver lo invisible.',\n  'flotar': 'Empiezas a flotar a unos centimetros del suelo...',\n  'luz eterna': 'Rayos de luz iridiscente colisionan para formar una bola de luz eterna...',\n  'refrescar': 'Nueva vitalidad fluye hacia ti.',\n  'crear fuego': 'Una gran hoguera se enciende en el suelo delante tuyo.',\n  'curar leves': 'Tus heridas leves se cierran y el dolor desaparece.',\n  'detectar magia': 'Delgadas lineas azules reseguiran las siluetas de los objetos magicos que te encuentres.',\n  'detectar escondido': 'Tus sentidos cobran la viveza de los del mejor predador.',\n};\n\n// Skill cast results\n// const TIMEOUT = 0;\nconst NOT_AVAILABLE = undefined;\nconst BUSY = null;\nconst FAILED = false;\nconst CASTED = true;\n\nconst SKILL = /((?:\\w+ )+)\\s+(\\d+)%/g;\nconst SKILLS_DETECTOR = concatRegexes(\n  /-+\\[(\\w+)\\]-+\\n/,\n  /(.|\\n)+/,\n  /Te quedan \\d+ practicas.\\n/,\n  /Tienes \\d+ entrenamientos.\\n/,\n);\n\nexport function skillsPlugin({ when, write }: PluginContext) {\n  let isInitialized = false;\n  let isSpellRunning = false;\n  let skills: Record<string, number> = {};\n\n  const refresh = singleExecution(() => {\n    write('practicar');\n    return when(SKILLS_DETECTOR);\n  });\n\n  when(\n    SKILLS_DETECTOR,\n    ({ captured: [content] }) => {\n      isInitialized = true;\n\n      for (const skill of content.matchAll(SKILL)!) {\n        skills[skill[1].trim()] = parseInt(skill[2], 10);\n      }\n\n      isInitialized = true;\n    },\n    { captureLength: 3000 },\n  );\n\n  return { has, canLearn, castSpell, NOT_AVAILABLE, BUSY, FAILED, CASTED };\n\n  async function has(search: string | string[]) {\n    await ensureInitiated();\n\n    if (typeof search === 'string') {\n      return hasSync(search) ? search : null;\n    } else {\n      return search.find(hasSync) || null;\n    }\n  }\n\n  function hasSync(name: string) {\n    return skills[name];\n  }\n\n  async function canLearn(name: string) {\n    await ensureInitiated();\n    return name in skills;\n  }\n\n  function ensureInitiated() {\n    if (!isInitialized) {\n      return refresh();\n    }\n  }\n\n  async function castSpell(name: string | string[], args = '') {\n    const validName = await has(name);\n\n    if (!validName) {\n      return NOT_AVAILABLE;\n    }\n\n    if (!(validName in SUCCESS)) {\n      throw new Error(`Unknown response for spell \"${name}\".`);\n    }\n\n    if (isSpellRunning) {\n      return BUSY;\n    }\n\n    isSpellRunning = true;\n    write(`conjurar \"${validName}\" ${args}`);\n\n    const success = SUCCESS[validName as keyof typeof SUCCESS];\n\n    const result = await Promise.any([\n      when(success).then(() => CASTED),\n      when(FAILURE)\n        .wait(8)\n        .then(() => FAILED),\n    ]);\n\n    isSpellRunning = false;\n    return result;\n  }\n}\n","export function concatRegexes(...regexes: (RegExp | string)[]) {\n  const join = regexes\n    .map(x => x.toString().replace(/^\\/|\\/[gi]*$/g, ''))\n    .join('');\n\n  const flags = regexes\n    .map(x => x instanceof RegExp && x.flags)\n    .filter(Boolean)\n    .join('');\n\n  const uniq = [...new Set(flags)].join('');\n  return new RegExp(join, uniq);\n}\n","import { PluginContext } from '../lib/PluginContext';\n\nexport async function login(\n  { when, write, log }: PluginContext,\n  username: string,\n  password: string,\n  initialize: () => Promise<any>,\n) {\n  write(username);\n  log('Username sent, waiting for password request');\n\n  // TODO: \"Reconectando...\" no triggerea esto nunca\n\n  await when('Password:');\n  write(password);\n  log(`Logged in as ${username}`);\n\n  await Promise.any([\n    when('Reconectando.'),\n    (async () => {\n      await when('Pulsa [ENTER]');\n      write('');\n      await when('Pulsa [ENTER]');\n      write('');\n    })(),\n  ]);\n\n  // Kids don't do this at home\n  await when('Bienvenido a Balzhur...', initialize, { await: true }).once();\n}\n","import { Pattern } from './Pattern';\nimport { PatternMatcher } from './PatternMatcher';\nimport { PatternMatchSubscription } from './PatternMatchSubscription';\nimport { PatternOptions } from './PatternOptions';\nimport { PatternPromise } from './PatternPromise';\nimport { PatternResult } from './PatternResult';\n\ntype Handler = (result: PatternResult) => void;\n\nexport class TriggerCollection {\n  private readonly patterns = new Set<PatternMatcher>();\n  private readonly queue: string[] = [];\n  private isProcessing = false;\n\n  add(pattern: Pattern, options?: PatternOptions): PatternPromise;\n  add(\n    pattern: Pattern,\n    handler: (result: PatternResult) => void,\n    options?: PatternOptions,\n  ): PatternMatchSubscription;\n  add(\n    pattern: Pattern,\n    handler?: Handler | PatternOptions,\n    options?: PatternOptions,\n  ): any {\n    if (arguments.length === 1) return this.once(pattern);\n\n    if (arguments.length === 3)\n      return this.watch(pattern, handler as Handler, options);\n\n    if (typeof handler === 'function')\n      return this.watch(pattern, handler as Handler);\n\n    return this.once(pattern, handler as PatternOptions);\n  }\n\n  private watch(pattern: Pattern, handler: Handler, options?: PatternOptions) {\n    const entry = new PatternMatcher(pattern, x => handler(x), options);\n\n    this.patterns.add(entry);\n\n    const unsubscribe = () => this.patterns.delete(entry);\n\n    const once = () =>\n      new PatternPromise(resolve => {\n        const original = handler;\n\n        handler = async x => {\n          unsubscribe();\n\n          if (original) {\n            if (options && options.await) {\n              await original(x);\n            } else {\n              original(x);\n            }\n          }\n\n          resolve(x);\n        };\n      });\n\n    return { unsubscribe, once } as PatternMatchSubscription;\n  }\n\n  private once(pattern: Pattern, options?: PatternOptions) {\n    return new PatternPromise(resolve => {\n      const sub = this.add(pattern, handler, options);\n\n      function handler(result: PatternResult) {\n        sub.unsubscribe();\n        resolve(result);\n      }\n    });\n  }\n\n  async process(text: string): Promise<void> {\n    if (this.isProcessing) {\n      this.queue.push(text);\n      return;\n    }\n\n    this.isProcessing = true;\n\n    const splitted = text.split('\\n');\n    const last = splitted.pop() as string;\n    const lines = [...splitted.map(x => `${x}\\n`), last];\n\n    for (const line of lines) {\n      // console.log('PROCESS', line);\n      for (const pattern of this.patterns) {\n        await pattern.process(line);\n      }\n    }\n\n    this.isProcessing = false;\n\n    if (this.queue.length) {\n      return this.process(this.queue.pop()!);\n    }\n  }\n}\n","import { trimEnd } from '../util/trimEnd';\nimport { Pattern, SinglePattern } from './Pattern';\nimport { PatternOptions } from './PatternOptions';\nimport { PatternResult } from './PatternResult';\n\nexport class PatternMatcher {\n  private readonly patterns: SinglePattern[];\n  private readonly buffer;\n  readonly length;\n\n  constructor(\n    pattern: Pattern,\n    private readonly handler: (result: PatternResult) => void,\n    private readonly options: PatternOptions = {},\n  ) {\n    this.patterns = Array.isArray(pattern) ? pattern : [pattern];\n    this.length =\n      options.captureLength ||\n      Math.max(...this.patterns.map(x => String(x).length)) * 10;\n\n    this.buffer = buffer(this.length);\n  }\n\n  process(text: string) {\n    const value = this.buffer(text);\n    const matching = this.patterns.filter(pattern =>\n      this.testPattern(value, pattern),\n    );\n\n    if (!matching.length) {\n      return;\n    }\n\n    this.buffer.clear();\n    const result = new PatternResult(matching, value);\n    const output = this.handler(result);\n    return this.options.await ? output : null;\n  }\n\n  private testPattern(text: string, pattern: SinglePattern) {\n    if (typeof pattern === 'string') {\n      return text.indexOf(pattern) > -1;\n    }\n\n    return pattern.test(text);\n  }\n}\n\nfunction buffer(length: number) {\n  let value = '';\n  const clear = () => (value = '');\n  const add = (text: string) => (value = trimEnd(`${value}${text}`, length));\n  return Object.assign(add, { clear });\n}\n","export function trimEnd(value: string, maxLength: number) {\n  return value.length > maxLength\n    ? value.substr(value.length - maxLength)\n    : value;\n}\n","import { SinglePattern } from './Pattern';\n\nexport class PatternResult {\n  private get regexes() {\n    return this.patterns.filter(isRegex);\n  }\n\n  private get stringPatterns() {\n    return this.patterns.filter(x => !isRegex(x));\n  }\n\n  get captured() {\n    const regexMatches = this.regexes\n      .map(x => this.haystack.match(x)!)\n      .filter(Boolean)\n      .map(x => Array.from(x));\n\n    // TODO: maybe return the one with more captures?\n    return regexMatches[0];\n  }\n\n  get groups(): Record<string, string> {\n    return this.regexes\n      .map(x => this.haystack.match(x)!)\n      .filter(Boolean)\n      .map(x => x.groups!)\n      .filter(Boolean)\n      .reduce(merge, {});\n  }\n\n  constructor(\n    readonly patterns: SinglePattern[],\n    private readonly haystack: string,\n  ) {}\n}\n\nfunction isRegex(value: SinglePattern) {\n  return value instanceof RegExp;\n}\n\nfunction merge(a: object, b: object) {\n  return { ...a, ...b };\n}\n","import { PluginMap } from '../../plugins/index';\nimport { ExecutionAbortedError } from '../ExecutionAbortedError';\nimport { Mud } from '../Mud';\nimport { PluginContext } from '../PluginContext';\nimport { TriggerCollection } from '../triggers/TriggerCollection';\nimport { bindAll } from '../util/bindAll';\nimport { MissingPluginError } from './MissingPluginError';\n\nexport class Context extends PluginContext {\n  private finish: ((reason: any) => void) | null = null;\n\n  readonly plugins: PluginMap;\n\n  constructor(\n    name: string,\n    username: string,\n    triggers: TriggerCollection,\n    plugins: PluginMap,\n    send: (command: string) => void,\n    private readonly runWorkflow: Mud['invokeWorkflow'],\n  ) {\n    super(`W(${name})`, username, triggers, send);\n    this.plugins = createPluginsGetter(plugins, this.log.bind(this));\n\n    bindAll(this, Context);\n  }\n\n  invokeWorkflow<T>(name: string, params: any[] = []) {\n    this.checkNotAborted();\n    this.log(`Invoke workflow ${name} with`, ...params);\n    return this.runWorkflow(name, params, { logs: this.isPrintingLogs });\n  }\n\n  runForever() {\n    return new Promise(resolve => (this.finish = resolve));\n  }\n\n  abort() {\n    super.abort();\n\n    if (this.finish) {\n      this.finish(new ExecutionAbortedError());\n    }\n  }\n}\n\nfunction createPluginsGetter(source: PluginMap, log: Function) {\n  return new Proxy(source, {\n    get(target, key: string) {\n      if (!(key in target)) {\n        log(`Failed to get plugin ${key}`);\n        throw new MissingPluginError(`Plugin ${key} is not registered.`);\n      }\n\n      log(`Requires plugin ${key}`);\n      return target[key as keyof typeof target];\n    },\n  });\n}\n","export class MissingPluginError extends Error {}\n","import { Context } from './Context';\n\nexport class Workflow<Args extends any[] = any[], Return = any> {\n  private executionCount = 0;\n  private currentExecutions = 0;\n\n  get isRunning() {\n    return this.currentExecutions > 0;\n  }\n\n  get timesExecuted() {\n    return this.executionCount;\n  }\n\n  constructor(\n    readonly name: string,\n    private readonly run: (\n      context: Context,\n      ...args: Args\n    ) => Promise<Return> | void,\n  ) {}\n\n  async execute(context: Context, ...args: Args) {\n    this.currentExecutions++;\n    const iteration = this.executionCount++;\n\n    context.log(`[Exe(${iteration})]`, ...args);\n\n    try {\n      const result = await this.run(context, ...args);\n      context.log(`[Res(${iteration}]`, result);\n      return result;\n    } catch (error) {\n      context.log(`[ERR(${iteration})]`, error);\n      throw error;\n    } finally {\n      this.currentExecutions--;\n    }\n  }\n}\n","export class WorkflowNotFoundError extends Error {}\n","import { emitter } from '@amatiasq/emitter';\nimport { ClientSocket } from '@amatiasq/socket';\n\nimport { ClientMessage } from '../../../shared/ClientMessage';\nimport { ServerMessage } from '../../../shared/ServerMessage';\n\nexport class RemoteTelnet {\n  private _isConnected = false;\n\n  get isConnected() {\n    return this._isConnected;\n  }\n\n  private readonly emitConnected = emitter();\n  readonly onConnected = this.emitConnected.subscribe;\n\n  private readonly emitClose = emitter();\n  readonly onClose = this.emitClose.subscribe;\n\n  private readonly emitData = emitter<string>();\n  readonly onData = this.emitData.subscribe;\n\n  constructor(\n    private readonly socket: ClientSocket<ClientMessage, ServerMessage>,\n  ) {\n    socket.onMessageType('CONNECTED', this.emitConnected);\n    socket.onMessageType('DISCONNECTED', this.emitClose);\n    socket.onMessageType('OUTPUT', this.emitData);\n\n    this.onConnected(() => (this._isConnected = true));\n    this.onClose(() => (this._isConnected = false));\n  }\n\n  connect(options: { host: string; port: number }) {\n    this.socket.send('OPEN', options);\n  }\n\n  send(value: string) {\n    this.socket.send('INPUT', value);\n  }\n\n  close() {\n    this.socket.close();\n  }\n}\n","import { Mud } from './lib/Mud';\nimport { dope } from './workflows/dope';\nimport { drink } from './workflows/drink';\nimport { eat } from './workflows/eat';\nimport { fight } from './workflows/fight';\nimport { idle } from './workflows/idle';\nimport { rest } from './workflows/rest';\nimport { train } from './workflows/train';\n\nexport function registerWorkflows(mud: Mud) {\n  mud.registerWorkflow('fight', fight);\n  mud.registerWorkflow('train', train);\n\n  mud.runWorkflow('dope', dope);\n  mud.runWorkflow('drink', drink);\n  mud.runWorkflow('eat', eat);\n  mud.runWorkflow('idle', idle);\n  mud.runWorkflow('rest', rest);\n}\n","import { ClientStorage } from '@amatiasq/client-storage';\nimport { wait } from '../lib/util/wait';\nimport { Context } from './../lib/workflow/Context';\n\nconst memory = new ClientStorage<string[]>('dope:casting');\n\nexport async function dope({\n  when,\n  runForever,\n  plugins: { prompt, skills },\n}: Context) {\n  const shouldHeal = defineShould(0.2);\n  const shouldRefresh = defineShould(0.1, 0.5);\n  const casting = new Set(memory.get());\n\n  ensureAlways('detectar invisible', 'Ya no ves objetos invisibles.');\n  ensureAlways('armadura', 'Tu armadura vuelve a su valor normal.');\n  ensureAlways('detectar magia', 'Las lineas azules desaparecen de tu vision.');\n  ensureAlways('flotar', 'Tus pies aterrizan suavemente en el suelo.');\n\n  prompt.onUpdate(\n    async ({\n      isFighting,\n      mana: { percent: mana },\n      hp: { percent: hp },\n      mv: { percent: mv },\n    }) => {\n      if (isFighting || mana === 0) {\n        return;\n      }\n\n      if (shouldHeal(mana, hp)) {\n        return skills.castSpell('curar leves');\n      }\n\n      if (shouldRefresh(mana, mv)) {\n        return skills.castSpell('refrescar');\n      }\n    },\n  );\n\n  await runForever();\n\n  function ensureAlways(spell: string, trigger: string) {\n    when(trigger, async () => {\n      casting.add(spell);\n      memory.set([...casting]);\n\n      const success = await repeatUntilCasted(spell);\n\n      if (success) {\n        casting.delete(spell);\n        memory.set([...casting]);\n      }\n    });\n  }\n\n  async function repeatUntilCasted(spell: string, args = ''): Promise<boolean> {\n    if (prompt.isFighting) {\n      await prompt.until(x => !x.isFighting);\n    }\n\n    switch (await skills.castSpell(spell, args)) {\n      case skills.CASTED:\n        return true;\n      case skills.NOT_AVAILABLE:\n        return false;\n      case skills.BUSY:\n        await wait(3);\n      case skills.FAILED:\n        return repeatUntilCasted(spell, args);\n    }\n\n    throw new Error('WTF DUDE');\n  }\n\n  function defineShould(min: number, max = 1) {\n    const multiplier = 1 / (max - min);\n\n    return (mana: number, stat: number) => {\n      if (mana === 0 || stat > max) return false;\n      if (stat < min) return true;\n\n      const clapped = (stat - min) * multiplier;\n      return Math.hypot(mana, 1 - clapped) > 1;\n    };\n  }\n}\n","import { Context } from './../lib/workflow/Context';\n\nexport async function drink({\n  when,\n  write,\n  runForever,\n  plugins: { inventory, navigation, skills },\n}: Context) {\n  let isFontAvailable = false;\n  let isBottleFull = false;\n\n  navigation.onRoomChange(() => (isFontAvailable = false));\n\n  when(\n    [\n      'Un manantial magico esta aqui.',\n      'Una hermosa fuente de marmol blanco esta aqui.',\n    ],\n    async () => {\n      isFontAvailable = true;\n\n      if (!isBottleFull) {\n        const bottle = await getWaterBottle();\n\n        if (bottle) {\n          write(`llenar ${bottle}`);\n          isBottleFull = true;\n        }\n      }\n    },\n  );\n\n  when(\n    [\n      'Te apetece dar un sorbo a algo refrescante.',\n      'Tienes sed.',\n      // 'Estas sediento.',\n      'Estas realmente sediento.',\n      'Estas MUERTO de SED!',\n      'Estas en peligro de deshidratacion.',\n    ],\n    async () => {\n      if (isFontAvailable) {\n        write('beber');\n        return;\n      }\n\n      const bottle = await getWaterBottle();\n\n      if (!bottle) {\n        console.log('No hay fuente de agua');\n        return;\n      }\n\n      write(`beber ${bottle}`);\n      await skills.castSpell('crear agua', bottle);\n    },\n  );\n\n  await runForever();\n\n  async function getWaterBottle() {\n    return inventory.has({\n      'un odre de cuero': 'odre',\n      'una cantimplora': 'cantimplora',\n    });\n  }\n}\n","import { Context } from './../lib/workflow/Context';\n\nexport async function eat({\n  when,\n  write,\n  runForever,\n  plugins: { inventory, navigation: nav, skills, prompt },\n}: Context) {\n  const EXPECTED_FOOD = 1;\n  const DEFAULT_FOOD_NAME = 'chuleta';\n\n  when(['Tienes hambre.', 'Estas realmente hambriento.'], eatSomething);\n\n  when(['Estas terriblemente hambriento.', 'Estas HAMBRIENTO!'], async () => {\n    if ((await eatSomething()) || (await createFood())) {\n      return;\n    }\n\n    await buyFood();\n    await eatSomething();\n  });\n\n  await runForever();\n\n  async function eatSomething() {\n    const food = await getFoodFromInventory();\n\n    if (food) {\n      write(`comer ${food}`);\n      inventory.refresh();\n    }\n\n    return true;\n  }\n\n  async function createFood() {\n    if (!(await skills.castSpell('crear comida'))) {\n      return false;\n    }\n\n    write('coger seta');\n\n    try {\n      await when('Coges una seta magica.').timeout(3);\n      write('comer seta');\n      return true;\n    } catch (err) {\n      return false;\n    }\n  }\n\n  async function buyFood() {\n    await nav.recall();\n    await nav.execute('2sen');\n\n    write(`comprar ${EXPECTED_FOOD} ${DEFAULT_FOOD_NAME}`);\n    await when('El carnicero pone todo en una bolsa y te la da.');\n    await getFoodFromBag();\n    await nav.execute('sw2n');\n  }\n\n  async function getFoodFromInventory() {\n    await getFoodFromBag();\n\n    return await inventory.has({\n      'un chorizo': 'chorizo',\n      'pavo cocinado': 'pavo',\n      'una chuleta de cordero': 'chuleta',\n      'loncha de salami': 'salami',\n      'pierna de cordero': 'pierna',\n      'ricas longanizas': 'longanizas',\n    });\n  }\n\n  async function getFoodFromBag() {\n    if (await inventory.has('una bolsa')) {\n      write('coger todo bolsa');\n      write('examinar bolsa');\n\n      const { captured } = await when(/Una bolsa contiene:\\n\\s+(Nada)?/);\n      if (captured[1]) {\n        write('tirar bolsa');\n      }\n    }\n  }\n}\n","import { Context } from '../lib/workflow/Context';\n\nexport async function fight(\n  { when, write, plugins: { prompt, navigation, skills } }: Context,\n  target: string,\n) {\n  when('Estas demasiado exhausto para huir del combate!', () =>\n    navigation.recall(),\n  );\n\n  when(\n    [\n      new RegExp(`Tu (?<attack>\\\\w+) (?<effect>\\\\w+) a( |\\\\w)+ ${target}.`),\n      new RegExp(`El ataque de( |\\\\w)+ ${target} te (?<effect>\\w+).`),\n    ],\n    update,\n  );\n\n  const attackSpells = ['ceguera', 'causar graves', 'causar leves'];\n  const cast = () => skills.castSpell(attackSpells, target);\n\n  if (!(await tryNTimes(3, cast))) {\n    write(`matar ${target}`);\n  }\n\n  await Promise.any([\n    navigation.waitForRecall().then(() => 'flee'),\n    when(`${target} ha MUERTO!!`).then(() => 'win'),\n    when('Huyes como un cobarde del combate.').then(() => 'flee'),\n    when('No esta aqui.')\n      .timeout(3)\n      .then(() => 'missing'),\n  ]);\n\n  async function update() {\n    if (prompt.isInDanger) {\n      await navigation.recall();\n    } else if (prompt.isExhausted || prompt.needsHospital) {\n      write('huir');\n    } else {\n      await skills.castSpell(['causar graves', 'causar leves']);\n    }\n  }\n\n  async function tryNTimes(times: number, action: () => Promise<boolean>) {\n    for (let i = 0; i < times; i++) {\n      if (await action()) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n}\n","import { Context } from './../lib/workflow/Context';\n\nexport async function idle({\n  when,\n  write,\n  invokeWorkflow,\n  runForever,\n  plugins: { navigation },\n}: Context) {\n  when('Desapareces en la nada.', () => {\n    console.log('IDLE');\n\n    if (navigation.isAtRecall) {\n      invokeWorkflow('train');\n    } else {\n      write('estado');\n    }\n  });\n\n  await runForever();\n}\n","import { Context } from './../lib/workflow/Context';\n\nexport async function rest({ when, write, runForever }: Context) {\n  when(\n    [\n      'Nah... Estas demasiado relajado...',\n      'En tus suenyos o que?',\n      'Estas demasiado relajado para lanzar ese conjuro.',\n    ],\n    () => write('despertar'),\n  );\n\n  await runForever();\n}\n","import { Context } from './../lib/workflow/Context';\n\nexport async function train({\n  when,\n  invokeWorkflow,\n  plugins: { navigation: nav, prompt },\n}: Context) {\n  const enemies: string[] = [];\n  let direction = 'sur';\n\n  await nav.recall();\n  await nav.go('abajo');\n\n  const enemySpotted = (prey: string) => () => enemies.push(prey);\n  const enemyGone = (prey: string) => () => {\n    const index = enemies.indexOf(prey);\n    if (index > -1) {\n      enemies.splice(index, 1);\n    }\n  };\n\n  when(\n    [\n      'Un pequenyo caracol esta aqui haciendo trompos.',\n      'El pequenyo caracol llega desde el',\n    ],\n    enemySpotted('pequenyo caracol'),\n  );\n\n  when(\n    ['Un buitre carronyero esta aqui.', 'El buitre carronyero llega desde el'],\n    enemySpotted('buitre carronyero'),\n  );\n\n  when(\n    [\n      'Un lobo hambriento te esta mirando.',\n      'El lobo hambriento llega desde el',\n    ],\n    enemySpotted('lobo hambriento'),\n  );\n\n  when(\n    [\n      'Una serpiente que parece venenosa te mira fijamente.',\n      'La serpiente llega desde el',\n    ],\n    enemySpotted('serpiente'),\n  );\n\n  when('El pequenyo caracol se va hacia el', enemyGone('pequenyo caracol'));\n  when('El buitre carronyero se va hacia el', enemyGone('buitre carronyero'));\n  when('El lobo hambriento se va hacia el', enemyGone('lobo hambriento'));\n  when('La serpiente se va hacia el', enemyGone('serpiente'));\n\n  return nextRoom();\n\n  async function nextRoom(): Promise<any> {\n    await prompt.until(({ mv: { current: mv } }) => mv > 50);\n\n    while (enemies.length) {\n      const result = await invokeWorkflow('fight', [enemies.pop()!]);\n\n      if (result === 'flee') {\n        console.log('Had to run. Train over.');\n        return nav.recall();\n      }\n    }\n\n    if (nav.canGo(direction)) {\n      await nav.go(direction);\n    } else if (nav.canGo('este')) {\n      await nav.go('este');\n      direction = direction === 'sur' ? 'norte' : 'sur';\n    } else {\n      return nav.execute('4w5nu');\n    }\n\n    return nextRoom();\n  }\n}\n","import { ClientSocket } from '@amatiasq/socket';\n\nimport { ClientMessage } from '../../shared/ClientMessage';\nimport { DEFAULT_PORT } from '../../shared/config.json';\nimport { ServerMessage } from '../../shared/ServerMessage';\n\nlet FORCE_PROD_SERVER = false;\n// FORCE_PROD_SERVER = true;\n\nconst serverUri =\n  location.origin === 'https://amatiasq.github.io' || FORCE_PROD_SERVER\n    ? 'wss://mudOS.amatiasq.com'\n    : `ws://localhost:${DEFAULT_PORT}`;\n\nexport const socket = new ClientSocket<ClientMessage, ServerMessage>(serverUri);\n\nsocket.onMessage(x => console.debug('MESSAGE', x));\nsocket.onMessageType('ERROR', x => {\n  console.error(x);\n\n  if (x.startsWith(\"Can't open connection to\")) {\n    location.reload();\n  }\n});\n","import { ClientStorage } from '@amatiasq/client-storage';\nimport './index.css';\n\nimport { Controls } from './Controls/Controls';\nimport { Hamburger } from './Hamburger/Hamburger';\nimport html from './index.html';\nimport { render } from './render';\nimport { Sidebar } from './Sidebar/Sidebar';\nimport { Terminal } from './Terminal/Terminal';\n\nexport function renderUserInterface(parent: HTMLElement) {\n  const state = initState();\n  const data = state.get()!;\n\n  const dom = render(html);\n  const main = dom.$('.container');\n\n  const sidebar = new Sidebar();\n  sidebar.render(main);\n\n  const controls = new Controls();\n  controls.render(main);\n\n  const terminal = new Terminal();\n  terminal.render(main);\n\n  parent.appendChild(dom);\n\n  const hamburger = new Hamburger(data.showControls);\n  hamburger.render(parent);\n\n  hamburger.onChange(x => {\n    if (x) {\n      main.classList.add('show-controls');\n      data.showControls = true;\n    } else {\n      main.classList.remove('show-controls');\n      data.showControls = false;\n    }\n\n    state.set(data);\n  });\n\n  return { controls, sidebar, terminal };\n}\n\nfunction initState() {\n  const state = new ClientStorage<{ showControls: boolean }>('ui:state');\n  const data = state.get();\n\n  if (!data) {\n    state.set({ showControls: false });\n  }\n\n  return state;\n}\n","import api from \"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n            import content from \"!!../../node_modules/css-loader/dist/cjs.js!./index.css\";\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nexport default content.locals || {};","import './Controls.css';\n\nimport { render } from '../render';\nimport html from './Controls.html';\n\ntype Observable = (listener: (data: number) => void) => void;\n\nexport class Controls {\n  private readonly dom = render(html);\n  private readonly meterTpl = this.dom.$('.meter-template')!;\n  private readonly buttonTpl = this.dom.$('.button-template')!;\n\n  render(parent: HTMLElement) {\n    parent.appendChild(this.dom);\n  }\n\n  addMeter(color: string, observable: Observable) {\n    const fragment = render(this.meterTpl, {\n      '.meter': x => {\n        x.style.setProperty('--color', color);\n        x.style.setProperty('--value', '100%');\n\n        observable(value => {\n          const percent = Math.round(value * 100);\n          x.style.setProperty('--value', `${percent}%`);\n        });\n      },\n    });\n\n    this.dom.appendChild(fragment);\n  }\n\n  addButton(name: string, onClick: () => void) {\n    const fragment = render(this.buttonTpl, {\n      button: x => {\n        x.textContent = name;\n        x.addEventListener('click', onClick);\n      },\n    });\n\n    this.dom.appendChild(fragment);\n  }\n}\n","import api from \"!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n            import content from \"!!../../../node_modules/css-loader/dist/cjs.js!./Controls.css\";\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nexport default content.locals || {};","// Module\nvar code = \"<header class=\\\"controls\\\"></header> <template class=\\\"meter-template\\\"> <div class=\\\"meter\\\" data-color=\\\"white\\\" data-value=\\\"100%\\\"> <div class=\\\"bar\\\"></div> </div> </template> <template class=\\\"button-template\\\"> <button class=\\\"ui-button\\\"></button> </template> \";\n// Exports\nmodule.exports = code;","import './Hamburger.css';\n\nimport { emitter } from '@amatiasq/emitter';\n\nimport { render } from '../render';\nimport html from './Hamburger.html';\n\nexport class Hamburger {\n  private readonly dom = render(html);\n  private readonly checkbox = this.dom.$<HTMLInputElement>('input');\n\n  private readonly emitChange = emitter<boolean>();\n  readonly onChange = this.emitChange.subscribe;\n\n  constructor(initialState = false) {\n    this.toggle = this.toggle.bind(this);\n    this.checkbox.checked = initialState;\n  }\n\n  render(parent: HTMLElement) {\n    this.checkbox.addEventListener('change', this.toggle);\n\n    parent.appendChild(this.dom);\n\n    if (this.checkbox.checked) {\n      this.toggle();\n    }\n  }\n\n  toggle() {\n    this.emitChange(this.checkbox.checked);\n  }\n}\n","import api from \"!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n            import content from \"!!../../../node_modules/css-loader/dist/cjs.js!./Hamburger.css\";\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nexport default content.locals || {};","// Module\nvar code = \"<div class=\\\"hamburger\\\"> <input type=\\\"checkbox\\\"/> <span></span> <span></span> <span></span> </div> \";\n// Exports\nmodule.exports = code;","// Module\nvar code = \"<div class=\\\"container\\\"></div> \";\n// Exports\nmodule.exports = code;","import './Sidebar.css';\n\nimport { render } from '../render';\nimport html from './Sidebar.html';\n\nexport class Sidebar {\n  private readonly dom = render(html);\n\n  render(parent: HTMLElement) {\n    parent.appendChild(this.dom);\n  }\n}\n","import api from \"!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n            import content from \"!!../../../node_modules/css-loader/dist/cjs.js!./Sidebar.css\";\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nexport default content.locals || {};","// Module\nvar code = \"<aside class=\\\"sidebar\\\"></aside> \";\n// Exports\nmodule.exports = code;","import { ClientStorage } from '@amatiasq/client-storage';\nimport './Terminal.css';\n\nimport Convert from 'ansi-to-html';\n\nimport { emitter } from '@amatiasq/emitter';\n\nimport { render } from '../render';\nimport html from './Terminal.html';\n\nconst convert = new Convert();\nconst history = new ClientStorage<string[]>('mud:command-history');\n\nexport class Terminal {\n  private readonly dom = render(html);\n  private readonly $log = this.dom.$('.log');\n  private readonly $input = this.dom.$<HTMLInputElement>('input');\n  private readonly log: string[] = [];\n  private readonly history: string[] = history.get() || [];\n  private histPos = 0;\n\n  private readonly emitSubmit = emitter<string>();\n  readonly onSubmit = this.emitSubmit.subscribe;\n\n  constructor() {\n    this.onKey = this.onKey.bind(this);\n  }\n\n  focus() {\n    this.$input.focus();\n  }\n\n  render(parent: HTMLElement) {\n    this.dom.$('.terminal').addEventListener('click', () => {\n      if (!userHasSelectedText()) {\n        this.$input.focus();\n      }\n    });\n\n    this.$input.addEventListener('keydown', this.onKey);\n    parent.appendChild(this.dom);\n  }\n\n  write(data: string) {\n    const $parent = this.$log.parentElement!;\n    const prev = this.log.length ? this.log.pop() : '';\n    const content = `${prev}${fixLineEndings(data)}`.split(/\\n\\n+/);\n    const last = content.pop()!;\n\n    for (const block of content) {\n      this.log.push(block);\n\n      const p = document.createElement('p');\n      p.innerHTML = asciiToHtml(block);\n      $parent.insertBefore(p, this.$log);\n    }\n\n    this.log.push(last);\n    this.$log.innerHTML = asciiToHtml(last);\n\n    if (!userHasSelectedText()) {\n      $parent.scrollTop = $parent.scrollHeight;\n    }\n  }\n\n  private onKey(event: KeyboardEvent) {\n    if (event.code === 'Enter') {\n      this.submit();\n    }\n\n    if (event.code === 'ArrowUp') {\n      this.loadHistory(1);\n    }\n\n    if (event.code === 'ArrowDown') {\n      this.loadHistory(-1);\n    }\n\n    this.$input.size = this.$input.value.length + 1;\n  }\n\n  private submit() {\n    const { value } = this.$input;\n    this.$input.value = '';\n\n    this.history.shift();\n    this.history.unshift(value);\n    this.history.unshift('');\n    history.set(this.history);\n    this.histPos = 0;\n\n    this.emitSubmit(value);\n  }\n\n  private loadHistory(modifier: 1 | -1) {\n    if (!this.history.length) {\n      return;\n    }\n\n    this.history[this.histPos] = this.$input.value;\n    this.histPos = clamp(this.histPos + modifier, 0, this.history.length - 1);\n    this.$input.value = this.history[this.histPos];\n  }\n}\n\nfunction asciiToHtml(text: string) {\n  const escaped = escapeHtml(text);\n  const html = convert.toHtml(escaped);\n  return html.replace(/\\n/g, '<br>');\n}\n\nfunction fixLineEndings(text: string) {\n  return text.replace(/\\r/g, '');\n}\n\nfunction escapeHtml(unsafe: string) {\n  return unsafe\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#039;')\n    .replace(/  +/g, x => '&nbsp;'.repeat(x.length));\n}\n\nfunction userHasSelectedText() {\n  const selection = getSelection();\n  return selection && selection.type === 'Range';\n}\n\nfunction clamp(value: number, min: number, max: number) {\n  return value < min ? min : value > max ? max : value;\n}\n","import api from \"!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n            import content from \"!!../../../node_modules/css-loader/dist/cjs.js!./Terminal.css\";\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nexport default content.locals || {};","// Module\nvar code = \"<main class=\\\"terminal\\\"> <span class=\\\"log\\\"></span> <input type=\\\"text\\\" size=\\\"1\\\" autofocus> </main>\";\n// Exports\nmodule.exports = code;","import { ClientStorage } from '@amatiasq/client-storage';\n\nexport function getPassword(user: string) {\n  const storage = new ClientStorage<string>(`pass:${user}`);\n  const stored = storage.get();\n\n  if (stored) {\n    return stored;\n  }\n\n  const input = prompt(`Password for ${user}`);\n\n  if (!input) {\n    throw new Error(`Password required`);\n  }\n\n  storage.set(input);\n  return input;\n}\n","export function getQueryParams() {\n  const result: { [key: string]: string } = {};\n\n  window.location.search\n    .substr(1)\n    .split('&')\n    .map(entry => entry.split('=').map(decodeURIComponent))\n    .forEach(([key, value]) => (result[key] = value));\n\n  return result;\n}\n"],"sourceRoot":""}
{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/spells.ts","webpack:///./src/ui/render.ts","webpack:///./src/lib/util/wait.ts","webpack:///./src/ui/index.css","webpack:///./src/ui/Controls/Controls.css","webpack:///./src/ui/Hamburger/Hamburger.css","webpack:///./src/ui/Sidebar/Sidebar.css","webpack:///./src/ui/Terminal/Terminal.css","webpack:///./src/lib/util/singleExecution.ts","webpack:///./src/lib/triggers/PatternPromise.ts","webpack:///./src/plugins/promptPlugin.ts","webpack:///./src/lib/PluginContext.ts","webpack:///./src/lib/ExecutionAbortedError.ts","webpack:///./src/lib/util/bindAll.ts","webpack:///./src/index.ts","webpack:///./src/lib/Mud.ts","webpack:///./src/plugins/index.ts","webpack:///./src/plugins/chatPlugin.ts","webpack:///./src/lib/util/requestNotificationPermission.ts","webpack:///./src/plugins/inventoryPlugin.ts","webpack:///./src/plugins/navigationPlugin.ts","webpack:///./src/lib/triggers/PatternPromiseTimeoutError.ts","webpack:///./src/plugins/skillsPlugin.ts","webpack:///./src/lib/util/concatRegexes.ts","webpack:///./src/plugins/login.ts","webpack:///./src/lib/triggers/TriggerCollection.ts","webpack:///./src/lib/triggers/PatternMatcher.ts","webpack:///./src/lib/util/trimEnd.ts","webpack:///./src/lib/triggers/PatternResult.ts","webpack:///./src/lib/workflow/Context.ts","webpack:///./src/lib/workflow/MissingPluginError.ts","webpack:///./src/lib/workflow/Workflow.ts","webpack:///./src/lib/workflow/WorkflowNotFoundError.ts","webpack:///./src/lib/RemoteTelnet.ts","webpack:///./src/registerWorkflows.ts","webpack:///./src/daemons/defend.ts","webpack:///./src/daemons/dope.ts","webpack:///./src/util/uniq.ts","webpack:///./src/daemons/drink.ts","webpack:///./src/daemons/eat.ts","webpack:///./src/daemons/idle.ts","webpack:///./src/daemons/rest.ts","webpack:///./src/workflows/afk.ts","webpack:///./src/workflows/bank.ts","webpack:///./src/workflows/cast.ts","webpack:///./src/workflows/donations.ts","webpack:///./src/workflows/go.ts","webpack:///./src/workflows/kill.ts","webpack:///./src/workflows/train.ts","webpack:///./src/ui/index.ts","webpack:///./src/ui/index.css?3ef0","webpack:///./src/ui/Controls/Controls.ts","webpack:///./src/ui/Controls/Controls.css?eebb","webpack:///./src/ui/Controls/Controls.html","webpack:///./src/ui/Hamburger/Hamburger.ts","webpack:///./src/ui/Hamburger/Hamburger.css?b2d9","webpack:///./src/ui/Hamburger/Hamburger.html","webpack:///./src/ui/index.html","webpack:///./src/ui/Sidebar/Sidebar.ts","webpack:///./src/ui/Sidebar/Sidebar.css?e0a4","webpack:///./src/ui/Sidebar/Sidebar.html","webpack:///./src/ui/Terminal/Terminal.ts","webpack:///./src/ui/Terminal/Terminal.css?82ae","webpack:///./src/ui/Terminal/Terminal.html","webpack:///./src/util/getPassword.ts","webpack:///./src/util/getQueryParams.ts"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","0","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","UNKNOWN","SPELL_FAILED","SPELL_ALREADY_APPLIED","SPELL_NOT_POSSIBLE","SPELLS_BY_TYPE","food","water","levitate","heal","attack","dedope","SPELL_LEARN_ORDER","entries","SPELLS","filter","desc","map","armadura","success","endEffect","dope","bendecir","ceguera","flotar","invisibilidad","afterDope","maldecir","proteccion","refrescar","terremoto","veneno","volar","clone","el","cloneNode","template","config","html","document","createElement","innerHTML","renderHtml","instance","HTMLTemplateElement","content","selector","operator","querySelector","console","error","assign","$","seconds","Promise","resolve","setTimeout","___CSS_LOADER_EXPORT___","fn","running","then","x","executor","_reject","super","reject","this","forceReject","wait","PatternPromiseTimeoutError","race","PROMPT","join","FPROMPT","replace","PROMPT_DETECTOR","RegExp","Stat","total","current","Math","round","toInt","parseInt","async","when","write","isInvisible","stats","hp","mana","mv","exp","gold","enemy","update","emitter","timeout","catch","finally","groups","g","hpCurr","hpTotal","mCurr","mTotal","mvCurr","mvTotal","Boolean","invis","waitForPrompt","getPercent","stat","percent","until","whenFresh","onUpdate","subscribe","isFighting","predicate","unsubscribe","PluginContext","username","triggers","send","subscriptions","isPrintingLogs","isAborted","bindAll","command","options","checkNotAborted","log","pattern","handler","add","forEach","args","ExecutionAbortedError","Error","target","source","proto","getOwnPropertyNames","getOwnPropertyDescriptor","method","serverUri","location","origin","DEFAULT_PORT","host","port","user","pass","server","getQueryParams","split","getPassword","getParams","terminal","controls","renderUserInterface","body","socket","WebSocket","addEventListener","telnet","RemoteTelnet","connect","mud","Mud","connectStats","addMeter","getPlugin","connectButtons","addButton","run","runWorkflow","cmd","message","onCommand","onData","onbeforeunload","isConnected","close","onSubmit","startsWith","workflow","substr","userInput","login","registerWorkflows","initializeMud","openSocket","TriggerCollection","workflows","emitCommand","whenLoggedIn","emitLoggedIn","process","text","removeAsciiCodes","context","plugins","initializePlugins","dispose","password","repeat","params","Workflow","runForever","executeWorkflow","WorkflowNotFoundError","logs","createWorkflowContext","printLogs","promise","execute","abort","Context","chat","chatPlugin","inventory","inventoryPlugin","navigation","navigationPlugin","prompt","promptPlugin","skills","skillsPlugin","promises","plugin","all","fromEntries","receive","addMessage","from","notify","sent","to","requestNotificationPermission","Notification","partial","time","Date","now","other","history","set","tell","ClientStorage","whisper","permission","requestPermission","warn","INVENTORY_DETECTOR","isInitialized","items","refresh","singleExecution","captured","_","trim","item","match","captureLength","has","search","hasSync","Array","isArray","find","keys","CLOSED","aliases","e","w","u","k","h","isNavigating","landingAtRecall","isAtRecall","directions","roomChanged","closed","includes","dir","canGo","go","callback","recall","untilEnd","step","path","times","toUpperCase","waitForRecall","PatternPromise","onRoomChange","direction","isClosed","any","NOT_AVAILABLE","undefined","SUCCESS","getSpells","SKILL","SKILLS_DETECTOR","concatRegexes","isSpellRunning","skill","matchAll","canLearn","ensureInitiated","castSpell","validName","BUSY","FAILED","CASTED","ALREADY_APPLIED","regexes","toString","flags","uniq","Set","initialize","await","once","patterns","queue","isProcessing","arguments","watch","entry","PatternMatcher","delete","original","sub","splitted","last","pop","lines","line","max","String","buffer","clear","trimEnd","matching","testPattern","PatternResult","output","indexOf","test","maxLength","isRegex","merge","a","b","haystack","reduce","register","finish","Proxy","MissingPluginError","executionCount","currentExecutions","iteration","_isConnected","emitClose","onClose","emitData","onMessage","proxy","type","payload","JSON","stringify","event","afk","bank","cast","donations","kill","train","daemon","defend","drink","eat","idle","rest","sustantives","fullName","memory","shouldHeal","defineShould","shouldRefresh","repeatUntilCasted","casting","spells","min","multiplier","clapped","hypot","spell","invoke","after","list","isFontAvailable","isBottleFull","getWaterBottle","bottle","nav","eatSomething","getFoodFromBag","getFoodFromInventory","err","createFood","buyFood","action","take","EQUIPMENT","weapon","hands","feet","head","complements","shield","levelMatch","level","room","Number","MAX_VALUE","itemsMatch","values","some","wear","attackSpells","tryNTimes","invokeWorkflow","enemies","enemySpotted","prey","enemyGone","index","parent","state","showControls","initState","dom","render","main","sidebar","Sidebar","Controls","Terminal","appendChild","hamburger","Hamburger","onChange","classList","remove","locals","meterTpl","buttonTpl","color","observable","fragment","style","setProperty","onClick","button","textContent","initialState","checkbox","emitChange","toggle","checked","convert","asciiToHtml","escaped","toHtml","userHasSelectedText","selection","getSelection","$log","$input","histPos","emitSubmit","onKey","focus","$parent","parentElement","block","insertBefore","scrollTop","scrollHeight","code","submit","loadHistory","size","unshift","modifier","storage","stored","input","decodeURIComponent"],"mappings":"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","file":"main.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t0: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([21,1]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","export type SpellName = keyof typeof SPELLS;\nexport type Spell = SpellName | SpellName[];\n\nexport const UNKNOWN = null;\nexport type UNKNOWN = typeof UNKNOWN;\n\nexport const SPELL_FAILED = [\n  'Algo te distrae y pierdes la concentracion.',\n  'Has perdido la concentracion.',\n  'Has tenido una laguna mental mientras invocabas el hechizo.',\n  'Pierdes la concentracion.',\n  'Un picor en la nariz te impide mantener la concentracion.',\n  'Un pinchazo en tu pierna te impide lanzar el conjuro adecuadamente.',\n  'Una mota de polvo en el ojo rompe tu concentracion por un momento.',\n];\n\nexport const SPELL_ALREADY_APPLIED = [\n  'Has fallado.',\n  'Eso no parece tener ningun efecto.',\n];\n\nexport const SPELL_NOT_POSSIBLE = [\n  'No tienes suficiente mana.',\n  'Este estilo de lucha pide demasiado atencion para hacer eso!',\n  'Este asalto del combate es demasiado febril para concentrarte adecuadamente.',\n  'No has tenido suficiente tiempo en este asalto para completar el conjuro.',\n];\n\nexport const SPELLS_BY_TYPE: Record<string, Spell> = {\n  food: ['crear baya', 'crear comida'],\n  water: ['crear manantial', 'crear agua'],\n  levitate: ['volar', 'flotar'],\n  heal: ['curar criticas', 'curar graves', 'curar leves'],\n  attack: ['causar critica', 'causar grave', 'causar leve'],\n  dedope: ['ceguera', 'veneno'],\n};\n\nexport const SPELL_LEARN_ORDER: Spell[] = [\n  // Survival\n  SPELLS_BY_TYPE.food,\n  SPELLS_BY_TYPE.water,\n  SPELLS_BY_TYPE.dedope,\n  'luz eterna',\n\n  // Love\n  'invisibilidad',\n  'invocar armadillo',\n\n  // Dope\n  'armadura',\n  'bendecir',\n  'detectar escondido',\n  'detectar invisible',\n  'detectar magia',\n  SPELLS_BY_TYPE.levitate,\n\n  // Medic\n  'curar ceguera',\n  SPELLS_BY_TYPE.heal,\n  'refrescar',\n\n  // Other\n  SPELLS_BY_TYPE.attack,\n  'crear fuego',\n];\n\nexport interface SpellDescription {\n  name: SpellName;\n  success: string | RegExp;\n  endEffect?: string | UNKNOWN;\n  dope?: boolean | SpellName[];\n  afterDope?: string;\n}\n\nexport function getSpells(): SpellDescription[] {\n  return Object.entries(SPELLS)\n    .filter(([name, desc]) => desc)\n    .map(([name, desc]) => ({\n      ...((desc as any) as Omit<SpellDescription, 'name'>),\n      name: name as SpellName,\n    }));\n}\n\nconst SPELLS = {\n  armadura: {\n    success: 'Tu armadura brilla suavemente al ser mejorada por un conjuro.',\n    endEffect: 'Tu armadura vuelve a su valor normal.',\n    dope: true,\n  },\n\n  bendecir: {\n    success: 'Tu dios te otorga una poderosa bendicion.',\n    endEffect: UNKNOWN,\n  },\n\n  'causar critica': UNKNOWN,\n\n  'causar grave': {\n    success: /Tu conjuro [^\\n]+ a( w+)+!/,\n  },\n\n  'causar leve': UNKNOWN,\n\n  ceguera: {\n    success: /Lanzas un conjuro de ceguera contra ([^.]+)./,\n  },\n\n  'conocer alineamiento': UNKNOWN,\n\n  'crear agua': {\n    success: ' esta lleno.\\n',\n  },\n\n  'crear baya': UNKNOWN,\n\n  'crear comida': {\n    success: 'Una seta magica aparece de repente.',\n  },\n\n  'crear fuego': {\n    success: 'Una gran hoguera se enciende en el suelo delante tuyo.',\n  },\n\n  'crear manantial': {\n    success:\n      'Trazas un circulo delante tuyo del cual emerge un manantial de agua cristalina.',\n    endEffect: 'Un manantial magico se seca.',\n  },\n\n  'curar ceguera': UNKNOWN,\n  'curar criticas': UNKNOWN,\n  'curar graves': UNKNOWN,\n\n  'curar leves': {\n    success: 'Tus heridas leves se cierran y el dolor desaparece.',\n  },\n\n  'curar veneno': UNKNOWN,\n\n  'detectar escondido': {\n    success: 'Tus sentidos cobran la viveza de los del mejor predador.',\n    endEffect: 'Te sientes menos consciente de lo que te rodea.',\n    dope: true,\n  },\n\n  'detectar invisible': {\n    success: 'Tus ojos brillan, siendo capaces ahora de ver lo invisible.',\n    endEffect: 'Ya no ves objetos invisibles.',\n    dope: true,\n  },\n\n  'detectar magia': {\n    success:\n      'Delgadas lineas azules reseguiran las siluetas de los objetos magicos que te encuentres.',\n    endEffect: 'Las lineas azules desaparecen de tu vision',\n    dope: true,\n  },\n\n  'detectar maldad': {\n    success:\n      'Delgadas lineas rojas reseguiran las siluetas de los seres malvados que te encuentres.',\n    endEffect: UNKNOWN,\n    dope: true,\n  },\n\n  'detectar trampas': {\n    success: 'De repente te sientes mas alerta de los peligros que te rodean.',\n    endEffect: 'Te sientes menos alerta de los peligros que te rodean.',\n    dope: true,\n  },\n\n  'disipar maldad': UNKNOWN,\n\n  flotar: {\n    success: 'Empiezas a flotar a unos centimetros del suelo...',\n    endEffect: 'Tus pies aterrizan suavemente en el suelo.',\n    dope: ['volar', 'flotar'],\n  },\n\n  'fuego espectral': UNKNOWN,\n\n  invisibilidad: {\n    success: 'Te desvaneces en el aire.',\n    endEffect: 'Ya no eres invisible.',\n    dope: true,\n  },\n\n  'invocar armadillo': {\n    success:\n      'Agitas tus brazos a la vez que te concentras para invocar un pequenyo armadillo.',\n    endEffect: UNKNOWN,\n  },\n\n  'llamar rayo': UNKNOWN,\n\n  'luz eterna': {\n    success:\n      'Rayos de luz iridiscente colisionan para formar una bola de luz eterna...',\n    endEffect: 'Esta completamente oscuro ...',\n    afterDope: ['vestir luz', 'mirar'],\n  },\n\n  maldecir: UNKNOWN,\n  'misil magico': UNKNOWN,\n  'niebla espectral': UNKNOWN,\n  proteccion: UNKNOWN,\n\n  refrescar: {\n    success: 'Nueva vitalidad fluye hacia ti.',\n  },\n\n  terremoto: UNKNOWN,\n  veneno: UNKNOWN,\n\n  volar: {\n    success: 'Te elevas entre las corrientes de aire...',\n    endEffect: 'Aterrizas suavemente en el suelo.',\n    dope: ['volar', 'flotar'],\n  },\n};\n","export function render(\n  template: string | HTMLElement,\n  config?: Record<string, (el: HTMLElement) => void>,\n) {\n  if (typeof template === 'string') {\n    template = renderHtml(template);\n  }\n\n  const instance =\n    template instanceof HTMLTemplateElement\n      ? clone(template.content)\n      : clone(template);\n\n  if (config) {\n    for (const [selector, operator] of Object.entries(config)) {\n      const el = instance.querySelector(selector) as HTMLElement;\n\n      if (el) {\n        operator(el);\n      } else {\n        console.error(`Selector ${selector} returned no results`);\n      }\n    }\n  }\n\n  return Object.assign(instance, {\n    $: <T extends HTMLElement>(selector: string) =>\n      instance.querySelector(selector) as T,\n  });\n}\n\nfunction renderHtml(html: string) {\n  const template = document.createElement('template');\n  template.innerHTML = html;\n  return template;\n}\n\nfunction clone<T extends Node>(el: T) {\n  return el.cloneNode(true) as T;\n}\n","export function wait(seconds: number) {\n  return new Promise<void>(resolve => setTimeout(resolve, seconds * 1000));\n}\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/cssWithMappingToString.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"body {\\n  --background-color: #1c1c1c;\\n  --border-color: #484848;\\n}\\n\\n.container {\\n  height: 100%;\\n  display: grid;\\n  grid-template-rows: 1fr;\\n  grid-template-columns: 1fr;\\n  grid-template-areas: 'terminal';\\n}\\n\\n.container.show-controls {\\n  grid-template-rows: 50px auto;\\n  grid-template-columns: 9fr 3fr;\\n  grid-template-areas:\\n    'controls sidebar'\\n    'terminal sidebar';\\n}\\n\\n.terminal {\\n  grid-area: terminal;\\n}\\n\\n.sidebar {\\n  grid-area: sidebar;\\n  background-color: var(--background-color);\\n  border-left: 1px solid var(--border-color);\\n}\\n\\n.controls {\\n  grid-area: controls;\\n  background-color: var(--background-color);\\n  border-bottom: 1px solid var(--border-color);\\n}\\n\\n.container:not(.show-controls) .sidebar,\\n.container:not(.show-controls) .controls {\\n  display: none;\\n}\\n\", \"\",{\"version\":3,\"sources\":[\"webpack://src/ui/index.css\"],\"names\":[],\"mappings\":\"AAAA;EACE,2BAA2B;EAC3B,uBAAuB;AACzB;;AAEA;EACE,YAAY;EACZ,aAAa;EACb,uBAAuB;EACvB,0BAA0B;EAC1B,+BAA+B;AACjC;;AAEA;EACE,6BAA6B;EAC7B,8BAA8B;EAC9B;;sBAEoB;AACtB;;AAEA;EACE,mBAAmB;AACrB;;AAEA;EACE,kBAAkB;EAClB,yCAAyC;EACzC,0CAA0C;AAC5C;;AAEA;EACE,mBAAmB;EACnB,yCAAyC;EACzC,4CAA4C;AAC9C;;AAEA;;EAEE,aAAa;AACf\",\"sourcesContent\":[\"body {\\n  --background-color: #1c1c1c;\\n  --border-color: #484848;\\n}\\n\\n.container {\\n  height: 100%;\\n  display: grid;\\n  grid-template-rows: 1fr;\\n  grid-template-columns: 1fr;\\n  grid-template-areas: 'terminal';\\n}\\n\\n.container.show-controls {\\n  grid-template-rows: 50px auto;\\n  grid-template-columns: 9fr 3fr;\\n  grid-template-areas:\\n    'controls sidebar'\\n    'terminal sidebar';\\n}\\n\\n.terminal {\\n  grid-area: terminal;\\n}\\n\\n.sidebar {\\n  grid-area: sidebar;\\n  background-color: var(--background-color);\\n  border-left: 1px solid var(--border-color);\\n}\\n\\n.controls {\\n  grid-area: controls;\\n  background-color: var(--background-color);\\n  border-bottom: 1px solid var(--border-color);\\n}\\n\\n.container:not(.show-controls) .sidebar,\\n.container:not(.show-controls) .controls {\\n  display: none;\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/cssWithMappingToString.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".controls {\\n  display: flex;\\n  align-items: stretch;\\n}\\n\\n.controls .meter {\\n  width: 100px;\\n  margin: 8px;\\n  margin-right: 0;\\n  border: 1px solid var(--border-color);\\n  --color: white;\\n  --value: 100%;\\n}\\n\\n.controls .meter .bar {\\n  height: 100%;\\n  width: var(--value);\\n  background-color: var(--color);\\n}\\n\", \"\",{\"version\":3,\"sources\":[\"webpack://src/ui/Controls/Controls.css\"],\"names\":[],\"mappings\":\"AAAA;EACE,aAAa;EACb,oBAAoB;AACtB;;AAEA;EACE,YAAY;EACZ,WAAW;EACX,eAAe;EACf,qCAAqC;EACrC,cAAc;EACd,aAAa;AACf;;AAEA;EACE,YAAY;EACZ,mBAAmB;EACnB,8BAA8B;AAChC\",\"sourcesContent\":[\".controls {\\n  display: flex;\\n  align-items: stretch;\\n}\\n\\n.controls .meter {\\n  width: 100px;\\n  margin: 8px;\\n  margin-right: 0;\\n  border: 1px solid var(--border-color);\\n  --color: white;\\n  --value: 100%;\\n}\\n\\n.controls .meter .bar {\\n  height: 100%;\\n  width: var(--value);\\n  background-color: var(--color);\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/cssWithMappingToString.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".hamburger {\\n  display: inline-block;\\n  position: absolute;\\n  top: 24px;\\n  right: 40px;\\n  z-index: 1;\\n  -webkit-user-select: none;\\n  user-select: none;\\n}\\n\\n.hamburger input {\\n  display: block;\\n  width: 40px;\\n  height: 32px;\\n  position: absolute;\\n  top: -7px;\\n  left: -5px;\\n  cursor: pointer;\\n  opacity: 0; /* hide this */\\n  z-index: 2; /* and place it over the hamburger */\\n  -webkit-touch-callout: none;\\n}\\n\\n.hamburger span {\\n  display: block;\\n  width: 33px;\\n  height: 4px;\\n  margin-bottom: 5px;\\n  position: relative;\\n  background: #cdcdcd;\\n  border-radius: 3px;\\n  z-index: 1;\\n  transform-origin: center right;\\n  transition: transform 0.5s cubic-bezier(0.77, 0.2, 0.05, 1),\\n    background 0.5s cubic-bezier(0.77, 0.2, 0.05, 1), opacity 0.55s ease;\\n}\\n\\n/*\\n * Transform all the slices of hamburger\\n * into a crossmark.\\n */\\n.hamburger input:checked ~ span:nth-of-type(2) {\\n  opacity: 0;\\n  transform: rotate(0deg) scale(0.2, 0.2);\\n}\\n\\n.hamburger input:checked ~ span:first-of-type {\\n  transform: rotate(-45deg) translate(0, -4px);\\n}\\n\\n.hamburger input:checked ~ span:last-of-type {\\n  transform: rotate(45deg) translate(0, 4px);\\n}\\n\", \"\",{\"version\":3,\"sources\":[\"webpack://src/ui/Hamburger/Hamburger.css\"],\"names\":[],\"mappings\":\"AAAA;EACE,qBAAqB;EACrB,kBAAkB;EAClB,SAAS;EACT,WAAW;EACX,UAAU;EACV,yBAAyB;EACzB,iBAAiB;AACnB;;AAEA;EACE,cAAc;EACd,WAAW;EACX,YAAY;EACZ,kBAAkB;EAClB,SAAS;EACT,UAAU;EACV,eAAe;EACf,UAAU,EAAE,cAAc;EAC1B,UAAU,EAAE,oCAAoC;EAChD,2BAA2B;AAC7B;;AAEA;EACE,cAAc;EACd,WAAW;EACX,WAAW;EACX,kBAAkB;EAClB,kBAAkB;EAClB,mBAAmB;EACnB,kBAAkB;EAClB,UAAU;EACV,8BAA8B;EAC9B;wEACsE;AACxE;;AAEA;;;EAGE;AACF;EACE,UAAU;EACV,uCAAuC;AACzC;;AAEA;EACE,4CAA4C;AAC9C;;AAEA;EACE,0CAA0C;AAC5C\",\"sourcesContent\":[\".hamburger {\\n  display: inline-block;\\n  position: absolute;\\n  top: 24px;\\n  right: 40px;\\n  z-index: 1;\\n  -webkit-user-select: none;\\n  user-select: none;\\n}\\n\\n.hamburger input {\\n  display: block;\\n  width: 40px;\\n  height: 32px;\\n  position: absolute;\\n  top: -7px;\\n  left: -5px;\\n  cursor: pointer;\\n  opacity: 0; /* hide this */\\n  z-index: 2; /* and place it over the hamburger */\\n  -webkit-touch-callout: none;\\n}\\n\\n.hamburger span {\\n  display: block;\\n  width: 33px;\\n  height: 4px;\\n  margin-bottom: 5px;\\n  position: relative;\\n  background: #cdcdcd;\\n  border-radius: 3px;\\n  z-index: 1;\\n  transform-origin: center right;\\n  transition: transform 0.5s cubic-bezier(0.77, 0.2, 0.05, 1),\\n    background 0.5s cubic-bezier(0.77, 0.2, 0.05, 1), opacity 0.55s ease;\\n}\\n\\n/*\\n * Transform all the slices of hamburger\\n * into a crossmark.\\n */\\n.hamburger input:checked ~ span:nth-of-type(2) {\\n  opacity: 0;\\n  transform: rotate(0deg) scale(0.2, 0.2);\\n}\\n\\n.hamburger input:checked ~ span:first-of-type {\\n  transform: rotate(-45deg) translate(0, -4px);\\n}\\n\\n.hamburger input:checked ~ span:last-of-type {\\n  transform: rotate(45deg) translate(0, 4px);\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/cssWithMappingToString.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".sidebar {\\n}\\n\", \"\",{\"version\":3,\"sources\":[\"webpack://src/ui/Sidebar/Sidebar.css\"],\"names\":[],\"mappings\":\"AAAA;AACA\",\"sourcesContent\":[\".sidebar {\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/cssWithMappingToString.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".terminal {\\n  grid-area: terminal;\\n  overflow-x: hidden;\\n  overflow-y: auto;\\n  -ms-overflow-style: none; /* IE and Edge */\\n  scrollbar-width: none; /* Firefox */\\n}\\n\\n.terminal::-webkit-scrollbar {\\n  display: none;\\n}\\n\\n.terminal p {\\n  margin: 1em 0;\\n}\\n\\n.terminal input {\\n  background-color: transparent;\\n  border: none;\\n  color: white;\\n  display: inline-block;\\n  font-family: monospace;\\n  outline: none;\\n}\\n\", \"\",{\"version\":3,\"sources\":[\"webpack://src/ui/Terminal/Terminal.css\"],\"names\":[],\"mappings\":\"AAAA;EACE,mBAAmB;EACnB,kBAAkB;EAClB,gBAAgB;EAChB,wBAAwB,EAAE,gBAAgB;EAC1C,qBAAqB,EAAE,YAAY;AACrC;;AAEA;EACE,aAAa;AACf;;AAEA;EACE,aAAa;AACf;;AAEA;EACE,6BAA6B;EAC7B,YAAY;EACZ,YAAY;EACZ,qBAAqB;EACrB,sBAAsB;EACtB,aAAa;AACf\",\"sourcesContent\":[\".terminal {\\n  grid-area: terminal;\\n  overflow-x: hidden;\\n  overflow-y: auto;\\n  -ms-overflow-style: none; /* IE and Edge */\\n  scrollbar-width: none; /* Firefox */\\n}\\n\\n.terminal::-webkit-scrollbar {\\n  display: none;\\n}\\n\\n.terminal p {\\n  margin: 1em 0;\\n}\\n\\n.terminal input {\\n  background-color: transparent;\\n  border: none;\\n  color: white;\\n  display: inline-block;\\n  font-family: monospace;\\n  outline: none;\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","export function singleExecution<Return>(fn: () => Promise<Return>) {\n  let running: Promise<Return> | null = null;\n\n  return () => {\n    if (running) {\n      return running;\n    }\n\n    running = fn().then(x => {\n      running = null;\n      return x;\n    });\n\n    return running;\n  };\n}\n","import { wait } from '../util/wait';\nimport { PatternMatchSubscription } from './PatternMatchSubscription';\nimport { PatternPromiseTimeoutError } from './PatternPromiseTimeoutError';\nimport { PatternResult } from './PatternResult';\n\nexport class PatternPromise\n  extends Promise<PatternResult>\n  implements PatternMatchSubscription {\n  private forceReject!: (reason?: any) => void;\n\n  constructor(\n    executor: (\n      resolve: (value?: PatternResult | PromiseLike<PatternResult>) => void,\n      reject: (reason?: any) => void,\n    ) => void,\n  ) {\n    let _reject!: (reason?: any) => void;\n\n    super((resolve, reject) => {\n      _reject = reject;\n      executor(resolve, reject);\n    });\n\n    this.forceReject = _reject;\n  }\n\n  timeout(seconds: number) {\n    wait(seconds).then(() =>\n      this.forceReject(new PatternPromiseTimeoutError()),\n    );\n\n    return this as Promise<PatternResult>;\n  }\n\n  wait(seconds: number) {\n    return Promise.race([this, wait(seconds)]);\n  }\n\n  unsubscribe(): void {\n    this.forceReject('aborted');\n  }\n\n  once() {\n    return this;\n  }\n}\n","import { emitter } from '@amatiasq/emitter';\n\nimport { PluginContext } from '../lib/PluginContext';\n\nconst PROMPT = [\n  '&W<',\n  '&R%h/%Hhp ',\n  '&C%m/%Mm ',\n  '&G%v/%Vmv ',\n  '&P%Xxp ',\n  '&Y%gg',\n  '&W> ',\n  '&W%A ',\n  '\\n',\n].join('');\n\nconst FPROMPT = PROMPT.replace('&W>', ' &R%E&W>');\n\nexport const PROMPT_DETECTOR = new RegExp(\n  [\n    '<',\n    '(?<hpCurr>\\\\d+)/(?<hpTotal>\\\\d+)hp ',\n    '(?<mCurr>\\\\d+)/(?<mTotal>\\\\d+)m ',\n    '(?<mvCurr>\\\\d+)/(?<mvTotal>\\\\d+)mv ',\n    '(?<exp>(\\\\d|,)+)xp ',\n    '(?<gold>(\\\\d|,)+)g',\n    '( \\\\((?<enemy>\\\\d+)%\\\\))?',\n    '> (?<invis>I)?',\n  ].join(''),\n);\n\nclass Stat {\n  total = 0;\n  current = 0;\n\n  get percent() {\n    const result = this.total ? (1 / this.total) * this.current : 0;\n    return Math.round(result * 100) / 100;\n  }\n}\n\nexport async function promptPlugin({ when, write }: PluginContext) {\n  let isInvisible = false;\n\n  const stats = {\n    hp: new Stat(),\n    mana: new Stat(),\n    mv: new Stat(),\n    exp: 0,\n    gold: 0,\n    enemy: null as number | null,\n\n    get isFighting() {\n      return stats.enemy !== null;\n    },\n  };\n\n  type Stats = typeof stats;\n\n  const update = emitter<typeof stats>();\n\n  when(PROMPT_DETECTOR)\n    .timeout(1)\n    .catch(setPrompt)\n    .finally(() => {\n      when(PROMPT_DETECTOR, ({ groups: g }) => {\n        stats.hp.current = toInt(g.hpCurr);\n        stats.hp.total = toInt(g.hpTotal);\n        stats.mana.current = toInt(g.mCurr);\n        stats.mana.total = toInt(g.mTotal);\n        stats.mv.current = toInt(g.mvCurr);\n        stats.mv.total = toInt(g.mvTotal);\n        stats.exp = toInt(g.exp);\n        stats.gold = toInt(g.gold);\n        stats.enemy = g.enemy ? toInt(g.enemy) : null;\n        isInvisible = Boolean(g.invis);\n        update(stats);\n      });\n    });\n\n  return {\n    waitForPrompt,\n    getPercent,\n    until,\n    whenFresh,\n    onUpdate: update.subscribe,\n\n    get isFighting() {\n      return stats.isFighting;\n    },\n\n    get isInvisible() {\n      return isInvisible;\n    },\n  };\n\n  function whenFresh() {\n    return until(\n      stats =>\n        stats.hp.percent === 1 &&\n        stats.mana.percent === 1 &&\n        stats.mv.percent === 1,\n    );\n  }\n\n  function setPrompt() {\n    write(`prompt ${PROMPT}`);\n    write(`fprompt ${FPROMPT}`);\n  }\n\n  function waitForPrompt() {\n    return when(PROMPT_DETECTOR);\n  }\n\n  function getPercent(stat: 'hp' | 'mana' | 'mv') {\n    return stats[stat].percent;\n  }\n\n  function until(predicate: (stats: Stats) => boolean) {\n    if (predicate(stats)) {\n      return true;\n    }\n\n    return new Promise(resolve => {\n      const unsubscribe = update.subscribe((stats: Stats) => {\n        if (predicate(stats)) {\n          unsubscribe();\n          resolve(stats);\n        }\n      });\n    });\n  }\n}\n\nfunction toInt(value: string) {\n  return parseInt(value.replace(/,/g, ''), 10);\n}\n","import { ExecutionAbortedError } from './ExecutionAbortedError';\nimport { Pattern } from './triggers/Pattern';\nimport { PatternMatchSubscription } from './triggers/PatternMatchSubscription';\nimport { PatternOptions } from './triggers/PatternOptions';\nimport { PatternPromise } from './triggers/PatternPromise';\nimport { PatternResult } from './triggers/PatternResult';\nimport { TriggerCollection } from './triggers/TriggerCollection';\nimport { bindAll } from './util/bindAll';\nimport { wait } from './util/wait';\nimport { WriteOptions } from './WriteOptions';\n\nexport class PluginContext {\n  protected readonly subscriptions: PatternMatchSubscription[] = [];\n  protected isPrintingLogs = false;\n  private isAborted = false;\n\n  get printLogs() {\n    this.isPrintingLogs = true;\n    return null;\n  }\n\n  constructor(\n    readonly name: string,\n    readonly username: string,\n    protected readonly triggers: TriggerCollection,\n    protected readonly send: (command: string, options?: WriteOptions) => void,\n  ) {\n    bindAll(this, PluginContext);\n  }\n\n  write(command: string, options?: WriteOptions) {\n    this.checkNotAborted();\n    this.log(`[WRITE]`, command);\n    this.send(command, options);\n  }\n\n  when(pattern: Pattern, options?: PatternOptions): PatternPromise;\n  when(\n    pattern: Pattern,\n    handler: (result: PatternResult) => void,\n    options?: PatternOptions,\n  ): PatternMatchSubscription;\n  when(\n    pattern: Pattern,\n    handler?: ((result: PatternResult) => void) | PatternOptions,\n    options?: PatternOptions,\n  ) {\n    this.checkNotAborted();\n    this.log('[WATCH]', pattern);\n\n    if (typeof handler === 'function') {\n      return this.triggers.add(pattern, handler, options);\n    } else {\n      return this.triggers.add(pattern, handler);\n    }\n  }\n\n  sleep(seconds: number) {\n    this.checkNotAborted();\n    this.log('[SLEEP]', seconds);\n    return wait(seconds);\n  }\n\n  abort() {\n    this.isAborted = true;\n  }\n\n  dispose() {\n    this.log('DISPOSE');\n    this.subscriptions.forEach(x => x.unsubscribe());\n  }\n\n  log(...args: Parameters<Console['log']>) {\n    this.checkNotAborted();\n\n    if (this.isPrintingLogs) {\n      console.log(`[${this.name}]`, ...args);\n    }\n  }\n\n  protected checkNotAborted() {\n    if (this.isAborted) {\n      throw new ExecutionAbortedError();\n    }\n  }\n}\n","export class ExecutionAbortedError extends Error {}\n","export function bindAll<T extends {}>(\n  target: T,\n  source: { new (...args: any[]): T },\n) {\n  const proto = source.prototype;\n  const keys = Object.getOwnPropertyNames(proto) as (keyof T)[];\n\n  keys\n    .filter(key => {\n      const descriptor = Object.getOwnPropertyDescriptor(proto, key)!;\n      return typeof descriptor.value === 'function';\n    })\n    .forEach(method => {\n      target[method] = (target[method] as any).bind(target);\n    });\n}\n","import { emitter } from '@amatiasq/emitter';\n\nimport { Mud } from './lib/Mud';\nimport { RemoteTelnet } from './lib/RemoteTelnet';\nimport { registerWorkflows } from './registerWorkflows';\nimport { renderUserInterface } from './ui';\nimport { getPassword } from './util/getPassword';\nimport { getQueryParams } from './util/getQueryParams';\nimport { DEFAULT_PORT } from '../../config.json';\n\nlet FORCE_PROD_SERVER = false;\n// FORCE_PROD_SERVER = true;\n\nconst serverUri = getSocketUri();\nconst { host, port, user, pass } = getParams();\nconst { terminal, controls } = renderUserInterface(document.body);\n\nopenSocket();\n\nfunction openSocket() {\n  const socket = new WebSocket(serverUri);\n\n  // socket.addEventListener('close', openSocket);\n  socket.addEventListener('open', () => {\n    const telnet = new RemoteTelnet(socket);\n\n    telnet.connect(host, port);\n    terminal.write(`Connecting to ${host}:${port} as ${user}\\n`);\n\n    initializeMud(telnet);\n  });\n}\n\nasync function initializeMud(telnet: RemoteTelnet) {\n  const mud = new Mud(telnet);\n\n  mud.onCommand(x => terminal.write(`${x}\\n`));\n  telnet.onData(data => terminal.write(data));\n\n  window.onbeforeunload = () => {\n    if (telnet.isConnected) {\n      telnet.send('abandonar');\n    }\n\n    telnet.close();\n  };\n\n  terminal.onSubmit(command => {\n    terminal.write(`${command}\\n`);\n\n    if (command.startsWith('!')) {\n      const [workflow, ...args] = command.substr(1).split(/\\s+/);\n      runWorkflow(workflow, args);\n      return;\n    }\n\n    telnet.send(command);\n    mud.userInput(command);\n  });\n\n  await mud.login(user, pass);\n  registerWorkflows(mud);\n  await connectStats();\n  connectButtons();\n\n  Object.assign(window, { mud });\n\n  async function connectStats() {\n    const hp = emitter<number>();\n    controls.addMeter('red', hp.subscribe);\n\n    const mana = emitter<number>();\n    controls.addMeter('blue', mana.subscribe);\n\n    const mv = emitter<number>();\n    controls.addMeter('green', mv.subscribe);\n\n    mud.getPlugin('prompt').onUpdate(x => {\n      hp(x.hp.percent);\n      mana(x.mana.percent);\n      mv(x.mv.percent);\n    });\n  }\n\n  function connectButtons() {\n    controls.addButton('Entrenar', () => mud.run('train'));\n  }\n\n  function runWorkflow(name: string, args: string[]) {\n    const cmd = `\"${name}\" with \"${args.join(' ')}\"`;\n    terminal.write(`-> Running ${cmd}\\n`);\n\n    mud.run(name, args).then(\n      x => terminal.write(`\\n<- Done ${cmd}\\n`),\n      x => terminal.write(`\\n\\n<! FAILED ${cmd}: ${x.message}\\n\\n`),\n    );\n  }\n}\n\nfunction getSocketUri() {\n  return location.origin === 'https://amatiasq.github.io' || FORCE_PROD_SERVER\n    ? 'wss://mudOS.amatiasq.com'\n    : `ws://localhost:${DEFAULT_PORT}`;\n}\n\nfunction getParams() {\n  const { user, server } = getQueryParams();\n  const [host, port] = server.split(':');\n  const pass = getPassword(user);\n  return { host, port: parseInt(port, 10), user, pass };\n}\n","import { emitter } from '@amatiasq/emitter';\n\nimport { initializePlugins, PluginMap } from '../plugins/index';\nimport { login } from '../plugins/login';\nimport { PluginContext } from './PluginContext';\nimport { RemoteTelnet } from './RemoteTelnet';\nimport { TriggerCollection } from './triggers/TriggerCollection';\nimport { Context } from './workflow/Context';\nimport { InvokeOptions } from './workflow/InvokeOptions';\nimport { Workflow } from './workflow/Workflow';\nimport { WorkflowFn } from './workflow/WorkflowFn';\nimport { WorkflowNotFoundError } from './workflow/WorkflowNotFoundError';\nimport { WriteOptions } from './WriteOptions';\n\nexport class Mud {\n  private readonly triggers = new TriggerCollection();\n  private readonly workflows: Record<string, Workflow> = {};\n  private plugins!: PluginMap;\n  private username!: string;\n\n  private readonly emitCommand = emitter<string>();\n  readonly onCommand = this.emitCommand.subscribe;\n\n  private emitLoggedIn!: (usernamne: string) => void;\n  readonly whenLoggedIn = new Promise(resolve => (this.emitLoggedIn = resolve));\n\n  constructor(private readonly telnet: RemoteTelnet) {\n    this.workflow = this.workflow.bind(this);\n    this.send = this.send.bind(this);\n    this.run = this.run.bind(this);\n    this.telnet.onData(x => this.triggers.process(removeNoise(x)));\n  }\n\n  async login(user: string, pass: string) {\n    const context = new PluginContext('login', 'N/A', this.triggers, this.send);\n\n    await login(context, user, pass, async () => {\n      this.plugins = await initializePlugins(\n        name => new PluginContext(name, user, this.triggers, this.send),\n      );\n    });\n\n    context.dispose();\n    this.username = user;\n    this.emitLoggedIn(user);\n  }\n\n  send(text: string, options: WriteOptions = {}) {\n    this.emitCommand(options.password ? '*'.repeat(text.length) : text);\n    this.telnet.send(text);\n  }\n\n  userInput(command: string): void {}\n\n  getPlugin<Name extends keyof PluginMap>(name: Name): PluginMap[Name] {\n    return this.plugins[name];\n  }\n\n  daemon<Args extends any[]>(\n    name: string,\n    run: WorkflowFn<[]>,\n    params?: Args,\n    options?: InvokeOptions,\n  ) {\n    const workflow = new Workflow(name, async (context: Context) => {\n      await run(context);\n      return context.runForever();\n    });\n\n    return this.executeWorkflow(\n      workflow as Workflow<any, any>,\n      params,\n      options,\n    );\n  }\n\n  workflow<Args extends any[]>(name: string, run: WorkflowFn<Args>) {\n    const workflow = new Workflow(name, run);\n    this.workflows[workflow.name] = workflow as Workflow<any, any>;\n    return workflow;\n  }\n\n  run(name: string, params?: any[], options?: InvokeOptions) {\n    if (!(name in this.workflows)) {\n      throw new WorkflowNotFoundError(`Workflow ${name} is not registered.`);\n    }\n\n    const workflow = this.workflows[name];\n    return this.executeWorkflow(workflow, params, options);\n  }\n\n  private executeWorkflow(\n    workflow: Workflow,\n    params: any[] = [],\n    { logs }: InvokeOptions = {},\n  ) {\n    const context = this.createWorkflowContext(workflow.name);\n\n    if (logs) {\n      context.printLogs;\n    }\n\n    const promise = workflow.execute(context, ...params).then(result => {\n      context.dispose();\n      return result;\n    });\n\n    return Object.assign(promise, {\n      abort() {\n        context.abort();\n      },\n    });\n  }\n\n  private createWorkflowContext(name: string): Context {\n    return new Context(\n      name,\n      this.username,\n      this.triggers,\n      this.plugins,\n      this.send,\n      this.workflow,\n      this.run,\n    );\n  }\n}\n\nfunction removeNoise(text: string) {\n  return removeAsciiCodes(text).replace(/\\r/g, '');\n}\n\nfunction removeAsciiCodes(text: string) {\n  return text.replace(/\\u001b\\[.*?m/g, '');\n}\n","import { PluginContext } from '../lib/PluginContext';\nimport { chatPlugin } from './chatPlugin';\nimport { inventoryPlugin } from './inventoryPlugin';\nimport { navigationPlugin } from './navigationPlugin';\nimport { promptPlugin } from './promptPlugin';\nimport { skillsPlugin } from './skillsPlugin';\n\nconst plugins = {\n  chat: chatPlugin,\n  inventory: inventoryPlugin,\n  navigation: navigationPlugin,\n  prompt: promptPlugin,\n  skills: skillsPlugin,\n};\n\n// -- Dirty implementation\n\ntype plugins = typeof plugins;\ntype UnPromisify<T> = T extends Promise<infer U> ? U : T;\n\nexport type PluginMap = {\n  [name in keyof plugins]: UnPromisify<ReturnType<plugins[name]>>;\n};\n\nexport async function initializePlugins(\n  context: (name: string) => PluginContext,\n) {\n  const promises = Object.entries(plugins).map(async ([name, plugin]) => [\n    name,\n    await plugin(context(name)),\n  ]);\n\n  const entries = await Promise.all(promises);\n  return Object.fromEntries(entries) as PluginMap;\n}\n","import { ClientStorage } from '@amatiasq/client-storage';\n\nimport { PluginContext } from '../lib/PluginContext';\nimport { PatternResult } from '../lib/triggers/PatternResult';\nimport { requestNotificationPermission } from '../lib/util/requestNotificationPermission';\n\ninterface Message {\n  time: number;\n  from: string;\n  to: string;\n  message: string;\n}\n\ntype History = ClientStorage<Record<string, Message[]>>;\n\nexport function chatPlugin({ when }: PluginContext) {\n  // const say = new ClientStorage<Record<string, Message[]>>('chat:say');\n  const tell = new ClientStorage<Record<string, Message[]>>('chat:tell');\n  const whisper = new ClientStorage<Record<string, Message[]>>('chat:whisper');\n\n  (window as any).chat = () => tell.get();\n\n  when(/(?<name>.+) te susurra '(?<message>[^']+)'/, receive(whisper));\n  when(/Susurras a (?<name>.+) '(?<message>[^']+)'/, sent(whisper));\n\n  when(\n    [\n      /(?<name>.+) te cuenta '(?<message>[^']+)'/,\n      /(?<name>.+) te responde '(?<message>[^']+)'/,\n    ],\n    receive(tell),\n  );\n\n  when(\n    [\n      /Cuentas a (?<name>.+) '(?<message>[^']+)'/,\n      /Respondes a (?<name>.+) '(?<message>[^']+)'/,\n    ],\n    sent(tell),\n  );\n}\n\ntype msg = { message: string };\n\nfunction receive(log: History) {\n  return ({ groups: { name, message } }: PatternResult) => {\n    console.log(`[MESSAGE(${name})]:`, message);\n    addMessage(log, { from: name, message });\n    notify(name, message);\n  };\n}\n\nfunction sent(log: History) {\n  return ({ groups: { name, message } }: PatternResult) =>\n    addMessage(log, { to: name, message });\n}\n\nasync function notify(from: string, message: string) {\n  await requestNotificationPermission();\n  return new Notification(`${name} te cuenta '${message}'`);\n}\n\nfunction addMessage(log: History, partial: { from: string } & msg): Message;\nfunction addMessage(log: History, partial: { to: string } & msg): Message;\nfunction addMessage(\n  log: History,\n  partial: { from?: string; to?: string } & msg,\n): Message {\n  const message: Message = {\n    time: Date.now(),\n    from: 'me',\n    to: 'me',\n    ...partial,\n  };\n\n  const data = log.get() || {};\n  const other = (partial.from || partial.to)!;\n  const history = data[other] || [];\n\n  history.push(message);\n  log.set({ ...data, [other]: history });\n  return message;\n}\n","export function requestNotificationPermission() {\n  if (!('Notification' in window)) {\n    console.warn('This browser does not support desktop notification');\n    return;\n  }\n\n  if (Notification.permission === 'granted') {\n    return Promise.resolve(true);\n  }\n\n  if (Notification.permission === 'denied') {\n    return;\n  }\n\n  return Notification.requestPermission().then(x => x === 'granted');\n}\n","import { PluginContext } from '../lib/PluginContext';\nimport { singleExecution } from '../lib/util/singleExecution';\n\nconst INVENTORY_DETECTOR = /Estas llevando:(\\n.*)+?\\n\\n/;\n\nexport function inventoryPlugin({ when, write }: PluginContext) {\n  let isInitialized = false;\n  let items: Record<string, number> = {};\n\n  const refresh = singleExecution(async () => {\n    write('inventario');\n    await when(INVENTORY_DETECTOR);\n  });\n\n  when('No tienes ese objeto.', refresh);\n\n  when(\n    INVENTORY_DETECTOR,\n    ({ captured }) => {\n      const [_, ...inventory] = captured[0]\n        .split('\\n')\n        .map(x => x.trim())\n        .filter(Boolean);\n\n      isInitialized = true;\n      items = {};\n\n      for (const item of inventory) {\n        if (item === 'Nada.') {\n          return;\n        }\n\n        const match = item.match(/(.*) \\((\\d+)\\)$/);\n\n        if (match) {\n          items[match[1]] = parseInt(match[2], 10);\n        } else {\n          items[item] = 1;\n        }\n      }\n    },\n    { captureLength: 1000 },\n  );\n\n  return { refresh, has };\n\n  async function has(search: string | string[] | Record<string, string>) {\n    if (!isInitialized) {\n      await refresh();\n    }\n\n    if (typeof search === 'string') {\n      return hasSync(search) ? search : null;\n    }\n\n    if (Array.isArray(search)) {\n      return search.find(hasSync) || null;\n    }\n\n    const key = Object.keys(search).find(hasSync);\n    return key ? search[key] : null;\n  }\n\n  function hasSync(key: string) {\n    return items[key];\n  }\n}\n","import { emitter } from '@amatiasq/emitter';\n\nimport { PluginContext } from '../lib/PluginContext';\nimport { PatternPromise } from '../lib/triggers/PatternPromise';\nimport { PROMPT_DETECTOR } from './promptPlugin';\n\nconst CLOSED = '(cerrada)';\nconst aliases = {\n  s: 'sur',\n  n: 'norte',\n  e: 'este',\n  w: 'oeste',\n  o: 'oeste',\n  u: 'arriba',\n  d: 'abajo',\n  l: 'sureste',\n  k: 'suroeste',\n  j: 'noreste',\n  h: 'noroeste',\n};\n\nexport function navigationPlugin({ log, when, write }: PluginContext) {\n  let isNavigating = false;\n  let landingAtRecall = false;\n  let isAtRecall = false;\n  let directions: string[] = [];\n\n  const prompt = () => when(PROMPT_DETECTOR);\n  const roomChanged = emitter<string[]>();\n\n  when(/Plaza de Darkhaven\\s+/, () => (landingAtRecall = true));\n\n  when('Puerta esta cerrada.', () => {\n    const closed = directions.find(x => x.includes(CLOSED));\n\n    if (closed) {\n      const dir = closed.replace(CLOSED, '');\n      write(`abrir ${dir}`);\n      write(dir);\n    }\n  });\n\n  when(/\\nSalidas: ([^\\.]+)/, async ({ captured }) => {\n    directions = captured[1].split(' ');\n    isNavigating = false;\n    isAtRecall = landingAtRecall;\n    landingAtRecall = false;\n    await prompt();\n    roomChanged(directions);\n  });\n\n  return {\n    canGo,\n    go,\n    execute,\n    recall,\n    waitForRecall,\n    onRoomChange: roomChanged.subscribe,\n\n    get isNavigating() {\n      return isNavigating;\n    },\n\n    get isAtRecall() {\n      return isAtRecall;\n    },\n  };\n\n  async function recall() {\n    if (isAtRecall) {\n      return Promise.resolve();\n    }\n\n    write('recall');\n    await when('Plaza de Darkhaven');\n    await prompt();\n  }\n\n  function waitForRecall() {\n    if (isAtRecall) {\n      return new PatternPromise(resolve => resolve());\n    }\n\n    return when('Plaza de Darkhaven');\n  }\n\n  function canGo(direction: string) {\n    return Boolean(get(direction));\n  }\n\n  function isClosed(direction: string) {\n    const dir = get(direction);\n    return dir && dir.includes(CLOSED);\n  }\n\n  async function execute(\n    pattern: string,\n    callback: () => Promise<any> | void = () => {},\n  ) {\n    if (pattern[0] === 'r') {\n      await recall();\n      pattern = pattern.substr(1);\n    }\n\n    let untilEnd = false;\n\n    for (const step of parsePath(pattern)) {\n      if (step.toUpperCase() === 'X') {\n        untilEnd = true;\n        continue;\n      }\n\n      if (!untilEnd) {\n        if (await go(step)) {\n          await callback();\n          continue;\n        } else {\n          return false;\n        }\n      }\n\n      while (canGo(step)) {\n        if (!(await go(step))) {\n          return false;\n        }\n\n        await callback();\n      }\n\n      untilEnd = false;\n    }\n\n    return true;\n  }\n\n  async function go(direction: string) {\n    if (isNavigating) {\n      throw new Error('WTF DUDE');\n    }\n\n    const dir = get(direction);\n\n    if (!dir) {\n      throw new Error(`Unknown direction '${direction}'`);\n    }\n\n    if (isClosed(direction)) {\n      write(`abrir ${direction}`);\n\n      const success = await Promise.any([\n        when('Abres la puerta.').then(() => true),\n        when('Esta cerrada con llave.').then(() => false),\n      ]);\n\n      if (!success) {\n        log('Can\\t open door');\n        return false;\n      }\n    }\n\n    write(dir.replace(CLOSED, '').trim());\n    isNavigating = true;\n\n    await when('\\nSalidas:');\n    await prompt();\n\n    isNavigating = false;\n    return true;\n  }\n\n  function get(direction: string) {\n    if (direction in aliases) {\n      direction = aliases[direction as keyof typeof aliases];\n    }\n\n    return directions.find(x => x.startsWith(direction));\n  }\n}\n\nfunction parsePath(path: string) {\n  return path.replace(/(\\d+)(\\w)/g, (_, times, dir) => dir.repeat(times));\n}\n","export class PatternPromiseTimeoutError extends Error {}\n","import { PluginContext } from '../lib/PluginContext';\nimport { concatRegexes } from '../lib/util/concatRegexes';\nimport { singleExecution } from '../lib/util/singleExecution';\nimport {\n  getSpells,\n  SPELL_ALREADY_APPLIED,\n  SPELL_FAILED,\n  SPELL_NOT_POSSIBLE,\n} from '../spells';\n\n// Skill cast results\n// const TIMEOUT = 0;\nconst NOT_AVAILABLE = undefined;\nconst BUSY = null;\nconst FAILED = false;\nconst CASTED = true;\nconst ALREADY_APPLIED = 1;\n\nconst SUCCESS = Object.fromEntries(getSpells().map(x => [x.name, x.success]));\n\nconst SKILL = /((?:\\w+ )+)\\s+(\\d+)%/g;\nconst SKILLS_DETECTOR = concatRegexes(\n  /-+\\[(\\w+)\\]-+\\n/,\n  /(.|\\n)+/,\n  /Te quedan \\d+ practicas.\\n/,\n  /Tienes \\d+ entrenamientos.\\n/,\n);\n\nexport function skillsPlugin({ when, write }: PluginContext) {\n  let isInitialized = false;\n  let isSpellRunning = false;\n  let skills: Record<string, number> = {};\n\n  const refresh = singleExecution(() => {\n    write('practicar');\n    return when(SKILLS_DETECTOR);\n  });\n\n  when(\n    SKILLS_DETECTOR,\n    ({ captured: [content] }) => {\n      isInitialized = true;\n\n      for (const skill of content.matchAll(SKILL)!) {\n        skills[skill[1].trim()] = parseInt(skill[2], 10);\n      }\n\n      isInitialized = true;\n\n      console.log(skills);\n    },\n    { captureLength: 3000 },\n  );\n\n  return {\n    has,\n    canLearn,\n    castSpell,\n    NOT_AVAILABLE,\n    BUSY,\n    FAILED,\n    CASTED,\n    ALREADY_APPLIED,\n  };\n\n  async function has(search: string | string[]) {\n    await ensureInitiated();\n\n    if (typeof search === 'string') {\n      return hasSync(search) ? search : null;\n    } else {\n      return search.find(hasSync) || null;\n    }\n  }\n\n  function hasSync(name: string) {\n    return skills[name];\n  }\n\n  async function canLearn(name: string) {\n    await ensureInitiated();\n    return name in skills;\n  }\n\n  function ensureInitiated() {\n    if (!isInitialized) {\n      return refresh();\n    }\n  }\n\n  async function castSpell(name: string | string[], args = '') {\n    const validName = await has(name);\n\n    if (!validName) {\n      return NOT_AVAILABLE;\n    }\n\n    if (!(validName in SUCCESS)) {\n      throw new Error(`Unknown response for spell \"${name}\".`);\n    }\n\n    if (isSpellRunning) {\n      return BUSY;\n    }\n\n    isSpellRunning = true;\n    write(`conjurar \"${validName}\" ${args}`);\n\n    const success = SUCCESS[validName as keyof typeof SUCCESS];\n\n    const result = await Promise.any([\n      when(success).then(() => CASTED),\n      when(SPELL_NOT_POSSIBLE).then(() => NOT_AVAILABLE),\n      when(SPELL_ALREADY_APPLIED).then(() => ALREADY_APPLIED),\n      when(SPELL_FAILED)\n        .wait(4)\n        .then(() => FAILED),\n    ]);\n\n    isSpellRunning = false;\n    return result;\n  }\n}\n","export function concatRegexes(...regexes: (RegExp | string)[]) {\n  const join = regexes\n    .map(x => x.toString().replace(/^\\/|\\/[gi]*$/g, ''))\n    .join('');\n\n  const flags = regexes\n    .map(x => x instanceof RegExp && x.flags)\n    .filter(Boolean)\n    .join('');\n\n  const uniq = [...new Set(flags)].join('');\n  return new RegExp(join, uniq);\n}\n","import { PluginContext } from '../lib/PluginContext';\n\nexport async function login(\n  { when, write, log }: PluginContext,\n  username: string,\n  password: string,\n  initialize: () => Promise<any>,\n) {\n  await when('Entra el nombre de tu personaje o escribe Nuevo:');\n  write(username);\n  log('Username sent, waiting for password request');\n\n  await when('Password:');\n  write(password, { password: true });\n  log(`Logged in as ${username}`);\n\n  await Promise.any([\n    (async () => {\n      await when('Reconectando.');\n      await initialize();\n    })(),\n    (async () => {\n      await when('Pulsa [ENTER]');\n      write('');\n      await when('Pulsa [ENTER]');\n      write('');\n      await when('Bienvenido a Balzhur...', initialize, { await: true }).once();\n    })(),\n  ]);\n}\n","import { Pattern } from './Pattern';\nimport { PatternMatcher } from './PatternMatcher';\nimport { PatternMatchSubscription } from './PatternMatchSubscription';\nimport { PatternOptions } from './PatternOptions';\nimport { PatternPromise } from './PatternPromise';\nimport { PatternResult } from './PatternResult';\n\ntype Handler = (result: PatternResult) => void;\n\nexport class TriggerCollection {\n  private readonly patterns = new Set<PatternMatcher>();\n  private readonly queue: string[] = [];\n  private isProcessing = false;\n\n  add(pattern: Pattern, options?: PatternOptions): PatternPromise;\n  add(\n    pattern: Pattern,\n    handler: (result: PatternResult) => void,\n    options?: PatternOptions,\n  ): PatternMatchSubscription;\n  add(\n    pattern: Pattern,\n    handler?: Handler | PatternOptions,\n    options?: PatternOptions,\n  ): any {\n    if (arguments.length === 1) return this.once(pattern);\n\n    if (arguments.length === 3)\n      return this.watch(pattern, handler as Handler, options);\n\n    if (typeof handler === 'function')\n      return this.watch(pattern, handler as Handler);\n\n    return this.once(pattern, handler as PatternOptions);\n  }\n\n  private watch(pattern: Pattern, handler: Handler, options?: PatternOptions) {\n    const entry = new PatternMatcher(pattern, x => handler(x), options);\n\n    this.patterns.add(entry);\n\n    const unsubscribe = () => this.patterns.delete(entry);\n\n    const once = () =>\n      new PatternPromise(resolve => {\n        const original = handler;\n\n        handler = async x => {\n          unsubscribe();\n\n          if (original) {\n            if (options && options.await) {\n              await original(x);\n            } else {\n              original(x);\n            }\n          }\n\n          resolve(x);\n        };\n      });\n\n    return { unsubscribe, once } as PatternMatchSubscription;\n  }\n\n  private once(pattern: Pattern, options?: PatternOptions) {\n    return new PatternPromise(resolve => {\n      const sub = this.add(pattern, handler, options);\n\n      function handler(result: PatternResult) {\n        sub.unsubscribe();\n        resolve(result);\n      }\n    });\n  }\n\n  async process(text: string): Promise<void> {\n    if (this.isProcessing) {\n      this.queue.push(text);\n      return;\n    }\n\n    this.isProcessing = true;\n\n    const splitted = text.split('\\n');\n    const last = splitted.pop() as string;\n    const lines = [...splitted.map(x => `${x}\\n`), last];\n\n    for (const line of lines) {\n      // console.log('PROCESS', line);\n      for (const pattern of this.patterns) {\n        await pattern.process(line);\n      }\n    }\n\n    this.isProcessing = false;\n\n    if (this.queue.length) {\n      return this.process(this.queue.pop()!);\n    }\n  }\n}\n","import { trimEnd } from '../util/trimEnd';\nimport { Pattern, SinglePattern } from './Pattern';\nimport { PatternOptions } from './PatternOptions';\nimport { PatternResult } from './PatternResult';\n\nexport class PatternMatcher {\n  private readonly patterns: SinglePattern[];\n  private readonly buffer;\n  readonly length;\n\n  constructor(\n    pattern: Pattern,\n    private readonly handler: (result: PatternResult) => void,\n    private readonly options: PatternOptions = {},\n  ) {\n    this.patterns = Array.isArray(pattern) ? pattern : [pattern];\n    this.length =\n      options.captureLength ||\n      Math.max(...this.patterns.map(x => String(x).length)) * 10;\n\n    this.buffer = buffer(this.length);\n  }\n\n  process(text: string) {\n    const value = this.buffer(text);\n    const matching = this.patterns.filter(pattern =>\n      this.testPattern(value, pattern),\n    );\n\n    if (!matching.length) {\n      return;\n    }\n\n    this.buffer.clear();\n    const result = new PatternResult(matching, value);\n    const output = this.handler(result);\n    return this.options.await ? output : null;\n  }\n\n  private testPattern(text: string, pattern: SinglePattern) {\n    if (typeof pattern === 'string') {\n      return text.indexOf(pattern) > -1;\n    }\n\n    return pattern.test(text);\n  }\n}\n\nfunction buffer(length: number) {\n  let value = '';\n  const clear = () => (value = '');\n  const add = (text: string) => (value = trimEnd(`${value}${text}`, length));\n  return Object.assign(add, { clear });\n}\n","export function trimEnd(value: string, maxLength: number) {\n  return value.length > maxLength\n    ? value.substr(value.length - maxLength)\n    : value;\n}\n","import { SinglePattern } from './Pattern';\n\nexport class PatternResult {\n  private get regexes() {\n    return this.patterns.filter(isRegex);\n  }\n\n  private get stringPatterns() {\n    return this.patterns.filter(x => !isRegex(x));\n  }\n\n  get captured() {\n    const regexMatches = this.regexes\n      .map(x => this.haystack.match(x)!)\n      .filter(Boolean)\n      .map(x => Array.from(x));\n\n    // TODO: maybe return the one with more captures?\n    return regexMatches[0];\n  }\n\n  get groups(): Record<string, string> {\n    return this.regexes\n      .map(x => this.haystack.match(x)!)\n      .filter(Boolean)\n      .map(x => x.groups!)\n      .filter(Boolean)\n      .reduce(merge, {});\n  }\n\n  constructor(\n    readonly patterns: SinglePattern[],\n    private readonly haystack: string,\n  ) {}\n}\n\nfunction isRegex(value: SinglePattern) {\n  return value instanceof RegExp;\n}\n\nfunction merge(a: object, b: object) {\n  return { ...a, ...b };\n}\n","import { WorkflowFn } from './WorkflowFn';\nimport { PluginMap } from '../../plugins/index';\nimport { ExecutionAbortedError } from '../ExecutionAbortedError';\nimport { Mud } from '../Mud';\nimport { PluginContext } from '../PluginContext';\nimport { TriggerCollection } from '../triggers/TriggerCollection';\nimport { bindAll } from '../util/bindAll';\nimport { WriteOptions } from '../WriteOptions';\nimport { MissingPluginError } from './MissingPluginError';\n\nexport class Context extends PluginContext {\n  private finish: ((reason: any) => void) | null = null;\n\n  readonly plugins: PluginMap;\n\n  constructor(\n    name: string,\n    username: string,\n    triggers: TriggerCollection,\n    plugins: PluginMap,\n    send: (command: string, options?: WriteOptions) => void,\n    readonly register: <Args extends any[]>(\n      name: string,\n      action: WorkflowFn<Args>,\n    ) => void,\n    private readonly runWorkflow: Mud['run'],\n  ) {\n    super(`W(${name})`, username, triggers, send);\n    this.plugins = createPluginsGetter(plugins, this.log.bind(this));\n\n    bindAll(this, Context);\n  }\n\n  run<T>(name: string, params: any[] = []) {\n    this.checkNotAborted();\n    this.log(`Invoke workflow ${name} with`, ...params);\n    return this.runWorkflow(name, params, { logs: this.isPrintingLogs });\n  }\n\n  runForever() {\n    return new Promise(resolve => (this.finish = resolve));\n  }\n\n  abort() {\n    super.abort();\n\n    if (this.finish) {\n      this.finish(new ExecutionAbortedError());\n    }\n  }\n}\n\nfunction createPluginsGetter(source: PluginMap, log: Function) {\n  return new Proxy(source, {\n    get(target, key: string) {\n      if (!(key in target)) {\n        log(`Failed to get plugin ${key}`);\n        throw new MissingPluginError(`Plugin ${key} is not registered.`);\n      }\n\n      log(`Requires plugin ${key}`);\n      return target[key as keyof typeof target];\n    },\n  });\n}\n","export class MissingPluginError extends Error {}\n","import { Context } from './Context';\n\nexport class Workflow<Args extends any[] = any[], Return = any> {\n  private executionCount = 0;\n  private currentExecutions = 0;\n\n  get isRunning() {\n    return this.currentExecutions > 0;\n  }\n\n  get timesExecuted() {\n    return this.executionCount;\n  }\n\n  constructor(\n    readonly name: string,\n    private readonly run: (\n      context: Context,\n      ...args: Args\n    ) => Promise<Return> | void,\n  ) {}\n\n  async execute(context: Context, ...args: Args) {\n    this.currentExecutions++;\n    const iteration = this.executionCount++;\n\n    context.log(`[Exe(${iteration})]`, ...args);\n\n    try {\n      const result = await this.run(context, ...args);\n      context.log(`[Res(${iteration}]`, result);\n      return result;\n    } catch (error) {\n      context.log(`[ERR(${iteration})]`, error);\n      throw error;\n    } finally {\n      this.currentExecutions--;\n    }\n  }\n}\n","export class WorkflowNotFoundError extends Error {}\n","import { emitter } from '@amatiasq/emitter';\n\nexport class RemoteTelnet {\n  private _isConnected = false;\n\n  get isConnected() {\n    return this._isConnected;\n  }\n\n  private readonly emitClose = emitter();\n  readonly onClose = this.emitClose.subscribe;\n\n  private readonly emitData = emitter<string>();\n  readonly onData = this.emitData.subscribe;\n\n  constructor(private readonly socket: WebSocket) {\n    socket.addEventListener('close', this.emitClose);\n    socket.addEventListener('message', this.onMessage.bind(this));\n\n    this.onData(() => (this._isConnected = true));\n    this.onClose(() => (this._isConnected = false));\n  }\n\n  connect(host: string, port: number) {\n    this.proxy('OPEN', { host, port });\n  }\n\n  send(value: string) {\n    this.proxy('INPUT', value);\n  }\n\n  close() {\n    this.socket.close();\n  }\n\n  private proxy(type: string, payload: any) {\n    this.socket.send(JSON.stringify({ type, payload }));\n  }\n\n  private async onMessage(event: MessageEvent<Blob>) {\n    const escaped = await event.data.text();\n    const text = escaped\n      // .replace(/z<Ex>/g, '')\n      // .replace(/\\[1z<\\/Ex>/g, '')\n      .replace(/&lt;/g, '<')\n      .replace(/&gt;/g, '>')\n      .replace(/&amp;/g, '&');\n\n    this.emitData(text);\n  }\n}\n","import { defend } from './daemons/defend';\nimport { dope } from './daemons/dope';\nimport { drink } from './daemons/drink';\nimport { eat } from './daemons/eat';\nimport { idle } from './daemons/idle';\nimport { rest } from './daemons/rest';\nimport { Mud } from './lib/Mud';\nimport { afk } from './workflows/afk';\nimport { bank } from './workflows/bank';\nimport { cast } from './workflows/cast';\nimport { donations } from './workflows/donations';\nimport { go } from './workflows/go';\nimport { kill } from './workflows/kill';\nimport { train } from './workflows/train';\n\nexport function registerWorkflows(mud: Mud) {\n  mud.workflow('afk', afk);\n  mud.workflow('bank', bank);\n  mud.workflow('cast', cast);\n  mud.workflow('donations', donations);\n  mud.workflow('kill', kill);\n  mud.workflow('go', go);\n  mud.workflow('train', train);\n\n  mud.daemon('defend', defend);\n  mud.daemon('dope', dope);\n  mud.daemon('drink', drink);\n  mud.daemon('eat', eat);\n  mud.daemon('idle', idle);\n  mud.daemon('rest', rest);\n}\n","import { SPELLS_BY_TYPE } from '../spells';\nimport { Context } from './../lib/workflow/Context';\n\nconst sustantives = [\n  'serpiente',\n  'caracol',\n  'lobo',\n  'conejo',\n  'ogro',\n  'orco',\n  'buitre',\n  'ciervo',\n  'dragon',\n];\n\nexport async function defend({\n  log,\n  when,\n  write,\n  plugins: { prompt, skills, navigation },\n}: Context) {\n  when('Estas demasiado exhausto para huir del combate!', () =>\n    navigation.recall(),\n  );\n\n  when(/El \\w+ de (?:el|la|un|una) ((?: |\\w)+) te /, async ({ captured }) => {\n    const hp = prompt.getPercent('hp');\n\n    if (hp < 0.1) {\n      await navigation.recall();\n    } else if (prompt.getPercent('mv') < 0.1 || hp < 0.3) {\n      write('huir');\n    } else if (prompt.getPercent('mana') > 0.1) {\n      const fullName = captured[1];\n      const name = sustantives.find(x => fullName.includes(x));\n\n      if (!name) {\n        console.warn(`Unknown sustantive for \"${fullName}\"`);\n      }\n\n      await skills.castSpell(SPELLS_BY_TYPE.attack, name || fullName);\n    } else {\n      log('Nothing');\n    }\n  });\n}\n","import { SpellDescription, SPELLS_BY_TYPE } from './../spells';\nimport { ClientStorage } from '@amatiasq/client-storage';\nimport { getSpells } from '../spells';\nimport { Context } from './../lib/workflow/Context';\nimport { uniq } from '../util/uniq';\n\nconst memory = new ClientStorage<(string | string[])[]>('dope:casting');\n\nexport async function dope({\n  when,\n  write,\n  register,\n  run,\n  plugins: { prompt, skills },\n}: Context) {\n  const shouldHeal = defineShould(0.2);\n  const shouldRefresh = defineShould(0.1, 0.8);\n  const repeatUntilCasted = (name: string | string[]) =>\n    run('cast', [name]).catch(() => null);\n\n  const casting = new Set(memory.get());\n  const spells = getSpells();\n\n  spells.filter(x => x.endEffect).forEach(watchDope);\n\n  prompt.onUpdate(\n    async ({\n      isFighting,\n      mana: { percent: mana },\n      hp: { percent: hp },\n      mv: { percent: mv },\n    }) => {\n      if (isFighting || mana === 0) {\n        return;\n      }\n\n      if (shouldHeal(mana, hp)) {\n        return skills.castSpell(SPELLS_BY_TYPE.heal);\n      }\n\n      if (shouldRefresh(mana, mv)) {\n        return skills.castSpell('refrescar');\n      }\n    },\n  );\n\n  register('dope', async (x: Context) => {\n    const list = spells\n      .filter(x => x.dope)\n      .map(x => (Array.isArray(x.dope) ? x.dope.join('|') : x.name));\n\n    for (const spell of uniq(list)) {\n      await repeatUntilCasted(spell.split('|'));\n    }\n  });\n\n  async function watchDope(spell: SpellDescription) {\n    const invoke = Array.isArray(spell.dope) ? spell.dope : spell.name;\n\n    when(spell.endEffect!, async () => {\n      casting.add(invoke);\n      memory.set([...casting]);\n\n      const success = await repeatUntilCasted(invoke);\n\n      if (success) {\n        casting.delete(invoke);\n        memory.set([...casting]);\n\n        const after = spell.afterDope;\n\n        if (Array.isArray(after)) {\n          after.forEach(x => write(x));\n        } else if (after) {\n          write(after);\n        }\n      }\n    });\n  }\n\n  function defineShould(min: number, max = 1) {\n    const multiplier = 1 / (max - min);\n\n    return (mana: number, stat: number) => {\n      if (mana === 0 || stat > max) return false;\n      if (stat < min) return true;\n\n      const clapped = (stat - min) * multiplier;\n      return Math.hypot(mana, 1 - clapped) > 1;\n    };\n  }\n}\n","export function uniq<T>(list: T[]) {\n  return [...new Set(list)];\n}\n","import { Context } from './../lib/workflow/Context';\n\nexport async function drink({\n  when,\n  write,\n  plugins: { inventory, navigation, skills },\n}: Context) {\n  let isFontAvailable = false;\n  let isBottleFull = false;\n\n  navigation.onRoomChange(() => (isFontAvailable = false));\n\n  when(\n    [\n      'Un manantial magico esta aqui.',\n      'Una hermosa fuente de marmol blanco esta aqui.',\n      'Trazas un circulo delante tuyo del cual emerge un manantial de agua cristalina.',\n    ],\n    async () => {\n      isFontAvailable = true;\n\n      if (!isBottleFull) {\n        const bottle = await getWaterBottle();\n\n        if (bottle) {\n          write(`llenar ${bottle}`);\n          isBottleFull = true;\n        }\n      }\n    },\n  );\n\n  when(\n    [\n      'Te apetece dar un sorbo a algo refrescante.',\n      'Tienes sed.',\n      // 'Estas sediento.',\n      'Estas realmente sediento.',\n      'Estas MUERTO de SED!',\n      'Estas en peligro de deshidratacion.',\n    ],\n    async () => {\n      if (isFontAvailable || (await skills.castSpell('crear manantial'))) {\n        write('beber');\n        return;\n      }\n\n      const bottle = await getWaterBottle();\n\n      if (!bottle) {\n        console.log('No hay fuente de agua');\n        return;\n      }\n\n      write(`beber ${bottle}`);\n      await skills.castSpell('crear agua', bottle);\n    },\n  );\n\n  async function getWaterBottle() {\n    return inventory.has({\n      'un odre de cuero': 'odre',\n      'una cantimplora': 'cantimplora',\n    });\n  }\n}\n","import { Context } from './../lib/workflow/Context';\n\nexport async function eat({\n  when,\n  write,\n  plugins: { inventory, navigation: nav, skills },\n}: Context) {\n  const EXPECTED_FOOD = 1;\n  const DEFAULT_FOOD_NAME = 'chuleta';\n\n  when(['Tienes hambre.', 'Estas realmente hambriento.'], eatSomething);\n\n  when(['Estas terriblemente hambriento.', 'Estas HAMBRIENTO!'], async () => {\n    if (await eatSomething()) {\n      return;\n    }\n\n    await buyFood();\n    await eatSomething();\n  });\n\n  async function eatSomething() {\n    const food = await getFoodFromInventory();\n\n    if (food) {\n      write(`comer ${food}`);\n      inventory.refresh();\n      return true;\n    }\n\n    return await createFood();\n  }\n\n  async function createFood() {\n    if (!(await skills.castSpell('crear comida'))) {\n      return false;\n    }\n\n    write('coger seta');\n\n    try {\n      await when('Coges una seta magica.').timeout(3);\n      write('comer seta');\n      return true;\n    } catch (err) {\n      return false;\n    }\n  }\n\n  async function buyFood() {\n    await nav.recall();\n    await nav.execute('2sen');\n\n    write(`comprar ${EXPECTED_FOOD} ${DEFAULT_FOOD_NAME}`);\n\n    await Promise.any([\n      when('Compras una chuleta de cordero.'),\n      when('El carnicero pone todo en una bolsa y te la da.').then(\n        getFoodFromBag,\n      ),\n    ]);\n\n    await nav.execute('sw2n');\n  }\n\n  async function getFoodFromInventory() {\n    await getFoodFromBag();\n\n    return await inventory.has({\n      'un chorizo': 'chorizo',\n      'pavo cocinado': 'pavo',\n      'una chuleta de cordero': 'chuleta',\n      'loncha de salami': 'salami',\n      'pierna de cordero': 'pierna',\n      'ricas longanizas': 'longanizas',\n    });\n  }\n\n  async function getFoodFromBag() {\n    if (await inventory.has('una bolsa')) {\n      write('coger todo bolsa');\n      write('examinar bolsa');\n\n      const { captured } = await when(/Una bolsa contiene:\\n\\s+(Nada)?/);\n      if (captured[1]) {\n        write('tirar bolsa');\n      }\n    }\n  }\n}\n","import { Context } from './../lib/workflow/Context';\n\nexport async function idle({\n  when,\n  write,\n  run,\n  plugins: { navigation, skills },\n}: Context) {\n  when('Desapareces en la nada.', async () => {\n    console.log('IDLE');\n\n    if (!navigation.isAtRecall) {\n      write('estado');\n      return;\n    }\n\n    await run('train');\n\n    if (skills.has('invisibilidad')) {\n      await run('cast', ['invisibilidad']);\n    }\n  });\n}\n","import { Context } from './../lib/workflow/Context';\n\nexport async function rest({ when, write }: Context) {\n  when(\n    [\n      'Nah... Estas demasiado relajado...',\n      'En tus suenyos o que?',\n      'Estas demasiado relajado para lanzar ese conjuro.',\n    ],\n    () => write('despertar'),\n  );\n}\n","import { Context } from './../lib/workflow/Context';\n\nexport async function afk({ run, plugins: { prompt } }: Context) {\n  await action();\n\n  async function action(): Promise<void> {\n    await prompt.whenFresh();\n\n    console.log('Stats 100%. Start train...');\n\n    try {\n      await run('train');\n      console.log('workflow completed');\n    } catch (error) {\n      console.log('workflow failed');\n    }\n\n    await run('bank');\n    return action();\n  }\n}\n","import { Context } from '../lib/workflow/Context';\n\nexport async function bank(\n  { write, plugins: { navigation } }: Context,\n  take = 2000,\n) {\n  await navigation.execute('r4s2en');\n  write('banco ingresar todo');\n  write(`banco retirar ${take}`);\n  await navigation.execute('s2w4n');\n}\n","import { wait } from '../lib/util/wait';\nimport { Context } from '../lib/workflow/Context';\n\nexport async function cast(\n  { plugins: { prompt, skills } }: Context,\n  name: string | string[],\n) {\n  const result = await repeatUntilCasted(name);\n\n  if (result === false) {\n    throw new Error(`Unable to cast \"${name}\"`);\n  }\n\n  return result;\n\n  async function repeatUntilCasted(\n    spell: string | string[],\n    args = '',\n  ): Promise<boolean> {\n    if (prompt.isFighting) {\n      await prompt.until(x => !x.isFighting);\n    }\n\n    switch (await skills.castSpell(spell, args)) {\n      case skills.CASTED:\n      case skills.ALREADY_APPLIED:\n        return true;\n      case skills.NOT_AVAILABLE:\n        return false;\n      case skills.BUSY:\n        await wait(3);\n      case skills.FAILED:\n        return repeatUntilCasted(spell, args);\n    }\n\n    throw new Error('WTF DUDE');\n  }\n}\n","import { Context } from './../lib/workflow/Context';\n\ntype ItemName = typeof ITEM_NAMES[number];\n\nconst ITEM_NAMES = [\n  'anillo',\n  'anteojos',\n  // 'armadura',\n  'baculo',\n  'baston',\n  'botas',\n  // 'brazaletes',\n  'capa',\n  'casco',\n  'coderas',\n  'colgante',\n  'collar',\n  // 'cota',\n  'daga',\n  'escudo',\n  'espada',\n  'grebas',\n  'guanteletes',\n  'guantes',\n  'hacha',\n  'lanza',\n  'mangas',\n  'manoplas',\n  'martillo',\n  'maza',\n  'mocasines',\n  'pendiente',\n  'perneras',\n  'ropaje',\n  'peto',\n  'pica',\n  'polainas',\n  'pulsera',\n  'somprero',\n  'tobillera',\n  'vara',\n  'varita',\n  'visera',\n  'yelmo',\n] as const;\n\nconst EQUIPMENT: Record<string, ItemName[]> = {\n  weapon: [\n    'baculo',\n    'baston',\n    'vara',\n    'varita',\n    'daga',\n    'pica',\n    'lanza',\n    'espada',\n    'hacha',\n    'martillo',\n    'maza',\n  ],\n  body: ['ropaje' /*'armadura', 'capa', 'cota', 'peto'*/],\n  hands: [\n    // 'brazaletes',\n    'coderas',\n    'guanteletes',\n    'guantes',\n    'mangas',\n    'manoplas',\n    'pulsera',\n  ],\n  feet: ['botas', 'grebas', 'mocasines', 'perneras', 'polainas', 'tobillera'],\n  head: ['anteojos', 'casco', 'somprero', 'visera' /*, 'yelmo'*/],\n  complements: ['anillo', 'colgante', 'collar', 'pendiente'],\n  shield: ['escudo'],\n};\n\nexport async function donations({\n  when,\n  write,\n  plugins: { navigation: nav },\n}: Context) {\n  write('estado');\n  const { captured: levelMatch } = await when(/\\|\\| Nivel\\s+: (\\d+)\\s+/);\n  const level = parseInt(levelMatch[1], 10);\n\n  const rooms = [\n    { from: 31, to: 40, path: '4wn' },\n    { from: 21, to: 30, path: '3wn' },\n    { from: 11, to: 20, path: '2wn' },\n    { from: 1, to: 10, path: 'wn' },\n    { from: 41, to: 50, path: 'en' },\n    { from: 51, to: 60, path: '2en' },\n    { from: 61, to: 70, path: '3en' },\n    { from: 71, to: 80, path: '4en' },\n  ];\n\n  const room = rooms.find(x => x.from <= level && x.to <= level);\n\n  if (!room) {\n    throw new Error(`No room for level \"${level}\"`);\n  }\n\n  await nav.execute('rh2w4n');\n\n  const promise = when(/Salidas: sur\\.\\n\\n((?:.|\\n)*)\\n\\n/, {\n    captureLength: Number.MAX_VALUE,\n  });\n\n  await nav.execute(room.path);\n\n  const { captured: itemsMatch } = await promise;\n  const list = itemsMatch[1].split('\\n').map(x => x.trim());\n\n  for (const items of Object.values(EQUIPMENT)) {\n    for (const item of items) {\n      const found = list.some(x => x.includes(item) && !x.includes('mallas'));\n\n      if (found && (await wear(item))) {\n        break;\n      }\n    }\n  }\n\n  await nav.recall();\n\n  async function wear(item: ItemName) {\n    const LEVEL = false;\n    const MISSING = null;\n    const SUCCESS = true;\n\n    write(`coger ${item}`);\n    await when(/Coges /);\n    write(`vestir ${item}`);\n\n    const result = await Promise.any([\n      when(/Debes ser nivel \\d+ para usar este objeto/).then(() => LEVEL),\n      when(['No hay ningun', 'no puedes llevar tantos objetos']).then(\n        () => MISSING,\n      ),\n      when([\n        'Blandes ',\n        'Sostienes ',\n        'Te pones ',\n        'Te colocas ',\n        'Usas ',\n      ]).then(() => SUCCESS),\n    ]);\n\n    if (result === LEVEL) {\n      write(`tirar ${item}`);\n      await when('Tiras ');\n    }\n\n    return Boolean(result);\n  }\n}\n","import { Context } from './../lib/workflow/Context';\n\nexport function go({ plugins: { navigation } }: Context, path: string) {\n  return navigation.execute(path);\n}\n","import { SPELLS_BY_TYPE } from './../spells';\nimport { Context } from '../lib/workflow/Context';\n\nexport async function kill(\n  { when, write, plugins: { navigation, skills } }: Context,\n  target: string,\n) {\n  const attackSpells = [...SPELLS_BY_TYPE.dedope, ...SPELLS_BY_TYPE.attack];\n  const cast = () => skills.castSpell(attackSpells, target);\n\n  if (!(await tryNTimes(3, cast))) {\n    write(`matar ${target}`);\n  }\n\n  // wile result == null cast attack!!!!\n  const result = await Promise.any([\n    navigation.waitForRecall().then(() => 'flee'),\n    when(`${target} ha MUERTO!!`).then(() => 'win'),\n    when('Huyes como un cobarde del combate.').then(() => 'flee'),\n    when('No esta aqui.')\n      .timeout(3)\n      .then(() => 'missing'),\n  ]);\n\n  if (result === 'win') {\n    write('sacrificar cuerpo');\n    await when('te da una moneda de oro por tu sacrificio.');\n  }\n\n  return result;\n\n  async function tryNTimes(times: number, action: () => Promise<boolean>) {\n    for (let i = 0; i < times; i++) {\n      if (await action()) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n}\n","import { Context } from './../lib/workflow/Context';\n\nexport async function train({\n  when,\n  run: invokeWorkflow,\n  plugins: { navigation: nav, prompt },\n}: Context) {\n  const enemies: string[] = [];\n  let direction = 'sur';\n\n  await nav.recall();\n  await nav.go('abajo');\n\n  const enemySpotted = (prey: string) => () => enemies.push(prey);\n  const enemyGone = (prey: string) => () => {\n    const index = enemies.indexOf(prey);\n    if (index > -1) {\n      enemies.splice(index, 1);\n    }\n  };\n\n  when(\n    [\n      'Un pequenyo caracol esta aqui haciendo trompos.',\n      'El pequenyo caracol llega desde el',\n    ],\n    enemySpotted('pequenyo caracol'),\n  );\n\n  when(\n    ['Un buitre carronyero esta aqui.', 'El buitre carronyero llega desde el'],\n    enemySpotted('buitre carronyero'),\n  );\n\n  when(\n    [\n      'Un lobo hambriento te esta mirando.',\n      'El lobo hambriento llega desde el',\n    ],\n    enemySpotted('lobo hambriento'),\n  );\n\n  when(\n    [\n      'Una serpiente que parece venenosa te mira fijamente.',\n      'La serpiente llega desde el',\n    ],\n    enemySpotted('serpiente'),\n  );\n\n  when('El pequenyo caracol se va hacia el', enemyGone('pequenyo caracol'));\n  when('El buitre carronyero se va hacia el', enemyGone('buitre carronyero'));\n  when('El lobo hambriento se va hacia el', enemyGone('lobo hambriento'));\n  when('La serpiente se va hacia el', enemyGone('serpiente'));\n\n  await nav.execute('xsexnexsexnexs', checkRoom);\n  return nav.execute('4w5nu');\n\n  async function checkRoom() {\n    await prompt.until(({ mv: { current: mv } }) => mv > 50);\n\n    while (enemies.length) {\n      const result = await invokeWorkflow('kill', [enemies.pop()!]);\n\n      if (result === 'flee') {\n        console.log('Had to run. Train over.');\n        return nav.recall();\n      }\n    }\n  }\n}\n","import { ClientStorage } from '@amatiasq/client-storage';\nimport './index.css';\n\nimport { Controls } from './Controls/Controls';\nimport { Hamburger } from './Hamburger/Hamburger';\nimport html from './index.html';\nimport { render } from './render';\nimport { Sidebar } from './Sidebar/Sidebar';\nimport { Terminal } from './Terminal/Terminal';\n\nexport function renderUserInterface(parent: HTMLElement) {\n  const state = initState();\n  const data = state.get()!;\n\n  const dom = render(html);\n  const main = dom.$('.container');\n\n  const sidebar = new Sidebar();\n  sidebar.render(main);\n\n  const controls = new Controls();\n  controls.render(main);\n\n  const terminal = new Terminal();\n  terminal.render(main);\n\n  parent.appendChild(dom);\n\n  const hamburger = new Hamburger(data.showControls);\n  hamburger.render(parent);\n\n  hamburger.onChange(x => {\n    if (x) {\n      main.classList.add('show-controls');\n      data.showControls = true;\n    } else {\n      main.classList.remove('show-controls');\n      data.showControls = false;\n    }\n\n    state.set(data);\n  });\n\n  return { controls, sidebar, terminal };\n}\n\nfunction initState() {\n  const state = new ClientStorage<{ showControls: boolean }>('ui:state');\n  const data = state.get();\n\n  if (!data) {\n    state.set({ showControls: false });\n  }\n\n  return state;\n}\n","import api from \"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n            import content from \"!!../../node_modules/css-loader/dist/cjs.js!./index.css\";\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nexport default content.locals || {};","import './Controls.css';\n\nimport { render } from '../render';\nimport html from './Controls.html';\n\ntype Observable = (listener: (data: number) => void) => void;\n\nexport class Controls {\n  private readonly dom = render(html);\n  private readonly meterTpl = this.dom.$('.meter-template')!;\n  private readonly buttonTpl = this.dom.$('.button-template')!;\n\n  render(parent: HTMLElement) {\n    parent.appendChild(this.dom);\n  }\n\n  addMeter(color: string, observable: Observable) {\n    const fragment = render(this.meterTpl, {\n      '.meter': x => {\n        x.style.setProperty('--color', color);\n        x.style.setProperty('--value', '100%');\n\n        observable(value => {\n          const percent = Math.round(value * 100);\n          x.style.setProperty('--value', `${percent}%`);\n        });\n      },\n    });\n\n    this.dom.appendChild(fragment);\n  }\n\n  addButton(name: string, onClick: () => void) {\n    const fragment = render(this.buttonTpl, {\n      button: x => {\n        x.textContent = name;\n        x.addEventListener('click', onClick);\n      },\n    });\n\n    this.dom.appendChild(fragment);\n  }\n}\n","import api from \"!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n            import content from \"!!../../../node_modules/css-loader/dist/cjs.js!./Controls.css\";\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nexport default content.locals || {};","// Module\nvar code = \"<header class=\\\"controls\\\"></header> <template class=\\\"meter-template\\\"> <div class=\\\"meter\\\" data-color=\\\"white\\\" data-value=\\\"100%\\\"> <div class=\\\"bar\\\"></div> </div> </template> <template class=\\\"button-template\\\"> <button class=\\\"ui-button\\\"></button> </template> \";\n// Exports\nmodule.exports = code;","import './Hamburger.css';\n\nimport { emitter } from '@amatiasq/emitter';\n\nimport { render } from '../render';\nimport html from './Hamburger.html';\n\nexport class Hamburger {\n  private readonly dom = render(html);\n  private readonly checkbox = this.dom.$<HTMLInputElement>('input');\n\n  private readonly emitChange = emitter<boolean>();\n  readonly onChange = this.emitChange.subscribe;\n\n  constructor(initialState = false) {\n    this.toggle = this.toggle.bind(this);\n    this.checkbox.checked = initialState;\n  }\n\n  render(parent: HTMLElement) {\n    this.checkbox.addEventListener('change', this.toggle);\n\n    parent.appendChild(this.dom);\n\n    if (this.checkbox.checked) {\n      this.toggle();\n    }\n  }\n\n  toggle() {\n    this.emitChange(this.checkbox.checked);\n  }\n}\n","import api from \"!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n            import content from \"!!../../../node_modules/css-loader/dist/cjs.js!./Hamburger.css\";\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nexport default content.locals || {};","// Module\nvar code = \"<div class=\\\"hamburger\\\"> <input type=\\\"checkbox\\\"/> <span></span> <span></span> <span></span> </div> \";\n// Exports\nmodule.exports = code;","// Module\nvar code = \"<div class=\\\"container\\\"></div> \";\n// Exports\nmodule.exports = code;","import './Sidebar.css';\n\nimport { render } from '../render';\nimport html from './Sidebar.html';\n\nexport class Sidebar {\n  private readonly dom = render(html);\n\n  render(parent: HTMLElement) {\n    parent.appendChild(this.dom);\n  }\n}\n","import api from \"!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n            import content from \"!!../../../node_modules/css-loader/dist/cjs.js!./Sidebar.css\";\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nexport default content.locals || {};","// Module\nvar code = \"<aside class=\\\"sidebar\\\"></aside> \";\n// Exports\nmodule.exports = code;","import { ClientStorage } from '@amatiasq/client-storage';\nimport './Terminal.css';\n\nimport Convert from 'ansi-to-html';\n\nimport { emitter } from '@amatiasq/emitter';\n\nimport { render } from '../render';\nimport html from './Terminal.html';\n\nconst convert = new Convert();\nconst history = new ClientStorage<string[]>('mud:command-history');\n\nexport class Terminal {\n  private readonly dom = render(html);\n  private readonly $log = this.dom.$('.log');\n  private readonly $input = this.dom.$<HTMLInputElement>('input');\n  private readonly log: string[] = [];\n  private readonly history: string[] = history.get() || [];\n  private histPos = 0;\n\n  private readonly emitSubmit = emitter<string>();\n  readonly onSubmit = this.emitSubmit.subscribe;\n\n  constructor() {\n    this.onKey = this.onKey.bind(this);\n  }\n\n  focus() {\n    this.$input.focus();\n  }\n\n  render(parent: HTMLElement) {\n    this.dom.$('.terminal').addEventListener('click', () => {\n      if (!userHasSelectedText()) {\n        this.$input.focus();\n      }\n    });\n\n    this.$input.addEventListener('keydown', this.onKey);\n    parent.appendChild(this.dom);\n  }\n\n  write(data: string) {\n    const $parent = this.$log.parentElement!;\n    const prev = this.log.length ? this.log.pop() : '';\n    const content = `${prev}${fixLineEndings(data)}`.split(/\\n\\n+/);\n    const last = content.pop()!;\n\n    for (const block of content) {\n      this.log.push(block);\n\n      const p = document.createElement('p');\n      p.innerHTML = asciiToHtml(block);\n      $parent.insertBefore(p, this.$log);\n    }\n\n    this.log.push(last);\n    this.$log.innerHTML = asciiToHtml(last);\n\n    if (!userHasSelectedText()) {\n      $parent.scrollTop = $parent.scrollHeight;\n    }\n  }\n\n  private onKey(event: KeyboardEvent) {\n    if (event.code === 'Enter') {\n      this.submit();\n    }\n\n    if (event.code === 'ArrowUp') {\n      this.loadHistory(1);\n    }\n\n    if (event.code === 'ArrowDown') {\n      this.loadHistory(-1);\n    }\n\n    this.$input.size = this.$input.value.length + 1;\n  }\n\n  private submit() {\n    const { value } = this.$input;\n    this.$input.value = '';\n\n    if (value) {\n      this.history.shift();\n      this.history.unshift(value);\n      this.history.unshift('');\n      history.set(this.history);\n    }\n\n    this.histPos = 0;\n\n    this.emitSubmit(value);\n  }\n\n  private loadHistory(modifier: 1 | -1) {\n    if (!this.history.length) {\n      return;\n    }\n\n    this.history[this.histPos] = this.$input.value;\n    this.histPos = clamp(this.histPos + modifier, 0, this.history.length - 1);\n    this.$input.value = this.history[this.histPos];\n  }\n}\n\nfunction asciiToHtml(text: string) {\n  const escaped = escapeHtml(text);\n  const html = convert.toHtml(escaped);\n  return html.replace(/\\n/g, '<br>');\n}\n\nfunction fixLineEndings(text: string) {\n  return text.replace(/\\r/g, '');\n}\n\nfunction escapeHtml(unsafe: string) {\n  return unsafe\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#039;')\n    .replace(/  +/g, x => '&nbsp;'.repeat(x.length));\n}\n\nfunction userHasSelectedText() {\n  const selection = getSelection();\n  return selection && selection.type === 'Range';\n}\n\nfunction clamp(value: number, min: number, max: number) {\n  return value < min ? min : value > max ? max : value;\n}\n","import api from \"!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n            import content from \"!!../../../node_modules/css-loader/dist/cjs.js!./Terminal.css\";\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nexport default content.locals || {};","// Module\nvar code = \"<main class=\\\"terminal\\\"> <span class=\\\"log\\\"></span> <input type=\\\"text\\\" size=\\\"1\\\" autofocus> </main>\";\n// Exports\nmodule.exports = code;","import { ClientStorage } from '@amatiasq/client-storage';\n\nexport function getPassword(user: string) {\n  const storage = new ClientStorage<string>(`pass:${user}`);\n  const stored = storage.get();\n\n  if (stored) {\n    return stored;\n  }\n\n  const input = prompt(`Password for ${user}`);\n\n  if (!input) {\n    throw new Error(`Password required`);\n  }\n\n  storage.set(input);\n  return input;\n}\n","export function getQueryParams() {\n  const result: { [key: string]: string } = {};\n\n  window.location.search\n    .substr(1)\n    .split('&')\n    .map(entry => entry.split('=').map(decodeURIComponent))\n    .forEach(([key, value]) => (result[key] = value));\n\n  return result;\n}\n"],"sourceRoot":""}
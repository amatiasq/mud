{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/ui/render.ts","webpack:///./src/ui/index.css","webpack:///./src/ui/Controls/Controls.css","webpack:///./src/ui/Hamburger/Hamburger.css","webpack:///./src/ui/Sidebar/Sidebar.css","webpack:///./src/ui/Terminal/Terminal.css","webpack:///./src/lib/triggers/PatternPromise.ts","webpack:///./src/lib/util/wait.ts","webpack:///./src/plugins/promptPlugin.ts","webpack:///./src/lib/PluginContext.ts","webpack:///./src/lib/ExecutionAbortedError.ts","webpack:///./src/lib/util/bindAll.ts","webpack:///./src/index.ts","webpack:///./src/lib/Mud.ts","webpack:///./src/plugins/index.ts","webpack:///./src/plugins/chatPlugin.ts","webpack:///./src/lib/util/requestNotificationPermission.ts","webpack:///./src/plugins/inventoryPlugin.ts","webpack:///./src/plugins/navigationPlugin.ts","webpack:///./src/lib/triggers/PatternPromiseTimeoutError.ts","webpack:///./src/plugins/skillsPlugin.ts","webpack:///./src/lib/util/concatRegexes.ts","webpack:///./src/plugins/login.ts","webpack:///./src/lib/triggers/TriggerCollection.ts","webpack:///./src/lib/triggers/PatternMatcher.ts","webpack:///./src/lib/util/trimEnd.ts","webpack:///./src/lib/triggers/PatternResult.ts","webpack:///./src/lib/workflow/Context.ts","webpack:///./src/lib/workflow/MissingPluginError.ts","webpack:///./src/lib/workflow/Workflow.ts","webpack:///./src/lib/workflow/WorkflowNotFoundError.ts","webpack:///./src/lib/RemoteTelnet.ts","webpack:///./src/registerWorkflows.ts","webpack:///./src/workflows/dope.ts","webpack:///./src/workflows/drink.ts","webpack:///./src/workflows/eat.ts","webpack:///./src/workflows/fight.ts","webpack:///./src/workflows/idle.ts","webpack:///./src/workflows/rest.ts","webpack:///./src/workflows/train.ts","webpack:///./src/socket.ts","webpack:///./src/ui/index.ts","webpack:///./src/ui/index.css?3ef0","webpack:///./src/ui/Controls/Controls.ts","webpack:///./src/ui/Controls/Controls.css?eebb","webpack:///./src/ui/Controls/Controls.html","webpack:///./src/ui/Hamburger/Hamburger.ts","webpack:///./src/ui/Hamburger/Hamburger.css?b2d9","webpack:///./src/ui/Hamburger/Hamburger.html","webpack:///./src/ui/index.html","webpack:///./src/ui/Sidebar/Sidebar.ts","webpack:///./src/ui/Sidebar/Sidebar.css?e0a4","webpack:///./src/ui/Sidebar/Sidebar.html","webpack:///./src/ui/Terminal/Terminal.ts","webpack:///./src/ui/Terminal/Terminal.css?82ae","webpack:///./src/ui/Terminal/Terminal.html","webpack:///./src/util/getPassword.ts","webpack:///./src/util/getQueryParams.ts"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","0","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","clone","el","cloneNode","template","config","html","document","createElement","innerHTML","renderHtml","instance","HTMLTemplateElement","content","selector","operator","entries","querySelector","console","error","assign","$","___CSS_LOADER_EXPORT___","Promise","executor","_reject","super","resolve","reject","this","forceReject","seconds","wait","then","PatternPromiseTimeoutError","race","setTimeout","PROMPT","join","FPROMPT","replace","PROMPT_DETECTOR","RegExp","Stat","total","current","toInt","parseInt","async","when","write","isInvisible","stats","hp","mana","mv","exp","gold","enemy","update","emitter","timeout","catch","finally","groups","g","hpCurr","hpTotal","mCurr","mTotal","mvCurr","mvTotal","Boolean","invis","waitForPrompt","getPercent","stat","percent","onUpdate","subscribe","PluginContext","username","triggers","send","subscriptions","isPrintingLogs","isAborted","bindAll","command","checkNotAborted","log","pattern","handler","options","add","forEach","x","unsubscribe","args","ExecutionAbortedError","Error","target","source","proto","getOwnPropertyNames","filter","getOwnPropertyDescriptor","method","user","server","getQueryParams","host","port","split","pass","getPassword","terminal","controls","renderUserInterface","body","telnet","RemoteTelnet","socket","onConnected","mud","Mud","onCommand","onSubmit","userInput","login","registerWorkflows","addMeter","getPlugin","connectStats","addButton","invokeWorkflow","onData","connect","onbeforeunload","isConnected","close","TriggerCollection","workflows","emitCommand","whenLoggedIn","emitLoggedIn","process","text","removeAsciiCodes","context","plugins","initializePlugins","dispose","run","params","workflow","Workflow","executeWorkflow","WorkflowNotFoundError","logs","createWorkflowContext","printLogs","promise","execute","abort","Context","chat","chatPlugin","inventory","inventoryPlugin","navigation","navigationPlugin","prompt","promptPlugin","skills","skillsPlugin","promises","map","plugin","all","fromEntries","receive","message","addMessage","from","notify","sent","to","requestNotificationPermission","Notification","partial","time","Date","now","other","history","set","tell","ClientStorage","whisper","permission","requestPermission","warn","INVENTORY_DETECTOR","isInitialized","items","refresh","captured","_","trim","captureLength","has","search","find","Array","isArray","includes","found","aliases","e","w","u","k","h","isNavigating","landingAtRecall","isAtRecall","directions","roomChanged","canGo","direction","go","recall","substr","step","path","times","dir","repeat","waitForRecall","PatternPromise","onRoomChange","isClosed","startsWith","SKILL","SKILLS_DETECTOR","concatRegexes","skill","matchAll","ensureInitiated","canLearn","regexes","toString","flags","uniq","Set","password","initialize","await","once","patterns","queue","isProcessing","arguments","watch","entry","PatternMatcher","delete","original","sub","splitted","last","pop","lines","line","Math","max","String","buffer","clear","trimEnd","matching","testPattern","PatternResult","output","indexOf","test","maxLength","isRegex","merge","a","b","haystack","match","reduce","runWorkflow","finish","Proxy","MissingPluginError","executionCount","currentExecutions","iteration","_isConnected","emitConnected","emitClose","onClose","emitData","onMessageType","registerWorkflow","fight","train","dope","drink","eat","idle","rest","runForever","shouldHeal","min","inverse","hypot","defineShould","isFighting","isFontAvailable","isBottleFull","getWaterBottle","bottle","nav","eatSomething","food","getFoodFromBag","getFood","buyFood","isInDanger","isExhausted","needsHospital","any","enemies","enemySpotted","prey","enemyGone","index","nextRoom","serverUri","location","origin","DEFAULT_PORT","ClientSocket","onMessage","debug","parent","state","showControls","initState","dom","render","main","sidebar","Sidebar","Controls","Terminal","appendChild","hamburger","Hamburger","onChange","classList","remove","locals","meterTpl","buttonTpl","color","observable","fragment","style","setProperty","round","onClick","button","textContent","addEventListener","initialState","checkbox","emitChange","toggle","checked","convert","asciiToHtml","escaped","toHtml","userHasSelectedText","selection","getSelection","type","$log","$input","histPos","emitSubmit","onKey","focus","$parent","parentElement","block","insertBefore","scrollTop","scrollHeight","event","code","submit","loadHistory","size","unshift","modifier","storage","stored","input","decodeURIComponent"],"mappings":"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","file":"main.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t0: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([20,1]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","export function render(\n  template: string | HTMLElement,\n  config?: Record<string, (el: HTMLElement) => void>,\n) {\n  if (typeof template === 'string') {\n    template = renderHtml(template);\n  }\n\n  const instance =\n    template instanceof HTMLTemplateElement\n      ? clone(template.content)\n      : clone(template);\n\n  if (config) {\n    for (const [selector, operator] of Object.entries(config)) {\n      const el = instance.querySelector(selector) as HTMLElement;\n\n      if (el) {\n        operator(el);\n      } else {\n        console.error(`Selector ${selector} returned no results`);\n      }\n    }\n  }\n\n  return Object.assign(instance, {\n    $: <T extends HTMLElement>(selector: string) =>\n      instance.querySelector(selector) as T,\n  });\n}\n\nfunction renderHtml(html: string) {\n  const template = document.createElement('template');\n  template.innerHTML = html;\n  return template;\n}\n\nfunction clone<T extends Node>(el: T) {\n  return el.cloneNode(true) as T;\n}\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/cssWithMappingToString.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"body {\\n  --background-color: #1c1c1c;\\n  --border-color: #484848;\\n}\\n\\n.container {\\n  height: 100%;\\n  display: grid;\\n  grid-template-rows: 1fr;\\n  grid-template-columns: 1fr;\\n  grid-template-areas: 'terminal';\\n}\\n\\n.container.show-controls {\\n  grid-template-rows: 50px auto;\\n  grid-template-columns: 9fr 3fr;\\n  grid-template-areas:\\n    'controls sidebar'\\n    'terminal sidebar';\\n}\\n\\n.terminal {\\n  grid-area: terminal;\\n}\\n\\n.sidebar {\\n  grid-area: sidebar;\\n  background-color: var(--background-color);\\n  border-left: 1px solid var(--border-color);\\n}\\n\\n.controls {\\n  grid-area: controls;\\n  background-color: var(--background-color);\\n  border-bottom: 1px solid var(--border-color);\\n}\\n\\n.container:not(.show-controls) .sidebar,\\n.container:not(.show-controls) .controls {\\n  display: none;\\n}\\n\", \"\",{\"version\":3,\"sources\":[\"webpack://src/ui/index.css\"],\"names\":[],\"mappings\":\"AAAA;EACE,2BAA2B;EAC3B,uBAAuB;AACzB;;AAEA;EACE,YAAY;EACZ,aAAa;EACb,uBAAuB;EACvB,0BAA0B;EAC1B,+BAA+B;AACjC;;AAEA;EACE,6BAA6B;EAC7B,8BAA8B;EAC9B;;sBAEoB;AACtB;;AAEA;EACE,mBAAmB;AACrB;;AAEA;EACE,kBAAkB;EAClB,yCAAyC;EACzC,0CAA0C;AAC5C;;AAEA;EACE,mBAAmB;EACnB,yCAAyC;EACzC,4CAA4C;AAC9C;;AAEA;;EAEE,aAAa;AACf\",\"sourcesContent\":[\"body {\\n  --background-color: #1c1c1c;\\n  --border-color: #484848;\\n}\\n\\n.container {\\n  height: 100%;\\n  display: grid;\\n  grid-template-rows: 1fr;\\n  grid-template-columns: 1fr;\\n  grid-template-areas: 'terminal';\\n}\\n\\n.container.show-controls {\\n  grid-template-rows: 50px auto;\\n  grid-template-columns: 9fr 3fr;\\n  grid-template-areas:\\n    'controls sidebar'\\n    'terminal sidebar';\\n}\\n\\n.terminal {\\n  grid-area: terminal;\\n}\\n\\n.sidebar {\\n  grid-area: sidebar;\\n  background-color: var(--background-color);\\n  border-left: 1px solid var(--border-color);\\n}\\n\\n.controls {\\n  grid-area: controls;\\n  background-color: var(--background-color);\\n  border-bottom: 1px solid var(--border-color);\\n}\\n\\n.container:not(.show-controls) .sidebar,\\n.container:not(.show-controls) .controls {\\n  display: none;\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/cssWithMappingToString.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".controls {\\n  display: flex;\\n  align-items: stretch;\\n}\\n\\n.controls .meter {\\n  width: 100px;\\n  margin: 8px;\\n  margin-right: 0;\\n  border: 1px solid var(--border-color);\\n  --color: white;\\n  --value: 100%;\\n}\\n\\n.controls .meter .bar {\\n  height: 100%;\\n  width: var(--value);\\n  background-color: var(--color);\\n}\\n\", \"\",{\"version\":3,\"sources\":[\"webpack://src/ui/Controls/Controls.css\"],\"names\":[],\"mappings\":\"AAAA;EACE,aAAa;EACb,oBAAoB;AACtB;;AAEA;EACE,YAAY;EACZ,WAAW;EACX,eAAe;EACf,qCAAqC;EACrC,cAAc;EACd,aAAa;AACf;;AAEA;EACE,YAAY;EACZ,mBAAmB;EACnB,8BAA8B;AAChC\",\"sourcesContent\":[\".controls {\\n  display: flex;\\n  align-items: stretch;\\n}\\n\\n.controls .meter {\\n  width: 100px;\\n  margin: 8px;\\n  margin-right: 0;\\n  border: 1px solid var(--border-color);\\n  --color: white;\\n  --value: 100%;\\n}\\n\\n.controls .meter .bar {\\n  height: 100%;\\n  width: var(--value);\\n  background-color: var(--color);\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/cssWithMappingToString.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".hamburger {\\n  display: inline-block;\\n  position: absolute;\\n  top: 24px;\\n  right: 40px;\\n  z-index: 1;\\n  -webkit-user-select: none;\\n  user-select: none;\\n}\\n\\n.hamburger input {\\n  display: block;\\n  width: 40px;\\n  height: 32px;\\n  position: absolute;\\n  top: -7px;\\n  left: -5px;\\n  cursor: pointer;\\n  opacity: 0; /* hide this */\\n  z-index: 2; /* and place it over the hamburger */\\n  -webkit-touch-callout: none;\\n}\\n\\n.hamburger span {\\n  display: block;\\n  width: 33px;\\n  height: 4px;\\n  margin-bottom: 5px;\\n  position: relative;\\n  background: #cdcdcd;\\n  border-radius: 3px;\\n  z-index: 1;\\n  transform-origin: center right;\\n  transition: transform 0.5s cubic-bezier(0.77, 0.2, 0.05, 1),\\n    background 0.5s cubic-bezier(0.77, 0.2, 0.05, 1), opacity 0.55s ease;\\n}\\n\\n/*\\n * Transform all the slices of hamburger\\n * into a crossmark.\\n */\\n.hamburger input:checked ~ span:nth-of-type(2) {\\n  opacity: 0;\\n  transform: rotate(0deg) scale(0.2, 0.2);\\n}\\n\\n.hamburger input:checked ~ span:first-of-type {\\n  transform: rotate(-45deg) translate(0, -4px);\\n}\\n\\n.hamburger input:checked ~ span:last-of-type {\\n  transform: rotate(45deg) translate(0, 4px);\\n}\\n\", \"\",{\"version\":3,\"sources\":[\"webpack://src/ui/Hamburger/Hamburger.css\"],\"names\":[],\"mappings\":\"AAAA;EACE,qBAAqB;EACrB,kBAAkB;EAClB,SAAS;EACT,WAAW;EACX,UAAU;EACV,yBAAyB;EACzB,iBAAiB;AACnB;;AAEA;EACE,cAAc;EACd,WAAW;EACX,YAAY;EACZ,kBAAkB;EAClB,SAAS;EACT,UAAU;EACV,eAAe;EACf,UAAU,EAAE,cAAc;EAC1B,UAAU,EAAE,oCAAoC;EAChD,2BAA2B;AAC7B;;AAEA;EACE,cAAc;EACd,WAAW;EACX,WAAW;EACX,kBAAkB;EAClB,kBAAkB;EAClB,mBAAmB;EACnB,kBAAkB;EAClB,UAAU;EACV,8BAA8B;EAC9B;wEACsE;AACxE;;AAEA;;;EAGE;AACF;EACE,UAAU;EACV,uCAAuC;AACzC;;AAEA;EACE,4CAA4C;AAC9C;;AAEA;EACE,0CAA0C;AAC5C\",\"sourcesContent\":[\".hamburger {\\n  display: inline-block;\\n  position: absolute;\\n  top: 24px;\\n  right: 40px;\\n  z-index: 1;\\n  -webkit-user-select: none;\\n  user-select: none;\\n}\\n\\n.hamburger input {\\n  display: block;\\n  width: 40px;\\n  height: 32px;\\n  position: absolute;\\n  top: -7px;\\n  left: -5px;\\n  cursor: pointer;\\n  opacity: 0; /* hide this */\\n  z-index: 2; /* and place it over the hamburger */\\n  -webkit-touch-callout: none;\\n}\\n\\n.hamburger span {\\n  display: block;\\n  width: 33px;\\n  height: 4px;\\n  margin-bottom: 5px;\\n  position: relative;\\n  background: #cdcdcd;\\n  border-radius: 3px;\\n  z-index: 1;\\n  transform-origin: center right;\\n  transition: transform 0.5s cubic-bezier(0.77, 0.2, 0.05, 1),\\n    background 0.5s cubic-bezier(0.77, 0.2, 0.05, 1), opacity 0.55s ease;\\n}\\n\\n/*\\n * Transform all the slices of hamburger\\n * into a crossmark.\\n */\\n.hamburger input:checked ~ span:nth-of-type(2) {\\n  opacity: 0;\\n  transform: rotate(0deg) scale(0.2, 0.2);\\n}\\n\\n.hamburger input:checked ~ span:first-of-type {\\n  transform: rotate(-45deg) translate(0, -4px);\\n}\\n\\n.hamburger input:checked ~ span:last-of-type {\\n  transform: rotate(45deg) translate(0, 4px);\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/cssWithMappingToString.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".sidebar {\\n}\\n\", \"\",{\"version\":3,\"sources\":[\"webpack://src/ui/Sidebar/Sidebar.css\"],\"names\":[],\"mappings\":\"AAAA;AACA\",\"sourcesContent\":[\".sidebar {\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/cssWithMappingToString.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".terminal {\\n  grid-area: terminal;\\n  overflow-x: hidden;\\n  overflow-y: auto;\\n  -ms-overflow-style: none; /* IE and Edge */\\n  scrollbar-width: none; /* Firefox */\\n}\\n\\n.terminal::-webkit-scrollbar {\\n  display: none;\\n}\\n\\n.terminal p {\\n  margin: 1em 0;\\n}\\n\\n.terminal input {\\n  background-color: transparent;\\n  border: none;\\n  color: white;\\n  display: inline-block;\\n  font-family: monospace;\\n  outline: none;\\n}\\n\", \"\",{\"version\":3,\"sources\":[\"webpack://src/ui/Terminal/Terminal.css\"],\"names\":[],\"mappings\":\"AAAA;EACE,mBAAmB;EACnB,kBAAkB;EAClB,gBAAgB;EAChB,wBAAwB,EAAE,gBAAgB;EAC1C,qBAAqB,EAAE,YAAY;AACrC;;AAEA;EACE,aAAa;AACf;;AAEA;EACE,aAAa;AACf;;AAEA;EACE,6BAA6B;EAC7B,YAAY;EACZ,YAAY;EACZ,qBAAqB;EACrB,sBAAsB;EACtB,aAAa;AACf\",\"sourcesContent\":[\".terminal {\\n  grid-area: terminal;\\n  overflow-x: hidden;\\n  overflow-y: auto;\\n  -ms-overflow-style: none; /* IE and Edge */\\n  scrollbar-width: none; /* Firefox */\\n}\\n\\n.terminal::-webkit-scrollbar {\\n  display: none;\\n}\\n\\n.terminal p {\\n  margin: 1em 0;\\n}\\n\\n.terminal input {\\n  background-color: transparent;\\n  border: none;\\n  color: white;\\n  display: inline-block;\\n  font-family: monospace;\\n  outline: none;\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","import { wait } from '../util/wait';\nimport { PatternMatchSubscription } from './PatternMatchSubscription';\nimport { PatternPromiseTimeoutError } from './PatternPromiseTimeoutError';\nimport { PatternResult } from './PatternResult';\n\nexport class PatternPromise\n  extends Promise<PatternResult>\n  implements PatternMatchSubscription {\n  private forceReject!: (reason?: any) => void;\n\n  constructor(\n    executor: (\n      resolve: (value?: PatternResult | PromiseLike<PatternResult>) => void,\n      reject: (reason?: any) => void,\n    ) => void,\n  ) {\n    let _reject!: (reason?: any) => void;\n\n    super((resolve, reject) => {\n      _reject = reject;\n      executor(resolve, reject);\n    });\n\n    this.forceReject = _reject;\n  }\n\n  timeout(seconds: number) {\n    wait(seconds).then(() =>\n      this.forceReject(new PatternPromiseTimeoutError()),\n    );\n\n    return this as Promise<PatternResult>;\n  }\n\n  wait(seconds: number) {\n    return Promise.race([this, wait(seconds)]);\n  }\n\n  unsubscribe(): void {\n    this.forceReject('aborted');\n  }\n\n  once() {\n    return this;\n  }\n}\n","export function wait(seconds: number) {\n  return new Promise<void>(resolve => setTimeout(resolve, seconds * 1000));\n}\n","import { emitter } from '@amatiasq/emitter';\n\nimport { PluginContext } from '../lib/PluginContext';\n\nconst PROMPT = [\n  '&W<',\n  '&R%h/%Hhp ',\n  '&C%m/%Mm ',\n  '&G%v/%Vmv ',\n  '&P%Xxp ',\n  '&Y%gg',\n  '&W> ',\n  '&W%A ',\n  '\\n',\n].join('');\n\nconst FPROMPT = PROMPT.replace('&W>', ' &R%E&W>');\n\nexport const PROMPT_DETECTOR = new RegExp(\n  [\n    '<',\n    '(?<hpCurr>\\\\d+)/(?<hpTotal>\\\\d+)hp ',\n    '(?<mCurr>\\\\d+)/(?<mTotal>\\\\d+)m ',\n    '(?<mvCurr>\\\\d+)/(?<mvTotal>\\\\d+)mv ',\n    '(?<exp>(\\\\d|,)+)xp ',\n    '(?<gold>(\\\\d|,)+)g',\n    '( \\\\((?<enemy>\\\\d+)%\\\\))?',\n    '> (?<invis>I)?',\n  ].join(''),\n);\n\nclass Stat {\n  total = 0;\n  current = 0;\n\n  get percent() {\n    return this.total ? (1 / this.total) * this.current : 0;\n  }\n}\n\nexport async function promptPlugin({ when, write }: PluginContext) {\n  let isInvisible = false;\n\n  const stats = {\n    hp: new Stat(),\n    mana: new Stat(),\n    mv: new Stat(),\n    exp: 0,\n    gold: 0,\n    enemy: null as number | null,\n\n    get isFighting() {\n      return stats.enemy !== null;\n    },\n  };\n\n  const update = emitter<typeof stats>();\n\n  when(PROMPT_DETECTOR)\n    .timeout(1)\n    .catch(setPrompt)\n    .finally(() => {\n      when(PROMPT_DETECTOR, ({ groups: g }) => {\n        stats.hp.current = toInt(g.hpCurr);\n        stats.hp.total = toInt(g.hpTotal);\n        stats.mana.current = toInt(g.mCurr);\n        stats.mana.total = toInt(g.mTotal);\n        stats.mv.current = toInt(g.mvCurr);\n        stats.mv.total = toInt(g.mvTotal);\n        stats.exp = toInt(g.exp);\n        stats.gold = toInt(g.gold);\n        stats.enemy = g.enemy ? toInt(g.enemy) : null;\n        isInvisible = Boolean(g.invis);\n        update(stats);\n      });\n    });\n\n  return {\n    waitForPrompt,\n    getPercent,\n    onUpdate: update.subscribe,\n\n    get isExhausted() {\n      return stats.mv.current <= 15;\n    },\n\n    get isInjured() {\n      return stats.hp.percent !== 1;\n    },\n\n    get needsHospital() {\n      return stats.hp.percent < 0.3;\n    },\n\n    get isInDanger() {\n      return stats.hp.percent < 0.1;\n    },\n\n    get isInvisible() {\n      return isInvisible;\n    },\n  };\n\n  function setPrompt() {\n    write(`prompt ${PROMPT}`);\n    write(`fprompt ${FPROMPT}`);\n  }\n\n  function waitForPrompt() {\n    return when(PROMPT_DETECTOR);\n  }\n\n  function getPercent(stat: 'hp' | 'mana' | 'mv') {\n    return stats[stat].percent;\n  }\n}\n\nfunction toInt(value: string) {\n  return parseInt(value.replace(/,/g, ''), 10);\n}\n","import { ExecutionAbortedError } from './ExecutionAbortedError';\nimport { Pattern } from './triggers/Pattern';\nimport { PatternMatchSubscription } from './triggers/PatternMatchSubscription';\nimport { PatternOptions } from './triggers/PatternOptions';\nimport { PatternPromise } from './triggers/PatternPromise';\nimport { PatternResult } from './triggers/PatternResult';\nimport { TriggerCollection } from './triggers/TriggerCollection';\nimport { bindAll } from './util/bindAll';\nimport { wait } from './util/wait';\n\nexport class PluginContext {\n  protected readonly subscriptions: PatternMatchSubscription[] = [];\n  protected isPrintingLogs = false;\n  private isAborted = false;\n\n  get printLogs() {\n    this.isPrintingLogs = true;\n    return null;\n  }\n\n  constructor(\n    readonly name: string,\n    readonly username: string,\n    protected readonly triggers: TriggerCollection,\n    protected readonly send: (command: string) => void,\n  ) {\n    bindAll(this, PluginContext);\n  }\n\n  write(command: string) {\n    this.checkNotAborted();\n    this.log(`[WRITE]`, command);\n    this.send(command);\n  }\n\n  when(pattern: Pattern, options?: PatternOptions): PatternPromise;\n  when(\n    pattern: Pattern,\n    handler: (result: PatternResult) => void,\n    options?: PatternOptions,\n  ): PatternMatchSubscription;\n  when(\n    pattern: Pattern,\n    handler?: ((result: PatternResult) => void) | PatternOptions,\n    options?: PatternOptions,\n  ) {\n    this.checkNotAborted();\n    this.log('[WATCH]', pattern);\n\n    if (typeof handler === 'function') {\n      return this.triggers.add(pattern, handler, options);\n    } else {\n      return this.triggers.add(pattern, handler);\n    }\n  }\n\n  sleep(seconds: number) {\n    this.checkNotAborted();\n    this.log('[SLEEP]', seconds);\n    return wait(seconds);\n  }\n\n  abort() {\n    this.isAborted = true;\n  }\n\n  dispose() {\n    this.log('DISPOSE');\n    this.subscriptions.forEach(x => x.unsubscribe());\n  }\n\n  log(...args: Parameters<Console['log']>) {\n    this.checkNotAborted();\n\n    if (this.isPrintingLogs) {\n      console.log(`[${this.name}]`, ...args);\n    }\n  }\n\n  protected checkNotAborted() {\n    if (this.isAborted) {\n      throw new ExecutionAbortedError();\n    }\n  }\n}\n","export class ExecutionAbortedError extends Error {}\n","export function bindAll<T extends {}>(\n  target: T,\n  source: { new (...args: any[]): T },\n) {\n  const proto = source.prototype;\n  const keys = Object.getOwnPropertyNames(proto) as (keyof T)[];\n\n  keys\n    .filter(key => {\n      const descriptor = Object.getOwnPropertyDescriptor(proto, key)!;\n      return typeof descriptor.value === 'function';\n    })\n    .forEach(method => {\n      target[method] = (target[method] as any).bind(target);\n    });\n}\n","import { emitter } from '@amatiasq/emitter';\n\nimport { Mud } from './lib/Mud';\nimport { RemoteTelnet } from './lib/RemoteTelnet';\nimport { registerWorkflows } from './registerWorkflows';\nimport { socket } from './socket';\nimport { renderUserInterface } from './ui';\nimport { getPassword } from './util/getPassword';\nimport { getQueryParams } from './util/getQueryParams';\n\nconst { user, server } = getQueryParams();\nconst [host, port] = server.split(':');\nconst pass = getPassword(user);\n\nconst { terminal, controls } = renderUserInterface(document.body);\nconst telnet = new RemoteTelnet(socket);\n\nterminal.write(`Connecting to ${host}:${port} as ${user}\\n`);\ntelnet.onConnected(initializeMud);\ntelnet.onData(data => terminal.write(data));\n\nsocket.onConnected(() => {\n  telnet.connect({ host, port: parseInt(port) });\n  terminal.onSubmit(value => {\n    terminal.write(`${value}\\n`);\n    telnet.send(value);\n  });\n\n  window.onbeforeunload = () => {\n    if (telnet.isConnected) {\n      telnet.send('abandonar');\n    }\n\n    telnet.close();\n  };\n});\n\nasync function initializeMud() {\n  const mud = new Mud(telnet);\n  mud.onCommand(x => terminal.write(`${x}\\n`));\n\n  terminal.onSubmit(command => mud.userInput(command));\n\n  await mud.login(user, pass);\n  registerWorkflows(mud);\n  await connectStats();\n  connectButtons();\n\n  Object.assign(window, { mud });\n\n  async function connectStats() {\n    const hp = emitter<number>();\n    controls.addMeter('red', hp.subscribe);\n\n    const mana = emitter<number>();\n    controls.addMeter('blue', mana.subscribe);\n\n    const mv = emitter<number>();\n    controls.addMeter('green', mv.subscribe);\n\n    mud.getPlugin('prompt').onUpdate(x => {\n      hp(x.hp.percent);\n      mana(x.mana.percent);\n      mv(x.mv.percent);\n    });\n  }\n\n  function connectButtons() {\n    controls.addButton('Entrenar', () => mud.invokeWorkflow('train'));\n  }\n}\n","import { emitter } from '@amatiasq/emitter';\n\nimport { initializePlugins, PluginMap } from '../plugins/index';\nimport { login } from '../plugins/login';\nimport { PluginContext } from './PluginContext';\nimport { RemoteTelnet } from './RemoteTelnet';\nimport { TriggerCollection } from './triggers/TriggerCollection';\nimport { Context } from './workflow/Context';\nimport { InvokeOptions } from './workflow/InvokeOptions';\nimport { Workflow } from './workflow/Workflow';\nimport { WorkflowNotFoundError } from './workflow/WorkflowNotFoundError';\n\nexport class Mud {\n  private readonly triggers = new TriggerCollection();\n  private readonly workflows: Record<string, Workflow> = {};\n  private plugins!: PluginMap;\n  private username!: string;\n\n  private readonly emitCommand = emitter<string>();\n  readonly onCommand = this.emitCommand.subscribe;\n\n  private emitLoggedIn!: (usernamne: string) => void;\n  readonly whenLoggedIn = new Promise(resolve => (this.emitLoggedIn = resolve));\n\n  constructor(private readonly telnet: RemoteTelnet) {\n    this.send = this.send.bind(this);\n    this.invokeWorkflow = this.invokeWorkflow.bind(this);\n    this.telnet.onData(x => this.triggers.process(removeNoise(x)));\n  }\n\n  async login(user: string, pass: string) {\n    const context = new PluginContext('login', 'N/A', this.triggers, this.send);\n\n    await login(context, user, pass, async () => {\n      this.plugins = await initializePlugins(\n        name => new PluginContext(name, user, this.triggers, this.send),\n      );\n    });\n\n    context.dispose();\n    this.username = user;\n    this.emitLoggedIn(user);\n  }\n\n  send(text: string) {\n    this.emitCommand(text);\n    this.telnet.send(text);\n  }\n\n  userInput(command: string): void {}\n\n  getPlugin<Name extends keyof PluginMap>(name: Name): PluginMap[Name] {\n    return this.plugins[name];\n  }\n\n  runWorkflow<Args extends any[]>(\n    run: (context: Context, ...args: Args) => Promise<any> | void,\n    params?: Args,\n    options?: InvokeOptions,\n  ) {\n    const workflow = new Workflow(run);\n    return this.executeWorkflow(\n      workflow as Workflow<any, any>,\n      params,\n      options,\n    );\n  }\n\n  registerWorkflow<Args extends any[]>(\n    run: (context: Context, ...args: Args) => Promise<any> | void,\n  ) {\n    const workflow = new Workflow(run);\n    this.workflows[workflow.name] = workflow as Workflow<any, any>;\n    return workflow;\n  }\n\n  invokeWorkflow(name: string, params?: any[], options?: InvokeOptions) {\n    if (!(name in this.workflows)) {\n      throw new WorkflowNotFoundError(`Workflow ${name} is not registered.`);\n    }\n\n    const workflow = this.workflows[name];\n    return this.executeWorkflow(workflow, params, options);\n  }\n\n  private executeWorkflow(\n    workflow: Workflow,\n    params: any[] = [],\n    { logs }: InvokeOptions = {},\n  ) {\n    const context = this.createWorkflowContext(workflow.name);\n\n    if (logs) {\n      context.printLogs;\n    }\n\n    const promise = workflow.execute(context, ...params).then(result => {\n      context.dispose();\n      return result;\n    });\n\n    return Object.assign(promise, {\n      abort() {\n        context.abort();\n      },\n    });\n  }\n\n  private createWorkflowContext(name: string): Context {\n    return new Context(\n      name,\n      this.username,\n      this.triggers,\n      this.plugins,\n      this.send,\n      this.invokeWorkflow,\n    );\n  }\n}\n\nfunction removeNoise(text: string) {\n  return removeAsciiCodes(text).replace(/\\r/g, '');\n}\n\nfunction removeAsciiCodes(text: string) {\n  return text.replace(/\\u001b\\[.*?m/g, '');\n}\n","import { PluginContext } from '../lib/PluginContext';\nimport { chatPlugin } from './chatPlugin';\nimport { inventoryPlugin } from './inventoryPlugin';\nimport { navigationPlugin } from './navigationPlugin';\nimport { promptPlugin } from './promptPlugin';\nimport { skillsPlugin } from './skillsPlugin';\n\nconst plugins = {\n  chat: chatPlugin,\n  inventory: inventoryPlugin,\n  navigation: navigationPlugin,\n  prompt: promptPlugin,\n  skills: skillsPlugin,\n};\n\n// -- Dirty implementation\n\ntype plugins = typeof plugins;\ntype UnPromisify<T> = T extends Promise<infer U> ? U : T;\n\nexport type PluginMap = {\n  [name in keyof plugins]: UnPromisify<ReturnType<plugins[name]>>;\n};\n\nexport async function initializePlugins(\n  context: (name: string) => PluginContext,\n) {\n  const promises = Object.entries(plugins).map(async ([name, plugin]) => [\n    name,\n    await plugin(context(name)),\n  ]);\n\n  const entries = await Promise.all(promises);\n  return Object.fromEntries(entries) as PluginMap;\n}\n","import { ClientStorage } from '@amatiasq/client-storage';\n\nimport { PluginContext } from '../lib/PluginContext';\nimport { PatternResult } from '../lib/triggers/PatternResult';\nimport { requestNotificationPermission } from '../lib/util/requestNotificationPermission';\n\ninterface Message {\n  time: number;\n  from: string;\n  to: string;\n  message: string;\n}\n\ntype History = ClientStorage<Record<string, Message[]>>;\n\nexport function chatPlugin({ when }: PluginContext) {\n  // const say = new ClientStorage<Record<string, Message[]>>('chat:say');\n  const tell = new ClientStorage<Record<string, Message[]>>('chat:tell');\n  const whisper = new ClientStorage<Record<string, Message[]>>('chat:whisper');\n\n  when(/(?<name>.+) te susurra '(?<message>[^']+)'/, receive(whisper));\n  when(/Susurras a (?<name>.+) '(?<message>[^']+)'/, sent(whisper));\n\n  when(\n    [\n      /(?<name>.+) te cuenta '(?<message>[^']+)'/,\n      /(?<name>.+) te responde '(?<message>[^']+)'/,\n    ],\n    receive(tell),\n  );\n\n  when(\n    [\n      /Cuentas a (?<name>.+) '(?<message>[^']+)'/,\n      /Respondes a (?<name>.+) '(?<message>[^']+)'/,\n    ],\n    sent(tell),\n  );\n}\n\ntype msg = { message: string };\n\nfunction receive(log: History) {\n  return ({ groups: { name, message } }: PatternResult) => {\n    addMessage(log, { from: name, message });\n    notify(name, message);\n  };\n}\n\nfunction sent(log: History) {\n  return ({ groups: { name, message } }: PatternResult) =>\n    addMessage(log, { to: name, message });\n}\n\nasync function notify(from: string, message: string) {\n  await requestNotificationPermission();\n  return new Notification(`${name} te cuenta '${message}'`);\n}\n\nfunction addMessage(log: History, partial: { from: string } & msg): Message;\nfunction addMessage(log: History, partial: { to: string } & msg): Message;\nfunction addMessage(\n  log: History,\n  partial: { from?: string; to?: string } & msg,\n): Message {\n  const message: Message = {\n    time: Date.now(),\n    from: 'me',\n    to: 'me',\n    ...partial,\n  };\n\n  const data = log.get() || {};\n  const other = (partial.from || partial.to)!;\n  const history = data[other] || [];\n\n  history.push(message);\n  log.set({ ...data, [other]: history });\n  return message;\n}\n","export function requestNotificationPermission() {\n  if (!('Notification' in window)) {\n    console.warn('This browser does not support desktop notification');\n    return;\n  }\n\n  if (Notification.permission === 'granted') {\n    return Promise.resolve(true);\n  }\n\n  if (Notification.permission === 'denied') {\n    return;\n  }\n\n  return Notification.requestPermission().then(x => x === 'granted');\n}\n","import { PluginContext } from '../lib/PluginContext';\n\nconst INVENTORY_DETECTOR = /Estas llevando:(\\n.*)+?\\n\\n/;\n\nexport function inventoryPlugin({ when, write }: PluginContext) {\n  let isInitialized = false;\n  let items: string[] = [];\n\n  when('No tienes ese objeto.', refresh);\n\n  when(\n    INVENTORY_DETECTOR,\n    ({ captured }) => {\n      const [_, ...inventory] = captured[0]\n        .split('\\n')\n        .map(x => x.trim())\n        .filter(Boolean);\n\n      isInitialized = true;\n      items = inventory;\n    },\n    { captureLength: 1000 },\n  );\n\n  return { refresh, has };\n\n  async function refresh() {\n    write('inventario');\n    await when(INVENTORY_DETECTOR);\n  }\n\n  async function has(search: string | string[] | Record<string, string>) {\n    if (!isInitialized) {\n      await refresh();\n    }\n\n    if (typeof search === 'string') {\n      return items.find(x => x === search);\n    }\n\n    if (Array.isArray(search)) {\n      return items.find(x => search.includes(x));\n    }\n\n    const found = items.find(x => x in search);\n    return found && search[found];\n  }\n}\n","import { emitter } from '@amatiasq/emitter';\n\nimport { PluginContext } from '../lib/PluginContext';\nimport { PatternPromise } from '../lib/triggers/PatternPromise';\nimport { PROMPT_DETECTOR } from './promptPlugin';\n\nconst aliases = {\n  s: 'sur',\n  n: 'norte',\n  e: 'este',\n  w: 'oeste',\n  o: 'oeste',\n  u: 'arriba',\n  d: 'abajo',\n  l: 'sureste',\n  k: 'suroeste',\n  j: 'noreste',\n  h: 'noroeste',\n};\n\nexport function navigationPlugin({ when, write }: PluginContext) {\n  let isNavigating = false;\n  let landingAtRecall = false;\n  let isAtRecall = false;\n  let directions: string[] = [];\n\n  const prompt = () => when(PROMPT_DETECTOR);\n  const roomChanged = emitter<string[]>();\n\n  when('Plaza de Darkhaven', () => (landingAtRecall = true));\n\n  when(/\\nSalidas: ([^\\.]+)/, async ({ captured }) => {\n    directions = captured[1].split(' ');\n    isNavigating = false;\n    isAtRecall = landingAtRecall;\n    landingAtRecall = false;\n    await prompt();\n    roomChanged(directions);\n  });\n\n  return {\n    canGo,\n    go,\n    execute,\n    recall,\n    waitForRecall,\n    onRoomChange: roomChanged.subscribe,\n\n    get isNavigating() {\n      return isNavigating;\n    },\n\n    get isAtRecall() {\n      return isAtRecall;\n    },\n  };\n\n  async function recall() {\n    if (isAtRecall) {\n      return Promise.resolve();\n    }\n\n    write('recall');\n    await when('Plaza de Darkhaven');\n    await prompt();\n  }\n\n  function waitForRecall() {\n    if (isAtRecall) {\n      return new PatternPromise(resolve => resolve());\n    }\n\n    return when('Plaza de Darkhaven');\n  }\n\n  function canGo(direction: string) {\n    return Boolean(get(direction));\n  }\n\n  function isClosed(direction: string) {\n    const dir = get(direction);\n    return dir && dir.includes('(cerrada)');\n  }\n\n  async function execute(pattern: string) {\n    if (pattern[0] === 'r') {\n      await recall();\n      pattern = pattern.substr(1);\n    }\n\n    for (const step of parsePath(pattern)) {\n      await go(step);\n    }\n  }\n\n  async function go(direction: string) {\n    if (isNavigating) {\n      throw new Error('WTF DUDE');\n    }\n\n    if (direction in aliases) {\n      direction = aliases[direction as keyof typeof aliases];\n    }\n\n    const dir = get(direction);\n\n    if (!dir) {\n      throw new Error(`Unknown direction '${direction}'`);\n    }\n\n    if (isClosed(direction)) {\n      write(`abrir ${direction}`);\n      await when('Abres la puerta.');\n    }\n\n    write(direction);\n    isNavigating = true;\n\n    await when('\\nSalidas:');\n    await prompt();\n  }\n\n  function get(direction: string) {\n    return directions.find(x => x.startsWith(direction));\n  }\n}\n\nfunction parsePath(path: string) {\n  return path.replace(/(\\d+)(\\w)/g, (_, times, dir) => dir.repeat(times));\n}\n","export class PatternPromiseTimeoutError extends Error {}\n","import { PluginContext } from '../lib/PluginContext';\nimport { concatRegexes } from '../lib/util/concatRegexes';\n\nconst SKILL = /((?:\\w+ )+)\\s+(\\d+)%/g;\nconst SKILLS_DETECTOR = concatRegexes(\n  /-+\\[(\\w+)\\]-+\\n/,\n  /(.|\\n)+/,\n  /Te quedan \\d+ practicas.\\n/,\n  /Tienes \\d+ entrenamientos.\\n/,\n);\n\nexport function skillsPlugin({ when, write }: PluginContext) {\n  let isInitialized = false;\n  let skills: Record<string, number> = {};\n\n  when(\n    SKILLS_DETECTOR,\n    ({ captured: [content] }) => {\n      isInitialized = true;\n\n      for (const skill of content.matchAll(SKILL)!) {\n        skills[skill[1].trim()] = parseInt(skill[2], 10);\n      }\n\n      isInitialized = true;\n    },\n    { captureLength: 3000 },\n  );\n\n  return { has, canLearn };\n\n  function refresh() {\n    write('practicar');\n    return when(SKILLS_DETECTOR);\n  }\n\n  async function has(name: string) {\n    await ensureInitiated();\n    return Boolean(skills[name]);\n  }\n\n  async function canLearn(name: string) {\n    await ensureInitiated();\n    return name in skills;\n  }\n\n  function ensureInitiated() {\n    if (!isInitialized) {\n      return refresh();\n    }\n  }\n}\n","export function concatRegexes(...regexes: (RegExp | string)[]) {\n  const join = regexes\n    .map(x => x.toString().replace(/^\\/|\\/[gi]*$/g, ''))\n    .join('');\n\n  const flags = regexes\n    .map(x => x instanceof RegExp && x.flags)\n    .filter(Boolean)\n    .join('');\n\n  const uniq = [...new Set(flags)].join('');\n  return new RegExp(join, uniq);\n}\n","import { PluginContext } from '../lib/PluginContext';\n\nexport async function login(\n  { when, write, log }: PluginContext,\n  username: string,\n  password: string,\n  initialize: () => Promise<any>,\n) {\n  write(username);\n  log('Username sent, waiting for password request');\n\n  await when('Password:');\n  write(password);\n  log(`Logged in as ${username}`);\n\n  await when('Pulsa [ENTER]');\n  write('');\n  await when('Pulsa [ENTER]');\n  write('');\n\n  // Kids don't do this at home\n  await when('Bienvenido a Balzhur...', initialize, { await: true }).once();\n}\n","import { Pattern } from './Pattern';\nimport { PatternMatcher } from './PatternMatcher';\nimport { PatternMatchSubscription } from './PatternMatchSubscription';\nimport { PatternOptions } from './PatternOptions';\nimport { PatternPromise } from './PatternPromise';\nimport { PatternResult } from './PatternResult';\n\ntype Handler = (result: PatternResult) => void;\n\nexport class TriggerCollection {\n  private readonly patterns = new Set<PatternMatcher>();\n  private readonly queue: string[] = [];\n  private isProcessing = false;\n\n  add(pattern: Pattern, options?: PatternOptions): PatternPromise;\n  add(\n    pattern: Pattern,\n    handler: (result: PatternResult) => void,\n    options?: PatternOptions,\n  ): PatternMatchSubscription;\n  add(\n    pattern: Pattern,\n    handler?: Handler | PatternOptions,\n    options?: PatternOptions,\n  ): any {\n    if (arguments.length === 1) return this.once(pattern);\n\n    if (arguments.length === 3)\n      return this.watch(pattern, handler as Handler, options);\n\n    if (typeof handler === 'function')\n      return this.watch(pattern, handler as Handler);\n\n    return this.once(pattern, handler as PatternOptions);\n  }\n\n  private watch(pattern: Pattern, handler: Handler, options?: PatternOptions) {\n    const entry = new PatternMatcher(pattern, x => handler(x), options);\n\n    this.patterns.add(entry);\n\n    const unsubscribe = () => this.patterns.delete(entry);\n\n    const once = () =>\n      new PatternPromise(resolve => {\n        const original = handler;\n\n        handler = async x => {\n          unsubscribe();\n\n          if (original) {\n            if (options && options.await) {\n              await original(x);\n            } else {\n              original(x);\n            }\n          }\n\n          resolve(x);\n        };\n      });\n\n    return { unsubscribe, once } as PatternMatchSubscription;\n  }\n\n  private once(pattern: Pattern, options?: PatternOptions) {\n    return new PatternPromise(resolve => {\n      const sub = this.add(pattern, handler, options);\n\n      function handler(result: PatternResult) {\n        sub.unsubscribe();\n        resolve(result);\n      }\n    });\n  }\n\n  async process(text: string): Promise<void> {\n    if (this.isProcessing) {\n      this.queue.push(text);\n      return;\n    }\n\n    this.isProcessing = true;\n\n    const splitted = text.split('\\n');\n    const last = splitted.pop() as string;\n    const lines = [...splitted.map(x => `${x}\\n`), last];\n\n    for (const line of lines) {\n      // console.log('PROCESS', line);\n      for (const pattern of this.patterns) {\n        await pattern.process(line);\n      }\n    }\n\n    this.isProcessing = false;\n\n    if (this.queue.length) {\n      return this.process(this.queue.pop()!);\n    }\n  }\n}\n","import { trimEnd } from '../util/trimEnd';\nimport { Pattern, SinglePattern } from './Pattern';\nimport { PatternOptions } from './PatternOptions';\nimport { PatternResult } from './PatternResult';\n\nexport class PatternMatcher {\n  private readonly patterns: SinglePattern[];\n  private readonly buffer;\n  readonly length;\n\n  constructor(\n    pattern: Pattern,\n    private readonly handler: (result: PatternResult) => void,\n    private readonly options: PatternOptions = {},\n  ) {\n    this.patterns = Array.isArray(pattern) ? pattern : [pattern];\n    this.length =\n      options.captureLength ||\n      Math.max(...this.patterns.map(x => String(x).length)) * 10;\n\n    this.buffer = buffer(this.length);\n  }\n\n  process(text: string) {\n    const value = this.buffer(text);\n    const matching = this.patterns.filter(pattern =>\n      this.testPattern(value, pattern),\n    );\n\n    if (!matching.length) {\n      return;\n    }\n\n    this.buffer.clear();\n    const result = new PatternResult(matching, value);\n    const output = this.handler(result);\n    return this.options.await ? output : null;\n  }\n\n  private testPattern(text: string, pattern: SinglePattern) {\n    if (typeof pattern === 'string') {\n      return text.indexOf(pattern) > -1;\n    }\n\n    return pattern.test(text);\n  }\n}\n\nfunction buffer(length: number) {\n  let value = '';\n  const clear = () => (value = '');\n  const add = (text: string) => (value = trimEnd(`${value}${text}`, length));\n  return Object.assign(add, { clear });\n}\n","export function trimEnd(value: string, maxLength: number) {\n  return value.length > maxLength\n    ? value.substr(value.length - maxLength)\n    : value;\n}\n","import { SinglePattern } from './Pattern';\n\nexport class PatternResult {\n  private get regexes() {\n    return this.patterns.filter(isRegex);\n  }\n\n  private get stringPatterns() {\n    return this.patterns.filter(x => !isRegex(x));\n  }\n\n  get captured() {\n    const regexMatches = this.regexes\n      .map(x => this.haystack.match(x)!)\n      .filter(Boolean)\n      .map(x => Array.from(x));\n\n    // TODO: maybe return the one with more captures?\n    return regexMatches[0];\n  }\n\n  get groups(): Record<string, string> {\n    return this.regexes\n      .map(x => this.haystack.match(x)!)\n      .filter(Boolean)\n      .map(x => x.groups!)\n      .filter(Boolean)\n      .reduce(merge, {});\n  }\n\n  constructor(\n    readonly patterns: SinglePattern[],\n    private readonly haystack: string,\n  ) {}\n}\n\nfunction isRegex(value: SinglePattern) {\n  return value instanceof RegExp;\n}\n\nfunction merge(a: object, b: object) {\n  return { ...a, ...b };\n}\n","import { PluginMap } from '../../plugins/index';\nimport { ExecutionAbortedError } from '../ExecutionAbortedError';\nimport { Mud } from '../Mud';\nimport { PluginContext } from '../PluginContext';\nimport { TriggerCollection } from '../triggers/TriggerCollection';\nimport { bindAll } from '../util/bindAll';\nimport { MissingPluginError } from './MissingPluginError';\n\nexport class Context extends PluginContext {\n  private finish: ((reason: any) => void) | null = null;\n\n  readonly plugins: PluginMap;\n\n  constructor(\n    name: string,\n    username: string,\n    triggers: TriggerCollection,\n    plugins: PluginMap,\n    send: (command: string) => void,\n    private readonly runWorkflow: Mud['invokeWorkflow'],\n  ) {\n    super(`W(${name})`, username, triggers, send);\n    this.plugins = createPluginsGetter(plugins, this.log.bind(this));\n\n    bindAll(this, Context);\n  }\n\n  invokeWorkflow<T>(name: string, params: any[] = []) {\n    this.checkNotAborted();\n    this.log(`Invoke workflow ${name} with`, ...params);\n    return this.runWorkflow(name, params, { logs: this.isPrintingLogs });\n  }\n\n  runForever() {\n    return new Promise(resolve => (this.finish = resolve));\n  }\n\n  abort() {\n    super.abort();\n\n    if (this.finish) {\n      this.finish(new ExecutionAbortedError());\n    }\n  }\n}\n\nfunction createPluginsGetter(source: PluginMap, log: Function) {\n  return new Proxy(source, {\n    get(target, key: string) {\n      if (!(key in target)) {\n        log(`Failed to get plugin ${key}`);\n        throw new MissingPluginError(`Plugin ${key} is not registered.`);\n      }\n\n      log(`Requires plugin ${key}`);\n      return target[key as keyof typeof target];\n    },\n  });\n}\n","export class MissingPluginError extends Error {}\n","import { Context } from './Context';\n\nexport class Workflow<Args extends any[] = any[], Return = any> {\n  private executionCount = 0;\n  private currentExecutions = 0;\n\n  get isRunning() {\n    return this.currentExecutions > 0;\n  }\n\n  get timesExecuted() {\n    return this.executionCount;\n  }\n\n  get name() {\n    return this.run.name;\n  }\n\n  constructor(\n    private readonly run: (\n      context: Context,\n      ...args: Args\n    ) => Promise<Return> | void,\n  ) {}\n\n  async execute(context: Context, ...args: Args) {\n    this.currentExecutions++;\n    const iteration = this.executionCount++;\n\n    context.log(`[Exe(${iteration})]`, ...args);\n\n    try {\n      const result = await this.run(context, ...args);\n      context.log(`[Res(${iteration}]`, result);\n      return result;\n    } catch (error) {\n      context.log(`[ERR(${iteration})]`, error);\n      throw error;\n    } finally {\n      this.currentExecutions--;\n    }\n  }\n}\n","export class WorkflowNotFoundError extends Error {}\n","import { emitter } from '@amatiasq/emitter';\nimport { ClientSocket } from '@amatiasq/socket';\n\nimport { ClientMessage } from '../../../shared/ClientMessage';\nimport { ServerMessage } from '../../../shared/ServerMessage';\n\nexport class RemoteTelnet {\n  private _isConnected = false;\n\n  get isConnected() {\n    return this._isConnected;\n  }\n\n  private readonly emitConnected = emitter();\n  readonly onConnected = this.emitConnected.subscribe;\n\n  private readonly emitClose = emitter();\n  readonly onClose = this.emitClose.subscribe;\n\n  private readonly emitData = emitter<string>();\n  readonly onData = this.emitData.subscribe;\n\n  constructor(\n    private readonly socket: ClientSocket<ClientMessage, ServerMessage>,\n  ) {\n    socket.onMessageType('CONNECTED', this.emitConnected);\n    socket.onMessageType('DISCONNECTED', this.emitClose);\n    socket.onMessageType('OUTPUT', this.emitData);\n\n    this.onConnected(() => (this._isConnected = true));\n    this.onClose(() => (this._isConnected = false));\n  }\n\n  connect(options: { host: string; port: number }) {\n    this.socket.send('OPEN', options);\n  }\n\n  send(value: string) {\n    this.socket.send('INPUT', value);\n  }\n\n  close() {\n    this.socket.close();\n  }\n}\n","import { Mud } from './lib/Mud';\nimport { dope } from './workflows/dope';\nimport { drink } from './workflows/drink';\nimport { eat } from './workflows/eat';\nimport { fight } from './workflows/fight';\nimport { idle } from './workflows/idle';\nimport { rest } from './workflows/rest';\nimport { train } from './workflows/train';\n\nexport function registerWorkflows(mud: Mud) {\n  mud.registerWorkflow(fight);\n  mud.registerWorkflow(train);\n\n  mud.runWorkflow(dope);\n  mud.runWorkflow(drink);\n  mud.runWorkflow(eat);\n  mud.runWorkflow(idle);\n  mud.runWorkflow(rest);\n}\n","import { Context } from './../lib/workflow/Context';\n\nexport async function dope({\n  write,\n  runForever,\n  plugins: { prompt, skills },\n}: Context) {\n  const defineShould = (min: number) => {\n    const operator = 1 + 1 / ((1 - min) / min);\n    return (stat: number, mana: number) => {\n      const inverse = (1 - stat) * operator;\n      return Math.hypot(inverse, mana) > 1;\n    };\n  };\n\n  const shouldHeal = defineShould(0.2);\n  // const shouldRefresh = defineShould(0.2);\n\n  prompt.onUpdate(\n    async ({\n      isFighting,\n      hp: { percent: hp },\n      mana: { percent: mana },\n      // mv: { percent: mv },\n    }) => {\n      if (isFighting || mana === 0) {\n        return;\n      }\n\n      if (hp < 1 && shouldHeal(hp, mana)) {\n        if (await skills.has('curar leves')) {\n          write('c \"curar leves\"');\n          return;\n        }\n      }\n\n      // else if (mv < 1 && shouldRefresh(mv, mana)) {\n      //   write('c refrescar');\n      // }\n    },\n  );\n\n  await runForever();\n}\n","import { Context } from './../lib/workflow/Context';\n\nexport async function drink({\n  when,\n  write,\n  runForever,\n  plugins: { inventory, navigation, skills },\n}: Context) {\n  let isFontAvailable = false;\n  let isBottleFull = false;\n\n  navigation.onRoomChange(() => (isFontAvailable = false));\n\n  when(\n    [\n      'Un manantial magico esta aqui.',\n      'Una hermosa fuente de marmol blanco esta aqui.',\n    ],\n    async () => {\n      isFontAvailable = true;\n\n      if (!isBottleFull) {\n        const bottle = await getWaterBottle();\n\n        if (bottle) {\n          write(`llenar ${bottle}`);\n          isBottleFull = true;\n        }\n      }\n    },\n  );\n\n  when(\n    [\n      'Te apetece dar un sorbo a algo refrescante.',\n      'Tienes sed.',\n      // 'Estas sediento.',\n      'Estas realmente sediento.',\n      'Estas MUERTO de SED!',\n      'Estas en peligro de deshidratacion.',\n    ],\n    async () => {\n      if (isFontAvailable) {\n        write('beber');\n        return;\n      }\n\n      const bottle = await getWaterBottle();\n\n      if (!bottle) {\n        console.log('No hay fuente de agua');\n        return;\n      }\n\n      write(`beber ${bottle}`);\n\n      if (await skills.has('crear agua')) {\n        write(`c \"crear agua\" ${bottle}`);\n      }\n    },\n  );\n\n  await runForever();\n\n  async function getWaterBottle() {\n    return inventory.has({\n      'un odre de cuero': 'odre',\n      'una cantimplora': 'cantimplora',\n    });\n  }\n}\n","import { wait } from '../lib/util/wait';\nimport { Context } from './../lib/workflow/Context';\n\nexport async function eat({\n  when,\n  write,\n  runForever,\n  plugins: { inventory, navigation: nav },\n}: Context) {\n  const EXPECTED_FOOD = 1;\n  const DEFAULT_FOOD_NAME = 'chuleta';\n  let foodInInventory = 0;\n\n  when(['Tienes hambre.', 'Estas realmente hambriento.'], eatSomething);\n\n  when(['Estas terriblemente hambriento.', 'Estas HAMBRIENTO!'], async () => {\n    console.log('hungry');\n\n    if (await eatSomething()) {\n      return;\n    }\n\n    await buyFood();\n    await eatSomething();\n  });\n\n  await runForever();\n\n  async function eatSomething() {\n    console.log('eatSomething');\n\n    const food = await getFood();\n    if (!food) return false;\n\n    write(`comer ${food}`);\n    inventory.refresh();\n    return true;\n  }\n\n  async function buyFood() {\n    await nav.recall();\n    await nav.execute('2sen');\n\n    write(`comprar ${EXPECTED_FOOD - foodInInventory} ${DEFAULT_FOOD_NAME}`);\n    await when('El carnicero pone todo en una bolsa y te la da.');\n    await getFoodFromBag();\n    await nav.execute('sw2n');\n  }\n\n  async function getFood() {\n    await getFoodFromBag();\n\n    return await inventory.has({\n      'un chorizo': 'chorizo',\n      'pavo cocinado': 'pavo',\n      'una chuleta de cordero': 'chuleta',\n      'loncha de salami': 'salami',\n      'pierna de cordero': 'pierna',\n      'ricas longanizas': 'longanizas',\n    });\n  }\n\n  async function getFoodFromBag() {\n    if (await inventory.has('una bolsa')) {\n      write('coger todo bolsa');\n      write('examinar bolsa');\n\n      const { captured } = await when(/Una bolsa contiene:\\n\\s+(Nada)?/);\n      if (captured[1]) {\n        write('tirar bolsa');\n      }\n    }\n  }\n}\n","import { Context } from '../lib/workflow/Context';\n\nexport async function fight(\n  { when, write, plugins: { prompt, navigation } }: Context,\n  target: string,\n) {\n  when('Estas demasiado exhausto para huir del combate!', () =>\n    navigation.recall(),\n  );\n\n  when(\n    [\n      new RegExp(`Tu (?<attack>\\\\w+) (?<effect>\\\\w+) a( |\\\\w)+ ${target}.`),\n      new RegExp(`El ataque de( |\\\\w)+ ${target} te (?<effect>\\w+).`),\n    ],\n    update,\n  );\n\n  // if causar graves\n  // if causar leves\n  write(`kill ${target}`);\n\n  return Promise.any([\n    navigation.waitForRecall().then(() => 'flee'),\n    when(`${target} ha MUERTO!!`).then(() => 'win'),\n    when('Huyes como un cobarde del combate.').then(() => 'flee'),\n    when('No esta aqui.')\n      .timeout(3)\n      .then(() => 'missing'),\n  ]);\n\n  async function update() {\n    if (prompt.isInDanger) {\n      await navigation.recall();\n    } else if (prompt.isExhausted || prompt.needsHospital) {\n      write('huir');\n    }\n  }\n}\n","import { Context } from './../lib/workflow/Context';\n\nexport async function idle({\n  when,\n  write,\n  invokeWorkflow,\n  runForever,\n  plugins: { navigation },\n}: Context) {\n  when('Desapareces en la nada.', () => {\n    console.log('IDLE');\n    if (navigation.isAtRecall) {\n      invokeWorkflow('train');\n    } else {\n      write('estado');\n    }\n  });\n\n  await runForever();\n}\n","import { Context } from './../lib/workflow/Context';\n\nexport async function rest({ when, write, runForever }: Context) {\n  when(\n    [\n      'Nah... Estas demasiado relajado...',\n      'En tus suenyos o que?',\n      'Estas demasiado relajado para lanzar ese conjuro.',\n    ],\n    () => write('despertar'),\n  );\n\n  await runForever();\n}\n","import { Context } from './../lib/workflow/Context';\n\nexport async function train({\n  when,\n  invokeWorkflow,\n  plugins: { navigation: nav },\n}: Context) {\n  const enemies: string[] = [];\n  let direction = 'sur';\n\n  await nav.recall();\n  await nav.go('abajo');\n\n  const enemySpotted = (prey: string) => () => enemies.push(prey);\n  const enemyGone = (prey: string) => () => {\n    const index = enemies.indexOf(prey);\n    if (index > -1) {\n      enemies.splice(index, 1);\n    }\n  };\n\n  when(\n    [\n      'Un pequenyo caracol esta aqui haciendo trompos.',\n      'El pequenyo caracol llega desde el',\n    ],\n    enemySpotted('pequenyo caracol'),\n  );\n\n  when(\n    ['Un buitre carronyero esta aqui.', 'El buitre carronyero llega desde el'],\n    enemySpotted('buitre carronyero'),\n  );\n\n  when(\n    [\n      'Un lobo hambriento te esta mirando.',\n      'El lobo hambriento llega desde el',\n    ],\n    enemySpotted('lobo hambriento'),\n  );\n\n  when(\n    [\n      'Una serpiente que parece venenosa te mira fijamente.',\n      'La serpiente llega desde el',\n    ],\n    enemySpotted('serpiente'),\n  );\n\n  when('El pequenyo caracol se va hacia el', enemyGone('pequenyo caracol'));\n  when('El buitre carronyero se va hacia el', enemyGone('buitre carronyero'));\n  when('El lobo hambriento se va hacia el', enemyGone('lobo hambriento'));\n  when('La serpiente se va hacia el', enemyGone('serpiente'));\n\n  return nextRoom();\n\n  async function nextRoom(): Promise<any> {\n    while (enemies.length) {\n      const result = await invokeWorkflow('fight', [enemies.pop()!]);\n\n      if (result === 'flee') {\n        console.log('Had to run. Train over.');\n        return nav.recall();\n      }\n    }\n\n    if (nav.canGo(direction)) {\n      await nav.go(direction);\n    } else if (nav.canGo('este')) {\n      await nav.go('este');\n      direction = direction === 'sur' ? 'norte' : 'sur';\n    } else {\n      return nav.execute('4w5nu');\n    }\n\n    return nextRoom();\n  }\n}\n","import { ClientSocket } from '@amatiasq/socket';\n\nimport { ClientMessage } from '../../shared/ClientMessage';\nimport { DEFAULT_PORT } from '../../shared/config.json';\nimport { ServerMessage } from '../../shared/ServerMessage';\n\nlet FORCE_PROD_SERVER = false;\n// FORCE_PROD_SERVER = true;\n\nconst serverUri =\n  location.origin === 'https://amatiasq.github.io' || FORCE_PROD_SERVER\n    ? 'wss://ts-socket.amatiasq.com'\n    : `ws://localhost:${DEFAULT_PORT}`;\n\nexport const socket = new ClientSocket<ClientMessage, ServerMessage>(serverUri);\n\nsocket.onMessage(x => console.debug('MESSAGE', x));\n","import { ClientStorage } from '@amatiasq/client-storage';\nimport './index.css';\n\nimport { Controls } from './Controls/Controls';\nimport { Hamburger } from './Hamburger/Hamburger';\nimport html from './index.html';\nimport { render } from './render';\nimport { Sidebar } from './Sidebar/Sidebar';\nimport { Terminal } from './Terminal/Terminal';\n\nexport function renderUserInterface(parent: HTMLElement) {\n  const state = initState();\n  const data = state.get()!;\n\n  const dom = render(html);\n  const main = dom.$('.container');\n\n  const sidebar = new Sidebar();\n  sidebar.render(main);\n\n  const controls = new Controls();\n  controls.render(main);\n\n  const terminal = new Terminal();\n  terminal.render(main);\n\n  parent.appendChild(dom);\n\n  const hamburger = new Hamburger(data.showControls);\n  hamburger.render(parent);\n\n  hamburger.onChange(x => {\n    if (x) {\n      main.classList.add('show-controls');\n      data.showControls = true;\n    } else {\n      main.classList.remove('show-controls');\n      data.showControls = false;\n    }\n\n    state.set(data);\n  });\n\n  return { controls, sidebar, terminal };\n}\n\nfunction initState() {\n  const state = new ClientStorage<{ showControls: boolean }>('ui:state');\n  const data = state.get();\n\n  if (!data) {\n    state.set({ showControls: false });\n  }\n\n  return state;\n}\n","import api from \"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n            import content from \"!!../../node_modules/css-loader/dist/cjs.js!./index.css\";\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nexport default content.locals || {};","import './Controls.css';\n\nimport { render } from '../render';\nimport html from './Controls.html';\n\ntype Observable = (listener: (data: number) => void) => void;\n\nexport class Controls {\n  private readonly dom = render(html);\n  private readonly meterTpl = this.dom.$('.meter-template')!;\n  private readonly buttonTpl = this.dom.$('.button-template')!;\n\n  render(parent: HTMLElement) {\n    parent.appendChild(this.dom);\n  }\n\n  addMeter(color: string, observable: Observable) {\n    const fragment = render(this.meterTpl, {\n      '.meter': x => {\n        x.style.setProperty('--color', color);\n        x.style.setProperty('--value', '100%');\n\n        observable(value => {\n          const percent = Math.round(value * 100);\n          x.style.setProperty('--value', `${percent}%`);\n        });\n      },\n    });\n\n    this.dom.appendChild(fragment);\n  }\n\n  addButton(name: string, onClick: () => void) {\n    const fragment = render(this.buttonTpl, {\n      button: x => {\n        x.textContent = name;\n        x.addEventListener('click', onClick);\n      },\n    });\n\n    this.dom.appendChild(fragment);\n  }\n}\n","import api from \"!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n            import content from \"!!../../../node_modules/css-loader/dist/cjs.js!./Controls.css\";\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nexport default content.locals || {};","// Module\nvar code = \"<header class=\\\"controls\\\"></header> <template class=\\\"meter-template\\\"> <div class=\\\"meter\\\" data-color=\\\"white\\\" data-value=\\\"100%\\\"> <div class=\\\"bar\\\"></div> </div> </template> <template class=\\\"button-template\\\"> <button class=\\\"ui-button\\\"></button> </template> \";\n// Exports\nmodule.exports = code;","import './Hamburger.css';\n\nimport { emitter } from '@amatiasq/emitter';\n\nimport { render } from '../render';\nimport html from './Hamburger.html';\n\nexport class Hamburger {\n  private readonly dom = render(html);\n  private readonly checkbox = this.dom.$<HTMLInputElement>('input');\n\n  private readonly emitChange = emitter<boolean>();\n  readonly onChange = this.emitChange.subscribe;\n\n  constructor(initialState = false) {\n    this.toggle = this.toggle.bind(this);\n    this.checkbox.checked = initialState;\n  }\n\n  render(parent: HTMLElement) {\n    this.checkbox.addEventListener('change', this.toggle);\n\n    parent.appendChild(this.dom);\n\n    if (this.checkbox.checked) {\n      this.toggle();\n    }\n  }\n\n  toggle() {\n    this.emitChange(this.checkbox.checked);\n  }\n}\n","import api from \"!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n            import content from \"!!../../../node_modules/css-loader/dist/cjs.js!./Hamburger.css\";\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nexport default content.locals || {};","// Module\nvar code = \"<div class=\\\"hamburger\\\"> <input type=\\\"checkbox\\\"/> <span></span> <span></span> <span></span> </div> \";\n// Exports\nmodule.exports = code;","// Module\nvar code = \"<div class=\\\"container\\\"></div> \";\n// Exports\nmodule.exports = code;","import './Sidebar.css';\n\nimport { render } from '../render';\nimport html from './Sidebar.html';\n\nexport class Sidebar {\n  private readonly dom = render(html);\n\n  render(parent: HTMLElement) {\n    parent.appendChild(this.dom);\n  }\n}\n","import api from \"!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n            import content from \"!!../../../node_modules/css-loader/dist/cjs.js!./Sidebar.css\";\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nexport default content.locals || {};","// Module\nvar code = \"<aside class=\\\"sidebar\\\"></aside> \";\n// Exports\nmodule.exports = code;","import { ClientStorage } from '@amatiasq/client-storage';\nimport './Terminal.css';\n\nimport Convert from 'ansi-to-html';\n\nimport { emitter } from '@amatiasq/emitter';\n\nimport { render } from '../render';\nimport html from './Terminal.html';\n\nconst convert = new Convert();\nconst history = new ClientStorage<string[]>('mud:command-history');\n\nexport class Terminal {\n  private readonly dom = render(html);\n  private readonly $log = this.dom.$('.log');\n  private readonly $input = this.dom.$<HTMLInputElement>('input');\n  private readonly log: string[] = [];\n  private readonly history: string[] = history.get() || [];\n  private histPos = 0;\n\n  private readonly emitSubmit = emitter<string>();\n  readonly onSubmit = this.emitSubmit.subscribe;\n\n  constructor() {\n    this.onKey = this.onKey.bind(this);\n  }\n\n  focus() {\n    this.$input.focus();\n  }\n\n  render(parent: HTMLElement) {\n    this.dom.$('.terminal').addEventListener('click', () => {\n      if (!userHasSelectedText()) {\n        this.$input.focus();\n      }\n    });\n\n    this.$input.addEventListener('keydown', this.onKey);\n    parent.appendChild(this.dom);\n  }\n\n  write(data: string) {\n    const $parent = this.$log.parentElement!;\n    const prev = this.log.length ? this.log.pop() : '';\n    const content = `${prev}${fixLineEndings(data)}`.split(/\\n\\n+/);\n    const last = content.pop()!;\n\n    for (const block of content) {\n      this.log.push(block);\n\n      const p = document.createElement('p');\n      p.innerHTML = asciiToHtml(block);\n      $parent.insertBefore(p, this.$log);\n    }\n\n    this.log.push(last);\n    this.$log.innerHTML = asciiToHtml(last);\n\n    if (!userHasSelectedText()) {\n      $parent.scrollTop = $parent.scrollHeight;\n    }\n  }\n\n  private onKey(event: KeyboardEvent) {\n    if (event.code === 'Enter') {\n      this.submit();\n    }\n\n    if (event.code === 'ArrowUp') {\n      this.loadHistory(1);\n    }\n\n    if (event.code === 'ArrowDown') {\n      this.loadHistory(-1);\n    }\n\n    this.$input.size = this.$input.value.length + 1;\n  }\n\n  private submit() {\n    const { value } = this.$input;\n    this.$input.value = '';\n\n    this.history.shift();\n    this.history.unshift(value);\n    this.history.unshift('');\n    history.set(this.history);\n    this.histPos = 0;\n\n    this.emitSubmit(value);\n  }\n\n  private loadHistory(modifier: 1 | -1) {\n    if (!this.history.length) {\n      return;\n    }\n\n    this.history[this.histPos] = this.$input.value;\n    this.histPos = clamp(this.histPos + modifier, 0, this.history.length - 1);\n    this.$input.value = this.history[this.histPos];\n  }\n}\n\nfunction asciiToHtml(text: string) {\n  const escaped = escapeHtml(text);\n  const html = convert.toHtml(escaped);\n  return html.replace(/\\n/g, '<br>');\n}\n\nfunction fixLineEndings(text: string) {\n  return text.replace(/\\r/g, '');\n}\n\nfunction escapeHtml(unsafe: string) {\n  return unsafe\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#039;')\n    .replace(/  +/g, x => '&nbsp;'.repeat(x.length));\n}\n\nfunction userHasSelectedText() {\n  const selection = getSelection();\n  return selection && selection.type === 'Range';\n}\n\nfunction clamp(value: number, min: number, max: number) {\n  return value < min ? min : value > max ? max : value;\n}\n","import api from \"!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n            import content from \"!!../../../node_modules/css-loader/dist/cjs.js!./Terminal.css\";\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nexport default content.locals || {};","// Module\nvar code = \"<main class=\\\"terminal\\\"> <span class=\\\"log\\\"></span> <input type=\\\"text\\\" size=\\\"1\\\" autofocus> </main>\";\n// Exports\nmodule.exports = code;","import { ClientStorage } from '@amatiasq/client-storage';\n\nexport function getPassword(user: string) {\n  const storage = new ClientStorage<string>(`pass:${user}`);\n  const stored = storage.get();\n\n  if (stored) {\n    return stored;\n  }\n\n  const input = prompt(`Password for ${user}`);\n\n  if (!input) {\n    throw new Error(`Password required`);\n  }\n\n  storage.set(input);\n  return input;\n}\n","export function getQueryParams() {\n  const result: { [key: string]: string } = {};\n\n  window.location.search\n    .substr(1)\n    .split('&')\n    .map(entry => entry.split('=').map(decodeURIComponent))\n    .forEach(([key, value]) => (result[key] = value));\n\n  return result;\n}\n"],"sourceRoot":""}